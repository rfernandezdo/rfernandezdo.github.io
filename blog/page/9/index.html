<!DOCTYPE html><html class="no-js" lang="en"><head>
<meta charset="utf-8">
<meta content="width=device-width,initial-scale=1" name="viewport">
<meta content="A blog about Azure, DevOps and other stuff" name="description">
<meta content="Rafael Fernández" name="author">
<link href="https://rfernandezdo.github.io/blog/page/9/" rel="canonical">
<link href="../../tags/" rel="next">
<link href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=es&amp;_x_tr_hl=es&amp;_x_tr_pto=wapp" hreflang="en" rel="alternate">
<link href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=en&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp" hreflang="es" rel="alternate">
<link href="../../../feed_rss_created.xml" rel="alternate" title="RSS feed" type="application/rss+xml">
<link href="../../../feed_rss_updated.xml" rel="alternate" title="RSS feed of updated content" type="application/rss+xml">
<link href="../../../assets/images/favicon.png" rel="icon">
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.1" name="generator">
<title>Blog - Un Rinconcito donde contar lo que quiera</title>
<link href="../../../assets/stylesheets/main.484c7ddc.min.css" rel="stylesheet">
<link href="../../../assets/stylesheets/palette.ab4e12ef.min.css" rel="stylesheet">
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet">
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<meta content="website" property="og:type">
<meta content="Blog - Un Rinconcito donde contar lo que quiera" property="og:title">
<meta content="A blog about Azure, DevOps and other stuff" property="og:description">
<meta content="https://rfernandezdo.github.io/assets/images/social/blog/page/9/index.png" property="og:image">
<meta content="image/png" property="og:image:type">
<meta content="1200" property="og:image:width">
<meta content="630" property="og:image:height">
<meta content="https://rfernandezdo.github.io/blog/page/9/" property="og:url">
<meta content="summary_large_image" property="twitter:card">
<meta content="Blog - Un Rinconcito donde contar lo que quiera" property="twitter:title">
<meta content="A blog about Azure, DevOps and other stuff" property="twitter:description">
<meta content="https://rfernandezdo.github.io/assets/images/social/blog/page/9/index.png" property="twitter:image">
<link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox">
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox">
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#blog">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Un Rinconcito donde contar lo que quiera" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="Un Rinconcito donde contar lo que quiera">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Un Rinconcito donde contar lo que quiera
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Blog
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio">
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio">
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<div class="md-header__option">
<div class="md-select">
<button aria-label="Select language" class="md-header__button md-icon">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"></path></svg>
</button>
<div class="md-select__inner">
<ul class="md-select__list">
<li class="md-select__item">
<a class="md-select__link" href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=es&amp;_x_tr_hl=es&amp;_x_tr_pto=wapp" hreflang="en">
              English
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=en&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp" hreflang="es">
              Spanish
            </a>
</li>
</ul>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text">
<label class="md-search__icon md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../">
          
  
  
  Blog

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
        
  
  
    
  
  About

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../contributions/">
        
  
  
    
  
  Contributions

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../Azure/Security/MCSB/Readme/">
          
  
  
  Azure

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../Tools/Federated_Identity_Credentials_Report/README-federated-identity-credentials/">
          
  
  
  Tools

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Un Rinconcito donde contar lo que quiera" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="Un Rinconcito donde contar lo que quiera">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Un Rinconcito donde contar lo que quiera
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox">
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
<span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox">
<a class="md-nav__link md-nav__link--active" href="../../">
<span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tags/">
<span class="md-ellipsis">
    
  
    Posts by Tags
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1_3" type="checkbox">
<label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="">
<span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_3">
<span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/12/">
<span class="md-ellipsis">
    
  
    2025/12
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/11/">
<span class="md-ellipsis">
    
  
    2025/11
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/10/">
<span class="md-ellipsis">
    
  
    2025/10
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/09/">
<span class="md-ellipsis">
    
  
    2025/09
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/08/">
<span class="md-ellipsis">
    
  
    2025/08
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/07/">
<span class="md-ellipsis">
    
  
    2025/07
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/06/">
<span class="md-ellipsis">
    
  
    2025/06
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/05/">
<span class="md-ellipsis">
    
  
    2025/05
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/04/">
<span class="md-ellipsis">
    
  
    2025/04
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/03/">
<span class="md-ellipsis">
    
  
    2025/03
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/02/">
<span class="md-ellipsis">
    
  
    2025/02
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/01/">
<span class="md-ellipsis">
    
  
    2025/01
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/12/">
<span class="md-ellipsis">
    
  
    2024/12
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/11/">
<span class="md-ellipsis">
    
  
    2024/11
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/10/">
<span class="md-ellipsis">
    
  
    2024/10
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/09/">
<span class="md-ellipsis">
    
  
    2024/09
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/06/">
<span class="md-ellipsis">
    
  
    2024/06
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/05/">
<span class="md-ellipsis">
    
  
    2024/05
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/04/">
<span class="md-ellipsis">
    
  
    2024/04
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/03/">
<span class="md-ellipsis">
    
  
    2024/03
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/02/">
<span class="md-ellipsis">
    
  
    2024/02
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2023/12/">
<span class="md-ellipsis">
    
  
    2023/12
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2023/11/">
<span class="md-ellipsis">
    
  
    2023/11
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2023/10/">
<span class="md-ellipsis">
    
  
    2023/10
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1_4" type="checkbox">
<label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="">
<span class="md-ellipsis">
    
  
    Categories
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Categories
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/azure/">
<span class="md-ellipsis">
    
  
    Azure
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/azure-ad/">
<span class="md-ellipsis">
    
  
    Azure AD
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/azure-automation/">
<span class="md-ellipsis">
    
  
    Azure Automation
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/azure-devops/">
<span class="md-ellipsis">
    
  
    Azure DevOps
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/azure-frameworks/">
<span class="md-ellipsis">
    
  
    Azure Frameworks
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/azure-governance/">
<span class="md-ellipsis">
    
  
    Azure Governance
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/azure-networking/">
<span class="md-ellipsis">
    
  
    Azure Networking
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/azure-security/">
<span class="md-ellipsis">
    
  
    Azure Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/azure-services/">
<span class="md-ellipsis">
    
  
    Azure Services
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/azure-updates/">
<span class="md-ellipsis">
    
  
    Azure Updates
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/caf/">
<span class="md-ellipsis">
    
  
    CAF
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/cicd/">
<span class="md-ellipsis">
    
  
    CI/CD
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/devops/">
<span class="md-ellipsis">
    
  
    DevOps
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/development/">
<span class="md-ellipsis">
    
  
    Development
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/drift-detection/">
<span class="md-ellipsis">
    
  
    Drift Detection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/english/">
<span class="md-ellipsis">
    
  
    English
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/enterprise-policy-as-code/">
<span class="md-ellipsis">
    
  
    Enterprise Policy as Code
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/finops/">
<span class="md-ellipsis">
    
  
    FinOps
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/firewall/">
<span class="md-ellipsis">
    
  
    Firewall
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/gtd/">
<span class="md-ellipsis">
    
  
    GTD
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/git/">
<span class="md-ellipsis">
    
  
    Git
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/github-actions/">
<span class="md-ellipsis">
    
  
    GitHub Actions
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/hashicorp/">
<span class="md-ellipsis">
    
  
    HashiCorp
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/hello_world/">
<span class="md-ellipsis">
    
  
    Hello_World
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/infrastructure-as-code/">
<span class="md-ellipsis">
    
  
    Infrastructure as Code
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/learning/">
<span class="md-ellipsis">
    
  
    Learning
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/m365/">
<span class="md-ellipsis">
    
  
    M365
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/microsoft-365/">
<span class="md-ellipsis">
    
  
    Microsoft 365
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/microsoft-entra/">
<span class="md-ellipsis">
    
  
    Microsoft Entra
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/microsoft-entra-external-id/">
<span class="md-ellipsis">
    
  
    Microsoft Entra External ID
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/microsoft-entra-id/">
<span class="md-ellipsis">
    
  
    Microsoft Entra ID
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/networking/">
<span class="md-ellipsis">
    
  
    Networking
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/outlook/">
<span class="md-ellipsis">
    
  
    Outlook
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/pim/">
<span class="md-ellipsis">
    
  
    PIM
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/power-automate/">
<span class="md-ellipsis">
    
  
    Power Automate
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/power-bi/">
<span class="md-ellipsis">
    
  
    Power BI
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/productividad/">
<span class="md-ellipsis">
    
  
    Productividad
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/productividad--microsoft-365/">
<span class="md-ellipsis">
    
  
    Productividad / Microsoft 365
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/security/">
<span class="md-ellipsis">
    
  
    Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/seguridad/">
<span class="md-ellipsis">
    
  
    Seguridad
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/snowflake/">
<span class="md-ellipsis">
    
  
    Snowflake
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/terraform/">
<span class="md-ellipsis">
    
  
    Terraform
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/threat-intelligence/">
<span class="md-ellipsis">
    
  
    Threat Intelligence
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/tools/">
<span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/troubleshooting/">
<span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/visual-studio-code/">
<span class="md-ellipsis">
    
  
    Visual Studio Code
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/viva-insights/">
<span class="md-ellipsis">
    
  
    Viva Insights
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../category/windows/">
<span class="md-ellipsis">
    
  
    Windows
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    
  
    About
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../contributions/">
<span class="md-ellipsis">
    
  
    Contributions
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox">
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Azure
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Azure
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1" type="checkbox">
<label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Security
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1_1" type="checkbox">
<label class="md-nav__link" for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
<span class="md-ellipsis">
    
  
    MCSB v1
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_1">
<span class="md-nav__icon md-icon"></span>
            
  
    MCSB v1
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Readme/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Readme
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Asset%20Management/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Asset Management
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Backup%20and%20Recovery/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Backup and Recovery
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Data%20Protection/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Data Protection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/DevOps%20Security/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - DevOps Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Endpoint%20Security/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Endpoint Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Governance%20and%20Strategy/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Governance and Strategy
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Identity%20Management/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Identity Management
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Incident%20Response/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Incident Response
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Logging%20and%20Threat%20Detection/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Logging and Threat Detection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Network%20Security/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Network Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Posture%20and%20Vulnerability%20Mgmt/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Posture and Vulnerability Mgmt
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Privileged%20Access/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Privileged Access
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1_2" type="checkbox">
<label class="md-nav__link" for="__nav_4_1_2" id="__nav_4_1_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    MCSB v2
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_2">
<span class="md-nav__icon md-icon"></span>
            
  
    MCSB v2
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Index/">
<span class="md-ellipsis">
    
  
    Microsoft Cloud Security Benchmark v2
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Network%20Security/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Network Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Identity%20Management/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Identity Management
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Privileged%20Access/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Privileged Access
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Data%20Protection/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Data Protection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Asset%20Management/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Asset Management
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Logging%20and%20Threat%20Detection/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Logging and Threat Detection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Incident%20Response/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Incident Response
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Posture%20and%20Vulnerability%20Manag/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Posture and Vulnerability Manag
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Endpoint%20Security/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Endpoint Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Backup%20and%20Recovery/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Backup and Recovery
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Artificial%20Intelligence%20Securit/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Artificial Intelligence Securit
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox">
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            
  
    Tools
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_1" type="checkbox">
<label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Federated Identity Credentials Report
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Federated Identity Credentials Report
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Tools/Federated_Identity_Credentials_Report/README-federated-identity-credentials/">
<span class="md-ellipsis">
    
  
    Script de Reporte para Federated Identity Credentials
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_2" type="checkbox">
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Analyze Virtual Network Flows
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Analyze Virtual Network Flows
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Tools/Analyze_Virtual_Network_Flows/">
<span class="md-ellipsis">
    
  
    Analyze-VNETFlowLogs
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<div class="md-content__inner">
<header class="md-typeset">
<h1 id="blog">Blog</h1>
</header>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-01-24 00:00:00+00:00">January 24, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              4 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-virtual-network-manager-a-comprehensive-guide"><a class="toclink" href="../../2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/">Azure Virtual Network Manager: A Comprehensive Guide</a></h2>
<p>Azure Virtual Network Manager is a powerful management service that allows you to group, configure, deploy, and manage virtual networks across subscriptions on a global scale. It provides the ability to define network groups for logical segmentation of your virtual networks. You can then establish connectivity and security configurations and apply them across all selected virtual networks in network groups simultaneously.</p>
<h3 id="how-does-azure-virtual-network-manager-work"><a class="toclink" href="../../2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#how-does-azure-virtual-network-manager-work">How Does Azure Virtual Network Manager Work?</a></h3>
<p>The functionality of Azure Virtual Network Manager revolves around a well-defined process:</p>
<ol>
<li>
<p><strong>Scope Definition:</strong> During the creation process, you determine the scope of what your Azure Virtual Network Manager will manage. The Network Manager only has delegated access to apply configurations within this defined scope boundary. Although you can directly define a scope on a list of subscriptions, it's recommended to use management groups for scope definition as they provide hierarchical organization to your subscriptions.</p>
</li>
<li>
<p><strong>Deployment of Configuration Types:</strong> After defining the scope, you deploy configuration types including Connectivity and SecurityAdmin rules for your Virtual Network Manager.</p>
</li>
<li>
<p><strong>Creation of Network Group:</strong> Post-deployment, you create a network group which acts as a logical container of networking resources for applying configurations at scale. You can manually select individual virtual networks to be added to your network group (static membership) or use Azure Policy to define conditions for dynamic group membership.</p>
</li>
<li>
<p><strong>Connectivity and Security Configurations:</strong> Next, you create connectivity and/or security configurations to be applied to those network groups based on your topology and security requirements. A connectivity configuration enables you to create a mesh or a hub-and-spoke network topology, while a security configuration lets you define a collection of rules that can be applied globally to one or more network groups.</p>
</li>
<li>
<p><strong>Deployment of Configurations:</strong> Once you've created your desired network groups and configurations, you can deploy the configurations to any region of your choosing.</p>
</li>
</ol>
<p>Azure Virtual Network Manager can be deployed and managed through various platforms such as the Azure portal, Azure CLI, Azure PowerShell, or Terraform.</p>
<h3 id="key-benefits-of-azure-virtual-network-manager"><a class="toclink" href="../../2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#key-benefits-of-azure-virtual-network-manager">Key Benefits of Azure Virtual Network Manager</a></h3>
<ul>
<li>Centralized management of connectivity and security policies globally across regions and subscriptions.</li>
<li>Direct connectivity between spokes in a hub-and-spoke configuration without the complexity of managing a mesh network.</li>
<li>Highly scalable and highly available service with redundancy and replication across the globe.</li>
<li>Ability to create network security rules that override network security group rules.</li>
<li>Low latency and high bandwidth between resources in different virtual networks using virtual network peering.</li>
<li>Roll out network changes through a specific region sequence and frequency of your choosing.</li>
</ul>
<h3 id="use-cases-for-azure-virtual-network-manager"><a class="toclink" href="../../2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#use-cases-for-azure-virtual-network-manager">Use Cases for Azure Virtual Network Manager</a></h3>
<p>Azure Virtual Network Manager is a versatile tool that can be used in a variety of scenarios:</p>
<ol>
<li>
<p><strong>Hub-and-Spoke Network Topology:</strong> Azure Virtual Network Manager is ideal for managing hub-and-spoke network topologies where you have a central hub virtual network that connects to multiple spoke virtual networks. You can easily create and manage these configurations at scale using Azure Virtual Network Manager.</p>
</li>
<li>
<p><strong>Global Connectivity and Security Policies:</strong> If you have a global presence with virtual networks deployed across multiple regions, Azure Virtual Network Manager allows you to define and apply connectivity and security policies globally, ensuring consistent network configurations across all regions.</p>
</li>
<li>
<p><strong>Network Segmentation and Isolation:</strong> Azure Virtual Network Manager enables you to segment and isolate your virtual networks based on your organizational requirements. You can create network groups and apply security configurations to enforce network isolation and access control.</p>
</li>
<li>
<p><strong>Centralized Network Management:</strong> For organizations with multiple subscriptions and virtual networks, Azure Virtual Network Manager provides a centralized management solution to manage network configurations, connectivity, and security policies across all subscriptions.</p>
</li>
<li>
<p><strong>Automated Network Configuration Deployment:</strong> By leveraging Azure Policy and Azure Virtual Network Manager, you can automate the deployment of network configurations based on predefined conditions, ensuring consistent network configurations and compliance across your Azure environment.</p>
</li>
</ol>
<h3 id="example-connectivity-and-security-configurations-forcing-a-network-security-rule"><a class="toclink" href="../../2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#example-connectivity-and-security-configurations-forcing-a-network-security-rule">Example connectivity and security configurations forcing a Network Security Rule</a></h3>
<p>In Azure Virtual Network Manager:</p>
<p><img alt="alt text" src="../../2025/01/image-3.png"></p>
<p>In Azure Virtual Network:</p>
<p><img alt="alt text" src="../../2025/01/image.png"></p>
<h4 id="example-connectivity-configuration-forcing-a-hub-and-spoke-network-topology"><a class="toclink" href="../../2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#example-connectivity-configuration-forcing-a-hub-and-spoke-network-topology">Example Connectivity Configuration forcing a Hub-and-Spoke Network Topology</a></h4>
<p>In Azure Virtual Network Manager:</p>
<p><img alt="alt text" src="../../2025/01/image-2.png"></p>
<p>In Azure Virtual Network:</p>
<p><img alt="alt text" src="../../2025/01/image-1.png"></p>
<h3 id="preview-features"><a class="toclink" href="../../2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#preview-features">Preview Features</a></h3>
<p>At the time of writing, Azure Virtual Network Manager has some features in preview and may not be available in all regions. Some of the preview features include:</p>
<ul>
<li>IP address management: allows you to manage IP addresses by creating and assigning IP address pools to your virtual networks.</li>
<li>
<p>Virtual Network verifier: Enables you to check if your network policies allow or disallow traffic between your Azure network resources.</p>
</li>
<li>
<p>Configurations, creation of a routing is in preview, very interesting to manage the traffic between the different networks.</p>
</li>
</ul>
<h3 id="conclusion"><a class="toclink" href="../../2025/01/24/azure-virtual-network-manager-a-comprehensive-guide/#conclusion">Conclusion</a></h3>
<p>Azure Virtual Network Manager is a powerful service that simplifies the management of virtual networks in Azure. By providing a centralized platform to define and apply connectivity and security configurations at scale, Azure Virtual Network Manager streamlines network management tasks and ensures consistent network configurations across your Azure environment.</p>
<p>For up-to-date information on the regions where Azure Virtual Network Manager is available, refer to <a href="https://azure.microsoft.com/en-us/explore/global-infrastructure/products-by-region/table">Products available by region</a>.</p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-01-22 00:00:00+00:00">January 22, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              4 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-container-registry-geo-replication-y-webhook-automation"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/">Azure Container Registry: Geo-replication y webhook automation</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#resumen">Resumen</a></h3>
<p>Azure Container Registry (ACR) no es solo un registro Docker. Con geo-replication consigues latencia mínima global y con webhooks automatizas despliegues. Aquí el setup avanzado.</p>
<h3 id="cuando-usar-acr-vs-docker-hub"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#cuando-usar-acr-vs-docker-hub">¿Cuándo usar ACR vs Docker Hub?</a></h3>
<p><strong>Usa ACR si:</strong>
- ✅ Necesitas registry privado en Azure
- ✅ Quieres integración nativa con AKS, App Service, Container Apps
- ✅ Compliance requiere datos en región específica
- ✅ Necesitas geo-replication</p>
<p><strong>Usa Docker Hub si:</strong>
- Imágenes públicas open source
- Proyectos personales sin requisitos enterprise</p>
<h3 id="crear-acr-con-premium-sku"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#crear-acr-con-premium-sku">Crear ACR con Premium SKU</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># Variables</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="nv">RG</span><span class="o">=</span><span class="s2">"my-rg"</span>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="nv">ACR_NAME</span><span class="o">=</span><span class="s2">"myacr</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="s2">"</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="nv">LOCATION</span><span class="o">=</span><span class="s2">"westeurope"</span>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a>
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="c1"># Crear ACR Premium (requerido para geo-replication)</span>
</span><span id="__span-13-7"><a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a>az<span class="w"> </span>acr<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-8"><a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-9"><a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-10"><a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">  </span>--sku<span class="w"> </span>Premium<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-11"><a href="#__codelineno-13-11" id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-12"><a href="#__codelineno-13-12" id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="w">  </span>--admin-enabled<span class="w"> </span><span class="nb">false</span>
</span></code></pre></div>
<p>SKUs disponibles:
- <strong>Basic</strong>: €4.4/mes - Sin geo-replication, webhooks limitados
- <strong>Standard</strong>: €22/mes - Webhooks, mejor throughput
- <strong>Premium</strong>: €44/mes - Geo-replication, Content Trust, Private Link</p>
<h3 id="geo-replication"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#geo-replication">Geo-replication</a></h3>
<p>Replica tu registry a múltiples regiones para:
- Reducir latencia de pull
- Alta disponibilidad
- Cumplir data residency</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># Replicar a East US</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a>az<span class="w"> </span>acr<span class="w"> </span>replication<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">  </span>--registry<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">  </span>--location<span class="w"> </span>eastus
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a>
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="c1"># Replicar a Southeast Asia</span>
</span><span id="__span-14-8"><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a>az<span class="w"> </span>acr<span class="w"> </span>replication<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-9"><a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-10"><a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">  </span>--registry<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-11"><a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">  </span>--location<span class="w"> </span>southeastasia
</span><span id="__span-14-12"><a href="#__codelineno-14-12" id="__codelineno-14-12" name="__codelineno-14-12"></a>
</span><span id="__span-14-13"><a href="#__codelineno-14-13" id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="c1"># Listar réplicas</span>
</span><span id="__span-14-14"><a href="#__codelineno-14-14" id="__codelineno-14-14" name="__codelineno-14-14"></a>az<span class="w"> </span>acr<span class="w"> </span>replication<span class="w"> </span>list<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-15"><a href="#__codelineno-14-15" id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-16"><a href="#__codelineno-14-16" id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="w">  </span>--registry<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-17"><a href="#__codelineno-14-17" id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="w">  </span>--output<span class="w"> </span>table
</span></code></pre></div>
<p>Ahora tu imagen <code>myacr.azurecr.io/app:v1</code> está disponible en 3 regiones con un solo push.</p>
<h3 id="push-de-imagenes"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#push-de-imagenes">Push de imágenes</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1"># Login a ACR</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a>az<span class="w"> </span>acr<span class="w"> </span>login<span class="w"> </span>--name<span class="w"> </span><span class="nv">$ACR_NAME</span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="c1"># Tag imagen</span>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a>docker<span class="w"> </span>tag<span class="w"> </span>my-app:latest<span class="w"> </span><span class="si">${</span><span class="nv">ACR_NAME</span><span class="si">}</span>.azurecr.io/my-app:v1.0
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a>
</span><span id="__span-15-7"><a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="c1"># Push</span>
</span><span id="__span-15-8"><a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a>docker<span class="w"> </span>push<span class="w"> </span><span class="si">${</span><span class="nv">ACR_NAME</span><span class="si">}</span>.azurecr.io/my-app:v1.0
</span><span id="__span-15-9"><a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a>
</span><span id="__span-15-10"><a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="c1"># Listar imágenes</span>
</span><span id="__span-15-11"><a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a>az<span class="w"> </span>acr<span class="w"> </span>repository<span class="w"> </span>list<span class="w"> </span>--name<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span>--output<span class="w"> </span>table
</span><span id="__span-15-12"><a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a>
</span><span id="__span-15-13"><a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="c1"># Ver tags</span>
</span><span id="__span-15-14"><a href="#__codelineno-15-14" id="__codelineno-15-14" name="__codelineno-15-14"></a>az<span class="w"> </span>acr<span class="w"> </span>repository<span class="w"> </span>show-tags<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-15"><a href="#__codelineno-15-15" id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-16"><a href="#__codelineno-15-16" id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">  </span>--repository<span class="w"> </span>my-app<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-17"><a href="#__codelineno-15-17" id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">  </span>--output<span class="w"> </span>table
</span></code></pre></div>
<h3 id="acr-tasks-build-en-azure"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#acr-tasks-build-en-azure">ACR Tasks: Build en Azure</a></h3>
<p>Build imágenes sin Docker local:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># Build desde Dockerfile en repo Git</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>az<span class="w"> </span>acr<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">  </span>--registry<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span>--image<span class="w"> </span>my-app:<span class="o">{{</span>.Run.ID<span class="o">}}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">  </span>--image<span class="w"> </span>my-app:latest<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">  </span>https://github.com/myorg/myapp.git#main
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a>
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="c1"># Build desde directorio local</span>
</span><span id="__span-16-10"><a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a>az<span class="w"> </span>acr<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-11"><a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-12"><a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">  </span>--registry<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-13"><a href="#__codelineno-16-13" id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">  </span>--image<span class="w"> </span>my-app:v1.1<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-14"><a href="#__codelineno-16-14" id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="w">  </span>.
</span></code></pre></div>
<h3 id="webhooks-para-cicd"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#webhooks-para-cicd">Webhooks para CI/CD</a></h3>
<p>Trigger despliegue automático cuando hay nuevo push:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># Crear webhook</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>az<span class="w"> </span>acr<span class="w"> </span>webhook<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">  </span>--registry<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">  </span>--name<span class="w"> </span>deployWebhook<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">  </span>--actions<span class="w"> </span>push<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">  </span>--uri<span class="w"> </span>https://my-function-app.azurewebsites.net/api/deploy<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">  </span>--scope<span class="w"> </span>my-app:*
</span></code></pre></div>
<p>Payload del webhook:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="p">{</span>
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unique-id"</span><span class="p">,</span>
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">  </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-01-22T10:00:00Z"</span><span class="p">,</span>
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">  </span><span class="nt">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"push"</span><span class="p">,</span>
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">  </span><span class="nt">"target"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">    </span><span class="nt">"mediaType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/vnd.docker.distribution.manifest.v2+json"</span><span class="p">,</span>
</span><span id="__span-18-7"><a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">    </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">1234</span><span class="p">,</span>
</span><span id="__span-18-8"><a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">    </span><span class="nt">"digest"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256:abc123..."</span><span class="p">,</span>
</span><span id="__span-18-9"><a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">    </span><span class="nt">"repository"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-app"</span><span class="p">,</span>
</span><span id="__span-18-10"><a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="w">    </span><span class="nt">"tag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v1.2"</span>
</span><span id="__span-18-11"><a href="#__codelineno-18-11" id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-18-12"><a href="#__codelineno-18-12" id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">  </span><span class="nt">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-13"><a href="#__codelineno-18-13" id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w">    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"req-id"</span><span class="p">,</span>
</span><span id="__span-18-14"><a href="#__codelineno-18-14" id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w">    </span><span class="nt">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"myacr.azurecr.io"</span><span class="p">,</span>
</span><span id="__span-18-15"><a href="#__codelineno-18-15" id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="w">    </span><span class="nt">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT"</span><span class="p">,</span>
</span><span id="__span-18-16"><a href="#__codelineno-18-16" id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="w">    </span><span class="nt">"useragent"</span><span class="p">:</span><span class="w"> </span><span class="s2">"docker/20.10.12"</span>
</span><span id="__span-18-17"><a href="#__codelineno-18-17" id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-18"><a href="#__codelineno-18-18" id="__codelineno-18-18" name="__codelineno-18-18"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="azure-function-para-auto-deploy"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#azure-function-para-auto-deploy">Azure Function para auto-deploy</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">azure.functions</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">func</span>
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-19-3"><a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
</span><span id="__span-19-4"><a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a>
</span><span id="__span-19-5"><a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">req</span><span class="p">:</span> <span class="n">func</span><span class="o">.</span><span class="n">HttpRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">func</span><span class="o">.</span><span class="n">HttpResponse</span><span class="p">:</span>
</span><span id="__span-19-6"><a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a>    <span class="c1"># Parse webhook payload</span>
</span><span id="__span-19-7"><a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a>    <span class="n">webhook_data</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
</span><span id="__span-19-8"><a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a>
</span><span id="__span-19-9"><a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a>    <span class="n">repository</span> <span class="o">=</span> <span class="n">webhook_data</span><span class="p">[</span><span class="s1">'target'</span><span class="p">][</span><span class="s1">'repository'</span><span class="p">]</span>
</span><span id="__span-19-10"><a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a>    <span class="n">tag</span> <span class="o">=</span> <span class="n">webhook_data</span><span class="p">[</span><span class="s1">'target'</span><span class="p">][</span><span class="s1">'tag'</span><span class="p">]</span>
</span><span id="__span-19-11"><a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a>    <span class="n">image</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"myacr.azurecr.io/</span><span class="si">{</span><span class="n">repository</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-19-12"><a href="#__codelineno-19-12" id="__codelineno-19-12" name="__codelineno-19-12"></a>
</span><span id="__span-19-13"><a href="#__codelineno-19-13" id="__codelineno-19-13" name="__codelineno-19-13"></a>    <span class="c1"># Trigger deployment (ejemplo: kubectl)</span>
</span><span id="__span-19-14"><a href="#__codelineno-19-14" id="__codelineno-19-14" name="__codelineno-19-14"></a>    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span>
</span><span id="__span-19-15"><a href="#__codelineno-19-15" id="__codelineno-19-15" name="__codelineno-19-15"></a>        <span class="s1">'kubectl'</span><span class="p">,</span> <span class="s1">'set'</span><span class="p">,</span> <span class="s1">'image'</span><span class="p">,</span>
</span><span id="__span-19-16"><a href="#__codelineno-19-16" id="__codelineno-19-16" name="__codelineno-19-16"></a>        <span class="s1">'deployment/my-app'</span><span class="p">,</span>
</span><span id="__span-19-17"><a href="#__codelineno-19-17" id="__codelineno-19-17" name="__codelineno-19-17"></a>        <span class="sa">f</span><span class="s1">'app=</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
</span><span id="__span-19-18"><a href="#__codelineno-19-18" id="__codelineno-19-18" name="__codelineno-19-18"></a>        <span class="s1">'--record'</span>
</span><span id="__span-19-19"><a href="#__codelineno-19-19" id="__codelineno-19-19" name="__codelineno-19-19"></a>    <span class="p">])</span>
</span><span id="__span-19-20"><a href="#__codelineno-19-20" id="__codelineno-19-20" name="__codelineno-19-20"></a>
</span><span id="__span-19-21"><a href="#__codelineno-19-21" id="__codelineno-19-21" name="__codelineno-19-21"></a>    <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">HttpResponse</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Deployed </span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="security-managed-identity"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#security-managed-identity">Security: Managed Identity</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># Asignar managed identity a AKS</span>
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="nv">AKS_PRINCIPAL_ID</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>aks<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-4"><a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">  </span>--name<span class="w"> </span>my-aks<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-5"><a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="w">  </span>--query<span class="w"> </span>identityProfile.kubeletidentity.objectId<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>
</span><span id="__span-20-6"><a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a>
</span><span id="__span-20-7"><a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="c1"># Dar permiso AcrPull</span>
</span><span id="__span-20-8"><a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a>az<span class="w"> </span>role<span class="w"> </span>assignment<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-9"><a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">  </span>--assignee<span class="w"> </span><span class="nv">$AKS_PRINCIPAL_ID</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-10"><a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">  </span>--role<span class="w"> </span>AcrPull<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-11"><a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">  </span>--scope<span class="w"> </span><span class="k">$(</span>az<span class="w"> </span>acr<span class="w"> </span>show<span class="w"> </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span>--name<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span>--query<span class="w"> </span>id<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>
</span></code></pre></div>
<p>Ahora AKS puede pullear sin passwords:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-21-3"><a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-21-4"><a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
</span><span id="__span-21-5"><a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-21-6"><a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-21-7"><a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-21-8"><a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-21-9"><a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
</span><span id="__span-21-10"><a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myacr.azurecr.io/my-app:v1.0</span>
</span><span id="__span-21-11"><a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="w">        </span><span class="c1"># No imagePullSecrets needed!</span>
</span></code></pre></div>
<h3 id="content-trust-image-signing"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#content-trust-image-signing">Content Trust (image signing)</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1"># Habilitar Content Trust</span>
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a>az<span class="w"> </span>acr<span class="w"> </span>config<span class="w"> </span>content-trust<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-3"><a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-4"><a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">  </span>--registry<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-5"><a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">  </span>--status<span class="w"> </span>enabled
</span><span id="__span-22-6"><a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a>
</span><span id="__span-22-7"><a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="c1"># Docker content trust</span>
</span><span id="__span-22-8"><a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">DOCKER_CONTENT_TRUST</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-22-9"><a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="nb">export</span><span class="w"> </span><span class="nv">DOCKER_CONTENT_TRUST_SERVER</span><span class="o">=</span>https://<span class="si">${</span><span class="nv">ACR_NAME</span><span class="si">}</span>.azurecr.io
</span><span id="__span-22-10"><a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a>
</span><span id="__span-22-11"><a href="#__codelineno-22-11" id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="c1"># Push firmado</span>
</span><span id="__span-22-12"><a href="#__codelineno-22-12" id="__codelineno-22-12" name="__codelineno-22-12"></a>docker<span class="w"> </span>push<span class="w"> </span><span class="si">${</span><span class="nv">ACR_NAME</span><span class="si">}</span>.azurecr.io/my-app:v1.0-signed
</span></code></pre></div>
<h3 id="vulnerability-scanning"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#vulnerability-scanning">Vulnerability scanning</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="c1"># Habilitar Microsoft Defender for Container Registries</span>
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a>az<span class="w"> </span>security<span class="w"> </span>pricing<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-3"><a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">  </span>--name<span class="w"> </span>ContainerRegistry<span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-4"><a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">  </span>--tier<span class="w"> </span>Standard
</span><span id="__span-23-5"><a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a>
</span><span id="__span-23-6"><a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="c1"># Ver vulnerabilidades</span>
</span><span id="__span-23-7"><a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a>az<span class="w"> </span>acr<span class="w"> </span>repository<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-8"><a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-9"><a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">  </span>--repository<span class="w"> </span>my-app<span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-10"><a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">  </span>--query<span class="w"> </span><span class="s2">"metadata.vulnerabilities"</span>
</span></code></pre></div>
<h3 id="retention-policy-cleanup-automatico"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#retention-policy-cleanup-automatico">Retention policy (cleanup automático)</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1"># Retener solo últimos 30 días</span>
</span><span id="__span-24-2"><a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a>az<span class="w"> </span>acr<span class="w"> </span>config<span class="w"> </span>retention<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-3"><a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="w">  </span>--registry<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-4"><a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">  </span>--status<span class="w"> </span>enabled<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-5"><a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">  </span>--days<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-6"><a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">  </span>--type<span class="w"> </span>UntaggedManifests
</span><span id="__span-24-7"><a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a>
</span><span id="__span-24-8"><a href="#__codelineno-24-8" id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="c1"># Borrar tags viejos manualmente</span>
</span><span id="__span-24-9"><a href="#__codelineno-24-9" id="__codelineno-24-9" name="__codelineno-24-9"></a>az<span class="w"> </span>acr<span class="w"> </span>repository<span class="w"> </span>show-tags<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-10"><a href="#__codelineno-24-10" id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-11"><a href="#__codelineno-24-11" id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="w">  </span>--repository<span class="w"> </span>my-app<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-12"><a href="#__codelineno-24-12" id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="w">  </span>--orderby<span class="w"> </span>time_asc<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-13"><a href="#__codelineno-24-13" id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="w">  </span>--output<span class="w"> </span>tsv<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-14"><a href="#__codelineno-24-14" id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-15"><a href="#__codelineno-24-15" id="__codelineno-24-15" name="__codelineno-24-15"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>az<span class="w"> </span>acr<span class="w"> </span>repository<span class="w"> </span>delete<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-16"><a href="#__codelineno-24-16" id="__codelineno-24-16" name="__codelineno-24-16"></a><span class="w">      </span>--name<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-17"><a href="#__codelineno-24-17" id="__codelineno-24-17" name="__codelineno-24-17"></a><span class="w">      </span>--image<span class="w"> </span>my-app:<span class="o">{}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-18"><a href="#__codelineno-24-18" id="__codelineno-24-18" name="__codelineno-24-18"></a><span class="w">      </span>--yes
</span></code></pre></div>
<h3 id="import-imagenes-desde-docker-hub"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#import-imagenes-desde-docker-hub">Import imágenes desde Docker Hub</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1"># Importar imagen pública</span>
</span><span id="__span-25-2"><a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a>az<span class="w"> </span>acr<span class="w"> </span>import<span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-3"><a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-4"><a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">  </span>--source<span class="w"> </span>docker.io/library/nginx:latest<span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-5"><a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="w">  </span>--image<span class="w"> </span>nginx:latest
</span><span id="__span-25-6"><a href="#__codelineno-25-6" id="__codelineno-25-6" name="__codelineno-25-6"></a>
</span><span id="__span-25-7"><a href="#__codelineno-25-7" id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="c1"># Importar desde otro ACR</span>
</span><span id="__span-25-8"><a href="#__codelineno-25-8" id="__codelineno-25-8" name="__codelineno-25-8"></a>az<span class="w"> </span>acr<span class="w"> </span>import<span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-9"><a href="#__codelineno-25-9" id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$ACR_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-10"><a href="#__codelineno-25-10" id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="w">  </span>--source<span class="w"> </span>otheracr.azurecr.io/app:v1<span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-11"><a href="#__codelineno-25-11" id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="w">  </span>--image<span class="w"> </span>app:v1<span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-12"><a href="#__codelineno-25-12" id="__codelineno-25-12" name="__codelineno-25-12"></a><span class="w">  </span>--username<span class="w"> </span>&lt;user&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-13"><a href="#__codelineno-25-13" id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="w">  </span>--password<span class="w"> </span>&lt;password&gt;
</span></code></pre></div>
<h3 id="buenas-practicas"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#buenas-practicas">Buenas prácticas</a></h3>
<ul>
<li><strong>Tagging strategy</strong>: Usa semver (<code>v1.2.3</code>) + <code>latest</code> + commit SHA</li>
<li><strong>Multi-arch images</strong>: Build para amd64 y arm64</li>
<li><strong>Scan antes de deploy</strong>: Integra vulnerability scanning en CI</li>
<li><strong>Cleanup periódico</strong>: Retención de 30-90 días</li>
<li><strong>Private endpoint</strong>: No expongas ACR a Internet</li>
<li><strong>Geo-replication</strong>: Mínimo 2 regiones para producción</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Costos</p>
<ul>
<li>Storage: €0.08/GB/mes</li>
<li>Geo-replication: €44/mes por región</li>
<li>Build minutes: €0.0008/segundo</li>
</ul>
<p>Ejemplo: ACR Premium + 50GB + 2 réplicas = ~€140/mes</p>
</div>
<h3 id="referencias"><a class="toclink" href="../../2025/01/22/azure-container-registry-geo-replication-y-webhook-automation/#referencias">Referencias</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/container-registry/">Azure Container Registry documentation</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/container-registry/container-registry-geo-replication">ACR geo-replication</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/container-registry/container-registry-webhook">ACR webhooks</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-01-18 00:00:00+00:00">January 18, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              4 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-private-dns-zones-resolucion-de-nombres-en-vnets"><a class="toclink" href="../../2025/01/18/azure-private-dns-zones-resoluci%C3%B3n-de-nombres-en-vnets/">Azure Private DNS Zones: Resolución de nombres en VNets</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/01/18/azure-private-dns-zones-resoluci%C3%B3n-de-nombres-en-vnets/#resumen">Resumen</a></h3>
<p>Private DNS Zones te permite usar nombres DNS personalizados dentro de tus VNets sin exponer nada a Internet. Esencial para arquitecturas privadas y hybrid cloud.</p>
<h3 id="que-es-private-dns-zone"><a class="toclink" href="../../2025/01/18/azure-private-dns-zones-resoluci%C3%B3n-de-nombres-en-vnets/#que-es-private-dns-zone">¿Qué es Private DNS Zone?</a></h3>
<p>Es un servicio DNS que solo resuelve dentro de VNets enlazadas. Casos de uso:</p>
<ul>
<li>Nombres personalizados para VMs privadas (<code>db01.internal.company.com</code>)</li>
<li>Private Endpoints de servicios PaaS (<code>mystorageacct.privatelink.blob.core.windows.net</code>)</li>
<li>Integración con on-premises DNS (conditional forwarding)</li>
<li>Split-horizon DNS (nombre público vs privado)</li>
</ul>
<h3 id="crear-private-dns-zone"><a class="toclink" href="../../2025/01/18/azure-private-dns-zones-resoluci%C3%B3n-de-nombres-en-vnets/#crear-private-dns-zone">Crear Private DNS Zone</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># Variables</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="nv">RG</span><span class="o">=</span><span class="s2">"my-rg"</span>
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="nv">ZONE_NAME</span><span class="o">=</span><span class="s2">"internal.company.com"</span>
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="nv">VNET_NAME</span><span class="o">=</span><span class="s2">"my-vnet"</span>
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a>
</span><span id="__span-9-6"><a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="c1"># Crear Private DNS Zone</span>
</span><span id="__span-9-7"><a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a>az<span class="w"> </span>network<span class="w"> </span>private-dns<span class="w"> </span>zone<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-8"><a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-9"><a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$ZONE_NAME</span>
</span><span id="__span-9-10"><a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a>
</span><span id="__span-9-11"><a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="c1"># Enlazar a VNet (Virtual Network Link)</span>
</span><span id="__span-9-12"><a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a>az<span class="w"> </span>network<span class="w"> </span>private-dns<span class="w"> </span>link<span class="w"> </span>vnet<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-13"><a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-14"><a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="w">  </span>--zone-name<span class="w"> </span><span class="nv">$ZONE_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-15"><a href="#__codelineno-9-15" id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="w">  </span>--name<span class="w"> </span><span class="si">${</span><span class="nv">VNET_NAME</span><span class="si">}</span>-link<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-16"><a href="#__codelineno-9-16" id="__codelineno-9-16" name="__codelineno-9-16"></a><span class="w">  </span>--virtual-network<span class="w"> </span><span class="nv">$VNET_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-17"><a href="#__codelineno-9-17" id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="w">  </span>--registration-enabled<span class="w"> </span><span class="nb">false</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Auto-registration</p>
<p>Si <code>--registration-enabled true</code>, Azure crea automáticamente records A/AAAA cuando despliegas VMs en la VNet.</p>
</div>
<h3 id="anadir-registros-dns"><a class="toclink" href="../../2025/01/18/azure-private-dns-zones-resoluci%C3%B3n-de-nombres-en-vnets/#anadir-registros-dns">Añadir registros DNS</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># Record A (IPv4)</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>az<span class="w"> </span>network<span class="w"> </span>private-dns<span class="w"> </span>record-set<span class="w"> </span>a<span class="w"> </span>add-record<span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-4"><a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">  </span>--zone-name<span class="w"> </span><span class="nv">$ZONE_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-5"><a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">  </span>--record-set-name<span class="w"> </span>db01<span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-6"><a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">  </span>--ipv4-address<span class="w"> </span><span class="m">10</span>.0.1.10
</span><span id="__span-10-7"><a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a>
</span><span id="__span-10-8"><a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="c1"># Record CNAME</span>
</span><span id="__span-10-9"><a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a>az<span class="w"> </span>network<span class="w"> </span>private-dns<span class="w"> </span>record-set<span class="w"> </span>cname<span class="w"> </span>set-record<span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-10"><a href="#__codelineno-10-10" id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-11"><a href="#__codelineno-10-11" id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">  </span>--zone-name<span class="w"> </span><span class="nv">$ZONE_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-12"><a href="#__codelineno-10-12" id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w">  </span>--record-set-name<span class="w"> </span>www<span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-13"><a href="#__codelineno-10-13" id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">  </span>--cname<span class="w"> </span>db01.internal.company.com
</span><span id="__span-10-14"><a href="#__codelineno-10-14" id="__codelineno-10-14" name="__codelineno-10-14"></a>
</span><span id="__span-10-15"><a href="#__codelineno-10-15" id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="c1"># Record TXT (verificación de dominio)</span>
</span><span id="__span-10-16"><a href="#__codelineno-10-16" id="__codelineno-10-16" name="__codelineno-10-16"></a>az<span class="w"> </span>network<span class="w"> </span>private-dns<span class="w"> </span>record-set<span class="w"> </span>txt<span class="w"> </span>add-record<span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-17"><a href="#__codelineno-10-17" id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-18"><a href="#__codelineno-10-18" id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="w">  </span>--zone-name<span class="w"> </span><span class="nv">$ZONE_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-19"><a href="#__codelineno-10-19" id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="w">  </span>--record-set-name<span class="w"> </span>_verification<span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-20"><a href="#__codelineno-10-20" id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="w">  </span>--value<span class="w"> </span><span class="s2">"verification-token-12345"</span>
</span></code></pre></div>
<h3 id="auto-registration-de-vms"><a class="toclink" href="../../2025/01/18/azure-private-dns-zones-resoluci%C3%B3n-de-nombres-en-vnets/#auto-registration-de-vms">Auto-registration de VMs</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># Crear zona con auto-registration</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>az<span class="w"> </span>network<span class="w"> </span>private-dns<span class="w"> </span>zone<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-4"><a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">  </span>--name<span class="w"> </span>auto.internal.com
</span><span id="__span-11-5"><a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a>
</span><span id="__span-11-6"><a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="c1"># Link con auto-registration habilitado</span>
</span><span id="__span-11-7"><a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a>az<span class="w"> </span>network<span class="w"> </span>private-dns<span class="w"> </span>link<span class="w"> </span>vnet<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-8"><a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-9"><a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">  </span>--zone-name<span class="w"> </span>auto.internal.com<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-10"><a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">  </span>--name<span class="w"> </span>auto-vnet-link<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-11"><a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="w">  </span>--virtual-network<span class="w"> </span><span class="nv">$VNET_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-12"><a href="#__codelineno-11-12" id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="w">  </span>--registration-enabled<span class="w"> </span><span class="nb">true</span>
</span><span id="__span-11-13"><a href="#__codelineno-11-13" id="__codelineno-11-13" name="__codelineno-11-13"></a>
</span><span id="__span-11-14"><a href="#__codelineno-11-14" id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="c1"># Crear VM - se auto-registra</span>
</span><span id="__span-11-15"><a href="#__codelineno-11-15" id="__codelineno-11-15" name="__codelineno-11-15"></a>az<span class="w"> </span>vm<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-16"><a href="#__codelineno-11-16" id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-17"><a href="#__codelineno-11-17" id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="w">  </span>--name<span class="w"> </span>myvm01<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-18"><a href="#__codelineno-11-18" id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="w">  </span>--vnet-name<span class="w"> </span><span class="nv">$VNET_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-19"><a href="#__codelineno-11-19" id="__codelineno-11-19" name="__codelineno-11-19"></a><span class="w">  </span>--subnet<span class="w"> </span>default<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-20"><a href="#__codelineno-11-20" id="__codelineno-11-20" name="__codelineno-11-20"></a><span class="w">  </span>--image<span class="w"> </span>Ubuntu2204<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-21"><a href="#__codelineno-11-21" id="__codelineno-11-21" name="__codelineno-11-21"></a><span class="w">  </span>--admin-username<span class="w"> </span>azureuser
</span></code></pre></div>
<p>La VM se registra automáticamente como <code>myvm01.auto.internal.com</code> apuntando a su IP privada.</p>
<h3 id="private-endpoints-con-dns"><a class="toclink" href="../../2025/01/18/azure-private-dns-zones-resoluci%C3%B3n-de-nombres-en-vnets/#private-endpoints-con-dns">Private Endpoints con DNS</a></h3>
<p>Cuando creas un Private Endpoint para Azure Storage, SQL, etc., necesitas Private DNS Zone para resolución:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1"># Crear Storage Account</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="nv">STORAGE_ACCOUNT</span><span class="o">=</span><span class="s2">"mystorageacct</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="s2">"</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">  </span>--sku<span class="w"> </span>Standard_LRS<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">  </span>--public-network-access<span class="w"> </span>Disabled
</span><span id="__span-12-8"><a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a>
</span><span id="__span-12-9"><a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="c1"># Crear Private DNS Zone para Blob</span>
</span><span id="__span-12-10"><a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a>az<span class="w"> </span>network<span class="w"> </span>private-dns<span class="w"> </span>zone<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-11"><a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-12"><a href="#__codelineno-12-12" id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="w">  </span>--name<span class="w"> </span>privatelink.blob.core.windows.net
</span><span id="__span-12-13"><a href="#__codelineno-12-13" id="__codelineno-12-13" name="__codelineno-12-13"></a>
</span><span id="__span-12-14"><a href="#__codelineno-12-14" id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="c1"># Link a VNet</span>
</span><span id="__span-12-15"><a href="#__codelineno-12-15" id="__codelineno-12-15" name="__codelineno-12-15"></a>az<span class="w"> </span>network<span class="w"> </span>private-dns<span class="w"> </span>link<span class="w"> </span>vnet<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-16"><a href="#__codelineno-12-16" id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-17"><a href="#__codelineno-12-17" id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="w">  </span>--zone-name<span class="w"> </span>privatelink.blob.core.windows.net<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-18"><a href="#__codelineno-12-18" id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="w">  </span>--name<span class="w"> </span>blob-dns-link<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-19"><a href="#__codelineno-12-19" id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="w">  </span>--virtual-network<span class="w"> </span><span class="nv">$VNET_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-20"><a href="#__codelineno-12-20" id="__codelineno-12-20" name="__codelineno-12-20"></a><span class="w">  </span>--registration-enabled<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-12-21"><a href="#__codelineno-12-21" id="__codelineno-12-21" name="__codelineno-12-21"></a>
</span><span id="__span-12-22"><a href="#__codelineno-12-22" id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="c1"># Crear Private Endpoint</span>
</span><span id="__span-12-23"><a href="#__codelineno-12-23" id="__codelineno-12-23" name="__codelineno-12-23"></a>az<span class="w"> </span>network<span class="w"> </span>private-endpoint<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-24"><a href="#__codelineno-12-24" id="__codelineno-12-24" name="__codelineno-12-24"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-25"><a href="#__codelineno-12-25" id="__codelineno-12-25" name="__codelineno-12-25"></a><span class="w">  </span>--name<span class="w"> </span><span class="si">${</span><span class="nv">STORAGE_ACCOUNT</span><span class="si">}</span>-pe<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-26"><a href="#__codelineno-12-26" id="__codelineno-12-26" name="__codelineno-12-26"></a><span class="w">  </span>--vnet-name<span class="w"> </span><span class="nv">$VNET_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-27"><a href="#__codelineno-12-27" id="__codelineno-12-27" name="__codelineno-12-27"></a><span class="w">  </span>--subnet<span class="w"> </span>default<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-28"><a href="#__codelineno-12-28" id="__codelineno-12-28" name="__codelineno-12-28"></a><span class="w">  </span>--private-connection-resource-id<span class="w"> </span><span class="k">$(</span>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>show<span class="w"> </span>--name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span>--query<span class="w"> </span>id<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-29"><a href="#__codelineno-12-29" id="__codelineno-12-29" name="__codelineno-12-29"></a><span class="w">  </span>--group-id<span class="w"> </span>blob<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-30"><a href="#__codelineno-12-30" id="__codelineno-12-30" name="__codelineno-12-30"></a><span class="w">  </span>--connection-name<span class="w"> </span>blob-connection
</span><span id="__span-12-31"><a href="#__codelineno-12-31" id="__codelineno-12-31" name="__codelineno-12-31"></a>
</span><span id="__span-12-32"><a href="#__codelineno-12-32" id="__codelineno-12-32" name="__codelineno-12-32"></a><span class="c1"># Crear DNS record automáticamente</span>
</span><span id="__span-12-33"><a href="#__codelineno-12-33" id="__codelineno-12-33" name="__codelineno-12-33"></a>az<span class="w"> </span>network<span class="w"> </span>private-endpoint<span class="w"> </span>dns-zone-group<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-34"><a href="#__codelineno-12-34" id="__codelineno-12-34" name="__codelineno-12-34"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-35"><a href="#__codelineno-12-35" id="__codelineno-12-35" name="__codelineno-12-35"></a><span class="w">  </span>--endpoint-name<span class="w"> </span><span class="si">${</span><span class="nv">STORAGE_ACCOUNT</span><span class="si">}</span>-pe<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-36"><a href="#__codelineno-12-36" id="__codelineno-12-36" name="__codelineno-12-36"></a><span class="w">  </span>--name<span class="w"> </span>blob-dns-group<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-37"><a href="#__codelineno-12-37" id="__codelineno-12-37" name="__codelineno-12-37"></a><span class="w">  </span>--private-dns-zone<span class="w"> </span>privatelink.blob.core.windows.net<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-38"><a href="#__codelineno-12-38" id="__codelineno-12-38" name="__codelineno-12-38"></a><span class="w">  </span>--zone-name<span class="w"> </span>blob
</span></code></pre></div>
<p>Ahora desde la VNet:
</p><div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a>nslookup<span class="w"> </span>mystorageacct.blob.core.windows.net
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="c1"># Resuelve a IP privada 10.0.1.5</span>
</span></code></pre></div><p></p>
<h3 id="dns-forwarding-para-hybrid-cloud"><a class="toclink" href="../../2025/01/18/azure-private-dns-zones-resoluci%C3%B3n-de-nombres-en-vnets/#dns-forwarding-para-hybrid-cloud">DNS Forwarding para hybrid cloud</a></h3>
<p>Para que on-premises resuelva nombres de Private DNS Zone:</p>
<pre class="mermaid"><code>graph LR
    A[On-Premises DNS] --&gt;|Conditional Forwarding| B[Azure DNS Resolver]
    B --&gt; C[Private DNS Zone]
    C --&gt; D[mystorageacct.privatelink.blob.core.windows.net]
</code></pre>
<p><strong>Paso 1: Crear DNS Private Resolver</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># Crear subnet para resolver</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>subnet<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">  </span>--vnet-name<span class="w"> </span><span class="nv">$VNET_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">  </span>--name<span class="w"> </span>dns-resolver-inbound<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">  </span>--address-prefixes<span class="w"> </span><span class="m">10</span>.0.255.0/28
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a>
</span><span id="__span-14-8"><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="c1"># Crear DNS Private Resolver</span>
</span><span id="__span-14-9"><a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a>az<span class="w"> </span>dns-resolver<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-10"><a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-11"><a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">  </span>--name<span class="w"> </span>my-dns-resolver<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-12"><a href="#__codelineno-14-12" id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="w">  </span>--location<span class="w"> </span>westeurope<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-13"><a href="#__codelineno-14-13" id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="w">  </span>--id<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourceGroups/<span class="nv">$RG</span>/providers/Microsoft.Network/virtualNetworks/<span class="nv">$VNET_NAME</span>
</span><span id="__span-14-14"><a href="#__codelineno-14-14" id="__codelineno-14-14" name="__codelineno-14-14"></a>
</span><span id="__span-14-15"><a href="#__codelineno-14-15" id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="c1"># Crear inbound endpoint</span>
</span><span id="__span-14-16"><a href="#__codelineno-14-16" id="__codelineno-14-16" name="__codelineno-14-16"></a>az<span class="w"> </span>dns-resolver<span class="w"> </span>inbound-endpoint<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-17"><a href="#__codelineno-14-17" id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-18"><a href="#__codelineno-14-18" id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="w">  </span>--dns-resolver-name<span class="w"> </span>my-dns-resolver<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-19"><a href="#__codelineno-14-19" id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="w">  </span>--name<span class="w"> </span>inbound-endpoint<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-20"><a href="#__codelineno-14-20" id="__codelineno-14-20" name="__codelineno-14-20"></a><span class="w">  </span>--location<span class="w"> </span>westeurope<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-21"><a href="#__codelineno-14-21" id="__codelineno-14-21" name="__codelineno-14-21"></a><span class="w">  </span>--ip-configurations<span class="w"> </span><span class="s1">'[{"subnet":{"id":"/subscriptions/{sub-id}/resourceGroups/'</span><span class="nv">$RG</span><span class="s1">'/providers/Microsoft.Network/virtualNetworks/'</span><span class="nv">$VNET_NAME</span><span class="s1">'/subnets/dns-resolver-inbound"},"privateIpAllocationMethod":"Dynamic"}]'</span>
</span></code></pre></div>
<p><strong>Paso 2: Configurar on-premises DNS</strong></p>
<p>En tu DNS on-premises (BIND, Windows DNS, etc.):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a># Conditional Forwarder
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a>Zone: privatelink.blob.core.windows.net
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a>Forwarder: 10.0.255.4  # IP del inbound endpoint
</span></code></pre></div>
<h3 id="listar-registros"><a class="toclink" href="../../2025/01/18/azure-private-dns-zones-resoluci%C3%B3n-de-nombres-en-vnets/#listar-registros">Listar registros</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># Ver todos los record sets</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>az<span class="w"> </span>network<span class="w"> </span>private-dns<span class="w"> </span>record-set<span class="w"> </span>list<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">  </span>--zone-name<span class="w"> </span><span class="nv">$ZONE_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span>--output<span class="w"> </span>table
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a>
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="c1"># Ver record específico</span>
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a>az<span class="w"> </span>network<span class="w"> </span>private-dns<span class="w"> </span>record-set<span class="w"> </span>a<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-10"><a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">  </span>--zone-name<span class="w"> </span><span class="nv">$ZONE_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-11"><a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">  </span>--name<span class="w"> </span>db01
</span></code></pre></div>
<h3 id="troubleshooting-dns"><a class="toclink" href="../../2025/01/18/azure-private-dns-zones-resoluci%C3%B3n-de-nombres-en-vnets/#troubleshooting-dns">Troubleshooting DNS</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># Desde una VM en la VNet</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>nslookup<span class="w"> </span>db01.internal.company.com
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="c1"># Ver configuración DNS de la NIC</span>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a>az<span class="w"> </span>network<span class="w"> </span>nic<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">  </span>--name<span class="w"> </span>myvm-nic<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">  </span>--query<span class="w"> </span><span class="s2">"dnsSettings"</span>
</span><span id="__span-17-9"><a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a>
</span><span id="__span-17-10"><a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="c1"># Probar desde VM con dig</span>
</span><span id="__span-17-11"><a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a>dig<span class="w"> </span>db01.internal.company.com
</span><span id="__span-17-12"><a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a>
</span><span id="__span-17-13"><a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="c1"># Flush DNS cache en Linux VM</span>
</span><span id="__span-17-14"><a href="#__codelineno-17-14" id="__codelineno-17-14" name="__codelineno-17-14"></a>sudo<span class="w"> </span>systemd-resolve<span class="w"> </span>--flush-caches
</span></code></pre></div>
<h3 id="buenas-practicas"><a class="toclink" href="../../2025/01/18/azure-private-dns-zones-resoluci%C3%B3n-de-nombres-en-vnets/#buenas-practicas">Buenas prácticas</a></h3>
<ul>
<li><strong>Naming convention</strong>: Usa <code>.internal</code>, <code>.private</code> o <code>.local</code> para zonas privadas</li>
<li><strong>Un zone por VNet</strong>: Evita múltiples zonas con el mismo nombre</li>
<li><strong>RBAC</strong>: Separa permisos de DNS de permisos de red</li>
<li><strong>Monitoring</strong>: Habilita diagnostic logs para audit</li>
<li><strong>Terraform</strong>: Gestiona DNS zones como código</li>
<li><strong>Private Endpoint DNS</strong>: Usa DNS Zone Groups para auto-configuración</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Limitaciones</p>
<ul>
<li>Máximo 25,000 records por zone</li>
<li>Máximo 1,000 VNet links por zone</li>
<li>No soporta DNSSEC</li>
<li>No soporta zone transfers (AXFR/IXFR)</li>
</ul>
</div>
<h3 id="costos"><a class="toclink" href="../../2025/01/18/azure-private-dns-zones-resoluci%C3%B3n-de-nombres-en-vnets/#costos">Costos</a></h3>
<ul>
<li><strong>Hosted zone</strong>: €0.45/zone/mes</li>
<li><strong>Queries</strong>: Primeros 1B gratis, luego €0.36/millón</li>
<li><strong>VNet links</strong>: €0.09/link/mes</li>
</ul>
<p>En práctica: 1 zone + 5 VNet links = ~€0.90/mes</p>
<h3 id="referencias"><a class="toclink" href="../../2025/01/18/azure-private-dns-zones-resoluci%C3%B3n-de-nombres-en-vnets/#referencias">Referencias</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/dns/private-dns-overview">What is Azure Private DNS?</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/private-link/private-endpoint-dns">Azure Private Endpoint DNS configuration</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/dns/dns-private-resolver-overview">Azure DNS Private Resolver</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-01-15 00:00:00+00:00">January 15, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              3 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="application-insights-instrumentacion-completa-en-10-minutos"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/">Application Insights: Instrumentación completa en 10 minutos</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#resumen">Resumen</a></h3>
<p>Application Insights te da observability completa de tu aplicación: traces, metrics, logs y dependencies. aquí está el setup mínimo para .NET, Python y Node.js.</p>
<h3 id="que-es-application-insights"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#que-es-application-insights">¿Qué es Application Insights?</a></h3>
<p>Application Insights es el APM (Application Performance Monitoring) nativo de Azure. Captura automáticamente:</p>
<ul>
<li><strong>Requests</strong>: HTTP requests con duración y status code</li>
<li><strong>Dependencies</strong>: Llamadas a DBs, APIs externas, Redis, etc.</li>
<li><strong>Exceptions</strong>: Stack traces completos</li>
<li><strong>Custom events</strong>: Lo que tú quieras trackear</li>
<li><strong>User telemetry</strong>: Sessions, page views, user flows</li>
</ul>
<h3 id="crear-recurso"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#crear-recurso">Crear recurso</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1"># Variables</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="nv">RG</span><span class="o">=</span><span class="s2">"my-rg"</span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="nv">LOCATION</span><span class="o">=</span><span class="s2">"westeurope"</span>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="nv">APPINSIGHTS_NAME</span><span class="o">=</span><span class="s2">"my-appinsights"</span>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a>
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="c1"># Crear Log Analytics Workspace (requerido)</span>
</span><span id="__span-15-7"><a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a>az<span class="w"> </span>monitor<span class="w"> </span>log-analytics<span class="w"> </span>workspace<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-8"><a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-9"><a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">  </span>--workspace-name<span class="w"> </span>my-workspace<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-10"><a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span>
</span><span id="__span-15-11"><a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a>
</span><span id="__span-15-12"><a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="nv">WORKSPACE_ID</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>monitor<span class="w"> </span>log-analytics<span class="w"> </span>workspace<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-13"><a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-14"><a href="#__codelineno-15-14" id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">  </span>--workspace-name<span class="w"> </span>my-workspace<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-15"><a href="#__codelineno-15-15" id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">  </span>--query<span class="w"> </span>id<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>
</span><span id="__span-15-16"><a href="#__codelineno-15-16" id="__codelineno-15-16" name="__codelineno-15-16"></a>
</span><span id="__span-15-17"><a href="#__codelineno-15-17" id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="c1"># Crear Application Insights</span>
</span><span id="__span-15-18"><a href="#__codelineno-15-18" id="__codelineno-15-18" name="__codelineno-15-18"></a>az<span class="w"> </span>monitor<span class="w"> </span>app-insights<span class="w"> </span>component<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-19"><a href="#__codelineno-15-19" id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="w">  </span>--app<span class="w"> </span><span class="nv">$APPINSIGHTS_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-20"><a href="#__codelineno-15-20" id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-21"><a href="#__codelineno-15-21" id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-22"><a href="#__codelineno-15-22" id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="w">  </span>--workspace<span class="w"> </span><span class="nv">$WORKSPACE_ID</span>
</span></code></pre></div>
<h3 id="obtener-connection-string"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#obtener-connection-string">Obtener connection string</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># Connection string (nuevo método recomendado)</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="nv">CONN_STRING</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>monitor<span class="w"> </span>app-insights<span class="w"> </span>component<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">  </span>--app<span class="w"> </span><span class="nv">$APPINSIGHTS_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span>--query<span class="w"> </span>connectionString<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a>
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="nb">echo</span><span class="w"> </span><span class="nv">$CONN_STRING</span>
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="c1"># InstrumentationKey=abc-123;IngestionEndpoint=https://westeurope-5.in.applicationinsights.azure.com/</span>
</span></code></pre></div>
<h3 id="instrumentacion-por-lenguaje"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#instrumentacion-por-lenguaje">Instrumentación por lenguaje</a></h3>
<h4 id="net-6"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#net-6">.NET 6+</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># Instalar paquete NuGet</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>dotnet<span class="w"> </span>add<span class="w"> </span>package<span class="w"> </span>Microsoft.ApplicationInsights.AspNetCore
</span></code></pre></div>
<p><code>Program.cs</code>:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WebApplication</span><span class="p">.</span><span class="n">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a>
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="c1">// Añadir Application Insights</span>
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddApplicationInsightsTelemetry</span><span class="p">(</span><span class="n">options</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="p">{</span>
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">ConnectionString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">[</span><span class="s">"ApplicationInsights:ConnectionString"</span><span class="p">];</span>
</span><span id="__span-18-7"><a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="p">});</span>
</span><span id="__span-18-8"><a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a>
</span><span id="__span-18-9"><a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="kt">var</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">Build</span><span class="p">();</span>
</span></code></pre></div>
<p><code>appsettings.json</code>:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="p">{</span>
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">  </span><span class="nt">"ApplicationInsights"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-3"><a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">    </span><span class="nt">"ConnectionString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"InstrumentationKey=abc-123;..."</span>
</span><span id="__span-19-4"><a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-5"><a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="python-flaskfastapi"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#python-flaskfastapi">Python (Flask/FastAPI)</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># Instalar SDK</span>
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a>pip<span class="w"> </span>install<span class="w"> </span>opencensus-ext-azure
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a>pip<span class="w"> </span>install<span class="w"> </span>opencensus-ext-flask<span class="w">  </span><span class="c1"># O opencensus-ext-fastapi</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span>
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opencensus.ext.azure.log_exporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">AzureLogHandler</span>
</span><span id="__span-21-3"><a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opencensus.ext.flask.flask_middleware</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlaskMiddleware</span>
</span><span id="__span-21-4"><a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="__span-21-5"><a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a>
</span><span id="__span-21-6"><a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-21-7"><a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a>
</span><span id="__span-21-8"><a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="c1"># Middleware para auto-instrumentación</span>
</span><span id="__span-21-9"><a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="n">middleware</span> <span class="o">=</span> <span class="n">FlaskMiddleware</span><span class="p">(</span>
</span><span id="__span-21-10"><a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a>    <span class="n">app</span><span class="p">,</span>
</span><span id="__span-21-11"><a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a>    <span class="n">exporter</span><span class="o">=</span><span class="n">AzureLogHandler</span><span class="p">(</span>
</span><span id="__span-21-12"><a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a>        <span class="n">connection_string</span><span class="o">=</span><span class="s1">'InstrumentationKey=abc-123;...'</span>
</span><span id="__span-21-13"><a href="#__codelineno-21-13" id="__codelineno-21-13" name="__codelineno-21-13"></a>    <span class="p">)</span>
</span><span id="__span-21-14"><a href="#__codelineno-21-14" id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="p">)</span>
</span><span id="__span-21-15"><a href="#__codelineno-21-15" id="__codelineno-21-15" name="__codelineno-21-15"></a>
</span><span id="__span-21-16"><a href="#__codelineno-21-16" id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="c1"># Logger</span>
</span><span id="__span-21-17"><a href="#__codelineno-21-17" id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-21-18"><a href="#__codelineno-21-18" id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">AzureLogHandler</span><span class="p">(</span>
</span><span id="__span-21-19"><a href="#__codelineno-21-19" id="__codelineno-21-19" name="__codelineno-21-19"></a>    <span class="n">connection_string</span><span class="o">=</span><span class="s1">'InstrumentationKey=abc-123;...'</span>
</span><span id="__span-21-20"><a href="#__codelineno-21-20" id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="p">))</span>
</span><span id="__span-21-21"><a href="#__codelineno-21-21" id="__codelineno-21-21" name="__codelineno-21-21"></a>
</span><span id="__span-21-22"><a href="#__codelineno-21-22" id="__codelineno-21-22" name="__codelineno-21-22"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
</span><span id="__span-21-23"><a href="#__codelineno-21-23" id="__codelineno-21-23" name="__codelineno-21-23"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello</span><span class="p">():</span>
</span><span id="__span-21-24"><a href="#__codelineno-21-24" id="__codelineno-21-24" name="__codelineno-21-24"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Home page accessed'</span><span class="p">)</span>
</span><span id="__span-21-25"><a href="#__codelineno-21-25" id="__codelineno-21-25" name="__codelineno-21-25"></a>    <span class="k">return</span> <span class="s1">'Hello World'</span>
</span></code></pre></div>
<h4 id="nodejs"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#nodejs">Node.js</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1"># Instalar SDK</span>
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a>npm<span class="w"> </span>install<span class="w"> </span>applicationinsights
</span></code></pre></div>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">appInsights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">'applicationinsights'</span><span class="p">);</span>
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a>
</span><span id="__span-23-3"><a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="nx">appInsights</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="s1">'InstrumentationKey=abc-123;...'</span><span class="p">)</span>
</span><span id="__span-23-4"><a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">    </span><span class="p">.</span><span class="nx">setAutoDependencyCorrelation</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-23-5"><a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">    </span><span class="p">.</span><span class="nx">setAutoCollectRequests</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-23-6"><a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">    </span><span class="p">.</span><span class="nx">setAutoCollectPerformance</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-23-7"><a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">    </span><span class="p">.</span><span class="nx">setAutoCollectExceptions</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-23-8"><a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">    </span><span class="p">.</span><span class="nx">setAutoCollectDependencies</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-23-9"><a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">    </span><span class="p">.</span><span class="nx">setAutoCollectConsole</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-23-10"><a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">    </span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-23-11"><a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a>
</span><span id="__span-23-12"><a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="c1">// Tu código Express</span>
</span><span id="__span-23-13"><a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="kd">const</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
</span><span id="__span-23-14"><a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span>
</span><span id="__span-23-15"><a href="#__codelineno-23-15" id="__codelineno-23-15" name="__codelineno-23-15"></a>
</span><span id="__span-23-16"><a href="#__codelineno-23-16" id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-17"><a href="#__codelineno-23-17" id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="w">    </span><span class="nx">appInsights</span><span class="p">.</span><span class="nx">defaultClient</span><span class="p">.</span><span class="nx">trackEvent</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">'HomePage'</span><span class="p">});</span>
</span><span id="__span-23-18"><a href="#__codelineno-23-18" id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'Hello World'</span><span class="p">);</span>
</span><span id="__span-23-19"><a href="#__codelineno-23-19" id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="p">});</span>
</span></code></pre></div>
<h3 id="custom-telemetry"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#custom-telemetry">Custom telemetry</a></h3>
<h4 id="tracking-personalizado"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#tracking-personalizado">Tracking personalizado</a></h4>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1">// .NET</span>
</span><span id="__span-24-2"><a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.ApplicationInsights</span><span class="p">;</span>
</span><span id="__span-24-3"><a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a>
</span><span id="__span-24-4"><a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">TelemetryClient</span><span class="w"> </span><span class="n">_telemetry</span><span class="p">;</span>
</span><span id="__span-24-5"><a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a>
</span><span id="__span-24-6"><a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="k">public</span><span class="w"> </span><span class="nf">MyService</span><span class="p">(</span><span class="n">TelemetryClient</span><span class="w"> </span><span class="n">telemetry</span><span class="p">)</span>
</span><span id="__span-24-7"><a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="p">{</span>
</span><span id="__span-24-8"><a href="#__codelineno-24-8" id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">    </span><span class="n">_telemetry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">telemetry</span><span class="p">;</span>
</span><span id="__span-24-9"><a href="#__codelineno-24-9" id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="p">}</span>
</span><span id="__span-24-10"><a href="#__codelineno-24-10" id="__codelineno-24-10" name="__codelineno-24-10"></a>
</span><span id="__span-24-11"><a href="#__codelineno-24-11" id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ProcessOrder</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span>
</span><span id="__span-24-12"><a href="#__codelineno-24-12" id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="p">{</span>
</span><span id="__span-24-13"><a href="#__codelineno-24-13" id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="w">    </span><span class="c1">// Track evento</span>
</span><span id="__span-24-14"><a href="#__codelineno-24-14" id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="w">    </span><span class="n">_telemetry</span><span class="p">.</span><span class="n">TrackEvent</span><span class="p">(</span><span class="s">"OrderProcessed"</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span>
</span><span id="__span-24-15"><a href="#__codelineno-24-15" id="__codelineno-24-15" name="__codelineno-24-15"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-24-16"><a href="#__codelineno-24-16" id="__codelineno-24-16" name="__codelineno-24-16"></a><span class="w">        </span><span class="p">{</span><span class="s">"OrderId"</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="n">Id</span><span class="p">},</span>
</span><span id="__span-24-17"><a href="#__codelineno-24-17" id="__codelineno-24-17" name="__codelineno-24-17"></a><span class="w">        </span><span class="p">{</span><span class="s">"Amount"</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="n">Total</span><span class="p">.</span><span class="n">ToString</span><span class="p">()}</span>
</span><span id="__span-24-18"><a href="#__codelineno-24-18" id="__codelineno-24-18" name="__codelineno-24-18"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-24-19"><a href="#__codelineno-24-19" id="__codelineno-24-19" name="__codelineno-24-19"></a>
</span><span id="__span-24-20"><a href="#__codelineno-24-20" id="__codelineno-24-20" name="__codelineno-24-20"></a><span class="w">    </span><span class="c1">// Track métrica</span>
</span><span id="__span-24-21"><a href="#__codelineno-24-21" id="__codelineno-24-21" name="__codelineno-24-21"></a><span class="w">    </span><span class="n">_telemetry</span><span class="p">.</span><span class="n">TrackMetric</span><span class="p">(</span><span class="s">"OrderValue"</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="n">Total</span><span class="p">);</span>
</span><span id="__span-24-22"><a href="#__codelineno-24-22" id="__codelineno-24-22" name="__codelineno-24-22"></a>
</span><span id="__span-24-23"><a href="#__codelineno-24-23" id="__codelineno-24-23" name="__codelineno-24-23"></a><span class="w">    </span><span class="c1">// Track trace (log)</span>
</span><span id="__span-24-24"><a href="#__codelineno-24-24" id="__codelineno-24-24" name="__codelineno-24-24"></a><span class="w">    </span><span class="n">_telemetry</span><span class="p">.</span><span class="n">TrackTrace</span><span class="p">(</span><span class="s">$"Processing order {order.Id}"</span><span class="p">,</span><span class="w"> </span><span class="n">SeverityLevel</span><span class="p">.</span><span class="n">Information</span><span class="p">);</span>
</span><span id="__span-24-25"><a href="#__codelineno-24-25" id="__codelineno-24-25" name="__codelineno-24-25"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1"># Python</span>
</span><span id="__span-25-2"><a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opencensus.trace</span><span class="w"> </span><span class="kn">import</span> <span class="n">tracer</span> <span class="k">as</span> <span class="n">tracer_module</span>
</span><span id="__span-25-3"><a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opencensus.ext.azure.trace_exporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">AzureExporter</span>
</span><span id="__span-25-4"><a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a>
</span><span id="__span-25-5"><a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="n">tracer</span> <span class="o">=</span> <span class="n">tracer_module</span><span class="o">.</span><span class="n">Tracer</span><span class="p">(</span>
</span><span id="__span-25-6"><a href="#__codelineno-25-6" id="__codelineno-25-6" name="__codelineno-25-6"></a>    <span class="n">exporter</span><span class="o">=</span><span class="n">AzureExporter</span><span class="p">(</span><span class="n">connection_string</span><span class="o">=</span><span class="s1">'...'</span><span class="p">),</span>
</span><span id="__span-25-7"><a href="#__codelineno-25-7" id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="p">)</span>
</span><span id="__span-25-8"><a href="#__codelineno-25-8" id="__codelineno-25-8" name="__codelineno-25-8"></a>
</span><span id="__span-25-9"><a href="#__codelineno-25-9" id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'ProcessOrder'</span><span class="p">):</span>
</span><span id="__span-25-10"><a href="#__codelineno-25-10" id="__codelineno-25-10" name="__codelineno-25-10"></a>    <span class="c1"># Tu lógica</span>
</span><span id="__span-25-11"><a href="#__codelineno-25-11" id="__codelineno-25-11" name="__codelineno-25-11"></a>    <span class="n">tracer</span><span class="o">.</span><span class="n">add_attribute_to_current_span</span><span class="p">(</span><span class="s1">'orderId'</span><span class="p">,</span> <span class="n">order_id</span><span class="p">)</span>
</span><span id="__span-25-12"><a href="#__codelineno-25-12" id="__codelineno-25-12" name="__codelineno-25-12"></a>    <span class="n">tracer</span><span class="o">.</span><span class="n">add_attribute_to_current_span</span><span class="p">(</span><span class="s1">'amount'</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="queries-utiles-en-log-analytics"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#queries-utiles-en-log-analytics">Queries útiles en Log Analytics</a></h3>
<div class="language-kusto highlight"><pre><span></span><code><span id="__span-26-1"><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c">// Requests más lentos (P95)</span>
</span><span id="__span-26-2"><a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="n">requests</span>
</span><span id="__span-26-3"><a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="n">ago</span><span class="p">(</span><span class="mi">1</span><span class="n">h</span><span class="p">)</span>
</span><span id="__span-26-4"><a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">percentile</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span><span class="w"> </span><span class="mi">95</span><span class="p">)</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">name</span>
</span><span id="__span-26-5"><a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">percentile_duration_95</span><span class="w"> </span><span class="n">desc</span>
</span><span id="__span-26-6"><a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a>
</span><span id="__span-26-7"><a href="#__codelineno-26-7" id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="c">// Excepciones por tipo</span>
</span><span id="__span-26-8"><a href="#__codelineno-26-8" id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="n">exceptions</span>
</span><span id="__span-26-9"><a href="#__codelineno-26-9" id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="n">ago</span><span class="p">(</span><span class="mi">24</span><span class="n">h</span><span class="p">)</span>
</span><span id="__span-26-10"><a href="#__codelineno-26-10" id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">outerMessage</span>
</span><span id="__span-26-11"><a href="#__codelineno-26-11" id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">count_</span><span class="w"> </span><span class="n">desc</span>
</span><span id="__span-26-12"><a href="#__codelineno-26-12" id="__codelineno-26-12" name="__codelineno-26-12"></a>
</span><span id="__span-26-13"><a href="#__codelineno-26-13" id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="c">// Dependency calls fallando</span>
</span><span id="__span-26-14"><a href="#__codelineno-26-14" id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="n">dependencies</span>
</span><span id="__span-26-15"><a href="#__codelineno-26-15" id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="n">false</span>
</span><span id="__span-26-16"><a href="#__codelineno-26-16" id="__codelineno-26-16" name="__codelineno-26-16"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="n">ago</span><span class="p">(</span><span class="mi">1</span><span class="n">h</span><span class="p">)</span>
</span><span id="__span-26-17"><a href="#__codelineno-26-17" id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">resultCode</span>
</span><span id="__span-26-18"><a href="#__codelineno-26-18" id="__codelineno-26-18" name="__codelineno-26-18"></a>
</span><span id="__span-26-19"><a href="#__codelineno-26-19" id="__codelineno-26-19" name="__codelineno-26-19"></a><span class="c">// User journey (funnels)</span>
</span><span id="__span-26-20"><a href="#__codelineno-26-20" id="__codelineno-26-20" name="__codelineno-26-20"></a><span class="n">customEvents</span>
</span><span id="__span-26-21"><a href="#__codelineno-26-21" id="__codelineno-26-21" name="__codelineno-26-21"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="n">ago</span><span class="p">(</span><span class="mi">7</span><span class="n">d</span><span class="p">)</span>
</span><span id="__span-26-22"><a href="#__codelineno-26-22" id="__codelineno-26-22" name="__codelineno-26-22"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">(</span><span class="s">'PageView'</span><span class="p">,</span><span class="w"> </span><span class="s">'AddToCart'</span><span class="p">,</span><span class="w"> </span><span class="s">'Checkout'</span><span class="p">,</span><span class="w"> </span><span class="s">'Purchase'</span><span class="p">)</span>
</span><span id="__span-26-23"><a href="#__codelineno-26-23" id="__codelineno-26-23" name="__codelineno-26-23"></a><span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">name</span>
</span></code></pre></div>
<h3 id="alertas-automatizadas"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#alertas-automatizadas">Alertas automatizadas</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="c1"># Alert para tasa de errores &gt; 5%</span>
</span><span id="__span-27-2"><a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a>az<span class="w"> </span>monitor<span class="w"> </span>metrics<span class="w"> </span>alert<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-3"><a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">  </span>--name<span class="w"> </span>high-error-rate<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-4"><a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-5"><a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">  </span>--scopes<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourceGroups/<span class="nv">$RG</span>/providers/Microsoft.Insights/components/<span class="nv">$APPINSIGHTS_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-6"><a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="w">  </span>--condition<span class="w"> </span><span class="s2">"avg requests/failed &gt; 5"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-7"><a href="#__codelineno-27-7" id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="w">  </span>--window-size<span class="w"> </span>5m<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-8"><a href="#__codelineno-27-8" id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="w">  </span>--evaluation-frequency<span class="w"> </span>1m<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-9"><a href="#__codelineno-27-9" id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="w">  </span>--action<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourceGroups/<span class="nv">$RG</span>/providers/Microsoft.Insights/actionGroups/ops-team
</span></code></pre></div>
<h3 id="live-metrics-stream"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#live-metrics-stream">Live Metrics Stream</a></h3>
<p>Para debugging en tiempo real:</p>
<ol>
<li>Portal Azure → Application Insights → Live Metrics</li>
<li>Ver requests, dependencies, exceptions en vivo</li>
<li>Aplicar filtros por server, cloud role, etc.</li>
</ol>
<h3 id="sampling-para-reducir-costos"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#sampling-para-reducir-costos">Sampling para reducir costos</a></h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-28-1"><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1">// .NET - adaptive sampling (recomendado)</span>
</span><span id="__span-28-2"><a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddApplicationInsightsTelemetry</span><span class="p">(</span><span class="n">options</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-28-3"><a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="p">{</span>
</span><span id="__span-28-4"><a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">EnableAdaptiveSampling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-28-5"><a href="#__codelineno-28-5" id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">ConnectionString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connectionString</span><span class="p">;</span>
</span><span id="__span-28-6"><a href="#__codelineno-28-6" id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="p">});</span>
</span><span id="__span-28-7"><a href="#__codelineno-28-7" id="__codelineno-28-7" name="__codelineno-28-7"></a>
</span><span id="__span-28-8"><a href="#__codelineno-28-8" id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="c1">// Fixed sampling (5% de telemetría)</span>
</span><span id="__span-28-9"><a href="#__codelineno-28-9" id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddApplicationInsightsTelemetryProcessor</span><span class="o">&lt;</span><span class="n">AdaptiveSamplingTelemetryProcessor</span><span class="o">&gt;</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-28-10"><a href="#__codelineno-28-10" id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="p">{</span>
</span><span id="__span-28-11"><a href="#__codelineno-28-11" id="__codelineno-28-11" name="__codelineno-28-11"></a><span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="n">SamplingPercentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-28-12"><a href="#__codelineno-28-12" id="__codelineno-28-12" name="__codelineno-28-12"></a><span class="p">});</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Costos</p>
<p>Application Insights cobra por GB ingestado:
- Primeros 5 GB/mes: gratis
- &gt;5 GB: ~€2/GB</p>
<p>Con sampling al 10%, una app con 1M requests/día → ~15GB/mes → €20/mes</p>
</div>
<h3 id="distributed-tracing"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#distributed-tracing">Distributed tracing</a></h3>
<p>Para microservicios, Application Insights correlaciona automáticamente:</p>
<pre class="mermaid"><code>graph LR
    A[API Gateway] --&gt;|operation_Id: abc123| B[Auth Service]
    A --&gt;|operation_Id: abc123| C[Order Service]
    C --&gt;|operation_Id: abc123| D[Payment API]
</code></pre>
<p>Query cross-service:</p>
<div class="language-kusto highlight"><pre><span></span><code><span id="__span-29-1"><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c">// Trace completo de una operación</span>
</span><span id="__span-29-2"><a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="k">union</span><span class="w"> </span><span class="n">requests</span><span class="p">,</span><span class="w"> </span><span class="n">dependencies</span>
</span><span id="__span-29-3"><a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">operation_Id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">'abc123'</span>
</span><span id="__span-29-4"><a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">itemType</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">duration</span><span class="p">,</span><span class="w"> </span><span class="n">success</span>
</span><span id="__span-29-5"><a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="n">asc</span>
</span></code></pre></div>
<h3 id="buenas-practicas"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#buenas-practicas">Buenas prácticas</a></h3>
<ul>
<li><strong>No loguees PII</strong>: Filtra datos sensibles antes de enviar</li>
<li><strong>Usa sampling en producción</strong>: 10-20% es suficiente</li>
<li><strong>Custom dimensions</strong>: Añade tenant_id, user_role para segmentar</li>
<li><strong>Dependency tracking</strong>: Verifica que captura SQL, Redis, HTTP</li>
<li><strong>Availability tests</strong>: Configura pings cada 5 minutos desde múltiples regiones</li>
</ul>
<h3 id="referencias"><a class="toclink" href="../../2025/01/15/application-insights-instrumentaci%C3%B3n-completa-en-10-minutos/#referencias">Referencias</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview">What is Application Insights?</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/azure-monitor/app/platforms">Application Insights SDKs</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-01-12 00:00:00+00:00">January 12, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../category/devops/">DevOps</a></li>
<li class="md-meta__item">
            
              3 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="terraform-backend-en-azure-storage-setup-completo"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/">Terraform Backend en Azure Storage: Setup completo</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#resumen">Resumen</a></h3>
<p>Guardar el estado de Terraform en local es peligroso y no escala. Azure Storage con state locking es la solución estándar para equipos. Aquí el setup completo en 5 minutos.</p>
<h3 id="por-que-usar-remote-backend"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#por-que-usar-remote-backend">¿Por qué usar remote backend?</a></h3>
<p><strong>Problemas con backend local:</strong>
- ❌ Estado se pierde si borras tu laptop
- ❌ Imposible colaborar en equipo
- ❌ No hay locking → corrupciones en despliegues simultáneos
- ❌ Secretos en plaintext en disco local</p>
<p><strong>Ventajas con Azure Storage:</strong>
- ✅ Estado centralizado y versionado
- ✅ Locking automático con blob lease
- ✅ Encriptación at-rest
- ✅ Acceso controlado con RBAC</p>
<h3 id="setup-del-backend"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#setup-del-backend">Setup del backend</a></h3>
<h4 id="1-crear-storage-account"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#1-crear-storage-account">1. Crear Storage Account</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c1"># Variables</span>
</span><span id="__span-26-2"><a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="nv">RG</span><span class="o">=</span><span class="s2">"terraform-state-rg"</span>
</span><span id="__span-26-3"><a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="nv">LOCATION</span><span class="o">=</span><span class="s2">"westeurope"</span>
</span><span id="__span-26-4"><a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="nv">STORAGE_ACCOUNT</span><span class="o">=</span><span class="s2">"tfstate</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="s2">"</span><span class="w">  </span><span class="c1"># Nombre único</span>
</span><span id="__span-26-5"><a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="nv">CONTAINER</span><span class="o">=</span><span class="s2">"tfstate"</span>
</span><span id="__span-26-6"><a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a>
</span><span id="__span-26-7"><a href="#__codelineno-26-7" id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="c1"># Crear resource group</span>
</span><span id="__span-26-8"><a href="#__codelineno-26-8" id="__codelineno-26-8" name="__codelineno-26-8"></a>az<span class="w"> </span>group<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-9"><a href="#__codelineno-26-9" id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-10"><a href="#__codelineno-26-10" id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span>
</span><span id="__span-26-11"><a href="#__codelineno-26-11" id="__codelineno-26-11" name="__codelineno-26-11"></a>
</span><span id="__span-26-12"><a href="#__codelineno-26-12" id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="c1"># Crear storage account</span>
</span><span id="__span-26-13"><a href="#__codelineno-26-13" id="__codelineno-26-13" name="__codelineno-26-13"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-14"><a href="#__codelineno-26-14" id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-15"><a href="#__codelineno-26-15" id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-16"><a href="#__codelineno-26-16" id="__codelineno-26-16" name="__codelineno-26-16"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-17"><a href="#__codelineno-26-17" id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="w">  </span>--sku<span class="w"> </span>Standard_LRS<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-18"><a href="#__codelineno-26-18" id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="w">  </span>--encryption-services<span class="w"> </span>blob<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-19"><a href="#__codelineno-26-19" id="__codelineno-26-19" name="__codelineno-26-19"></a><span class="w">  </span>--min-tls-version<span class="w"> </span>TLS1_2
</span><span id="__span-26-20"><a href="#__codelineno-26-20" id="__codelineno-26-20" name="__codelineno-26-20"></a>
</span><span id="__span-26-21"><a href="#__codelineno-26-21" id="__codelineno-26-21" name="__codelineno-26-21"></a><span class="c1"># Crear container</span>
</span><span id="__span-26-22"><a href="#__codelineno-26-22" id="__codelineno-26-22" name="__codelineno-26-22"></a>az<span class="w"> </span>storage<span class="w"> </span>container<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-23"><a href="#__codelineno-26-23" id="__codelineno-26-23" name="__codelineno-26-23"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$CONTAINER</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-24"><a href="#__codelineno-26-24" id="__codelineno-26-24" name="__codelineno-26-24"></a><span class="w">  </span>--account-name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-25"><a href="#__codelineno-26-25" id="__codelineno-26-25" name="__codelineno-26-25"></a><span class="w">  </span>--auth-mode<span class="w"> </span>login
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Naming convention</p>
<p>Storage account solo acepta lowercase y números, máximo 24 caracteres. Usa un sufijo único para evitar colisiones.</p>
</div>
<h4 id="2-configurar-backend-en-terraform"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#2-configurar-backend-en-terraform">2. Configurar backend en Terraform</a></h4>
<p><code>backend.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-27-1"><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-2"><a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="w">  </span><span class="kr">backend</span><span class="w"> </span><span class="nv">"azurerm"</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-3"><a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">    </span><span class="na">resource_group_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"terraform-state-rg"</span>
</span><span id="__span-27-4"><a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">    </span><span class="na">storage_account_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tfstate1234567890"</span>
</span><span id="__span-27-5"><a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">    </span><span class="na">container_name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"tfstate"</span>
</span><span id="__span-27-6"><a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="w">    </span><span class="na">key</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">"prod.terraform.tfstate"</span>
</span><span id="__span-27-7"><a href="#__codelineno-27-7" id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-8"><a href="#__codelineno-27-8" id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="3-inicializar"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#3-inicializar">3. Inicializar</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1"># Login a Azure</span>
</span><span id="__span-28-2"><a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a>az<span class="w"> </span>login
</span><span id="__span-28-3"><a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a>
</span><span id="__span-28-4"><a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="c1"># Inicializar backend</span>
</span><span id="__span-28-5"><a href="#__codelineno-28-5" id="__codelineno-28-5" name="__codelineno-28-5"></a>terraform<span class="w"> </span>init
</span><span id="__span-28-6"><a href="#__codelineno-28-6" id="__codelineno-28-6" name="__codelineno-28-6"></a>
</span><span id="__span-28-7"><a href="#__codelineno-28-7" id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="c1"># Migrar estado existente (si aplica)</span>
</span><span id="__span-28-8"><a href="#__codelineno-28-8" id="__codelineno-28-8" name="__codelineno-28-8"></a>terraform<span class="w"> </span>init<span class="w"> </span>-migrate-state
</span></code></pre></div>
<h3 id="state-locking"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#state-locking">State locking</a></h3>
<p>Azure usa blob leases para locking automático:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c1"># Ver si hay lock activo</span>
</span><span id="__span-29-2"><a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a>az<span class="w"> </span>storage<span class="w"> </span>blob<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-3"><a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="w">  </span>--container-name<span class="w"> </span><span class="nv">$CONTAINER</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-4"><a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">  </span>--name<span class="w"> </span>prod.terraform.tfstate<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-5"><a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="w">  </span>--account-name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-6"><a href="#__codelineno-29-6" id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="w">  </span>--query<span class="w"> </span><span class="s2">"properties.lease.status"</span>
</span></code></pre></div>
<p>Si alguien está ejecutando <code>terraform apply</code>, verás:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a>"locked"
</span></code></pre></div>
<h3 id="multi-entorno-con-workspaces"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#multi-entorno-con-workspaces">Multi-entorno con workspaces</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="c1"># Crear workspace por entorno</span>
</span><span id="__span-31-2"><a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a>terraform<span class="w"> </span>workspace<span class="w"> </span>new<span class="w"> </span>dev
</span><span id="__span-31-3"><a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a>terraform<span class="w"> </span>workspace<span class="w"> </span>new<span class="w"> </span>staging<span class="w">  </span>
</span><span id="__span-31-4"><a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a>terraform<span class="w"> </span>workspace<span class="w"> </span>new<span class="w"> </span>prod
</span><span id="__span-31-5"><a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a>
</span><span id="__span-31-6"><a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="c1"># Listar workspaces</span>
</span><span id="__span-31-7"><a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a>terraform<span class="w"> </span>workspace<span class="w"> </span>list
</span><span id="__span-31-8"><a href="#__codelineno-31-8" id="__codelineno-31-8" name="__codelineno-31-8"></a>
</span><span id="__span-31-9"><a href="#__codelineno-31-9" id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="c1"># Cambiar entre entornos</span>
</span><span id="__span-31-10"><a href="#__codelineno-31-10" id="__codelineno-31-10" name="__codelineno-31-10"></a>terraform<span class="w"> </span>workspace<span class="w"> </span><span class="k">select</span><span class="w"> </span>prod
</span></code></pre></div>
<p>Cada workspace crea su propio state file:
</p><div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a>prod.terraform.tfstate
</span><span id="__span-32-2"><a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a>dev.terraform.tfstate
</span><span id="__span-32-3"><a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a>staging.terraform.tfstate
</span></code></pre></div><p></p>
<h3 id="seguridad-managed-identity"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#seguridad-managed-identity">Seguridad: Managed Identity</a></h3>
<p>Evita usar access keys en pipelines:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="c1"># Crear managed identity</span>
</span><span id="__span-33-2"><a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a>az<span class="w"> </span>identity<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-3"><a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-4"><a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="w">  </span>--name<span class="w"> </span>terraform-identity
</span><span id="__span-33-5"><a href="#__codelineno-33-5" id="__codelineno-33-5" name="__codelineno-33-5"></a>
</span><span id="__span-33-6"><a href="#__codelineno-33-6" id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="c1"># Asignar rol Storage Blob Data Contributor</span>
</span><span id="__span-33-7"><a href="#__codelineno-33-7" id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="nv">IDENTITY_ID</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>identity<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-8"><a href="#__codelineno-33-8" id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-9"><a href="#__codelineno-33-9" id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="w">  </span>--name<span class="w"> </span>terraform-identity<span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-10"><a href="#__codelineno-33-10" id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="w">  </span>--query<span class="w"> </span>principalId<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>
</span><span id="__span-33-11"><a href="#__codelineno-33-11" id="__codelineno-33-11" name="__codelineno-33-11"></a>
</span><span id="__span-33-12"><a href="#__codelineno-33-12" id="__codelineno-33-12" name="__codelineno-33-12"></a>az<span class="w"> </span>role<span class="w"> </span>assignment<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-13"><a href="#__codelineno-33-13" id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="w">  </span>--role<span class="w"> </span><span class="s2">"Storage Blob Data Contributor"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-14"><a href="#__codelineno-33-14" id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="w">  </span>--assignee<span class="w"> </span><span class="nv">$IDENTITY_ID</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-15"><a href="#__codelineno-33-15" id="__codelineno-33-15" name="__codelineno-33-15"></a><span class="w">  </span>--scope<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourceGroups/<span class="nv">$RG</span>/providers/Microsoft.Storage/storageAccounts/<span class="nv">$STORAGE_ACCOUNT</span>
</span></code></pre></div>
<p>Backend config con managed identity:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-34-1"><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-2"><a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="w">  </span><span class="kr">backend</span><span class="w"> </span><span class="nv">"azurerm"</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-3"><a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="w">    </span><span class="na">resource_group_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"terraform-state-rg"</span>
</span><span id="__span-34-4"><a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="w">    </span><span class="na">storage_account_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tfstate1234567890"</span>
</span><span id="__span-34-5"><a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="w">    </span><span class="na">container_name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"tfstate"</span>
</span><span id="__span-34-6"><a href="#__codelineno-34-6" id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="w">    </span><span class="na">key</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">"prod.terraform.tfstate"</span>
</span><span id="__span-34-7"><a href="#__codelineno-34-7" id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="w">    </span><span class="na">use_msi</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-34-8"><a href="#__codelineno-34-8" id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="w">    </span><span class="na">subscription_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"00000000-0000-0000-0000-000000000000"</span>
</span><span id="__span-34-9"><a href="#__codelineno-34-9" id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="w">    </span><span class="na">tenant_id</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">"00000000-0000-0000-0000-000000000000"</span>
</span><span id="__span-34-10"><a href="#__codelineno-34-10" id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-11"><a href="#__codelineno-34-11" id="__codelineno-34-11" name="__codelineno-34-11"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="versionado-del-estado"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#versionado-del-estado">Versionado del estado</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="c1"># Habilitar versioning en el container</span>
</span><span id="__span-35-2"><a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a>az<span class="w"> </span>storage<span class="w"> </span>blob<span class="w"> </span>service-properties<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-35-3"><a href="#__codelineno-35-3" id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="w">  </span>--account-name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-35-4"><a href="#__codelineno-35-4" id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">  </span>--enable-versioning<span class="w"> </span><span class="nb">true</span>
</span><span id="__span-35-5"><a href="#__codelineno-35-5" id="__codelineno-35-5" name="__codelineno-35-5"></a>
</span><span id="__span-35-6"><a href="#__codelineno-35-6" id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="c1"># Ver versiones anteriores</span>
</span><span id="__span-35-7"><a href="#__codelineno-35-7" id="__codelineno-35-7" name="__codelineno-35-7"></a>az<span class="w"> </span>storage<span class="w"> </span>blob<span class="w"> </span>list<span class="w"> </span><span class="se">\</span>
</span><span id="__span-35-8"><a href="#__codelineno-35-8" id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="w">  </span>--container-name<span class="w"> </span><span class="nv">$CONTAINER</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-35-9"><a href="#__codelineno-35-9" id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="w">  </span>--account-name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-35-10"><a href="#__codelineno-35-10" id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="w">  </span>--include<span class="w"> </span>v<span class="w"> </span><span class="se">\</span>
</span><span id="__span-35-11"><a href="#__codelineno-35-11" id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="w">  </span>--query<span class="w"> </span><span class="s2">"[?name=='prod.terraform.tfstate'].{Version:versionId, LastModified:properties.lastModified}"</span>
</span></code></pre></div>
<h3 id="pipeline-cicd-con-azure-devops"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#pipeline-cicd-con-azure-devops">Pipeline CI/CD con Azure DevOps</a></h3>
<p><code>azure-pipelines.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-36-1"><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="nt">trigger</span><span class="p">:</span>
</span><span id="__span-36-2"><a href="#__codelineno-36-2" id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id="__span-36-3"><a href="#__codelineno-36-3" id="__codelineno-36-3" name="__codelineno-36-3"></a>
</span><span id="__span-36-4"><a href="#__codelineno-36-4" id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="nt">pool</span><span class="p">:</span>
</span><span id="__span-36-5"><a href="#__codelineno-36-5" id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="w">  </span><span class="nt">vmImage</span><span class="p">:</span><span class="w"> </span><span class="s">'ubuntu-latest'</span>
</span><span id="__span-36-6"><a href="#__codelineno-36-6" id="__codelineno-36-6" name="__codelineno-36-6"></a>
</span><span id="__span-36-7"><a href="#__codelineno-36-7" id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-36-8"><a href="#__codelineno-36-8" id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform-variables</span>
</span><span id="__span-36-9"><a href="#__codelineno-36-9" id="__codelineno-36-9" name="__codelineno-36-9"></a>
</span><span id="__span-36-10"><a href="#__codelineno-36-10" id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="nt">stages</span><span class="p">:</span>
</span><span id="__span-36-11"><a href="#__codelineno-36-11" id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Plan</span>
</span><span id="__span-36-12"><a href="#__codelineno-36-12" id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="w">    </span><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-36-13"><a href="#__codelineno-36-13" id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TerraformPlan</span>
</span><span id="__span-36-14"><a href="#__codelineno-36-14" id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="w">        </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-36-15"><a href="#__codelineno-36-15" id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">task</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AzureCLI@2</span>
</span><span id="__span-36-16"><a href="#__codelineno-36-16" id="__codelineno-36-16" name="__codelineno-36-16"></a><span class="w">            </span><span class="nt">displayName</span><span class="p">:</span><span class="w"> </span><span class="s">'Terraform</span><span class="nv"> </span><span class="s">Init</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">Plan'</span>
</span><span id="__span-36-17"><a href="#__codelineno-36-17" id="__codelineno-36-17" name="__codelineno-36-17"></a><span class="w">            </span><span class="nt">inputs</span><span class="p">:</span>
</span><span id="__span-36-18"><a href="#__codelineno-36-18" id="__codelineno-36-18" name="__codelineno-36-18"></a><span class="w">              </span><span class="nt">azureSubscription</span><span class="p">:</span><span class="w"> </span><span class="s">'Azure</span><span class="nv"> </span><span class="s">Service</span><span class="nv"> </span><span class="s">Connection'</span>
</span><span id="__span-36-19"><a href="#__codelineno-36-19" id="__codelineno-36-19" name="__codelineno-36-19"></a><span class="w">              </span><span class="nt">scriptType</span><span class="p">:</span><span class="w"> </span><span class="s">'bash'</span>
</span><span id="__span-36-20"><a href="#__codelineno-36-20" id="__codelineno-36-20" name="__codelineno-36-20"></a><span class="w">              </span><span class="nt">scriptLocation</span><span class="p">:</span><span class="w"> </span><span class="s">'inlineScript'</span>
</span><span id="__span-36-21"><a href="#__codelineno-36-21" id="__codelineno-36-21" name="__codelineno-36-21"></a><span class="w">              </span><span class="nt">inlineScript</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-36-22"><a href="#__codelineno-36-22" id="__codelineno-36-22" name="__codelineno-36-22"></a><span class="w">                </span><span class="no">terraform init</span>
</span><span id="__span-36-23"><a href="#__codelineno-36-23" id="__codelineno-36-23" name="__codelineno-36-23"></a><span class="w">                </span><span class="no">terraform plan -out=tfplan</span>
</span><span id="__span-36-24"><a href="#__codelineno-36-24" id="__codelineno-36-24" name="__codelineno-36-24"></a>
</span><span id="__span-36-25"><a href="#__codelineno-36-25" id="__codelineno-36-25" name="__codelineno-36-25"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">publish</span><span class="p">:</span><span class="w"> </span><span class="s">'$(System.DefaultWorkingDirectory)/tfplan'</span>
</span><span id="__span-36-26"><a href="#__codelineno-36-26" id="__codelineno-36-26" name="__codelineno-36-26"></a><span class="w">            </span><span class="nt">artifact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tfplan</span>
</span><span id="__span-36-27"><a href="#__codelineno-36-27" id="__codelineno-36-27" name="__codelineno-36-27"></a>
</span><span id="__span-36-28"><a href="#__codelineno-36-28" id="__codelineno-36-28" name="__codelineno-36-28"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apply</span>
</span><span id="__span-36-29"><a href="#__codelineno-36-29" id="__codelineno-36-29" name="__codelineno-36-29"></a><span class="w">    </span><span class="nt">dependsOn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Plan</span>
</span><span id="__span-36-30"><a href="#__codelineno-36-30" id="__codelineno-36-30" name="__codelineno-36-30"></a><span class="w">    </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">succeeded()</span>
</span><span id="__span-36-31"><a href="#__codelineno-36-31" id="__codelineno-36-31" name="__codelineno-36-31"></a><span class="w">    </span><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-36-32"><a href="#__codelineno-36-32" id="__codelineno-36-32" name="__codelineno-36-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">deployment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TerraformApply</span>
</span><span id="__span-36-33"><a href="#__codelineno-36-33" id="__codelineno-36-33" name="__codelineno-36-33"></a><span class="w">        </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="s">'production'</span>
</span><span id="__span-36-34"><a href="#__codelineno-36-34" id="__codelineno-36-34" name="__codelineno-36-34"></a><span class="w">        </span><span class="nt">strategy</span><span class="p">:</span>
</span><span id="__span-36-35"><a href="#__codelineno-36-35" id="__codelineno-36-35" name="__codelineno-36-35"></a><span class="w">          </span><span class="nt">runOnce</span><span class="p">:</span>
</span><span id="__span-36-36"><a href="#__codelineno-36-36" id="__codelineno-36-36" name="__codelineno-36-36"></a><span class="w">            </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-36-37"><a href="#__codelineno-36-37" id="__codelineno-36-37" name="__codelineno-36-37"></a><span class="w">              </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-36-38"><a href="#__codelineno-36-38" id="__codelineno-36-38" name="__codelineno-36-38"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">download</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">current</span>
</span><span id="__span-36-39"><a href="#__codelineno-36-39" id="__codelineno-36-39" name="__codelineno-36-39"></a><span class="w">                  </span><span class="nt">artifact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tfplan</span>
</span><span id="__span-36-40"><a href="#__codelineno-36-40" id="__codelineno-36-40" name="__codelineno-36-40"></a>
</span><span id="__span-36-41"><a href="#__codelineno-36-41" id="__codelineno-36-41" name="__codelineno-36-41"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">task</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AzureCLI@2</span>
</span><span id="__span-36-42"><a href="#__codelineno-36-42" id="__codelineno-36-42" name="__codelineno-36-42"></a><span class="w">                  </span><span class="nt">displayName</span><span class="p">:</span><span class="w"> </span><span class="s">'Terraform</span><span class="nv"> </span><span class="s">Apply'</span>
</span><span id="__span-36-43"><a href="#__codelineno-36-43" id="__codelineno-36-43" name="__codelineno-36-43"></a><span class="w">                  </span><span class="nt">inputs</span><span class="p">:</span>
</span><span id="__span-36-44"><a href="#__codelineno-36-44" id="__codelineno-36-44" name="__codelineno-36-44"></a><span class="w">                    </span><span class="nt">azureSubscription</span><span class="p">:</span><span class="w"> </span><span class="s">'Azure</span><span class="nv"> </span><span class="s">Service</span><span class="nv"> </span><span class="s">Connection'</span>
</span><span id="__span-36-45"><a href="#__codelineno-36-45" id="__codelineno-36-45" name="__codelineno-36-45"></a><span class="w">                    </span><span class="nt">scriptType</span><span class="p">:</span><span class="w"> </span><span class="s">'bash'</span>
</span><span id="__span-36-46"><a href="#__codelineno-36-46" id="__codelineno-36-46" name="__codelineno-36-46"></a><span class="w">                    </span><span class="nt">scriptLocation</span><span class="p">:</span><span class="w"> </span><span class="s">'inlineScript'</span>
</span><span id="__span-36-47"><a href="#__codelineno-36-47" id="__codelineno-36-47" name="__codelineno-36-47"></a><span class="w">                    </span><span class="nt">inlineScript</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-36-48"><a href="#__codelineno-36-48" id="__codelineno-36-48" name="__codelineno-36-48"></a><span class="w">                      </span><span class="no">terraform init</span>
</span><span id="__span-36-49"><a href="#__codelineno-36-49" id="__codelineno-36-49" name="__codelineno-36-49"></a><span class="w">                      </span><span class="no">terraform apply tfplan</span>
</span></code></pre></div>
<h3 id="troubleshooting"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#troubleshooting">Troubleshooting</a></h3>
<p><strong>Error: "Failed to lock state"</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a href="#__codelineno-37-1" id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1"># Forzar unlock (solo si estás seguro)</span>
</span><span id="__span-37-2"><a href="#__codelineno-37-2" id="__codelineno-37-2" name="__codelineno-37-2"></a>terraform<span class="w"> </span>force-unlock<span class="w"> </span>&lt;LOCK_ID&gt;
</span><span id="__span-37-3"><a href="#__codelineno-37-3" id="__codelineno-37-3" name="__codelineno-37-3"></a>
</span><span id="__span-37-4"><a href="#__codelineno-37-4" id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="c1"># O romper lease manualmente</span>
</span><span id="__span-37-5"><a href="#__codelineno-37-5" id="__codelineno-37-5" name="__codelineno-37-5"></a>az<span class="w"> </span>storage<span class="w"> </span>blob<span class="w"> </span>lease<span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-6"><a href="#__codelineno-37-6" id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="w">  </span>--container-name<span class="w"> </span><span class="nv">$CONTAINER</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-7"><a href="#__codelineno-37-7" id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="w">  </span>--blob-name<span class="w"> </span>prod.terraform.tfstate<span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-8"><a href="#__codelineno-37-8" id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="w">  </span>--account-name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span>
</span></code></pre></div>
<p><strong>Error: "storage account not found"</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="c1"># Verificar permisos</span>
</span><span id="__span-38-2"><a href="#__codelineno-38-2" id="__codelineno-38-2" name="__codelineno-38-2"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-38-3"><a href="#__codelineno-38-3" id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-38-4"><a href="#__codelineno-38-4" id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span>
</span></code></pre></div>
<h3 id="buenas-practicas"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#buenas-practicas">Buenas prácticas</a></h3>
<ul>
<li><strong>State file por proyecto</strong>: No mezcles infraestructuras diferentes</li>
<li><strong>Soft delete</strong>: Habilita soft delete en storage account</li>
<li><strong>Network security</strong>: Restringe acceso desde VNet específicas</li>
<li><strong>Audit logs</strong>: Habilita diagnostic settings para compliance</li>
<li><strong>Backup externo</strong>: Exporta estados críticos a otro storage account</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Never commit state files</p>
<p>Añade <code>*.tfstate*</code> a <code>.gitignore</code>. El state contiene secretos en plaintext.</p>
</div>
<h3 id="referencias"><a class="toclink" href="../../2025/01/12/terraform-backend-en-azure-storage-setup-completo/#referencias">Referencias</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/developer/terraform/store-state-in-azure-storage">Store Terraform state in Azure Storage</a></li>
<li><a href="https://developer.hashicorp.com/terraform/language/settings/backends/azurerm">Terraform azurerm backend</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-01-08 00:00:00+00:00">January 8, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../category/azure-security/">Azure Security</a></li>
<li class="md-meta__item">
            
              4 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-bastion-ssh-y-rdp-sin-exponer-ips-publicas"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/">Azure Bastion: SSH y RDP sin exponer IPs públicas</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#resumen">Resumen</a></h3>
<p>Azure Bastion te permite conectarte a tus VMs sin asignarles IP pública. Funciona como jump server managed que accedes desde el portal de Azure. Ideal para cumplir con políticas de seguridad estrictas.</p>
<h3 id="que-es-azure-bastion"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#que-es-azure-bastion">¿Qué es Azure Bastion?</a></h3>
<p>Azure Bastion es un servicio PaaS que despliegas en tu VNet y proporciona:</p>
<ul>
<li>Conectividad RDP/SSH segura sobre SSL (puerto 443)</li>
<li>Sin necesidad de IP pública en las VMs</li>
<li>Sin agentes ni software cliente</li>
<li>Protección contra port scanning y zero-day exploits</li>
</ul>
<h3 id="arquitectura"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#arquitectura">Arquitectura</a></h3>
<pre class="mermaid"><code>graph LR
    A[Usuario] --&gt;|HTTPS 443| B[Azure Bastion]
    B --&gt;|Private IP| C[VM Linux SSH]
    B --&gt;|Private IP| D[VM Windows RDP]
    B -.subnet dedicado.- E[AzureBastionSubnet]
</code></pre>
<h3 id="despliegue-basico"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#despliegue-basico">Despliegue básico</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># Variables</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="nv">RG</span><span class="o">=</span><span class="s2">"my-rg"</span>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="nv">LOCATION</span><span class="o">=</span><span class="s2">"westeurope"</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="nv">VNET_NAME</span><span class="o">=</span><span class="s2">"my-vnet"</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="nv">BASTION_NAME</span><span class="o">=</span><span class="s2">"my-bastion"</span>
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a>
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="c1"># Crear subnet específica para Bastion (nombre obligatorio)</span>
</span><span id="__span-14-8"><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>subnet<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-9"><a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-10"><a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">  </span>--vnet-name<span class="w"> </span><span class="nv">$VNET_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-11"><a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">  </span>--name<span class="w"> </span>AzureBastionSubnet<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-12"><a href="#__codelineno-14-12" id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="w">  </span>--address-prefixes<span class="w"> </span><span class="m">10</span>.0.255.0/26
</span><span id="__span-14-13"><a href="#__codelineno-14-13" id="__codelineno-14-13" name="__codelineno-14-13"></a>
</span><span id="__span-14-14"><a href="#__codelineno-14-14" id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="c1"># Crear IP pública para Bastion</span>
</span><span id="__span-14-15"><a href="#__codelineno-14-15" id="__codelineno-14-15" name="__codelineno-14-15"></a>az<span class="w"> </span>network<span class="w"> </span>public-ip<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-16"><a href="#__codelineno-14-16" id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-17"><a href="#__codelineno-14-17" id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="w">  </span>--name<span class="w"> </span><span class="si">${</span><span class="nv">BASTION_NAME</span><span class="si">}</span>-pip<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-18"><a href="#__codelineno-14-18" id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="w">  </span>--sku<span class="w"> </span>Standard<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-19"><a href="#__codelineno-14-19" id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span>
</span><span id="__span-14-20"><a href="#__codelineno-14-20" id="__codelineno-14-20" name="__codelineno-14-20"></a>
</span><span id="__span-14-21"><a href="#__codelineno-14-21" id="__codelineno-14-21" name="__codelineno-14-21"></a><span class="c1"># Crear Azure Bastion</span>
</span><span id="__span-14-22"><a href="#__codelineno-14-22" id="__codelineno-14-22" name="__codelineno-14-22"></a>az<span class="w"> </span>network<span class="w"> </span>bastion<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-23"><a href="#__codelineno-14-23" id="__codelineno-14-23" name="__codelineno-14-23"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-24"><a href="#__codelineno-14-24" id="__codelineno-14-24" name="__codelineno-14-24"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$BASTION_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-25"><a href="#__codelineno-14-25" id="__codelineno-14-25" name="__codelineno-14-25"></a><span class="w">  </span>--public-ip-address<span class="w"> </span><span class="si">${</span><span class="nv">BASTION_NAME</span><span class="si">}</span>-pip<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-26"><a href="#__codelineno-14-26" id="__codelineno-14-26" name="__codelineno-14-26"></a><span class="w">  </span>--vnet-name<span class="w"> </span><span class="nv">$VNET_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-27"><a href="#__codelineno-14-27" id="__codelineno-14-27" name="__codelineno-14-27"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Requisitos de subnet</p>
<ul>
<li>El subnet DEBE llamarse <code>AzureBastionSubnet</code></li>
<li>Mínimo /26 (64 IPs)</li>
<li>No puede tener NSG restrictivo</li>
</ul>
</div>
<h3 id="conexion-a-vms"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#conexion-a-vms">Conexión a VMs</a></h3>
<h4 id="desde-el-portal"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#desde-el-portal">Desde el Portal</a></h4>
<ol>
<li>Ir a la VM → Connect → Bastion</li>
<li>Introducir credenciales</li>
<li>Conectar en el navegador</li>
</ol>
<h4 id="desde-cli-requiere-standard-sku"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#desde-cli-requiere-standard-sku">Desde CLI (requiere Standard SKU)</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1"># Conectar a VM Linux</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a>az<span class="w"> </span>network<span class="w"> </span>bastion<span class="w"> </span>ssh<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$BASTION_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">  </span>--target-resource-id<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourceGroups/<span class="nv">$RG</span>/providers/Microsoft.Compute/virtualMachines/my-linux-vm<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">  </span>--auth-type<span class="w"> </span>password<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-7"><a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">  </span>--username<span class="w"> </span>azureuser
</span><span id="__span-15-8"><a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a>
</span><span id="__span-15-9"><a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="c1"># Conectar a VM Windows (requiere native client)</span>
</span><span id="__span-15-10"><a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a>az<span class="w"> </span>network<span class="w"> </span>bastion<span class="w"> </span>rdp<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-11"><a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-12"><a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$BASTION_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-13"><a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">  </span>--target-resource-id<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourceGroups/<span class="nv">$RG</span>/providers/Microsoft.Compute/virtualMachines/my-windows-vm
</span></code></pre></div>
<h3 id="skus-disponibles"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#skus-disponibles">SKUs disponibles</a></h3>
<table>
<thead>
<tr>
<th>SKU</th>
<th>Características</th>
<th>Precio aprox.</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Basic</strong></td>
<td>RDP/SSH desde portal</td>
<td>~140€/mes</td>
</tr>
<tr>
<td><strong>Standard</strong></td>
<td>+ CLI access, file copy, IP-based connection</td>
<td>~140€/mes + instancias</td>
</tr>
<tr>
<td><strong>Premium</strong></td>
<td>+ Kerberos auth, session recording</td>
<td>En preview</td>
</tr>
</tbody>
</table>
<h3 id="standard-sku-funcionalidades-avanzadas"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#standard-sku-funcionalidades-avanzadas">Standard SKU: Funcionalidades avanzadas</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># Actualizar a Standard SKU y habilitar features</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>az<span class="w"> </span>network<span class="w"> </span>bastion<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$BASTION_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span>--sku<span class="w"> </span>Standard<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">  </span>--enable-tunneling<span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">  </span>--enable-ip-connect<span class="w"> </span><span class="nb">true</span>
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a>
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="c1"># Escalar instancias (2-50) para alta disponibilidad</span>
</span><span id="__span-16-10"><a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a>az<span class="w"> </span>network<span class="w"> </span>bastion<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-11"><a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-12"><a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$BASTION_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-13"><a href="#__codelineno-16-13" id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">  </span>--scale-units<span class="w"> </span><span class="m">3</span>
</span></code></pre></div>
<p><strong>Nuevas capacidades con Standard:</strong>
- <strong>Native client support</strong>: Conectar con tu cliente SSH/RDP local vía <code>az network bastion</code>
- <strong>IP-based connection</strong>: Conectar a cualquier IP dentro de la VNet
- <strong>File transfer</strong>: Upload/download archivos vía tunnel
- <strong>Tunneling</strong>: Crear túneles SSH para port forwarding
- <strong>Shareable link</strong>: Generar URLs para acceso temporal (requiere Premium)</p>
<h3 id="copiar-archivos-standard-sku-con-tunneling"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#copiar-archivos-standard-sku-con-tunneling">Copiar archivos (Standard SKU con tunneling)</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># Crear tunnel SSH para file transfer</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>az<span class="w"> </span>network<span class="w"> </span>bastion<span class="w"> </span>tunnel<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$BASTION_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">  </span>--target-resource-id<span class="w"> </span>/subscriptions/<span class="o">{</span>sub<span class="o">}</span>/resourceGroups/<span class="nv">$RG</span>/providers/Microsoft.Compute/virtualMachines/my-vm<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">  </span>--resource-port<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">  </span>--port<span class="w"> </span><span class="m">2222</span>
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a>
</span><span id="__span-17-9"><a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="c1"># En otra terminal: upload archivo</span>
</span><span id="__span-17-10"><a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a>scp<span class="w"> </span>-P<span class="w"> </span><span class="m">2222</span><span class="w"> </span>local-file.txt<span class="w"> </span>azureuser@localhost:/home/azureuser/
</span><span id="__span-17-11"><a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a>
</span><span id="__span-17-12"><a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="c1"># Download archivo</span>
</span><span id="__span-17-13"><a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a>scp<span class="w"> </span>-P<span class="w"> </span><span class="m">2222</span><span class="w"> </span>azureuser@localhost:/home/azureuser/remote-file.txt<span class="w"> </span>./
</span></code></pre></div>
<p><strong>Tunnel para RDP:</strong>
</p><div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1"># Crear tunnel RDP (puerto 3389)</span>
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a>az<span class="w"> </span>network<span class="w"> </span>bastion<span class="w"> </span>tunnel<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$BASTION_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">  </span>--target-resource-id<span class="w"> </span>/subscriptions/<span class="o">{</span>sub<span class="o">}</span>/resourceGroups/<span class="nv">$RG</span>/providers/Microsoft.Compute/virtualMachines/my-windows-vm<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">  </span>--resource-port<span class="w"> </span><span class="m">3389</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-7"><a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">  </span>--port<span class="w"> </span><span class="m">13389</span>
</span><span id="__span-18-8"><a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a>
</span><span id="__span-18-9"><a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="c1"># Conectar con cliente RDP local a localhost:13389</span>
</span><span id="__span-18-10"><a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a>mstsc<span class="w"> </span>/v:localhost:13389
</span></code></pre></div><p></p>
<h3 id="monitoreo"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#monitoreo">Monitoreo</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="c1"># Ver métricas de sesiones</span>
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>az<span class="w"> </span>monitor<span class="w"> </span>metrics<span class="w"> </span>list<span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-3"><a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">  </span>--resource<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourceGroups/<span class="nv">$RG</span>/providers/Microsoft.Network/bastionHosts/<span class="nv">$BASTION_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-4"><a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="w">  </span>--metric<span class="w"> </span><span class="s2">"Sessions"</span>
</span><span id="__span-19-5"><a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a>
</span><span id="__span-19-6"><a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="c1"># Diagnostic logs</span>
</span><span id="__span-19-7"><a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a>az<span class="w"> </span>monitor<span class="w"> </span>diagnostic-settings<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-8"><a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="w">  </span>--resource<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourceGroups/<span class="nv">$RG</span>/providers/Microsoft.Network/bastionHosts/<span class="nv">$BASTION_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-9"><a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="w">  </span>--name<span class="w"> </span>bastion-logs<span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-10"><a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="w">  </span>--workspace<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourceGroups/<span class="nv">$RG</span>/providers/Microsoft.OperationalInsights/workspaces/my-law<span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-11"><a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="w">  </span>--logs<span class="w"> </span><span class="s1">'[{"category": "BastionAuditLogs", "enabled": true}]'</span>
</span></code></pre></div>
<h3 id="buenas-practicas"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#buenas-practicas">Buenas prácticas</a></h3>
<ul>
<li><strong>NSG en subnets de VMs</strong>: Permite solo tráfico desde AzureBastionSubnet</li>
<li><strong>JIT Access</strong>: Combina con Microsoft Defender for Cloud JIT</li>
<li><strong>Session recording</strong>: Habilita en Premium SKU para compliance</li>
<li><strong>Firewall rules</strong>: Bastion necesita acceso saliente a Internet (servicios Azure)</li>
<li><strong>Disaster recovery</strong>: Despliega Bastion en múltiples regiones</li>
</ul>
<h3 id="restricciones-de-red-nsg"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#restricciones-de-red-nsg">Restricciones de red (NSG)</a></h3>
<p>El subnet <code>AzureBastionSubnet</code> requiere reglas NSG específicas:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># Crear NSG para AzureBastionSubnet</span>
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a>az<span class="w"> </span>network<span class="w"> </span>nsg<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-4"><a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="si">${</span><span class="nv">BASTION_NAME</span><span class="si">}</span>-nsg
</span><span id="__span-20-5"><a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a>
</span><span id="__span-20-6"><a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="c1"># Inbound: HTTPS desde Internet</span>
</span><span id="__span-20-7"><a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a>az<span class="w"> </span>network<span class="w"> </span>nsg<span class="w"> </span>rule<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-8"><a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-9"><a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">  </span>--nsg-name<span class="w"> </span><span class="si">${</span><span class="nv">BASTION_NAME</span><span class="si">}</span>-nsg<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-10"><a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">  </span>--name<span class="w"> </span>AllowHttpsInbound<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-11"><a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">  </span>--priority<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-12"><a href="#__codelineno-20-12" id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="w">  </span>--source-address-prefixes<span class="w"> </span>Internet<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-13"><a href="#__codelineno-20-13" id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="w">  </span>--destination-port-ranges<span class="w"> </span><span class="m">443</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-14"><a href="#__codelineno-20-14" id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="w">  </span>--protocol<span class="w"> </span>Tcp<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-15"><a href="#__codelineno-20-15" id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="w">  </span>--access<span class="w"> </span>Allow<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-16"><a href="#__codelineno-20-16" id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="w">  </span>--direction<span class="w"> </span>Inbound
</span><span id="__span-20-17"><a href="#__codelineno-20-17" id="__codelineno-20-17" name="__codelineno-20-17"></a>
</span><span id="__span-20-18"><a href="#__codelineno-20-18" id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="c1"># Inbound: GatewayManager</span>
</span><span id="__span-20-19"><a href="#__codelineno-20-19" id="__codelineno-20-19" name="__codelineno-20-19"></a>az<span class="w"> </span>network<span class="w"> </span>nsg<span class="w"> </span>rule<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-20"><a href="#__codelineno-20-20" id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-21"><a href="#__codelineno-20-21" id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="w">  </span>--nsg-name<span class="w"> </span><span class="si">${</span><span class="nv">BASTION_NAME</span><span class="si">}</span>-nsg<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-22"><a href="#__codelineno-20-22" id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="w">  </span>--name<span class="w"> </span>AllowGatewayManager<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-23"><a href="#__codelineno-20-23" id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="w">  </span>--priority<span class="w"> </span><span class="m">110</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-24"><a href="#__codelineno-20-24" id="__codelineno-20-24" name="__codelineno-20-24"></a><span class="w">  </span>--source-address-prefixes<span class="w"> </span>GatewayManager<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-25"><a href="#__codelineno-20-25" id="__codelineno-20-25" name="__codelineno-20-25"></a><span class="w">  </span>--destination-port-ranges<span class="w"> </span><span class="m">443</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-26"><a href="#__codelineno-20-26" id="__codelineno-20-26" name="__codelineno-20-26"></a><span class="w">  </span>--protocol<span class="w"> </span>Tcp<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-27"><a href="#__codelineno-20-27" id="__codelineno-20-27" name="__codelineno-20-27"></a><span class="w">  </span>--access<span class="w"> </span>Allow<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-28"><a href="#__codelineno-20-28" id="__codelineno-20-28" name="__codelineno-20-28"></a><span class="w">  </span>--direction<span class="w"> </span>Inbound
</span><span id="__span-20-29"><a href="#__codelineno-20-29" id="__codelineno-20-29" name="__codelineno-20-29"></a>
</span><span id="__span-20-30"><a href="#__codelineno-20-30" id="__codelineno-20-30" name="__codelineno-20-30"></a><span class="c1"># Inbound: Bastion internal communication</span>
</span><span id="__span-20-31"><a href="#__codelineno-20-31" id="__codelineno-20-31" name="__codelineno-20-31"></a>az<span class="w"> </span>network<span class="w"> </span>nsg<span class="w"> </span>rule<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-32"><a href="#__codelineno-20-32" id="__codelineno-20-32" name="__codelineno-20-32"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-33"><a href="#__codelineno-20-33" id="__codelineno-20-33" name="__codelineno-20-33"></a><span class="w">  </span>--nsg-name<span class="w"> </span><span class="si">${</span><span class="nv">BASTION_NAME</span><span class="si">}</span>-nsg<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-34"><a href="#__codelineno-20-34" id="__codelineno-20-34" name="__codelineno-20-34"></a><span class="w">  </span>--name<span class="w"> </span>AllowBastionHostCommunication<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-35"><a href="#__codelineno-20-35" id="__codelineno-20-35" name="__codelineno-20-35"></a><span class="w">  </span>--priority<span class="w"> </span><span class="m">120</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-36"><a href="#__codelineno-20-36" id="__codelineno-20-36" name="__codelineno-20-36"></a><span class="w">  </span>--source-address-prefixes<span class="w"> </span>VirtualNetwork<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-37"><a href="#__codelineno-20-37" id="__codelineno-20-37" name="__codelineno-20-37"></a><span class="w">  </span>--destination-port-ranges<span class="w"> </span><span class="m">8080</span><span class="w"> </span><span class="m">5701</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-38"><a href="#__codelineno-20-38" id="__codelineno-20-38" name="__codelineno-20-38"></a><span class="w">  </span>--protocol<span class="w"> </span>Tcp<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-39"><a href="#__codelineno-20-39" id="__codelineno-20-39" name="__codelineno-20-39"></a><span class="w">  </span>--access<span class="w"> </span>Allow<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-40"><a href="#__codelineno-20-40" id="__codelineno-20-40" name="__codelineno-20-40"></a><span class="w">  </span>--direction<span class="w"> </span>Inbound
</span><span id="__span-20-41"><a href="#__codelineno-20-41" id="__codelineno-20-41" name="__codelineno-20-41"></a>
</span><span id="__span-20-42"><a href="#__codelineno-20-42" id="__codelineno-20-42" name="__codelineno-20-42"></a><span class="c1"># Outbound: SSH/RDP a VMs</span>
</span><span id="__span-20-43"><a href="#__codelineno-20-43" id="__codelineno-20-43" name="__codelineno-20-43"></a>az<span class="w"> </span>network<span class="w"> </span>nsg<span class="w"> </span>rule<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-44"><a href="#__codelineno-20-44" id="__codelineno-20-44" name="__codelineno-20-44"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-45"><a href="#__codelineno-20-45" id="__codelineno-20-45" name="__codelineno-20-45"></a><span class="w">  </span>--nsg-name<span class="w"> </span><span class="si">${</span><span class="nv">BASTION_NAME</span><span class="si">}</span>-nsg<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-46"><a href="#__codelineno-20-46" id="__codelineno-20-46" name="__codelineno-20-46"></a><span class="w">  </span>--name<span class="w"> </span>AllowSshRdpOutbound<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-47"><a href="#__codelineno-20-47" id="__codelineno-20-47" name="__codelineno-20-47"></a><span class="w">  </span>--priority<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-48"><a href="#__codelineno-20-48" id="__codelineno-20-48" name="__codelineno-20-48"></a><span class="w">  </span>--destination-address-prefixes<span class="w"> </span>VirtualNetwork<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-49"><a href="#__codelineno-20-49" id="__codelineno-20-49" name="__codelineno-20-49"></a><span class="w">  </span>--destination-port-ranges<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">3389</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-50"><a href="#__codelineno-20-50" id="__codelineno-20-50" name="__codelineno-20-50"></a><span class="w">  </span>--protocol<span class="w"> </span>Tcp<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-51"><a href="#__codelineno-20-51" id="__codelineno-20-51" name="__codelineno-20-51"></a><span class="w">  </span>--access<span class="w"> </span>Allow<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-52"><a href="#__codelineno-20-52" id="__codelineno-20-52" name="__codelineno-20-52"></a><span class="w">  </span>--direction<span class="w"> </span>Outbound
</span><span id="__span-20-53"><a href="#__codelineno-20-53" id="__codelineno-20-53" name="__codelineno-20-53"></a>
</span><span id="__span-20-54"><a href="#__codelineno-20-54" id="__codelineno-20-54" name="__codelineno-20-54"></a><span class="c1"># Outbound: Azure Cloud (servicios de Azure)</span>
</span><span id="__span-20-55"><a href="#__codelineno-20-55" id="__codelineno-20-55" name="__codelineno-20-55"></a>az<span class="w"> </span>network<span class="w"> </span>nsg<span class="w"> </span>rule<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-56"><a href="#__codelineno-20-56" id="__codelineno-20-56" name="__codelineno-20-56"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-57"><a href="#__codelineno-20-57" id="__codelineno-20-57" name="__codelineno-20-57"></a><span class="w">  </span>--nsg-name<span class="w"> </span><span class="si">${</span><span class="nv">BASTION_NAME</span><span class="si">}</span>-nsg<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-58"><a href="#__codelineno-20-58" id="__codelineno-20-58" name="__codelineno-20-58"></a><span class="w">  </span>--name<span class="w"> </span>AllowAzureCloudOutbound<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-59"><a href="#__codelineno-20-59" id="__codelineno-20-59" name="__codelineno-20-59"></a><span class="w">  </span>--priority<span class="w"> </span><span class="m">110</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-60"><a href="#__codelineno-20-60" id="__codelineno-20-60" name="__codelineno-20-60"></a><span class="w">  </span>--destination-address-prefixes<span class="w"> </span>AzureCloud<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-61"><a href="#__codelineno-20-61" id="__codelineno-20-61" name="__codelineno-20-61"></a><span class="w">  </span>--destination-port-ranges<span class="w"> </span><span class="m">443</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-62"><a href="#__codelineno-20-62" id="__codelineno-20-62" name="__codelineno-20-62"></a><span class="w">  </span>--protocol<span class="w"> </span>Tcp<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-63"><a href="#__codelineno-20-63" id="__codelineno-20-63" name="__codelineno-20-63"></a><span class="w">  </span>--access<span class="w"> </span>Allow<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-64"><a href="#__codelineno-20-64" id="__codelineno-20-64" name="__codelineno-20-64"></a><span class="w">  </span>--direction<span class="w"> </span>Outbound
</span><span id="__span-20-65"><a href="#__codelineno-20-65" id="__codelineno-20-65" name="__codelineno-20-65"></a>
</span><span id="__span-20-66"><a href="#__codelineno-20-66" id="__codelineno-20-66" name="__codelineno-20-66"></a><span class="c1"># Asociar NSG al subnet</span>
</span><span id="__span-20-67"><a href="#__codelineno-20-67" id="__codelineno-20-67" name="__codelineno-20-67"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>subnet<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-68"><a href="#__codelineno-20-68" id="__codelineno-20-68" name="__codelineno-20-68"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-69"><a href="#__codelineno-20-69" id="__codelineno-20-69" name="__codelineno-20-69"></a><span class="w">  </span>--vnet-name<span class="w"> </span><span class="nv">$VNET_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-70"><a href="#__codelineno-20-70" id="__codelineno-20-70" name="__codelineno-20-70"></a><span class="w">  </span>--name<span class="w"> </span>AzureBastionSubnet<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-71"><a href="#__codelineno-20-71" id="__codelineno-20-71" name="__codelineno-20-71"></a><span class="w">  </span>--network-security-group<span class="w"> </span><span class="si">${</span><span class="nv">BASTION_NAME</span><span class="si">}</span>-nsg
</span></code></pre></div>
<h3 id="costos"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#costos">Costos</a></h3>
<p>Ejemplo en West Europe:
- Basic: ~€140/mes (fijo)
- Standard: ~€140/mes + ~€9/instancia adicional/mes
- Tráfico outbound: Estándar Azure</p>
<div class="admonition tip">
<p class="admonition-title">Ahorro</p>
<p>Si solo necesitas acceso ocasional, considera apagar/encender Bastion. Pagas solo por las horas que está running.</p>
</div>
<h3 id="alternativas"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#alternativas">Alternativas</a></h3>
<ul>
<li><strong>Azure VPN Gateway</strong>: Para acceso permanente desde on-premises</li>
<li><strong>Azure Virtual WAN</strong>: Para topologías hub-spoke complejas</li>
<li><strong>Just-in-Time Access</strong>: Para exposición temporal de puertos</li>
</ul>
<h3 id="referencias"><a class="toclink" href="../../2025/01/08/azure-bastion-ssh-y-rdp-sin-exponer-ips-p%C3%BAblicas/#referencias">Referencias</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/bastion/bastion-overview">What is Azure Bastion?</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/bastion/configuration-settings">Azure Bastion configuration settings</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-01-05 00:00:00+00:00">January 5, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../category/azure-security/">Azure Security</a></li>
<li class="md-meta__item">
            
              4 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="rotacion-automatica-de-secretos-en-azure-key-vault"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/">Rotación automática de secretos en Azure Key Vault</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#resumen">Resumen</a></h3>
<p>Rotar secretos manualmente es error-prone y tedioso. Azure Key Vault soporta rotación automatizada mediante Event Grid + Azure Functions. Aquí te muestro cómo implementarla paso a paso.</p>
<h3 id="por-que-rotar-secretos"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#por-que-rotar-secretos">¿Por qué rotar secretos?</a></h3>
<ul>
<li><strong>Compliance</strong>: PCI-DSS, SOC2 exigen rotación periódica</li>
<li><strong>Seguridad</strong>: Limita ventana de exposición si hay leak</li>
<li><strong>Best practice</strong>: NIST recomienda rotación cada 90 días</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Keys vs Secrets</p>
<ul>
<li><strong>Keys criptográficas</strong>: Tienen rotación nativa con rotation policy</li>
<li><strong>Secrets</strong> (passwords, API keys): Requieren Event Grid + Function App</li>
</ul>
<p>Este artículo cubre <strong>secrets</strong>. Para keys, ver <a href="https://learn.microsoft.com/en-us/azure/key-vault/keys/how-to-configure-key-rotation">Configure key rotation</a>.</p>
</div>
<h3 id="arquitectura-de-rotacion-automatica"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#arquitectura-de-rotacion-automatica">Arquitectura de rotación automática</a></h3>
<p>Azure Key Vault usa Event Grid para notificar cuando un secreto está cerca de expirar:</p>
<pre class="mermaid"><code>graph LR
    A[Key Vault Secret] --&gt;|30 días antes expiración| B[Event Grid]
    B --&gt;|SecretNearExpiry event| C[Function App]
    C --&gt;|Genera nuevo secret| D[Servicio Externo/SQL]
    C --&gt;|Actualiza secreto| A
</code></pre>
<p><strong>Proceso:</strong>
1. Key Vault publica evento <code>SecretNearExpiry</code> 30 días antes de expiración
2. Event Grid llama a Function App vía HTTP POST
3. Function genera nuevo secreto y actualiza el servicio
4. Function actualiza Key Vault con nueva versión del secreto</p>
<h3 id="implementacion-rotar-sql-server-password"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#implementacion-rotar-sql-server-password">Implementación: Rotar SQL Server password</a></h3>
<h4 id="1-crear-secreto-con-fecha-de-expiracion"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#1-crear-secreto-con-fecha-de-expiracion">1. Crear secreto con fecha de expiración</a></h4>
<h4 id="1-crear-secreto-con-fecha-de-expiracion_1"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#1-crear-secreto-con-fecha-de-expiracion_1">1. Crear secreto con fecha de expiración</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1"># Variables</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="nv">RG</span><span class="o">=</span><span class="s2">"my-rg"</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="nv">KV_NAME</span><span class="o">=</span><span class="s2">"my-keyvault"</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="nv">SECRET_NAME</span><span class="o">=</span><span class="s2">"sql-admin-password"</span>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="nv">SQL_SERVER</span><span class="o">=</span><span class="s2">"my-sql-server"</span>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a>
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="c1"># Crear secreto con expiración 90 días</span>
</span><span id="__span-12-8"><a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="nv">EXPIRY_DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>-u<span class="w"> </span>-d<span class="w"> </span><span class="s2">"+90 days"</span><span class="w"> </span>+<span class="s1">'%Y-%m-%dT%H:%M:%SZ'</span><span class="k">)</span>
</span><span id="__span-12-9"><a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a>
</span><span id="__span-12-10"><a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a>az<span class="w"> </span>keyvault<span class="w"> </span>secret<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-11"><a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">  </span>--vault-name<span class="w"> </span><span class="nv">$KV_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-12"><a href="#__codelineno-12-12" id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$SECRET_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-13"><a href="#__codelineno-12-13" id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="w">  </span>--value<span class="w"> </span><span class="s2">"InitialP@ssw0rd!"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-14"><a href="#__codelineno-12-14" id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="w">  </span>--expires<span class="w"> </span><span class="nv">$EXPIRY_DATE</span>
</span></code></pre></div>
<h4 id="2-desplegar-function-app-de-rotacion"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#2-desplegar-function-app-de-rotacion">2. Desplegar Function App de rotación</a></h4>
<p>Usar template oficial de Microsoft:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># Deploy ARM template con Function App preconfigurada</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a>az<span class="w"> </span>deployment<span class="w"> </span>group<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">  </span>--template-uri<span class="w"> </span>https://raw.githubusercontent.com/Azure-Samples/KeyVault-Rotation-SQLPassword-Csharp/main/ARM-Templates/Function/azuredeploy.json<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">  </span>--parameters<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">    </span><span class="nv">sqlServerName</span><span class="o">=</span><span class="nv">$SQL_SERVER</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-7"><a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">    </span><span class="nv">keyVaultName</span><span class="o">=</span><span class="nv">$KV_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-8"><a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">    </span><span class="nv">functionAppName</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">KV_NAME</span><span class="si">}</span><span class="s2">-rotation-func"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-9"><a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">    </span><span class="nv">secretName</span><span class="o">=</span><span class="nv">$SECRET_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-10"><a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">    </span><span class="nv">repoUrl</span><span class="o">=</span><span class="s2">"https://github.com/Azure-Samples/KeyVault-Rotation-SQLPassword-Csharp.git"</span>
</span></code></pre></div>
<p>Este template despliega:
- Function App con managed identity
- Event Grid subscription a <code>SecretNearExpiry</code>
- Access policy de Key Vault para la función
- Código de rotación preconfigura do</p>
<h4 id="3-codigo-de-la-funcion-incluido-en-el-template"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#3-codigo-de-la-funcion-incluido-en-el-template">3. Código de la función (incluido en el template)</a></h4>
<h4 id="3-codigo-de-la-funcion-incluido-en-el-template_1"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#3-codigo-de-la-funcion-incluido-en-el-template_1">3. Código de la función (incluido en el template)</a></h4>
<p>La función C# incluida en el template maneja:
- Recibe evento <code>SecretNearExpiry</code> de Event Grid
- Extrae nombre del secreto y versión
- Genera nuevo password aleatorio
- Actualiza SQL Server con nuevo password
- Crea nueva versión del secreto en Key Vault</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1">// Código simplificado (el template incluye implementación completa)</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="na">[FunctionName("AKVSQLRotation")]</span>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Run</span><span class="p">([</span><span class="n">EventGridTrigger</span><span class="p">]</span><span class="n">EventGridEvent</span><span class="w"> </span><span class="n">eventGridEvent</span><span class="p">)</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="p">{</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">secretName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventGridEvent</span><span class="p">.</span><span class="n">Subject</span><span class="p">;</span>
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">keyVaultName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ExtractVaultName</span><span class="p">(</span><span class="n">eventGridEvent</span><span class="p">.</span><span class="n">Topic</span><span class="p">);</span>
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a>
</span><span id="__span-14-8"><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">    </span><span class="c1">// Rotar password</span>
</span><span id="__span-14-9"><a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">    </span><span class="n">SecretRotator</span><span class="p">.</span><span class="n">RotateSecret</span><span class="p">(</span><span class="n">log</span><span class="p">,</span><span class="w"> </span><span class="n">secretName</span><span class="p">,</span><span class="w"> </span><span class="n">keyVaultName</span><span class="p">);</span>
</span><span id="__span-14-10"><a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="implementacion-rotar-storage-account-keys"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#implementacion-rotar-storage-account-keys">Implementación: Rotar Storage Account keys</a></h3>
<p>Para servicios con <strong>dos sets de credenciales</strong> (primary/secondary keys):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1"># Deploy template para Storage Account rotation</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a>az<span class="w"> </span>deployment<span class="w"> </span>group<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">  </span>--template-uri<span class="w"> </span>https://raw.githubusercontent.com/Azure-Samples/KeyVault-Rotation-StorageAccountKey-PowerShell/master/ARM-Templates/Function/azuredeploy.json<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">  </span>--parameters<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">    </span><span class="nv">storageAccountName</span><span class="o">=</span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-7"><a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">    </span><span class="nv">keyVaultName</span><span class="o">=</span><span class="nv">$KV_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-8"><a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">    </span><span class="nv">functionAppName</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">KV_NAME</span><span class="si">}</span><span class="s2">-storage-rotation"</span>
</span><span id="__span-15-9"><a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a>
</span><span id="__span-15-10"><a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="c1"># Crear secret con metadata para rotación</span>
</span><span id="__span-15-11"><a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="nv">EXPIRY_DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>-u<span class="w"> </span>-d<span class="w"> </span><span class="s2">"+60 days"</span><span class="w"> </span>+<span class="s1">'%Y-%m-%dT%H:%M:%SZ'</span><span class="k">)</span>
</span><span id="__span-15-12"><a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="nv">STORAGE_KEY</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>keys<span class="w"> </span>list<span class="w"> </span>-n<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span>--query<span class="w"> </span><span class="s2">"[0].value"</span><span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>
</span><span id="__span-15-13"><a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a>
</span><span id="__span-15-14"><a href="#__codelineno-15-14" id="__codelineno-15-14" name="__codelineno-15-14"></a>az<span class="w"> </span>keyvault<span class="w"> </span>secret<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-15"><a href="#__codelineno-15-15" id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">  </span>--vault-name<span class="w"> </span><span class="nv">$KV_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-16"><a href="#__codelineno-15-16" id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">  </span>--name<span class="w"> </span>storageKey<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-17"><a href="#__codelineno-15-17" id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">  </span>--value<span class="w"> </span><span class="s2">"</span><span class="nv">$STORAGE_KEY</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-18"><a href="#__codelineno-15-18" id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="w">  </span>--tags<span class="w"> </span><span class="nv">CredentialId</span><span class="o">=</span>key1<span class="w"> </span><span class="nv">ProviderAddress</span><span class="o">=</span><span class="s2">"/subscriptions/{sub}/resourceGroups/</span><span class="nv">$RG</span><span class="s2">/providers/Microsoft.Storage/storageAccounts/</span><span class="nv">$STORAGE_ACCOUNT</span><span class="s2">"</span><span class="w"> </span><span class="nv">ValidityPeriodDays</span><span class="o">=</span><span class="m">60</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-19"><a href="#__codelineno-15-19" id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="w">  </span>--expires<span class="w"> </span><span class="nv">$EXPIRY_DATE</span>
</span></code></pre></div>
<p><strong>Estrategia dual-key:</strong>
1. Key1 almacenada en Key Vault
2. Evento <code>SecretNearExpiry</code> activa rotación
3. Function regenera Key2 en Storage Account
4. Actualiza secreto en Key Vault con Key2
5. Próxima rotación alterna a Key1</p>
<h3 id="monitoreo-de-rotaciones"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#monitoreo-de-rotaciones">Monitoreo de rotaciones</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># Ver versiones de un secreto</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>az<span class="w"> </span>keyvault<span class="w"> </span>secret<span class="w"> </span>list-versions<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">  </span>--vault-name<span class="w"> </span><span class="nv">$KV_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$SECRET_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span>--query<span class="w"> </span><span class="s2">"[].{Version:id, Created:attributes.created, Expires:attributes.expires}"</span>
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a>
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="c1"># Ver última actualización</span>
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a>az<span class="w"> </span>keyvault<span class="w"> </span>secret<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">  </span>--vault-name<span class="w"> </span><span class="nv">$KV_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-10"><a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$SECRET_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-11"><a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">  </span>--query<span class="w"> </span><span class="s2">"attributes.{Updated:updated, Expires:expires, Enabled:enabled}"</span>
</span><span id="__span-16-12"><a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a>
</span><span id="__span-16-13"><a href="#__codelineno-16-13" id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="c1"># Ver logs de rotación en Function App</span>
</span><span id="__span-16-14"><a href="#__codelineno-16-14" id="__codelineno-16-14" name="__codelineno-16-14"></a>az<span class="w"> </span>monitor<span class="w"> </span>app-insights<span class="w"> </span>query<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-15"><a href="#__codelineno-16-15" id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w">  </span>--app<span class="w"> </span><span class="si">${</span><span class="nv">KV_NAME</span><span class="si">}</span>-rotation-func<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-16"><a href="#__codelineno-16-16" id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="w">  </span>--analytics-query<span class="w"> </span><span class="s2">"traces | where message contains 'Rotation' | top 10 by timestamp desc"</span>
</span></code></pre></div>
<h3 id="notificaciones-por-email"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#notificaciones-por-email">Notificaciones por email</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># Action Group para alertas</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>az<span class="w"> </span>monitor<span class="w"> </span>action-group<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">  </span>--name<span class="w"> </span>secret-rotation-alerts<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">  </span>--short-name<span class="w"> </span>SecRot<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">  </span>--email-receiver<span class="w"> </span>EmailAdmin<span class="w"> </span>admin@company.com
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a>
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="c1"># Alert rule</span>
</span><span id="__span-17-9"><a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a>az<span class="w"> </span>monitor<span class="w"> </span>metrics<span class="w"> </span>alert<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-10"><a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-11"><a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">  </span>--name<span class="w"> </span>secret-rotation-failed<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-12"><a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">  </span>--scopes<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourceGroups/<span class="nv">$RG</span>/providers/Microsoft.KeyVault/vaults/<span class="nv">$KV_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-13"><a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="w">  </span>--condition<span class="w"> </span><span class="s2">"count SecretRotationFailed &gt; 0"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-14"><a href="#__codelineno-17-14" id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="w">  </span>--action<span class="w"> </span>secret-rotation-alerts
</span></code></pre></div>
<h3 id="buenas-practicas"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#buenas-practicas">Buenas prácticas</a></h3>
<ul>
<li><strong>Overlap period</strong>: Mantén versión anterior válida 7-30 días</li>
<li><strong>Testing</strong>: Rota primero en entorno de dev/staging</li>
<li><strong>Documentación</strong>: Registra qué servicios usan cada secreto</li>
<li><strong>Backup</strong>: Exporta secretos críticos a offline storage encriptado</li>
<li><strong>Notificaciones</strong>: Configura alertas para rotaciones fallidas</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Secretos hardcodeados</p>
<p>La rotación no sirve de nada si tienes secretos hardcodeados en código o config files. Usa referencias a Key Vault (<code>@Microsoft.KeyVault(SecretUri=...)</code> en App Settings).</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Templates oficiales</p>
<p>Microsoft proporciona templates ARM completos para diferentes escenarios:
- <a href="https://github.com/Azure-Samples/KeyVault-Rotation-SQLPassword-Csharp">SQL password rotation</a>
- <a href="https://github.com/Azure-Samples/KeyVault-Rotation-StorageAccountKey-PowerShell">Storage Account keys rotation</a>
- Adaptables para otros servicios (Cosmos DB, Redis, APIs externas)</p>
</div>
<h3 id="referencias"><a class="toclink" href="../../2025/01/05/rotaci%C3%B3n-autom%C3%A1tica-de-secretos-en-azure-key-vault/#referencias">Referencias</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/key-vault/secrets/tutorial-rotation">Automate secret rotation (single credential)</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/key-vault/secrets/tutorial-rotation-dual">Automate secret rotation (dual credentials)</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/key-vault/general/autorotation">Understanding autorotation in Key Vault</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/key-vault/general/event-grid-overview">Key Vault Event Grid integration</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-01-02 00:00:00+00:00">January 2, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              3 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-app-service-deployment-slots-despliegues-sin-downtime"><a class="toclink" href="../../2025/01/02/azure-app-service-deployment-slots-despliegues-sin-downtime/">Azure App Service Deployment Slots: Despliegues sin downtime</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/01/02/azure-app-service-deployment-slots-despliegues-sin-downtime/#resumen">Resumen</a></h3>
<p>Los Deployment Slots en Azure App Service te permiten desplegar nuevas versiones de tu aplicación sin tiempo de inactividad. es la forma más sencilla de implementar blue-green deployments en Azure.</p>
<h3 id="que-son-los-deployment-slots"><a class="toclink" href="../../2025/01/02/azure-app-service-deployment-slots-despliegues-sin-downtime/#que-son-los-deployment-slots">¿Qué son los Deployment Slots?</a></h3>
<p>Los Deployment Slots son entornos en vivo dentro de tu App Service donde puedes desplegar diferentes versiones de tu aplicación. Cada slot:</p>
<ul>
<li>Tiene su propia URL</li>
<li>Puede tener configuración independiente</li>
<li>Permite swap instantáneo entre slots</li>
<li>Comparte el mismo plan de App Service</li>
</ul>
<h3 id="caso-de-uso-tipico"><a class="toclink" href="../../2025/01/02/azure-app-service-deployment-slots-despliegues-sin-downtime/#caso-de-uso-tipico">Caso de uso típico</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1"># Variables</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="nv">RG</span><span class="o">=</span><span class="s2">"my-rg"</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="nv">APP_NAME</span><span class="o">=</span><span class="s2">"my-webapp"</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="nv">LOCATION</span><span class="o">=</span><span class="s2">"westeurope"</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="c1"># Crear App Service Plan (mínimo Standard)</span>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a>az<span class="w"> </span>appservice<span class="w"> </span>plan<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-8"><a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">  </span>--name<span class="w"> </span><span class="si">${</span><span class="nv">APP_NAME</span><span class="si">}</span>-plan<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-9"><a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-10"><a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-11"><a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">  </span>--sku<span class="w"> </span>S1
</span><span id="__span-7-12"><a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a>
</span><span id="__span-7-13"><a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="c1"># Crear App Service</span>
</span><span id="__span-7-14"><a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a>az<span class="w"> </span>webapp<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-15"><a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-16"><a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-17"><a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="w">  </span>--plan<span class="w"> </span><span class="si">${</span><span class="nv">APP_NAME</span><span class="si">}</span>-plan
</span><span id="__span-7-18"><a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a>
</span><span id="__span-7-19"><a href="#__codelineno-7-19" id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="c1"># Crear slot de staging</span>
</span><span id="__span-7-20"><a href="#__codelineno-7-20" id="__codelineno-7-20" name="__codelineno-7-20"></a>az<span class="w"> </span>webapp<span class="w"> </span>deployment<span class="w"> </span>slot<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-21"><a href="#__codelineno-7-21" id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-22"><a href="#__codelineno-7-22" id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-23"><a href="#__codelineno-7-23" id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">  </span>--slot<span class="w"> </span>staging
</span></code></pre></div>
<h3 id="workflow-de-despliegue"><a class="toclink" href="../../2025/01/02/azure-app-service-deployment-slots-despliegues-sin-downtime/#workflow-de-despliegue">Workflow de despliegue</a></h3>
<p><strong>1. Desplegar a staging:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1"># Desplegar código al slot staging</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>az<span class="w"> </span>webapp<span class="w"> </span>deployment<span class="w"> </span><span class="nb">source</span><span class="w"> </span>config-zip<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">  </span>--slot<span class="w"> </span>staging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">  </span>--src<span class="w"> </span>app.zip
</span></code></pre></div>
<p><strong>2. Validar en staging:</strong></p>
<p>URL del slot: <code>https://{app-name}-staging.azurewebsites.net</code></p>
<p><strong>3. Hacer swap a producción:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># Swap directo staging -&gt; production</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>az<span class="w"> </span>webapp<span class="w"> </span>deployment<span class="w"> </span>slot<span class="w"> </span>swap<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">  </span>--slot<span class="w"> </span>staging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-6"><a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">  </span>--target-slot<span class="w"> </span>production
</span><span id="__span-9-7"><a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a>
</span><span id="__span-9-8"><a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="c1"># Swap con preview (recomendado)</span>
</span><span id="__span-9-9"><a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a>az<span class="w"> </span>webapp<span class="w"> </span>deployment<span class="w"> </span>slot<span class="w"> </span>swap<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-10"><a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-11"><a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-12"><a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="w">  </span>--slot<span class="w"> </span>staging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-13"><a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="w">  </span>--target-slot<span class="w"> </span>production<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-14"><a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="w">  </span>--action<span class="w"> </span>preview
</span><span id="__span-9-15"><a href="#__codelineno-9-15" id="__codelineno-9-15" name="__codelineno-9-15"></a>
</span><span id="__span-9-16"><a href="#__codelineno-9-16" id="__codelineno-9-16" name="__codelineno-9-16"></a><span class="c1"># Después de validar, completar swap</span>
</span><span id="__span-9-17"><a href="#__codelineno-9-17" id="__codelineno-9-17" name="__codelineno-9-17"></a>az<span class="w"> </span>webapp<span class="w"> </span>deployment<span class="w"> </span>slot<span class="w"> </span>swap<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-18"><a href="#__codelineno-9-18" id="__codelineno-9-18" name="__codelineno-9-18"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-19"><a href="#__codelineno-9-19" id="__codelineno-9-19" name="__codelineno-9-19"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-20"><a href="#__codelineno-9-20" id="__codelineno-9-20" name="__codelineno-9-20"></a><span class="w">  </span>--slot<span class="w"> </span>staging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-21"><a href="#__codelineno-9-21" id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="w">  </span>--target-slot<span class="w"> </span>production<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-22"><a href="#__codelineno-9-22" id="__codelineno-9-22" name="__codelineno-9-22"></a><span class="w">  </span>--action<span class="w"> </span>swap
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Proceso de swap</p>
<p>Durante el swap, Azure sigue este proceso:
1. Aplica settings del target slot al source slot
2. Espera a que todas las instancias se reinicien y calienten
3. Si todas las instancias están healthy, intercambia el routing
4. El target slot (production) queda con la nueva app sin downtime</p>
<p>Tiempo total: 1-5 minutos dependiendo de warmup. La producción NO sufre downtime.</p>
</div>
<h3 id="configuracion-sticky-vs-swappable"><a class="toclink" href="../../2025/01/02/azure-app-service-deployment-slots-despliegues-sin-downtime/#configuracion-sticky-vs-swappable">Configuración sticky vs swappable</a></h3>
<p>No toda la configuración se intercambia en el swap:</p>
<p><strong>Sticky (no se mueve con el código):</strong>
- App settings marcadas como "Deployment slot setting"
- Connection strings marcadas como "Deployment slot setting"
- Custom domains
- Nonpublic certificates y TLS/SSL settings
- Scale settings
- IP restrictions
- Always On, Diagnostic settings, CORS</p>
<p><strong>Swappable (se mueve con el código):</strong>
- General settings (framework version, 32/64-bit)
- App settings no marcadas
- Handler mappings
- Public certificates
- WebJobs content
- Hybrid connections
- Virtual network integration</p>
<p><strong>Configurar sticky settings:</strong></p>
<p>Desde el portal Azure:
1. Ir a <strong>Configuration</strong> → <strong>Application settings</strong> del slot
2. Añadir/editar app setting
3. Marcar checkbox <strong>Deployment slot setting</strong>
4. Apply</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># Crear app setting en slot staging</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>az<span class="w"> </span>webapp<span class="w"> </span>config<span class="w"> </span>appsettings<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-4"><a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-5"><a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">  </span>--slot<span class="w"> </span>staging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-6"><a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">  </span>--settings<span class="w"> </span><span class="nv">DATABASE_URL</span><span class="o">=</span><span class="s2">"staging-connection-string"</span>
</span><span id="__span-10-7"><a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a>
</span><span id="__span-10-8"><a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="c1"># Para hacerla sticky: usar portal o ARM template</span>
</span><span id="__span-10-9"><a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="c1"># No hay flag CLI directo para marcar como slot-specific</span>
</span></code></pre></div>
<h3 id="auto-swap-para-cicd"><a class="toclink" href="../../2025/01/02/azure-app-service-deployment-slots-despliegues-sin-downtime/#auto-swap-para-cicd">Auto-swap para CI/CD</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># Configurar auto-swap desde staging a production</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>az<span class="w"> </span>webapp<span class="w"> </span>deployment<span class="w"> </span>slot<span class="w"> </span>auto-swap<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-4"><a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-5"><a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">  </span>--slot<span class="w"> </span>staging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-6"><a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">  </span>--auto-swap-slot<span class="w"> </span>production
</span></code></pre></div>
<p>Con auto-swap habilitado:
1. Push a staging → despliegue automático
2. Warmup automático del slot
3. Swap a producción sin intervención manual</p>
<p><strong>Customizar warmup path:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1"># Configurar URL de warmup personalizada</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a>az<span class="w"> </span>webapp<span class="w"> </span>config<span class="w"> </span>appsettings<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">  </span>--slot<span class="w"> </span>staging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">  </span>--settings<span class="w"> </span><span class="nv">WEBSITE_SWAP_WARMUP_PING_PATH</span><span class="o">=</span><span class="s2">"/health/ready"</span>
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a>
</span><span id="__span-12-8"><a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="c1"># Validar solo códigos HTTP específicos</span>
</span><span id="__span-12-9"><a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a>az<span class="w"> </span>webapp<span class="w"> </span>config<span class="w"> </span>appsettings<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-10"><a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-11"><a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-12"><a href="#__codelineno-12-12" id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="w">  </span>--slot<span class="w"> </span>staging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-13"><a href="#__codelineno-12-13" id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="w">  </span>--settings<span class="w"> </span><span class="nv">WEBSITE_SWAP_WARMUP_PING_STATUSES</span><span class="o">=</span><span class="s2">"200,202"</span>
</span></code></pre></div>
<h3 id="buenas-practicas"><a class="toclink" href="../../2025/01/02/azure-app-service-deployment-slots-despliegues-sin-downtime/#buenas-practicas">Buenas prácticas</a></h3>
<ul>
<li><strong>Usar staging para testing</strong>: Siempre valida en staging antes del swap</li>
<li><strong>Configurar health checks</strong>: Azure verifica el slot antes de hacer swap</li>
<li><strong>Mantener paridad</strong>: Staging debe replicar producción (misma configuración, DB de test similar)</li>
<li><strong>Rollback rápido</strong>: Si falla, haz swap inverso inmediatamente</li>
<li><strong>Limitar slots</strong>: Máximo 2-3 slots por app (staging, pre-production)</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Ahorro de costos</p>
<p>Los slots comparten recursos del App Service Plan. No pagas más por tener staging, pero requieres tier Standard o superior.</p>
</div>
<h3 id="monitoring-del-swap"><a class="toclink" href="../../2025/01/02/azure-app-service-deployment-slots-despliegues-sin-downtime/#monitoring-del-swap">Monitoring del swap</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># Ver historial de swaps</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a>az<span class="w"> </span>webapp<span class="w"> </span>deployment<span class="w"> </span>slot<span class="w"> </span>list<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a>
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="c1"># Logs durante el swap</span>
</span><span id="__span-13-7"><a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a>az<span class="w"> </span>webapp<span class="w"> </span>log<span class="w"> </span>tail<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-8"><a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-9"><a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-10"><a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">  </span>--slot<span class="w"> </span>staging
</span></code></pre></div>
<h3 id="referencias"><a class="toclink" href="../../2025/01/02/azure-app-service-deployment-slots-despliegues-sin-downtime/#referencias">Referencias</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/app-service/deploy-staging-slots">Set up staging environments - Azure App Service</a></li>
<li><a href="https://learn.microsoft.com/en-us/cli/azure/webapp/deployment/slot">Azure CLI - webapp deployment slot</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-01-01 00:00:00+00:00">January 1, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              6 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-cost-management-planifica-tu-presupuesto-2025"><a class="toclink" href="../../2025/01/01/azure-cost-management-planifica-tu-presupuesto-2025/">Azure Cost Management: planifica tu presupuesto 2025</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/01/01/azure-cost-management-planifica-tu-presupuesto-2025/#resumen">Resumen</a></h3>
<p>enero es el mes para configurar <strong>presupuestos y alertas de costes</strong> en Azure. Con Azure Cost Management puedes establecer límites, recibir notificaciones y evitar sorpresas en la factura. En este post verás cómo crear presupuestos, configurar alertas automáticas y usar Azure Advisor para optimizar gastos desde el primer día del año.</p>
<nav class="md-post__action">
<a href="../../2025/01/01/azure-cost-management-planifica-tu-presupuesto-2025/">
          Continue reading
        </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-12-22 00:00:00+00:00">December 22, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../category/outlook/">Outlook</a></li>
<li class="md-meta__item">
            
              5 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="gtd-in-outlook-with-microsoft-to-do"><a class="toclink" href="../../2024/12/22/gtd-in-outlook-with-microsoft-to-do/">GTD in Outlook with Microsoft To Do</a></h2>
<p>In this post, we will see how to use GTD in Outlook.</p>
<p>Firs of all, let's define what GTD is. GTD stands for Getting Things Done, a productivity method created by David Allen. The GTD method is based on the idea that you should get things out of your head and into a trusted system, so you can focus on what you need to do.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The GTD method is not about doing more things faster. It's about doing the right things at the right time.
This method needs to be aligned with your purpose, objectives, and goals, so you can focus on what really matters to you.</p>
</div>
<h3 id="the-gtd-workflow"><a class="toclink" href="../../2024/12/22/gtd-in-outlook-with-microsoft-to-do/#the-gtd-workflow">The GTD workflow</a></h3>
<p>The GTD workflow consists of five steps:</p>
<ol>
<li>Capture: Collect everything that has your attention.</li>
<li>Clarify: Process what you've captured.</li>
<li>Organize: Put everything in its place.</li>
<li>Reflect: Review your system regularly.</li>
<li>Engage: Choose what to do and do it.</li>
</ol>
<p>The detailed flowchart of the GTD method is shown below:</p>
<pre class="mermaid"><code>graph TD;
    subgraph Capture    
    subgraph for_each_item_not_in_Inbox
    AA[Collect everything that has your attention in the Inbox];
    end    
    A[Inbox]
    AA--&gt;A
    end
    subgraph Clarify        
    subgraph for_each_item_in_Inbox
    BB[  What is this?
            What should I do?
            Is this really worth doing?
            How does it fit in with all the other things I have to do?
            Is there any action that needs to be done about it or because of it?]
    end
    end
    A --&gt; BB
    subgraph Organize
    BB --&gt; B{Is it actionable?}
    B -- no --&gt; C{Is it reference material?}
    C -- yes --&gt; D[Archive]
    C -- no --&gt; E{Is it trash?}
    E -- yes --&gt; FF[Trash it]
    E -- no --&gt; GG[Incubate it]
    GG --&gt; HH[Review it weekly]
    B -- yes --&gt; F{Can it be done in one step?}
    F -- no --&gt; G[Project]
    G --&gt; HHH[Define a next action at least]
    HHH --&gt; H[Project Actions]    
    end
    subgraph Engage
    H --&gt; I
    F -- yes --&gt; I{Does it take more than 2 minutes?}
    I -- no --&gt; J[DO IT]
    I -- yes --&gt; K{Is it my responsibility?}
    K -- no --&gt; L[Delegate]
    L --&gt; M[Waiting For]    
    K -- yes --&gt; N{Does it have a specific date?}
    N -- yes --&gt; O[Add to Calendar]
    N -- no --&gt; P[Next Actions]
    O --&gt; Q[Schedule. Do it at a specific time]
    P --&gt; R[Do it as soon as possible]
    end
</code></pre>
<pre class="mermaid"><code>graph TD;
subgraph Reflect
    S[**Daily Review**
            - Review your tasks daily
            - Calendar
            - Next  actions
            - Urgent tasks]
    T[**Weekly Review**
            - Review your projects weekly, make sure you're making progress
            - Next actions
            - Waiting for
            - Someday/Maybe
            - Calendar]
    U[**Monthly Review**
            - Focus on your goals
            - Reference archive
            - Someday/Maybe
            - Completed projects]
    V[**Review your purpose annually**
            - Goals and purposes
            - Big projects
            - Historical archive]
    end

</code></pre>
<p>It's important to note that the GTD method is not a one-size-fits-all solution. You can adapt it to your needs and preferences. The key is to find a system that works for you and stick to it.</p>
<p>And now, let's see how to use GTD in Outlook and Microsoft To Do.</p>
<h3 id="how-to-use-gtd-in-outlook-with-microsoft-to-do"><a class="toclink" href="../../2024/12/22/gtd-in-outlook-with-microsoft-to-do/#how-to-use-gtd-in-outlook-with-microsoft-to-do">How to use GTD in Outlook with Microsoft To Do</a></h3>
<p>When it comes to implementing the GTD method in Outlook, the key is to use the right tools and techniques. Microsoft To Do is a great tool for managing your tasks and projects, and it integrates seamlessly with Outlook.</p>
<p>You can use Outlook to implement the GTD method by following these steps:</p>
<ol>
<li>Capture:<ul>
<li>emails: Use the Inbox to collect everything that has your attention.</li>
<li>Other Things: Use Microsoft To Do Taks default list to capture tasks and projects.</li>
</ul>
</li>
<li>Clarify: Process what you've captured by asking yourself the following questions:<ul>
<li>What is this?</li>
<li>What should I do?</li>
<li>Is this really worth doing?</li>
<li>How does it fit in with all the other things I have to do?</li>
<li>Is there any action that needs to be done about it or because of it?</li>
</ul>
</li>
<li>Organize: Put everything in its place by following these steps:<ul>
<li>Inbox:<ul>
<li>Move emails to the appropriate folder or delete them.</li>
<li>Categories: Use categories to organize your emails by context and folder to organize your emails by project or client.</li>
<li>Use search folders to find emails quickly by category or categories, you can clear categories after processing.</li>
<li>Flags emails to add to To Do.</li>
<li>Create rules to automate repetitive tasks when clarifying one type of email has allways the same action.</li>
</ul>
</li>
<li>Tasks: Organize your tasks and projects in Microsoft To Do.<ul>
<li>Lists: Create lists for different types of tasks, one by context or use #tags for that in one lists. For example:<ul>
<li>In the case of lists: Agendas, Anywhere, Calls, Computed, Errands, Home, Office, Waiting For, Someday/Maybe.</li>
<li>In the case of tags, one list with: #Agendas, #Anywhere, #Calls, #Computed, #Errands, #Home, #Office, #WaitingFor, #SomedayMaybe.</li>
</ul>
</li>
<li>Use tag #nextaction to identify the next task to do.</li>
<li>Use tag #urgent to identify urgent tasks.</li>
</ul>
</li>
<li>Projects<ul>
<li>Group Lists: Group lists by category of projects or client.</li>
<li>One list per project: Create a list for each project and add tasks to it.</li>
<li>Use #nextaction tag to identify the next task in each project.</li>
</ul>
</li>
<li>Reference Material:<ul>
<li>Store reference material in folders, better in OneDrive or SharePoint.</li>
<li>Use a folder structure to organize your reference material</li>
<li>Use search folders to find it quickly.</li>
<li>Use tags to identify the context of the reference material. You can use <a href="https://github.com/Dijji/FileMeta?tab=readme-ov-file">FileMeta</a> to add tags to files in Windows for non-taggeable files.</li>
</ul>
</li>
</ul>
</li>
<li>Reflect: Review your system regularly to make sure it's up to date.<ul>
<li>Daily Review</li>
<li>Weekly Review</li>
<li>Monthly Review</li>
<li>Annual Review</li>
</ul>
</li>
<li>Engage: Choose what to do and do it.<ul>
<li>Use the My Day Bar to see your tasks and events at a glance or in search bar type #nextaction to see all your next actions.</li>
</ul>
</li>
</ol>
<p>These are just some ideas to get you started. You can adapt the GTD method to your needs and preferences. The key is to find a system that works for you and stick to it.</p>
<p>My example of GTD in Outlook with Microsoft To Do:</p>
<p>Outlook:</p>
<p><img alt="alt text" src="../../2024/12/image-1.png"></p>
<p>To Do:</p>
<p><img alt="alt text" src="../../2024/12/image.png"></p>
<p>I'm using a mix of lists and tags with the same name to organize my tasks and projects. I have lists for different types of tasks, such as Agendas, Anywhere, Calls, Computed, Errands, Home, Office, Waiting For, and Someday/Maybe. I also use tags to identify the next action, urgent tasks and context of the task in projects.</p>
<p>In the case of emails, I use categories to organize them by context and folders to organize them by project or client. I also use search folders to find emails quickly by category or categories and filter by unreads. The reason for this is that I can clear categories after processing and in the mayorie of cases, I only need a quick review of the emails without the need to convert them into tasks.</p>
<p>By following these steps, you can implement the GTD method in Outlook and Microsoft To Do and improve your productivity and focus.</p>
<p>Good luck! 🍀</p>
<h3 id="references"><a class="toclink" href="../../2024/12/22/gtd-in-outlook-with-microsoft-to-do/#references">References</a></h3>
<ul>
<li><a href="https://youtu.be/Nob50sN4be0">How to use Microsoft To Do for Getting Things Done (GTD)</a></li>
<li><a href="https://gettingthingsdone.com/">Getting Things Done: The Art of Stress-Free Productivity</a></li>
<li><a href="https://support.microsoft.com/en-us/office/manage-email-messages-by-using-rules-in-outlook-c24f5dea-9465-4df4-ad17-a50704d66c59">Manage email messages by using rules in Outlook</a></li>
<li><a href="https://github.com/Dijji/FileMeta?tab=readme-ov-file">FileMeta</a></li>
</ul>
</div>
</article>
<nav class="md-pagination">
<a class="md-pagination__link" href="../../">1</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="../7/">7</a> <a class="md-pagination__link" href="../8/">8</a> <span class="md-pagination__current">9</span> <a class="md-pagination__link" href="../10/">10</a> <a class="md-pagination__link" href="../11/">11</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="../17/">17</a>
</nav>
</div>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2023-now Rafael Fernández
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://www.linkedin.com/in/rafaelfernandezd/" rel="noopener" target="_blank" title="LinkedIn">
<svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg>
</a>
<a class="md-social__link" href="https://github.com/rfernandezdo" rel="noopener" target="_blank" title="GitHub">
<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
<a class="md-social__link" href="https://rfernandezdo.github.io/feed_rss_created.xml" rel="noopener" target="_blank" title="RSS feed">
<svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h320c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64zm32 104c0-13.3 10.7-24 24-24 137 0 248 111 248 248 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200-13.3 0-24-10.7-24-24m0 96c0-13.3 10.7-24 24-24 83.9 0 152 68.1 152 152 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104-13.3 0-24-10.7-24-24m0 120a32 32 0 1 1 64 0 32 32 0 1 1-64 0"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-progress" data-md-component="progress" role="progressbar"></div>
<script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.sections", "navigation.top", "navigation.tracking", "toc.integrate", "toc.nested", "toc.smoothscroll", "footer", "content.code.copy", "content.code.select", "content.code.annotate", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
<script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
<script src="../../../javascripts/tablesort.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>