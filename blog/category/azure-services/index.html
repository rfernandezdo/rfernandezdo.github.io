<!DOCTYPE html><html class="no-js" lang="en"><head>
<meta charset="utf-8">
<meta content="width=device-width,initial-scale=1" name="viewport">
<meta content="A blog about Azure, DevOps and other stuff" name="description">
<meta content="Rafael Fernández" name="author">
<link href="https://rfernandezdo.github.io/blog/category/azure-services/" rel="canonical">
<link href="../azure-security/" rel="prev">
<link href="../azure-updates/" rel="next">
<link href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=es&amp;_x_tr_hl=es&amp;_x_tr_pto=wapp" hreflang="en" rel="alternate">
<link href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=en&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp" hreflang="es" rel="alternate">
<link href="../../../feed_rss_created.xml" rel="alternate" title="RSS feed" type="application/rss+xml">
<link href="../../../feed_rss_updated.xml" rel="alternate" title="RSS feed of updated content" type="application/rss+xml">
<link href="../../../assets/images/favicon.png" rel="icon">
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.1" name="generator">
<title>Azure Services - Un Rinconcito donde contar lo que quiera</title>
<link href="../../../assets/stylesheets/main.484c7ddc.min.css" rel="stylesheet">
<link href="../../../assets/stylesheets/palette.ab4e12ef.min.css" rel="stylesheet">
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet">
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<meta content="website" property="og:type">
<meta content="Azure Services - Un Rinconcito donde contar lo que quiera" property="og:title">
<meta content="A blog about Azure, DevOps and other stuff" property="og:description">
<meta content="https://rfernandezdo.github.io/assets/images/social/blog/category/azure-services.png" property="og:image">
<meta content="image/png" property="og:image:type">
<meta content="1200" property="og:image:width">
<meta content="630" property="og:image:height">
<meta content="https://rfernandezdo.github.io/blog/category/azure-services/" property="og:url">
<meta content="summary_large_image" property="twitter:card">
<meta content="Azure Services - Un Rinconcito donde contar lo que quiera" property="twitter:title">
<meta content="A blog about Azure, DevOps and other stuff" property="twitter:description">
<meta content="https://rfernandezdo.github.io/assets/images/social/blog/category/azure-services.png" property="twitter:image">
<link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox">
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox">
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#azure-services">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Un Rinconcito donde contar lo que quiera" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="Un Rinconcito donde contar lo que quiera">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Un Rinconcito donde contar lo que quiera
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Azure Services
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio">
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio">
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<div class="md-header__option">
<div class="md-select">
<button aria-label="Select language" class="md-header__button md-icon">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"></path></svg>
</button>
<div class="md-select__inner">
<ul class="md-select__list">
<li class="md-select__item">
<a class="md-select__link" href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=es&amp;_x_tr_hl=es&amp;_x_tr_pto=wapp" hreflang="en">
              English
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=en&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp" hreflang="es">
              Spanish
            </a>
</li>
</ul>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text">
<label class="md-search__icon md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../">
          
  
  
  Blog

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
        
  
  
    
  
  About

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../contributions/">
        
  
  
    
  
  Contributions

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../Azure/Security/MCSB/Readme/">
          
  
  
  Azure

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../Tools/Federated_Identity_Credentials_Report/README-federated-identity-credentials/">
          
  
  
  Tools

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Un Rinconcito donde contar lo que quiera" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="Un Rinconcito donde contar lo que quiera">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Un Rinconcito donde contar lo que quiera
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox">
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
<span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tags/">
<span class="md-ellipsis">
    
  
    Posts by Tags
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1_3" type="checkbox">
<label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="">
<span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_3">
<span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/12/">
<span class="md-ellipsis">
    
  
    2025/12
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/11/">
<span class="md-ellipsis">
    
  
    2025/11
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/10/">
<span class="md-ellipsis">
    
  
    2025/10
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/09/">
<span class="md-ellipsis">
    
  
    2025/09
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/08/">
<span class="md-ellipsis">
    
  
    2025/08
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/07/">
<span class="md-ellipsis">
    
  
    2025/07
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/06/">
<span class="md-ellipsis">
    
  
    2025/06
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/05/">
<span class="md-ellipsis">
    
  
    2025/05
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/04/">
<span class="md-ellipsis">
    
  
    2025/04
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/03/">
<span class="md-ellipsis">
    
  
    2025/03
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/02/">
<span class="md-ellipsis">
    
  
    2025/02
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/01/">
<span class="md-ellipsis">
    
  
    2025/01
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/12/">
<span class="md-ellipsis">
    
  
    2024/12
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/11/">
<span class="md-ellipsis">
    
  
    2024/11
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/10/">
<span class="md-ellipsis">
    
  
    2024/10
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/09/">
<span class="md-ellipsis">
    
  
    2024/09
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/06/">
<span class="md-ellipsis">
    
  
    2024/06
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/05/">
<span class="md-ellipsis">
    
  
    2024/05
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/04/">
<span class="md-ellipsis">
    
  
    2024/04
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/03/">
<span class="md-ellipsis">
    
  
    2024/03
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/02/">
<span class="md-ellipsis">
    
  
    2024/02
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2023/12/">
<span class="md-ellipsis">
    
  
    2023/12
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2023/11/">
<span class="md-ellipsis">
    
  
    2023/11
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2023/10/">
<span class="md-ellipsis">
    
  
    2023/10
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_1_4" type="checkbox">
<label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="">
<span class="md-ellipsis">
    
  
    Categories
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_1_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Categories
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../azure/">
<span class="md-ellipsis">
    
  
    Azure
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-ad/">
<span class="md-ellipsis">
    
  
    Azure AD
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-automation/">
<span class="md-ellipsis">
    
  
    Azure Automation
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-devops/">
<span class="md-ellipsis">
    
  
    Azure DevOps
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-frameworks/">
<span class="md-ellipsis">
    
  
    Azure Frameworks
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-governance/">
<span class="md-ellipsis">
    
  
    Azure Governance
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-networking/">
<span class="md-ellipsis">
    
  
    Azure Networking
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-security/">
<span class="md-ellipsis">
    
  
    Azure Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox">
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    Azure Services
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-updates/">
<span class="md-ellipsis">
    
  
    Azure Updates
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../caf/">
<span class="md-ellipsis">
    
  
    CAF
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cicd/">
<span class="md-ellipsis">
    
  
    CI/CD
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../devops/">
<span class="md-ellipsis">
    
  
    DevOps
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/">
<span class="md-ellipsis">
    
  
    Development
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../drift-detection/">
<span class="md-ellipsis">
    
  
    Drift Detection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../english/">
<span class="md-ellipsis">
    
  
    English
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../enterprise-policy-as-code/">
<span class="md-ellipsis">
    
  
    Enterprise Policy as Code
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../finops/">
<span class="md-ellipsis">
    
  
    FinOps
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../firewall/">
<span class="md-ellipsis">
    
  
    Firewall
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../gtd/">
<span class="md-ellipsis">
    
  
    GTD
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../git/">
<span class="md-ellipsis">
    
  
    Git
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../github-actions/">
<span class="md-ellipsis">
    
  
    GitHub Actions
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../hashicorp/">
<span class="md-ellipsis">
    
  
    HashiCorp
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../hello_world/">
<span class="md-ellipsis">
    
  
    Hello_World
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../infrastructure-as-code/">
<span class="md-ellipsis">
    
  
    Infrastructure as Code
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../learning/">
<span class="md-ellipsis">
    
  
    Learning
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../m365/">
<span class="md-ellipsis">
    
  
    M365
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../microsoft-365/">
<span class="md-ellipsis">
    
  
    Microsoft 365
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../microsoft-entra/">
<span class="md-ellipsis">
    
  
    Microsoft Entra
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../microsoft-entra-external-id/">
<span class="md-ellipsis">
    
  
    Microsoft Entra External ID
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../microsoft-entra-id/">
<span class="md-ellipsis">
    
  
    Microsoft Entra ID
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../networking/">
<span class="md-ellipsis">
    
  
    Networking
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../outlook/">
<span class="md-ellipsis">
    
  
    Outlook
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../pim/">
<span class="md-ellipsis">
    
  
    PIM
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../power-automate/">
<span class="md-ellipsis">
    
  
    Power Automate
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../power-bi/">
<span class="md-ellipsis">
    
  
    Power BI
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../productividad/">
<span class="md-ellipsis">
    
  
    Productividad
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../productividad--microsoft-365/">
<span class="md-ellipsis">
    
  
    Productividad / Microsoft 365
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../security/">
<span class="md-ellipsis">
    
  
    Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../seguridad/">
<span class="md-ellipsis">
    
  
    Seguridad
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../snowflake/">
<span class="md-ellipsis">
    
  
    Snowflake
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../terraform/">
<span class="md-ellipsis">
    
  
    Terraform
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../threat-intelligence/">
<span class="md-ellipsis">
    
  
    Threat Intelligence
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tools/">
<span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../troubleshooting/">
<span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../visual-studio-code/">
<span class="md-ellipsis">
    
  
    Visual Studio Code
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../viva-insights/">
<span class="md-ellipsis">
    
  
    Viva Insights
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../windows/">
<span class="md-ellipsis">
    
  
    Windows
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    
  
    About
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../contributions/">
<span class="md-ellipsis">
    
  
    Contributions
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox">
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Azure
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Azure
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1" type="checkbox">
<label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Security
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1_1" type="checkbox">
<label class="md-nav__link" for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
<span class="md-ellipsis">
    
  
    MCSB v1
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_1">
<span class="md-nav__icon md-icon"></span>
            
  
    MCSB v1
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Readme/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Readme
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Asset%20Management/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Asset Management
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Backup%20and%20Recovery/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Backup and Recovery
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Data%20Protection/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Data Protection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/DevOps%20Security/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - DevOps Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Endpoint%20Security/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Endpoint Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Governance%20and%20Strategy/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Governance and Strategy
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Identity%20Management/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Identity Management
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Incident%20Response/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Incident Response
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Logging%20and%20Threat%20Detection/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Logging and Threat Detection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Network%20Security/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Network Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Posture%20and%20Vulnerability%20Mgmt/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Posture and Vulnerability Mgmt
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Privileged%20Access/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Privileged Access
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1_2" type="checkbox">
<label class="md-nav__link" for="__nav_4_1_2" id="__nav_4_1_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    MCSB v2
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_2">
<span class="md-nav__icon md-icon"></span>
            
  
    MCSB v2
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Index/">
<span class="md-ellipsis">
    
  
    Microsoft Cloud Security Benchmark v2
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Network%20Security/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Network Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Identity%20Management/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Identity Management
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Privileged%20Access/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Privileged Access
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Data%20Protection/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Data Protection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Asset%20Management/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Asset Management
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Logging%20and%20Threat%20Detection/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Logging and Threat Detection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Incident%20Response/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Incident Response
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Posture%20and%20Vulnerability%20Manag/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Posture and Vulnerability Manag
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Endpoint%20Security/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Endpoint Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Backup%20and%20Recovery/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Backup and Recovery
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Artificial%20Intelligence%20Securit/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Artificial Intelligence Securit
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox">
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            
  
    Tools
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_1" type="checkbox">
<label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Federated Identity Credentials Report
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Federated Identity Credentials Report
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Tools/Federated_Identity_Credentials_Report/README-federated-identity-credentials/">
<span class="md-ellipsis">
    
  
    Script de Reporte para Federated Identity Credentials
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_2" type="checkbox">
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Analyze Virtual Network Flows
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Analyze Virtual Network Flows
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Tools/Analyze_Virtual_Network_Flows/">
<span class="md-ellipsis">
    
  
    Analyze-VNETFlowLogs
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<div class="md-content__inner">
<header class="md-typeset">
<h1 id="azure-services">Azure Services</h1>
</header>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-12-18 00:00:00+00:00">December 18, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure Services</a></li>
<li class="md-meta__item">
            
              11 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="seguridad-en-azure-storage-guia-completa-de-firewall-resource-instances-y-mejores-practicas"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/">Seguridad en Azure Storage: Guía Completa de Firewall, Resource Instances y Mejores Prácticas</a></h2>
<h3 id="introduccion"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#introduccion">Introducción</a></h3>
<p>La seguridad de las cuentas de almacenamiento en Azure es crítica para proteger tus datos. En este artículo profundizaremos en las diferentes opciones de firewall disponibles cuando no se usa Azure private endpoint, con especial énfasis en <strong>Resource Instances</strong>, <strong>Trusted Services</strong> y las configuraciones recomendadas cuando no se utilizan Private Endpoints.</p>
<h3 id="conceptos-fundamentales"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#conceptos-fundamentales">Conceptos Fundamentales</a></h3>
<h4 id="que-es-el-firewall-de-storage-account"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#que-es-el-firewall-de-storage-account">¿Qué es el Firewall de Storage Account?</a></h4>
<p>El firewall de Azure Storage Account es una capa de seguridad que controla el acceso al <strong>endpoint público</strong> de tu cuenta de almacenamiento. Es importante entender que:</p>
<ul>
<li><strong>Un solo firewall</strong> protege TODOS los servicios (Blob, Files, Queue, Table)</li>
<li>Las reglas aplican a nivel de <strong>Storage Account</strong>, no por servicio individual</li>
<li>El firewall controla <strong>quién</strong> puede conectarse, mientras que RBAC controla <strong>qué</strong> puede hacer</li>
</ul>
<pre class="mermaid"><code>graph TD
    A[Cliente/Servicio] --&gt;|Intenta acceder| B{Firewall}
    B --&gt;|✅ Permitido| C{RBAC}
    B --&gt;|❌ Bloqueado| D[403 Forbidden]
    C --&gt;|✅ Con permisos| E[Acceso a datos]
    C --&gt;|❌ Sin permisos| F[403 Unauthorized]
</code></pre>
<h3 id="tipos-de-reglas-de-red"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#tipos-de-reglas-de-red">Tipos de Reglas de Red</a></h3>
<p>Azure Storage ofrece <strong>cuatro tipos</strong> de reglas de red que puedes configurar:</p>
<h4 id="1-virtual-network-rules"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#1-virtual-network-rules">1. Virtual Network Rules</a></h4>
<p>Permiten tráfico desde subnets específicas dentro de Azure Virtual Networks.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-52-1"><a href="#__codelineno-52-1" id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="c"># Agregar regla de VNet</span>
</span><span id="__span-52-2"><a href="#__codelineno-52-2" id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="nb">Add-AzStorageAccountNetworkRule</span> <span class="p">`</span>
</span><span id="__span-52-3"><a href="#__codelineno-52-3" id="__codelineno-52-3" name="__codelineno-52-3"></a>    <span class="n">-ResourceGroupName</span> <span class="s2">"myRG"</span> <span class="p">`</span>
</span><span id="__span-52-4"><a href="#__codelineno-52-4" id="__codelineno-52-4" name="__codelineno-52-4"></a>    <span class="n">-Name</span> <span class="s2">"mystorageaccount"</span> <span class="p">`</span>
</span><span id="__span-52-5"><a href="#__codelineno-52-5" id="__codelineno-52-5" name="__codelineno-52-5"></a>    <span class="n">-VirtualNetworkResourceId</span> <span class="s2">"/subscriptions/xxx/resourceGroups/rg/providers/Microsoft.Network/virtualNetworks/vnet/subnets/subnet"</span>
</span></code></pre></div>
<p><strong>Límite:</strong> Máximo 400 reglas por Storage Account</p>
<h4 id="2-ip-network-rules"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#2-ip-network-rules">2. IP Network Rules</a></h4>
<p>Permiten tráfico desde rangos de IP públicas específicas.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-53-1"><a href="#__codelineno-53-1" id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="c"># Agregar regla de IP</span>
</span><span id="__span-53-2"><a href="#__codelineno-53-2" id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="nb">Add-AzStorageAccountNetworkRule</span> <span class="p">`</span>
</span><span id="__span-53-3"><a href="#__codelineno-53-3" id="__codelineno-53-3" name="__codelineno-53-3"></a>    <span class="n">-ResourceGroupName</span> <span class="s2">"myRG"</span> <span class="p">`</span>
</span><span id="__span-53-4"><a href="#__codelineno-53-4" id="__codelineno-53-4" name="__codelineno-53-4"></a>    <span class="n">-Name</span> <span class="s2">"mystorageaccount"</span> <span class="p">`</span>
</span><span id="__span-53-5"><a href="#__codelineno-53-5" id="__codelineno-53-5" name="__codelineno-53-5"></a>    <span class="n">-IPAddressOrRange</span> <span class="s2">"203.0.113.0/24"</span>
</span></code></pre></div>
<p><strong>Límite:</strong> Máximo 400 reglas por Storage Account</p>
<h4 id="3-resource-instance-rules"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#3-resource-instance-rules">3. Resource Instance Rules ⭐</a></h4>
<p>Permiten tráfico desde <strong>recursos Azure específicos</strong> identificados por su Resource ID.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-54-1"><a href="#__codelineno-54-1" id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="c"># Agregar Resource Instance</span>
</span><span id="__span-54-2"><a href="#__codelineno-54-2" id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="nb">Add-AzStorageAccountNetworkRule</span> <span class="p">`</span>
</span><span id="__span-54-3"><a href="#__codelineno-54-3" id="__codelineno-54-3" name="__codelineno-54-3"></a>    <span class="n">-ResourceGroupName</span> <span class="s2">"myRG"</span> <span class="p">`</span>
</span><span id="__span-54-4"><a href="#__codelineno-54-4" id="__codelineno-54-4" name="__codelineno-54-4"></a>    <span class="n">-Name</span> <span class="s2">"mystorageaccount"</span> <span class="p">`</span>
</span><span id="__span-54-5"><a href="#__codelineno-54-5" id="__codelineno-54-5" name="__codelineno-54-5"></a>    <span class="n">-TenantId</span> <span class="s2">"your-tenant-id"</span> <span class="p">`</span>
</span><span id="__span-54-6"><a href="#__codelineno-54-6" id="__codelineno-54-6" name="__codelineno-54-6"></a>    <span class="n">-ResourceId</span> <span class="s2">"/subscriptions/xxx/resourceGroups/rg/providers/Microsoft.Synapse/workspaces/myworkspace"</span>
</span></code></pre></div>
<p><strong>Límite:</strong> Máximo 200 reglas por Storage Account</p>
<h4 id="4-trusted-service-exceptions"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#4-trusted-service-exceptions">4. Trusted Service Exceptions</a></h4>
<p>Permiten tráfico desde servicios de Microsoft en la lista de confianza.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-55-1"><a href="#__codelineno-55-1" id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="c"># Habilitar Trusted Services</span>
</span><span id="__span-55-2"><a href="#__codelineno-55-2" id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="nb">Update-AzStorageAccountNetworkRuleSet</span> <span class="p">`</span>
</span><span id="__span-55-3"><a href="#__codelineno-55-3" id="__codelineno-55-3" name="__codelineno-55-3"></a>    <span class="n">-ResourceGroupName</span> <span class="s2">"myRG"</span> <span class="p">`</span>
</span><span id="__span-55-4"><a href="#__codelineno-55-4" id="__codelineno-55-4" name="__codelineno-55-4"></a>    <span class="n">-Name</span> <span class="s2">"mystorageaccount"</span> <span class="p">`</span>
</span><span id="__span-55-5"><a href="#__codelineno-55-5" id="__codelineno-55-5" name="__codelineno-55-5"></a>    <span class="n">-Bypass</span> <span class="n">AzureServices</span><span class="p">,</span><span class="n">Logging</span><span class="p">,</span><span class="n">Metrics</span>
</span></code></pre></div>
<p><strong>Límite:</strong> Sin límite (es un flag de configuración)</p>
<h3 id="resource-instances-control-granular"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#resource-instances-control-granular">Resource Instances: Control Granular</a></h3>
<h4 id="que-son-las-resource-instances"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#que-son-las-resource-instances">¿Qué son las Resource Instances?</a></h4>
<p>Las <strong>Resource Instance Rules</strong> son la forma más segura de permitir acceso a servicios Azure cuando no usas Private Endpoints. A diferencia de Trusted Services (que permite CUALQUIER instancia de un servicio en tu tenant), Resource Instances te permite especificar <strong>exactamente qué recurso</strong> puede acceder.</p>
<h4 id="comparacion-trusted-services-vs-resource-instances"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#comparacion-trusted-services-vs-resource-instances">Comparación: Trusted Services vs Resource Instances</a></h4>
<table>
<thead>
<tr>
<th>Aspecto</th>
<th>Trusted Services</th>
<th>Resource Instances</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Granularidad</strong></td>
<td>❌ Cualquier instancia del tenant</td>
<td>✅ Solo recursos específicos</td>
</tr>
<tr>
<td><strong>Seguridad</strong></td>
<td>⚠️ Permisivo</td>
<td>✅ Restrictivo</td>
</tr>
<tr>
<td><strong>Principio de menor privilegio</strong></td>
<td>❌ No cumple</td>
<td>✅ Cumple completamente</td>
</tr>
<tr>
<td><strong>Auditoría</strong></td>
<td>❌ Difícil rastrear</td>
<td>✅ Trazabilidad completa</td>
</tr>
<tr>
<td><strong>Compliance</strong></td>
<td>⚠️ Puede tener problemas</td>
<td>✅ SOC2, ISO27001 friendly</td>
</tr>
<tr>
<td><strong>Zero Trust</strong></td>
<td>❌ No alineado</td>
<td>✅ Completamente alineado</td>
</tr>
</tbody>
</table>
<h4 id="ejemplo-practico"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#ejemplo-practico">Ejemplo Práctico</a></h4>
<p>Imagina que tienes múltiples Azure Synapse Workspaces en tu tenant:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio"><input id="__tabbed_7_2" name="__tabbed_7" type="radio"><div class="tabbed-labels"><label for="__tabbed_7_1">❌ Con Trusted Services</label><label for="__tabbed_7_2">✅ Con Resource Instances</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-56-1"><a href="#__codelineno-56-1" id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="nb">Update-AzStorageAccountNetworkRuleSet</span> <span class="p">`</span>
</span><span id="__span-56-2"><a href="#__codelineno-56-2" id="__codelineno-56-2" name="__codelineno-56-2"></a>    <span class="n">-Bypass</span> <span class="n">AzureServices</span>
</span><span id="__span-56-3"><a href="#__codelineno-56-3" id="__codelineno-56-3" name="__codelineno-56-3"></a>
</span><span id="__span-56-4"><a href="#__codelineno-56-4" id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="c"># Resultado:</span>
</span><span id="__span-56-5"><a href="#__codelineno-56-5" id="__codelineno-56-5" name="__codelineno-56-5"></a><span class="c"># ✅ prod-synapse → Acceso permitido</span>
</span><span id="__span-56-6"><a href="#__codelineno-56-6" id="__codelineno-56-6" name="__codelineno-56-6"></a><span class="c"># ✅ dev-synapse → Acceso permitido</span>
</span><span id="__span-56-7"><a href="#__codelineno-56-7" id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="c"># ✅ test-synapse → Acceso permitido</span>
</span><span id="__span-56-8"><a href="#__codelineno-56-8" id="__codelineno-56-8" name="__codelineno-56-8"></a><span class="c"># ✅ Cualquier otro Synapse creado → Acceso permitido</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-57-1"><a href="#__codelineno-57-1" id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="nb">Add-AzStorageAccountNetworkRule</span> <span class="p">`</span>
</span><span id="__span-57-2"><a href="#__codelineno-57-2" id="__codelineno-57-2" name="__codelineno-57-2"></a>    <span class="n">-TenantId</span> <span class="s2">"xxx"</span> <span class="p">`</span>
</span><span id="__span-57-3"><a href="#__codelineno-57-3" id="__codelineno-57-3" name="__codelineno-57-3"></a>    <span class="n">-ResourceId</span> <span class="s2">"/subscriptions/xxx/.../Microsoft.Synapse/workspaces/prod-synapse"</span>
</span><span id="__span-57-4"><a href="#__codelineno-57-4" id="__codelineno-57-4" name="__codelineno-57-4"></a>
</span><span id="__span-57-5"><a href="#__codelineno-57-5" id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="c"># Resultado:</span>
</span><span id="__span-57-6"><a href="#__codelineno-57-6" id="__codelineno-57-6" name="__codelineno-57-6"></a><span class="c"># ✅ prod-synapse → Acceso permitido</span>
</span><span id="__span-57-7"><a href="#__codelineno-57-7" id="__codelineno-57-7" name="__codelineno-57-7"></a><span class="c"># ❌ dev-synapse → Bloqueado</span>
</span><span id="__span-57-8"><a href="#__codelineno-57-8" id="__codelineno-57-8" name="__codelineno-57-8"></a><span class="c"># ❌ test-synapse → Bloqueado</span>
</span><span id="__span-57-9"><a href="#__codelineno-57-9" id="__codelineno-57-9" name="__codelineno-57-9"></a><span class="c"># ❌ Cualquier otro Synapse → Bloqueado</span>
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="requerimientos-para-resource-instances"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#requerimientos-para-resource-instances">Requerimientos para Resource Instances</a></h3>
<p>Para usar Resource Instances correctamente, necesitas cumplir varios requisitos:</p>
<h4 id="checklist-de-requerimientos"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#checklist-de-requerimientos">✅ Checklist de Requerimientos</a></h4>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> <strong>Managed Identity</strong>: El recurso debe tener System-Assigned Managed Identity habilitada</li>
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> <strong>Mismo Tenant</strong>: Recurso y Storage Account en el mismo Microsoft Entra tenant</li>
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> <strong>Firewall Restrictivo</strong>: Storage Account con <code>DefaultAction: Deny</code></li>
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> <strong>Permisos para configurar</strong>: Rol Storage Account Contributor o superior</li>
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> <strong>Resource ID completo</strong>: Necesitas el Resource ID del recurso Azure</li>
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> <strong>Rol RBAC asignado</strong>: La Managed Identity necesita roles de acceso a datos</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Importante</p>
<p>La Resource Instance Rule solo da acceso al <strong>endpoint público</strong>, NO a los datos. Debes asignar roles RBAC a la Managed Identity del recurso.</p>
</div>
<h4 id="configuracion-completa-paso-a-paso"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#configuracion-completa-paso-a-paso">Configuración Completa Paso a Paso</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-58-1"><a href="#__codelineno-58-1" id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="c"># Variables</span>
</span><span id="__span-58-2"><a href="#__codelineno-58-2" id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="nv">$rgName</span> <span class="p">=</span> <span class="s2">"myResourceGroup"</span>
</span><span id="__span-58-3"><a href="#__codelineno-58-3" id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="nv">$storageAccount</span> <span class="p">=</span> <span class="s2">"mystorageaccount"</span>
</span><span id="__span-58-4"><a href="#__codelineno-58-4" id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="nv">$synapseWorkspaceName</span> <span class="p">=</span> <span class="s2">"prod-synapse"</span>
</span><span id="__span-58-5"><a href="#__codelineno-58-5" id="__codelineno-58-5" name="__codelineno-58-5"></a><span class="nv">$synapseRG</span> <span class="p">=</span> <span class="s2">"synapse-rg"</span>
</span><span id="__span-58-6"><a href="#__codelineno-58-6" id="__codelineno-58-6" name="__codelineno-58-6"></a><span class="nv">$tenantId</span> <span class="p">=</span> <span class="s2">"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"</span>
</span><span id="__span-58-7"><a href="#__codelineno-58-7" id="__codelineno-58-7" name="__codelineno-58-7"></a>
</span><span id="__span-58-8"><a href="#__codelineno-58-8" id="__codelineno-58-8" name="__codelineno-58-8"></a><span class="c"># 1. Obtener Resource ID del Synapse Workspace</span>
</span><span id="__span-58-9"><a href="#__codelineno-58-9" id="__codelineno-58-9" name="__codelineno-58-9"></a><span class="nv">$synapseResourceId</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-AzSynapseWorkspace</span> <span class="p">`</span>
</span><span id="__span-58-10"><a href="#__codelineno-58-10" id="__codelineno-58-10" name="__codelineno-58-10"></a>    <span class="n">-ResourceGroupName</span> <span class="nv">$synapseRG</span> <span class="p">`</span>
</span><span id="__span-58-11"><a href="#__codelineno-58-11" id="__codelineno-58-11" name="__codelineno-58-11"></a>    <span class="n">-Name</span> <span class="nv">$synapseWorkspaceName</span><span class="p">).</span><span class="n">Id</span>
</span><span id="__span-58-12"><a href="#__codelineno-58-12" id="__codelineno-58-12" name="__codelineno-58-12"></a>
</span><span id="__span-58-13"><a href="#__codelineno-58-13" id="__codelineno-58-13" name="__codelineno-58-13"></a><span class="c"># 2. Configurar firewall restrictivo</span>
</span><span id="__span-58-14"><a href="#__codelineno-58-14" id="__codelineno-58-14" name="__codelineno-58-14"></a><span class="nb">Update-AzStorageAccountNetworkRuleSet</span> <span class="p">`</span>
</span><span id="__span-58-15"><a href="#__codelineno-58-15" id="__codelineno-58-15" name="__codelineno-58-15"></a>    <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-58-16"><a href="#__codelineno-58-16" id="__codelineno-58-16" name="__codelineno-58-16"></a>    <span class="n">-Name</span> <span class="nv">$storageAccount</span> <span class="p">`</span>
</span><span id="__span-58-17"><a href="#__codelineno-58-17" id="__codelineno-58-17" name="__codelineno-58-17"></a>    <span class="n">-DefaultAction</span> <span class="n">Deny</span> <span class="p">`</span>
</span><span id="__span-58-18"><a href="#__codelineno-58-18" id="__codelineno-58-18" name="__codelineno-58-18"></a>    <span class="n">-Bypass</span> <span class="n">Logging</span><span class="p">,</span><span class="n">Metrics</span>
</span><span id="__span-58-19"><a href="#__codelineno-58-19" id="__codelineno-58-19" name="__codelineno-58-19"></a>
</span><span id="__span-58-20"><a href="#__codelineno-58-20" id="__codelineno-58-20" name="__codelineno-58-20"></a><span class="c"># 3. Agregar Resource Instance Rule</span>
</span><span id="__span-58-21"><a href="#__codelineno-58-21" id="__codelineno-58-21" name="__codelineno-58-21"></a><span class="nb">Add-AzStorageAccountNetworkRule</span> <span class="p">`</span>
</span><span id="__span-58-22"><a href="#__codelineno-58-22" id="__codelineno-58-22" name="__codelineno-58-22"></a>    <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-58-23"><a href="#__codelineno-58-23" id="__codelineno-58-23" name="__codelineno-58-23"></a>    <span class="n">-Name</span> <span class="nv">$storageAccount</span> <span class="p">`</span>
</span><span id="__span-58-24"><a href="#__codelineno-58-24" id="__codelineno-58-24" name="__codelineno-58-24"></a>    <span class="n">-TenantId</span> <span class="nv">$tenantId</span> <span class="p">`</span>
</span><span id="__span-58-25"><a href="#__codelineno-58-25" id="__codelineno-58-25" name="__codelineno-58-25"></a>    <span class="n">-ResourceId</span> <span class="nv">$synapseResourceId</span>
</span><span id="__span-58-26"><a href="#__codelineno-58-26" id="__codelineno-58-26" name="__codelineno-58-26"></a>
</span><span id="__span-58-27"><a href="#__codelineno-58-27" id="__codelineno-58-27" name="__codelineno-58-27"></a><span class="c"># 4. Obtener Managed Identity Object ID</span>
</span><span id="__span-58-28"><a href="#__codelineno-58-28" id="__codelineno-58-28" name="__codelineno-58-28"></a><span class="nv">$workspace</span> <span class="p">=</span> <span class="nb">Get-AzSynapseWorkspace</span> <span class="p">`</span>
</span><span id="__span-58-29"><a href="#__codelineno-58-29" id="__codelineno-58-29" name="__codelineno-58-29"></a>    <span class="n">-ResourceGroupName</span> <span class="nv">$synapseRG</span> <span class="p">`</span>
</span><span id="__span-58-30"><a href="#__codelineno-58-30" id="__codelineno-58-30" name="__codelineno-58-30"></a>    <span class="n">-Name</span> <span class="nv">$synapseWorkspaceName</span>
</span><span id="__span-58-31"><a href="#__codelineno-58-31" id="__codelineno-58-31" name="__codelineno-58-31"></a><span class="nv">$principalId</span> <span class="p">=</span> <span class="nv">$workspace</span><span class="p">.</span><span class="n">Identity</span><span class="p">.</span><span class="n">PrincipalId</span>
</span><span id="__span-58-32"><a href="#__codelineno-58-32" id="__codelineno-58-32" name="__codelineno-58-32"></a>
</span><span id="__span-58-33"><a href="#__codelineno-58-33" id="__codelineno-58-33" name="__codelineno-58-33"></a><span class="c"># 5. Asignar rol RBAC para acceso a datos</span>
</span><span id="__span-58-34"><a href="#__codelineno-58-34" id="__codelineno-58-34" name="__codelineno-58-34"></a><span class="nb">New-AzRoleAssignment</span> <span class="p">`</span>
</span><span id="__span-58-35"><a href="#__codelineno-58-35" id="__codelineno-58-35" name="__codelineno-58-35"></a>    <span class="n">-ObjectId</span> <span class="nv">$principalId</span> <span class="p">`</span>
</span><span id="__span-58-36"><a href="#__codelineno-58-36" id="__codelineno-58-36" name="__codelineno-58-36"></a>    <span class="n">-RoleDefinitionName</span> <span class="s2">"Storage Blob Data Contributor"</span> <span class="p">`</span>
</span><span id="__span-58-37"><a href="#__codelineno-58-37" id="__codelineno-58-37" name="__codelineno-58-37"></a>    <span class="n">-Scope</span> <span class="s2">"/subscriptions/</span><span class="p">$((</span><span class="nb">Get-AzContext</span><span class="p">).</span><span class="n">Subscription</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span><span class="s2">/resourceGroups/$rgName/providers/Microsoft.Storage/storageAccounts/$storageAccount"</span>
</span><span id="__span-58-38"><a href="#__codelineno-58-38" id="__codelineno-58-38" name="__codelineno-58-38"></a>
</span><span id="__span-58-39"><a href="#__codelineno-58-39" id="__codelineno-58-39" name="__codelineno-58-39"></a><span class="nb">Write-Host</span> <span class="s2">"✅ Configuración completa!"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span></code></pre></div>
<h3 id="excepciones-bypass-logging-y-metrics"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#excepciones-bypass-logging-y-metrics">Excepciones (Bypass): Logging y Metrics</a></h3>
<p>Las <strong>Exceptions</strong> son configuraciones especiales que permiten que ciertos servicios bypaseen el firewall.</p>
<h4 id="tipos-de-excepciones"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#tipos-de-excepciones">Tipos de Excepciones</a></h4>
<h5 id="1-allow-azure-services-on-the-trusted-services-list"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#1-allow-azure-services-on-the-trusted-services-list">1. Allow Azure services on the trusted services list</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-59-1"><a href="#__codelineno-59-1" id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="nt">Bypass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AzureServices</span>
</span><span id="__span-59-2"><a href="#__codelineno-59-2" id="__codelineno-59-2" name="__codelineno-59-2"></a>
</span><span id="__span-59-3"><a href="#__codelineno-59-3" id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="l l-Scalar l-Scalar-Plain">¿Qué hace?</span>
</span><span id="__span-59-4"><a href="#__codelineno-59-4" id="__codelineno-59-4" name="__codelineno-59-4"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- Permite TODOS los servicios de la lista de Trusted Services</span>
</span><span id="__span-59-5"><a href="#__codelineno-59-5" id="__codelineno-59-5" name="__codelineno-59-5"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- Incluye</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Azure Backup, Synapse, SQL, Stream Analytics, etc.</span>
</span><span id="__span-59-6"><a href="#__codelineno-59-6" id="__codelineno-59-6" name="__codelineno-59-6"></a>
</span><span id="__span-59-7"><a href="#__codelineno-59-7" id="__codelineno-59-7" name="__codelineno-59-7"></a><span class="nt">⚠️ Recomendación</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Usar Resource Instances en su lugar</span>
</span></code></pre></div>
<h5 id="2-allow-read-access-to-storage-logging"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#2-allow-read-access-to-storage-logging">2. Allow read access to storage logging</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-60-1"><a href="#__codelineno-60-1" id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="nt">Bypass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Logging</span>
</span><span id="__span-60-2"><a href="#__codelineno-60-2" id="__codelineno-60-2" name="__codelineno-60-2"></a>
</span><span id="__span-60-3"><a href="#__codelineno-60-3" id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="l l-Scalar l-Scalar-Plain">¿Qué hace?</span>
</span><span id="__span-60-4"><a href="#__codelineno-60-4" id="__codelineno-60-4" name="__codelineno-60-4"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- Permite leer el contenedor especial "$logs"</span>
</span><span id="__span-60-5"><a href="#__codelineno-60-5" id="__codelineno-60-5" name="__codelineno-60-5"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- Solo para diagnósticos de Azure Monitor</span>
</span><span id="__span-60-6"><a href="#__codelineno-60-6" id="__codelineno-60-6" name="__codelineno-60-6"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- NO da acceso a tus datos de aplicación</span>
</span><span id="__span-60-7"><a href="#__codelineno-60-7" id="__codelineno-60-7" name="__codelineno-60-7"></a>
</span><span id="__span-60-8"><a href="#__codelineno-60-8" id="__codelineno-60-8" name="__codelineno-60-8"></a><span class="nt">✅ Recomendación</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SIEMPRE habilitado</span>
</span></code></pre></div>
<h5 id="3-allow-read-access-to-storage-metrics"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#3-allow-read-access-to-storage-metrics">3. Allow read access to storage metrics</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-61-1"><a href="#__codelineno-61-1" id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="nt">Bypass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Metrics</span>
</span><span id="__span-61-2"><a href="#__codelineno-61-2" id="__codelineno-61-2" name="__codelineno-61-2"></a>
</span><span id="__span-61-3"><a href="#__codelineno-61-3" id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="l l-Scalar l-Scalar-Plain">¿Qué hace?</span>
</span><span id="__span-61-4"><a href="#__codelineno-61-4" id="__codelineno-61-4" name="__codelineno-61-4"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- Permite leer las tablas "$Metrics*"</span>
</span><span id="__span-61-5"><a href="#__codelineno-61-5" id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- Solo para métricas de Azure Monitor</span>
</span><span id="__span-61-6"><a href="#__codelineno-61-6" id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- NO da acceso a tus datos de aplicación</span>
</span><span id="__span-61-7"><a href="#__codelineno-61-7" id="__codelineno-61-7" name="__codelineno-61-7"></a>
</span><span id="__span-61-8"><a href="#__codelineno-61-8" id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="nt">✅ Recomendación</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SIEMPRE habilitado</span>
</span></code></pre></div>
<h4 id="como-configurar-excepciones-en-el-portal"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#como-configurar-excepciones-en-el-portal">Cómo Configurar Excepciones en el Portal</a></h4>
<ol>
<li>Ve a tu Storage Account</li>
<li>Navega a: <strong>Security + networking</strong> → <strong>Networking</strong></li>
<li>Click en <strong>View</strong> junto a "Virtual networks, IP addresses, and exceptions"</li>
<li>Scroll down hasta la sección <strong>Exceptions</strong></li>
<li>Marca/desmarca los checkboxes según necesites:</li>
<li>☐ Allow Azure services on the trusted services list</li>
<li>☑️ Allow read access to storage logging</li>
<li>☑️ Allow read access to storage metrics</li>
<li>Click en <strong>Save</strong></li>
</ol>
<h3 id="configuracion-recomendada-sin-private-endpoints"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#configuracion-recomendada-sin-private-endpoints">Configuración Recomendada sin Private Endpoints</a></h3>
<p>Esta es la configuración óptima para máxima seguridad sin el costo adicional de Private Endpoints:</p>
<h4 id="configuracion-de-produccion"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#configuracion-de-produccion">🎯 Configuración de Producción</a></h4>
<div class="admonition info">
<p class="admonition-title">Nota sobre Azure Backup</p>
<p>Si usas <strong>Azure Backup para discos no administrados</strong>, necesitarás habilitar <code>AzureServices</code> en el Bypass. Ver <a href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#casos-especiales-servicios-que-requieren-trusted-services">sección de Azure Backup</a> para más detalles.</p>
</div>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-62-1"><a href="#__codelineno-62-1" id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="c"># 1. Configurar firewall restrictivo con excepciones de lectura</span>
</span><span id="__span-62-2"><a href="#__codelineno-62-2" id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="nb">Update-AzStorageAccountNetworkRuleSet</span> <span class="p">`</span>
</span><span id="__span-62-3"><a href="#__codelineno-62-3" id="__codelineno-62-3" name="__codelineno-62-3"></a>    <span class="n">-ResourceGroupName</span> <span class="s2">"myRG"</span> <span class="p">`</span>
</span><span id="__span-62-4"><a href="#__codelineno-62-4" id="__codelineno-62-4" name="__codelineno-62-4"></a>    <span class="n">-Name</span> <span class="s2">"mystorageaccount"</span> <span class="p">`</span>
</span><span id="__span-62-5"><a href="#__codelineno-62-5" id="__codelineno-62-5" name="__codelineno-62-5"></a>    <span class="n">-DefaultAction</span> <span class="n">Deny</span> <span class="p">`</span>
</span><span id="__span-62-6"><a href="#__codelineno-62-6" id="__codelineno-62-6" name="__codelineno-62-6"></a>    <span class="n">-Bypass</span> <span class="n">Logging</span><span class="p">,</span><span class="n">Metrics</span>  <span class="c"># SIN AzureServices (a menos que uses Azure Backup)</span>
</span><span id="__span-62-7"><a href="#__codelineno-62-7" id="__codelineno-62-7" name="__codelineno-62-7"></a>
</span><span id="__span-62-8"><a href="#__codelineno-62-8" id="__codelineno-62-8" name="__codelineno-62-8"></a><span class="c"># 2. Agregar Resource Instances específicas</span>
</span><span id="__span-62-9"><a href="#__codelineno-62-9" id="__codelineno-62-9" name="__codelineno-62-9"></a><span class="nv">$resources</span> <span class="p">=</span> <span class="p">@(</span>
</span><span id="__span-62-10"><a href="#__codelineno-62-10" id="__codelineno-62-10" name="__codelineno-62-10"></a>    <span class="s2">"/subscriptions/xxx/resourceGroups/rg1/providers/Microsoft.Synapse/workspaces/prod-synapse"</span><span class="p">,</span>
</span><span id="__span-62-11"><a href="#__codelineno-62-11" id="__codelineno-62-11" name="__codelineno-62-11"></a>    <span class="s2">"/subscriptions/xxx/resourceGroups/rg1/providers/Microsoft.DataFactory/factories/prod-adf"</span><span class="p">,</span>
</span><span id="__span-62-12"><a href="#__codelineno-62-12" id="__codelineno-62-12" name="__codelineno-62-12"></a>    <span class="s2">"/subscriptions/xxx/resourceGroups/rg1/providers/Microsoft.Databricks/workspaces/prod-dbx"</span>
</span><span id="__span-62-13"><a href="#__codelineno-62-13" id="__codelineno-62-13" name="__codelineno-62-13"></a><span class="p">)</span>
</span><span id="__span-62-14"><a href="#__codelineno-62-14" id="__codelineno-62-14" name="__codelineno-62-14"></a>
</span><span id="__span-62-15"><a href="#__codelineno-62-15" id="__codelineno-62-15" name="__codelineno-62-15"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$resourceId</span> <span class="k">in</span> <span class="nv">$resources</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-62-16"><a href="#__codelineno-62-16" id="__codelineno-62-16" name="__codelineno-62-16"></a>    <span class="nb">Add-AzStorageAccountNetworkRule</span> <span class="p">`</span>
</span><span id="__span-62-17"><a href="#__codelineno-62-17" id="__codelineno-62-17" name="__codelineno-62-17"></a>        <span class="n">-ResourceGroupName</span> <span class="s2">"myRG"</span> <span class="p">`</span>
</span><span id="__span-62-18"><a href="#__codelineno-62-18" id="__codelineno-62-18" name="__codelineno-62-18"></a>        <span class="n">-Name</span> <span class="s2">"mystorageaccount"</span> <span class="p">`</span>
</span><span id="__span-62-19"><a href="#__codelineno-62-19" id="__codelineno-62-19" name="__codelineno-62-19"></a>        <span class="n">-TenantId</span> <span class="s2">"your-tenant-id"</span> <span class="p">`</span>
</span><span id="__span-62-20"><a href="#__codelineno-62-20" id="__codelineno-62-20" name="__codelineno-62-20"></a>        <span class="n">-ResourceId</span> <span class="nv">$resourceId</span>
</span><span id="__span-62-21"><a href="#__codelineno-62-21" id="__codelineno-62-21" name="__codelineno-62-21"></a><span class="p">}</span>
</span><span id="__span-62-22"><a href="#__codelineno-62-22" id="__codelineno-62-22" name="__codelineno-62-22"></a>
</span><span id="__span-62-23"><a href="#__codelineno-62-23" id="__codelineno-62-23" name="__codelineno-62-23"></a><span class="c"># 3. Agregar IPs de oficina/VPN (opcional)</span>
</span><span id="__span-62-24"><a href="#__codelineno-62-24" id="__codelineno-62-24" name="__codelineno-62-24"></a><span class="nv">$officeIPs</span> <span class="p">=</span> <span class="p">@(</span><span class="s2">"203.0.113.10"</span><span class="p">,</span> <span class="s2">"198.51.100.0/24"</span><span class="p">)</span>
</span><span id="__span-62-25"><a href="#__codelineno-62-25" id="__codelineno-62-25" name="__codelineno-62-25"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$ip</span> <span class="k">in</span> <span class="nv">$officeIPs</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-62-26"><a href="#__codelineno-62-26" id="__codelineno-62-26" name="__codelineno-62-26"></a>    <span class="nb">Add-AzStorageAccountNetworkRule</span> <span class="p">`</span>
</span><span id="__span-62-27"><a href="#__codelineno-62-27" id="__codelineno-62-27" name="__codelineno-62-27"></a>        <span class="n">-ResourceGroupName</span> <span class="s2">"myRG"</span> <span class="p">`</span>
</span><span id="__span-62-28"><a href="#__codelineno-62-28" id="__codelineno-62-28" name="__codelineno-62-28"></a>        <span class="n">-Name</span> <span class="s2">"mystorageaccount"</span> <span class="p">`</span>
</span><span id="__span-62-29"><a href="#__codelineno-62-29" id="__codelineno-62-29" name="__codelineno-62-29"></a>        <span class="n">-IPAddressOrRange</span> <span class="nv">$ip</span>
</span><span id="__span-62-30"><a href="#__codelineno-62-30" id="__codelineno-62-30" name="__codelineno-62-30"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="arquitectura-visual"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#arquitectura-visual">Arquitectura Visual</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-63-1"><a href="#__codelineno-63-1" id="__codelineno-63-1" name="__codelineno-63-1"></a>┌─────────────────────────────────────────────────────────────┐
</span><span id="__span-63-2"><a href="#__codelineno-63-2" id="__codelineno-63-2" name="__codelineno-63-2"></a>│         Storage Account Firewall Configuration              │
</span><span id="__span-63-3"><a href="#__codelineno-63-3" id="__codelineno-63-3" name="__codelineno-63-3"></a>├─────────────────────────────────────────────────────────────┤
</span><span id="__span-63-4"><a href="#__codelineno-63-4" id="__codelineno-63-4" name="__codelineno-63-4"></a>│                                                             │
</span><span id="__span-63-5"><a href="#__codelineno-63-5" id="__codelineno-63-5" name="__codelineno-63-5"></a>│ Public network access: Selected networks                    │
</span><span id="__span-63-6"><a href="#__codelineno-63-6" id="__codelineno-63-6" name="__codelineno-63-6"></a>│ Default Action: DENY                                        │
</span><span id="__span-63-7"><a href="#__codelineno-63-7" id="__codelineno-63-7" name="__codelineno-63-7"></a>│                                                             │
</span><span id="__span-63-8"><a href="#__codelineno-63-8" id="__codelineno-63-8" name="__codelineno-63-8"></a>│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━│
</span><span id="__span-63-9"><a href="#__codelineno-63-9" id="__codelineno-63-9" name="__codelineno-63-9"></a>│                                                             │
</span><span id="__span-63-10"><a href="#__codelineno-63-10" id="__codelineno-63-10" name="__codelineno-63-10"></a>│ Exceptions (Bypass):                                        │
</span><span id="__span-63-11"><a href="#__codelineno-63-11" id="__codelineno-63-11" name="__codelineno-63-11"></a>│   ☐ AzureServices (NO - demasiado permisivo)               │
</span><span id="__span-63-12"><a href="#__codelineno-63-12" id="__codelineno-63-12" name="__codelineno-63-12"></a>│   ☑️ Logging (SÍ - para troubleshooting)                   │
</span><span id="__span-63-13"><a href="#__codelineno-63-13" id="__codelineno-63-13" name="__codelineno-63-13"></a>│   ☑️ Metrics (SÍ - para monitoreo)                         │
</span><span id="__span-63-14"><a href="#__codelineno-63-14" id="__codelineno-63-14" name="__codelineno-63-14"></a>│                                                             │
</span><span id="__span-63-15"><a href="#__codelineno-63-15" id="__codelineno-63-15" name="__codelineno-63-15"></a>│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━│
</span><span id="__span-63-16"><a href="#__codelineno-63-16" id="__codelineno-63-16" name="__codelineno-63-16"></a>│                                                             │
</span><span id="__span-63-17"><a href="#__codelineno-63-17" id="__codelineno-63-17" name="__codelineno-63-17"></a>│ Resource Instances (granular):                             │
</span><span id="__span-63-18"><a href="#__codelineno-63-18" id="__codelineno-63-18" name="__codelineno-63-18"></a>│   ✅ prod-synapse                                           │
</span><span id="__span-63-19"><a href="#__codelineno-63-19" id="__codelineno-63-19" name="__codelineno-63-19"></a>│   ✅ prod-adf                                               │
</span><span id="__span-63-20"><a href="#__codelineno-63-20" id="__codelineno-63-20" name="__codelineno-63-20"></a>│   ✅ prod-databricks                                        │
</span><span id="__span-63-21"><a href="#__codelineno-63-21" id="__codelineno-63-21" name="__codelineno-63-21"></a>│                                                             │
</span><span id="__span-63-22"><a href="#__codelineno-63-22" id="__codelineno-63-22" name="__codelineno-63-22"></a>│ VNet Rules: [subnets específicas]                          │
</span><span id="__span-63-23"><a href="#__codelineno-63-23" id="__codelineno-63-23" name="__codelineno-63-23"></a>│ IP Rules: [oficinas, VPN]                                  │
</span><span id="__span-63-24"><a href="#__codelineno-63-24" id="__codelineno-63-24" name="__codelineno-63-24"></a>│                                                             │
</span><span id="__span-63-25"><a href="#__codelineno-63-25" id="__codelineno-63-25" name="__codelineno-63-25"></a>└─────────────────────────────────────────────────────────────┘
</span></code></pre></div>
<h3 id="alcance-del-firewall-todos-los-servicios"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#alcance-del-firewall-todos-los-servicios">Alcance del Firewall: Todos los Servicios</a></h3>
<div class="admonition important">
<p class="admonition-title">Concepto Clave</p>
<p>El firewall de Storage Account protege <strong>TODOS</strong> los servicios, no puedes configurarlo por servicio individual.</p>
</div>
<h4 id="servicios-afectados"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#servicios-afectados">Servicios Afectados</a></h4>
<p>El firewall aplica a todos estos endpoints:</p>
<ul>
<li>🔵 <strong>Blob Storage</strong>: <code>https://{account}.blob.core.windows.net</code></li>
<li>📁 <strong>File Storage</strong>: <code>https://{account}.file.core.windows.net</code></li>
<li>📮 <strong>Queue Storage</strong>: <code>https://{account}.queue.core.windows.net</code></li>
<li>📊 <strong>Table Storage</strong>: <code>https://{account}.table.core.windows.net</code></li>
</ul>
<h4 id="control-granular-por-servicio"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#control-granular-por-servicio">Control Granular por Servicio</a></h4>
<p>Si necesitas que un recurso acceda solo a Blob pero no a Files, usa <strong>RBAC</strong>:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-64-1"><a href="#__codelineno-64-1" id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="c"># Firewall: Permite conexión al endpoint (todos los servicios)</span>
</span><span id="__span-64-2"><a href="#__codelineno-64-2" id="__codelineno-64-2" name="__codelineno-64-2"></a><span class="nb">Add-AzStorageAccountNetworkRule</span> <span class="n">-ResourceId</span> <span class="nv">$resourceId</span>
</span><span id="__span-64-3"><a href="#__codelineno-64-3" id="__codelineno-64-3" name="__codelineno-64-3"></a>
</span><span id="__span-64-4"><a href="#__codelineno-64-4" id="__codelineno-64-4" name="__codelineno-64-4"></a><span class="c"># RBAC: Controla acceso específico por servicio</span>
</span><span id="__span-64-5"><a href="#__codelineno-64-5" id="__codelineno-64-5" name="__codelineno-64-5"></a><span class="nb">New-AzRoleAssignment</span> <span class="p">`</span>
</span><span id="__span-64-6"><a href="#__codelineno-64-6" id="__codelineno-64-6" name="__codelineno-64-6"></a>    <span class="n">-ObjectId</span> <span class="nv">$principalId</span> <span class="p">`</span>
</span><span id="__span-64-7"><a href="#__codelineno-64-7" id="__codelineno-64-7" name="__codelineno-64-7"></a>    <span class="n">-RoleDefinitionName</span> <span class="s2">"Storage Blob Data Contributor"</span> <span class="p">`</span>  <span class="c"># Solo Blob</span>
</span><span id="__span-64-8"><a href="#__codelineno-64-8" id="__codelineno-64-8" name="__codelineno-64-8"></a>    <span class="n">-Scope</span> <span class="nv">$storageAccountScope</span>
</span><span id="__span-64-9"><a href="#__codelineno-64-9" id="__codelineno-64-9" name="__codelineno-64-9"></a>
</span><span id="__span-64-10"><a href="#__codelineno-64-10" id="__codelineno-64-10" name="__codelineno-64-10"></a><span class="c"># No asignas roles para Files, Queues o Tables</span>
</span><span id="__span-64-11"><a href="#__codelineno-64-11" id="__codelineno-64-11" name="__codelineno-64-11"></a><span class="c"># → Aunque el firewall permita conexión, no tiene permisos RBAC</span>
</span></code></pre></div>
<h3 id="validacion-de-configuracion"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#validacion-de-configuracion">Validación de Configuración</a></h3>
<h4 id="script-de-validacion-completa"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#script-de-validacion-completa">Script de Validación Completa</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-65-1"><a href="#__codelineno-65-1" id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="k">function</span> <span class="nb">Test-StorageAccountSecurityConfig</span> <span class="p">{</span>
</span><span id="__span-65-2"><a href="#__codelineno-65-2" id="__codelineno-65-2" name="__codelineno-65-2"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-65-3"><a href="#__codelineno-65-3" id="__codelineno-65-3" name="__codelineno-65-3"></a>        <span class="no">[string]</span><span class="nv">$ResourceGroupName</span><span class="p">,</span>
</span><span id="__span-65-4"><a href="#__codelineno-65-4" id="__codelineno-65-4" name="__codelineno-65-4"></a>        <span class="no">[string]</span><span class="nv">$StorageAccountName</span>
</span><span id="__span-65-5"><a href="#__codelineno-65-5" id="__codelineno-65-5" name="__codelineno-65-5"></a>    <span class="p">)</span>
</span><span id="__span-65-6"><a href="#__codelineno-65-6" id="__codelineno-65-6" name="__codelineno-65-6"></a>
</span><span id="__span-65-7"><a href="#__codelineno-65-7" id="__codelineno-65-7" name="__codelineno-65-7"></a>    <span class="nv">$rules</span> <span class="p">=</span> <span class="nb">Get-AzStorageAccountNetworkRuleSet</span> <span class="p">`</span>
</span><span id="__span-65-8"><a href="#__codelineno-65-8" id="__codelineno-65-8" name="__codelineno-65-8"></a>        <span class="n">-ResourceGroupName</span> <span class="nv">$ResourceGroupName</span> <span class="p">`</span>
</span><span id="__span-65-9"><a href="#__codelineno-65-9" id="__codelineno-65-9" name="__codelineno-65-9"></a>        <span class="n">-Name</span> <span class="nv">$StorageAccountName</span>
</span><span id="__span-65-10"><a href="#__codelineno-65-10" id="__codelineno-65-10" name="__codelineno-65-10"></a>
</span><span id="__span-65-11"><a href="#__codelineno-65-11" id="__codelineno-65-11" name="__codelineno-65-11"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">🔍 VALIDACIÓN DE CONFIGURACIÓN ÓPTIMA"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-65-12"><a href="#__codelineno-65-12" id="__codelineno-65-12" name="__codelineno-65-12"></a>    <span class="nb">Write-Host</span> <span class="s2">"═══════════════════════════════════════</span><span class="se">`n</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-65-13"><a href="#__codelineno-65-13" id="__codelineno-65-13" name="__codelineno-65-13"></a>
</span><span id="__span-65-14"><a href="#__codelineno-65-14" id="__codelineno-65-14" name="__codelineno-65-14"></a>    <span class="nv">$score</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-65-15"><a href="#__codelineno-65-15" id="__codelineno-65-15" name="__codelineno-65-15"></a>    <span class="nv">$maxScore</span> <span class="p">=</span> <span class="n">5</span>
</span><span id="__span-65-16"><a href="#__codelineno-65-16" id="__codelineno-65-16" name="__codelineno-65-16"></a>
</span><span id="__span-65-17"><a href="#__codelineno-65-17" id="__codelineno-65-17" name="__codelineno-65-17"></a>    <span class="c"># Check 1: DefaultAction</span>
</span><span id="__span-65-18"><a href="#__codelineno-65-18" id="__codelineno-65-18" name="__codelineno-65-18"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$rules</span><span class="p">.</span><span class="n">DefaultAction</span> <span class="o">-eq</span> <span class="s2">"Deny"</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-65-19"><a href="#__codelineno-65-19" id="__codelineno-65-19" name="__codelineno-65-19"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ DefaultAction: Deny (Correcto)"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-65-20"><a href="#__codelineno-65-20" id="__codelineno-65-20" name="__codelineno-65-20"></a>        <span class="nv">$score</span><span class="p">++</span>
</span><span id="__span-65-21"><a href="#__codelineno-65-21" id="__codelineno-65-21" name="__codelineno-65-21"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-65-22"><a href="#__codelineno-65-22" id="__codelineno-65-22" name="__codelineno-65-22"></a>        <span class="nb">Write-Host</span> <span class="s2">"❌ DefaultAction: Allow (Cambiar a Deny)"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-65-23"><a href="#__codelineno-65-23" id="__codelineno-65-23" name="__codelineno-65-23"></a>    <span class="p">}</span>
</span><span id="__span-65-24"><a href="#__codelineno-65-24" id="__codelineno-65-24" name="__codelineno-65-24"></a>
</span><span id="__span-65-25"><a href="#__codelineno-65-25" id="__codelineno-65-25" name="__codelineno-65-25"></a>    <span class="c"># Check 2: Bypass óptimo</span>
</span><span id="__span-65-26"><a href="#__codelineno-65-26" id="__codelineno-65-26" name="__codelineno-65-26"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$rules</span><span class="p">.</span><span class="n">Bypass</span> <span class="o">-notlike</span> <span class="s2">"*AzureServices*"</span> <span class="o">-and</span> 
</span><span id="__span-65-27"><a href="#__codelineno-65-27" id="__codelineno-65-27" name="__codelineno-65-27"></a>        <span class="nv">$rules</span><span class="p">.</span><span class="n">Bypass</span> <span class="o">-like</span> <span class="s2">"*Logging*"</span> <span class="o">-and</span> 
</span><span id="__span-65-28"><a href="#__codelineno-65-28" id="__codelineno-65-28" name="__codelineno-65-28"></a>        <span class="nv">$rules</span><span class="p">.</span><span class="n">Bypass</span> <span class="o">-like</span> <span class="s2">"*Metrics*"</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-65-29"><a href="#__codelineno-65-29" id="__codelineno-65-29" name="__codelineno-65-29"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ Bypass: Logging,Metrics (Óptimo)"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-65-30"><a href="#__codelineno-65-30" id="__codelineno-65-30" name="__codelineno-65-30"></a>        <span class="nv">$score</span><span class="p">++</span>
</span><span id="__span-65-31"><a href="#__codelineno-65-31" id="__codelineno-65-31" name="__codelineno-65-31"></a>    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$rules</span><span class="p">.</span><span class="n">Bypass</span> <span class="o">-like</span> <span class="s2">"*AzureServices*"</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-65-32"><a href="#__codelineno-65-32" id="__codelineno-65-32" name="__codelineno-65-32"></a>        <span class="nb">Write-Host</span> <span class="s2">"⚠️  Bypass incluye AzureServices (Considerar usar Resource Instances)"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-65-33"><a href="#__codelineno-65-33" id="__codelineno-65-33" name="__codelineno-65-33"></a>    <span class="p">}</span>
</span><span id="__span-65-34"><a href="#__codelineno-65-34" id="__codelineno-65-34" name="__codelineno-65-34"></a>
</span><span id="__span-65-35"><a href="#__codelineno-65-35" id="__codelineno-65-35" name="__codelineno-65-35"></a>    <span class="c"># Check 3: Resource Instances</span>
</span><span id="__span-65-36"><a href="#__codelineno-65-36" id="__codelineno-65-36" name="__codelineno-65-36"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$rules</span><span class="p">.</span><span class="n">ResourceAccessRules</span><span class="p">.</span><span class="n">Count</span> <span class="o">-gt</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-65-37"><a href="#__codelineno-65-37" id="__codelineno-65-37" name="__codelineno-65-37"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ Resource Instances: </span><span class="p">$(</span><span class="nv">$rules</span><span class="p">.</span><span class="n">ResourceAccessRules</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> configuradas"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-65-38"><a href="#__codelineno-65-38" id="__codelineno-65-38" name="__codelineno-65-38"></a>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$rule</span> <span class="k">in</span> <span class="nv">$rules</span><span class="p">.</span><span class="n">ResourceAccessRules</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-65-39"><a href="#__codelineno-65-39" id="__codelineno-65-39" name="__codelineno-65-39"></a>            <span class="nv">$resourceName</span> <span class="p">=</span> <span class="nv">$rule</span><span class="p">.</span><span class="n">ResourceId</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)[-</span><span class="n">1</span><span class="p">]</span>
</span><span id="__span-65-40"><a href="#__codelineno-65-40" id="__codelineno-65-40" name="__codelineno-65-40"></a>            <span class="nb">Write-Host</span> <span class="s2">"   → $resourceName"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-65-41"><a href="#__codelineno-65-41" id="__codelineno-65-41" name="__codelineno-65-41"></a>        <span class="p">}</span>
</span><span id="__span-65-42"><a href="#__codelineno-65-42" id="__codelineno-65-42" name="__codelineno-65-42"></a>        <span class="nv">$score</span><span class="p">++</span>
</span><span id="__span-65-43"><a href="#__codelineno-65-43" id="__codelineno-65-43" name="__codelineno-65-43"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-65-44"><a href="#__codelineno-65-44" id="__codelineno-65-44" name="__codelineno-65-44"></a>        <span class="nb">Write-Host</span> <span class="s2">"⚠️  No hay Resource Instances configuradas"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-65-45"><a href="#__codelineno-65-45" id="__codelineno-65-45" name="__codelineno-65-45"></a>    <span class="p">}</span>
</span><span id="__span-65-46"><a href="#__codelineno-65-46" id="__codelineno-65-46" name="__codelineno-65-46"></a>
</span><span id="__span-65-47"><a href="#__codelineno-65-47" id="__codelineno-65-47" name="__codelineno-65-47"></a>    <span class="c"># Check 4: VNet Rules</span>
</span><span id="__span-65-48"><a href="#__codelineno-65-48" id="__codelineno-65-48" name="__codelineno-65-48"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$rules</span><span class="p">.</span><span class="n">VirtualNetworkRules</span><span class="p">.</span><span class="n">Count</span> <span class="o">-gt</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-65-49"><a href="#__codelineno-65-49" id="__codelineno-65-49" name="__codelineno-65-49"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ VNet Rules: </span><span class="p">$(</span><span class="nv">$rules</span><span class="p">.</span><span class="n">VirtualNetworkRules</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-65-50"><a href="#__codelineno-65-50" id="__codelineno-65-50" name="__codelineno-65-50"></a>        <span class="nv">$score</span><span class="p">++</span>
</span><span id="__span-65-51"><a href="#__codelineno-65-51" id="__codelineno-65-51" name="__codelineno-65-51"></a>    <span class="p">}</span>
</span><span id="__span-65-52"><a href="#__codelineno-65-52" id="__codelineno-65-52" name="__codelineno-65-52"></a>
</span><span id="__span-65-53"><a href="#__codelineno-65-53" id="__codelineno-65-53" name="__codelineno-65-53"></a>    <span class="c"># Check 5: IP Rules</span>
</span><span id="__span-65-54"><a href="#__codelineno-65-54" id="__codelineno-65-54" name="__codelineno-65-54"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$rules</span><span class="p">.</span><span class="n">IpRules</span><span class="p">.</span><span class="n">Count</span> <span class="o">-gt</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-65-55"><a href="#__codelineno-65-55" id="__codelineno-65-55" name="__codelineno-65-55"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ IP Rules: </span><span class="p">$(</span><span class="nv">$rules</span><span class="p">.</span><span class="n">IpRules</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-65-56"><a href="#__codelineno-65-56" id="__codelineno-65-56" name="__codelineno-65-56"></a>        <span class="nv">$score</span><span class="p">++</span>
</span><span id="__span-65-57"><a href="#__codelineno-65-57" id="__codelineno-65-57" name="__codelineno-65-57"></a>    <span class="p">}</span>
</span><span id="__span-65-58"><a href="#__codelineno-65-58" id="__codelineno-65-58" name="__codelineno-65-58"></a>
</span><span id="__span-65-59"><a href="#__codelineno-65-59" id="__codelineno-65-59" name="__codelineno-65-59"></a>    <span class="c"># Resumen</span>
</span><span id="__span-65-60"><a href="#__codelineno-65-60" id="__codelineno-65-60" name="__codelineno-65-60"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">════════════════════════════════════════"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-65-61"><a href="#__codelineno-65-61" id="__codelineno-65-61" name="__codelineno-65-61"></a>    <span class="nb">Write-Host</span> <span class="s2">"Puntaje de Seguridad: $score/$maxScore"</span> <span class="n">-ForegroundColor</span> <span class="p">$(</span>
</span><span id="__span-65-62"><a href="#__codelineno-65-62" id="__codelineno-65-62" name="__codelineno-65-62"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$score</span> <span class="o">-eq</span> <span class="nv">$maxScore</span><span class="p">)</span> <span class="p">{</span> <span class="s2">"Green"</span> <span class="p">}</span> 
</span><span id="__span-65-63"><a href="#__codelineno-65-63" id="__codelineno-65-63" name="__codelineno-65-63"></a>        <span class="k">elseif</span> <span class="p">(</span><span class="nv">$score</span> <span class="o">-ge</span> <span class="n">3</span><span class="p">)</span> <span class="p">{</span> <span class="s2">"Yellow"</span> <span class="p">}</span> 
</span><span id="__span-65-64"><a href="#__codelineno-65-64" id="__codelineno-65-64" name="__codelineno-65-64"></a>        <span class="k">else</span> <span class="p">{</span> <span class="s2">"Red"</span> <span class="p">}</span>
</span><span id="__span-65-65"><a href="#__codelineno-65-65" id="__codelineno-65-65" name="__codelineno-65-65"></a>    <span class="p">)</span>
</span><span id="__span-65-66"><a href="#__codelineno-65-66" id="__codelineno-65-66" name="__codelineno-65-66"></a>
</span><span id="__span-65-67"><a href="#__codelineno-65-67" id="__codelineno-65-67" name="__codelineno-65-67"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$score</span> <span class="o">-ge</span> <span class="n">4</span> <span class="o">-and</span> <span class="nv">$rules</span><span class="p">.</span><span class="n">Bypass</span> <span class="o">-notlike</span> <span class="s2">"*AzureServices*"</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-65-68"><a href="#__codelineno-65-68" id="__codelineno-65-68" name="__codelineno-65-68"></a>        <span class="nb">Write-Host</span> <span class="s2">"🎉 CONFIGURACIÓN ÓPTIMA"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-65-69"><a href="#__codelineno-65-69" id="__codelineno-65-69" name="__codelineno-65-69"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-65-70"><a href="#__codelineno-65-70" id="__codelineno-65-70" name="__codelineno-65-70"></a>        <span class="nb">Write-Host</span> <span class="s2">"⚠️  Revisar configuración según recomendaciones"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-65-71"><a href="#__codelineno-65-71" id="__codelineno-65-71" name="__codelineno-65-71"></a>    <span class="p">}</span>
</span><span id="__span-65-72"><a href="#__codelineno-65-72" id="__codelineno-65-72" name="__codelineno-65-72"></a><span class="p">}</span>
</span><span id="__span-65-73"><a href="#__codelineno-65-73" id="__codelineno-65-73" name="__codelineno-65-73"></a>
</span><span id="__span-65-74"><a href="#__codelineno-65-74" id="__codelineno-65-74" name="__codelineno-65-74"></a><span class="c"># Uso</span>
</span><span id="__span-65-75"><a href="#__codelineno-65-75" id="__codelineno-65-75" name="__codelineno-65-75"></a><span class="nb">Test-StorageAccountSecurityConfig</span> <span class="n">-ResourceGroupName</span> <span class="s2">"myRG"</span> <span class="n">-StorageAccountName</span> <span class="s2">"mystorageaccount"</span>
</span></code></pre></div>
<h3 id="mejores-practicas"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#mejores-practicas">Mejores Prácticas</a></h3>
<h4 id="recomendaciones-de-seguridad"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#recomendaciones-de-seguridad">✅ Recomendaciones de Seguridad</a></h4>
<ol>
<li><strong>Usa Resource Instances en lugar de Trusted Services</strong></li>
<li>Mayor control y trazabilidad</li>
<li>Cumple con Zero Trust</li>
<li>
<p>Mejor para compliance</p>
</li>
<li>
<p><strong>Siempre habilita Logging y Metrics</strong></p>
</li>
<li>Necesario para troubleshooting</li>
<li>No expone tus datos</li>
<li>
<p>Bajo riesgo de seguridad</p>
</li>
<li>
<p><strong>Aplica el principio de menor privilegio</strong></p>
</li>
<li>Firewall: Solo recursos que realmente necesitan acceso</li>
<li>
<p>RBAC: Solo los permisos mínimos necesarios</p>
</li>
<li>
<p><strong>Documenta tus Resource Instances</strong></p>
</li>
<li>Mantén un registro de qué recurso accede y por qué</li>
<li>
<p>Facilita auditorías y compliance</p>
</li>
<li>
<p><strong>Revisa periódicamente las reglas</strong></p>
</li>
<li>Elimina recursos que ya no existen</li>
<li>Verifica que las reglas siguen siendo necesarias</li>
</ol>
<h4 id="errores-comunes-a-evitar"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#errores-comunes-a-evitar">⚠️ Errores Comunes a Evitar</a></h4>
<div class="admonition danger">
<p class="admonition-title">No hagas esto</p>
<ul>
<li>❌ Dejar <code>DefaultAction: Allow</code> en producción</li>
<li>❌ Usar solo Trusted Services por conveniencia</li>
<li>❌ Olvidar asignar roles RBAC después de crear Resource Instance</li>
<li>❌ No documentar para qué sirve cada regla</li>
<li>❌ Deshabilitar Logging y Metrics</li>
</ul>
</div>
<h3 id="casos-especiales-servicios-que-requieren-trusted-services"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#casos-especiales-servicios-que-requieren-trusted-services">Casos Especiales: Servicios que Requieren Trusted Services</a></h3>
<p>Algunos servicios de Azure <strong>NO soportan Resource Instances</strong> y requieren que tengas habilitado <code>Bypass: AzureServices</code>. Es importante conocer estos casos para planificar tu estrategia de seguridad.</p>
<h4 id="azure-backup"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#azure-backup">Azure Backup</a></h4>
<p><strong>Azure Backup</strong> es uno de los servicios más importantes que requiere Trusted Services para ciertos escenarios:</p>
<div class="admonition warning">
<p class="admonition-title">Azure Backup y Trusted Services</p>
<p>Azure Backup necesita <code>Bypass: AzureServices</code> habilitado para:</p>
<ul>
<li><strong>Backup de discos no administrados</strong> (unmanaged disks) en VMs</li>
<li><strong>Restore de VMs</strong> con discos no administrados</li>
<li>Algunos escenarios de backup de Azure Files</li>
</ul>
<p><strong>NO necesita</strong> Trusted Services para:</p>
<ul>
<li>Backup de discos administrados (managed disks) - Azure los gestiona automáticamente</li>
</ul>
</div>
<h5 id="configuracion-para-azure-backup"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#configuracion-para-azure-backup">Configuración para Azure Backup</a></h5>
<p>Si usas Azure Backup, tienes dos opciones:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio"><input id="__tabbed_8_2" name="__tabbed_8" type="radio"><div class="tabbed-labels"><label for="__tabbed_8_1">Opción 1: Trusted Services (Menos Seguro)</label><label for="__tabbed_8_2">Opción 2: Híbrida (Más Seguro)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-66-1"><a href="#__codelineno-66-1" id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="c"># Habilitar Trusted Services para Azure Backup</span>
</span><span id="__span-66-2"><a href="#__codelineno-66-2" id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="nb">Update-AzStorageAccountNetworkRuleSet</span> <span class="p">`</span>
</span><span id="__span-66-3"><a href="#__codelineno-66-3" id="__codelineno-66-3" name="__codelineno-66-3"></a>    <span class="n">-ResourceGroupName</span> <span class="s2">"myRG"</span> <span class="p">`</span>
</span><span id="__span-66-4"><a href="#__codelineno-66-4" id="__codelineno-66-4" name="__codelineno-66-4"></a>    <span class="n">-Name</span> <span class="s2">"mystorageaccount"</span> <span class="p">`</span>
</span><span id="__span-66-5"><a href="#__codelineno-66-5" id="__codelineno-66-5" name="__codelineno-66-5"></a>    <span class="n">-DefaultAction</span> <span class="n">Deny</span> <span class="p">`</span>
</span><span id="__span-66-6"><a href="#__codelineno-66-6" id="__codelineno-66-6" name="__codelineno-66-6"></a>    <span class="n">-Bypass</span> <span class="n">AzureServices</span><span class="p">,</span><span class="n">Logging</span><span class="p">,</span><span class="n">Metrics</span>
</span><span id="__span-66-7"><a href="#__codelineno-66-7" id="__codelineno-66-7" name="__codelineno-66-7"></a>
</span><span id="__span-66-8"><a href="#__codelineno-66-8" id="__codelineno-66-8" name="__codelineno-66-8"></a><span class="c"># ⚠️ Esto permite acceso a TODOS los servicios trusted</span>
</span><span id="__span-66-9"><a href="#__codelineno-66-9" id="__codelineno-66-9" name="__codelineno-66-9"></a><span class="c"># No solo Azure Backup</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-67-1"><a href="#__codelineno-67-1" id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="c"># Combinar Trusted Services + Resource Instances</span>
</span><span id="__span-67-2"><a href="#__codelineno-67-2" id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="nb">Update-AzStorageAccountNetworkRuleSet</span> <span class="p">`</span>
</span><span id="__span-67-3"><a href="#__codelineno-67-3" id="__codelineno-67-3" name="__codelineno-67-3"></a>    <span class="n">-ResourceGroupName</span> <span class="s2">"myRG"</span> <span class="p">`</span>
</span><span id="__span-67-4"><a href="#__codelineno-67-4" id="__codelineno-67-4" name="__codelineno-67-4"></a>    <span class="n">-Name</span> <span class="s2">"mystorageaccount"</span> <span class="p">`</span>
</span><span id="__span-67-5"><a href="#__codelineno-67-5" id="__codelineno-67-5" name="__codelineno-67-5"></a>    <span class="n">-DefaultAction</span> <span class="n">Deny</span> <span class="p">`</span>
</span><span id="__span-67-6"><a href="#__codelineno-67-6" id="__codelineno-67-6" name="__codelineno-67-6"></a>    <span class="n">-Bypass</span> <span class="n">AzureServices</span><span class="p">,</span><span class="n">Logging</span><span class="p">,</span><span class="n">Metrics</span>  <span class="c"># Para Azure Backup</span>
</span><span id="__span-67-7"><a href="#__codelineno-67-7" id="__codelineno-67-7" name="__codelineno-67-7"></a>
</span><span id="__span-67-8"><a href="#__codelineno-67-8" id="__codelineno-67-8" name="__codelineno-67-8"></a><span class="c"># Agregar Resource Instances para otros servicios</span>
</span><span id="__span-67-9"><a href="#__codelineno-67-9" id="__codelineno-67-9" name="__codelineno-67-9"></a><span class="nb">Add-AzStorageAccountNetworkRule</span> <span class="p">`</span>
</span><span id="__span-67-10"><a href="#__codelineno-67-10" id="__codelineno-67-10" name="__codelineno-67-10"></a>    <span class="n">-TenantId</span> <span class="s2">"xxx"</span> <span class="p">`</span>
</span><span id="__span-67-11"><a href="#__codelineno-67-11" id="__codelineno-67-11" name="__codelineno-67-11"></a>    <span class="n">-ResourceId</span> <span class="s2">"/subscriptions/xxx/.../Microsoft.Synapse/workspaces/prod-synapse"</span>
</span><span id="__span-67-12"><a href="#__codelineno-67-12" id="__codelineno-67-12" name="__codelineno-67-12"></a>
</span><span id="__span-67-13"><a href="#__codelineno-67-13" id="__codelineno-67-13" name="__codelineno-67-13"></a><span class="c"># Resultado:</span>
</span><span id="__span-67-14"><a href="#__codelineno-67-14" id="__codelineno-67-14" name="__codelineno-67-14"></a><span class="c"># ✅ Azure Backup funciona (via Trusted Services)</span>
</span><span id="__span-67-15"><a href="#__codelineno-67-15" id="__codelineno-67-15" name="__codelineno-67-15"></a><span class="c"># ✅ Synapse tiene acceso controlado (via Resource Instance)</span>
</span><span id="__span-67-16"><a href="#__codelineno-67-16" id="__codelineno-67-16" name="__codelineno-67-16"></a><span class="c"># ⚠️ Otros servicios trusted también tienen acceso</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="otros-servicios-que-pueden-requerir-trusted-services"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#otros-servicios-que-pueden-requerir-trusted-services">Otros Servicios que Pueden Requerir Trusted Services</a></h4>
<table>
<thead>
<tr>
<th>Servicio</th>
<th>¿Soporta Resource Instances?</th>
<th>Notas</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Azure Backup</strong></td>
<td>❌ Solo vía Trusted Services</td>
<td>Para discos no administrados</td>
</tr>
<tr>
<td><strong>Azure Site Recovery</strong></td>
<td>❌ Solo vía Trusted Services</td>
<td>Replicación y DR</td>
</tr>
<tr>
<td><strong>Azure Import/Export</strong></td>
<td>❌ Solo vía Trusted Services</td>
<td>Transferencia masiva de datos</td>
</tr>
<tr>
<td><strong>Azure DevTest Labs</strong></td>
<td>❌ Solo vía Trusted Services</td>
<td>Creación de imágenes</td>
</tr>
<tr>
<td><strong>Azure Event Grid</strong></td>
<td>⚠️ Depende del escenario</td>
<td>Algunos casos necesitan Trusted Services</td>
</tr>
<tr>
<td><strong>Azure Synapse</strong></td>
<td>✅ Soporta Resource Instances</td>
<td><strong>Recomendado</strong> usar Resource Instances</td>
</tr>
<tr>
<td><strong>Azure Data Factory</strong></td>
<td>✅ Soporta Resource Instances</td>
<td><strong>Recomendado</strong> usar Resource Instances</td>
</tr>
<tr>
<td><strong>Azure Databricks</strong></td>
<td>✅ Soporta Resource Instances</td>
<td><strong>Recomendado</strong> usar Resource Instances</td>
</tr>
<tr>
<td><strong>Azure SQL Database</strong></td>
<td>✅ Soporta Resource Instances</td>
<td><strong>Recomendado</strong> usar Resource Instances</td>
</tr>
<tr>
<td><strong>Azure Stream Analytics</strong></td>
<td>✅ Soporta Resource Instances</td>
<td><strong>Recomendado</strong> usar Resource Instances</td>
</tr>
</tbody>
</table>
<h4 id="estrategia-recomendada-con-azure-backup"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#estrategia-recomendada-con-azure-backup">Estrategia Recomendada con Azure Backup</a></h4>
<p>Si necesitas usar Azure Backup pero quieres mantener la máxima seguridad:</p>
<ol>
<li>
<p><strong>Evalúa si realmente necesitas Trusted Services</strong>
</p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-68-1"><a href="#__codelineno-68-1" id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="c"># ¿Usas discos no administrados?</span>
</span><span id="__span-68-2"><a href="#__codelineno-68-2" id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="nb">Get-AzVM</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">StorageProfile</span><span class="p">.</span><span class="n">OsDisk</span><span class="p">.</span><span class="n">ManagedDisk</span> <span class="o">-eq</span> <span class="nv">$null</span><span class="p">}</span>
</span><span id="__span-68-3"><a href="#__codelineno-68-3" id="__codelineno-68-3" name="__codelineno-68-3"></a>
</span><span id="__span-68-4"><a href="#__codelineno-68-4" id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="c"># Si el resultado está vacío, NO necesitas Trusted Services para Backup</span>
</span></code></pre></div><p></p>
</li>
<li>
<p><strong>Migra a Managed Disks si es posible</strong></p>
</li>
<li>Los managed disks NO requieren Trusted Services</li>
<li>Mejor rendimiento y gestión</li>
<li>
<p>Recomendado por Microsoft</p>
</li>
<li>
<p><strong>Si DEBES usar Trusted Services, documéntalo</strong>
</p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-69-1"><a href="#__codelineno-69-1" id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="nt">Storage Account</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mystorageaccount</span>
</span><span id="__span-69-2"><a href="#__codelineno-69-2" id="__codelineno-69-2" name="__codelineno-69-2"></a><span class="nt">Bypass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AzureServices</span>
</span><span id="__span-69-3"><a href="#__codelineno-69-3" id="__codelineno-69-3" name="__codelineno-69-3"></a><span class="nt">Motivo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Azure Backup de VMs con discos no administrados</span>
</span><span id="__span-69-4"><a href="#__codelineno-69-4" id="__codelineno-69-4" name="__codelineno-69-4"></a><span class="nt">VMs afectadas</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-69-5"><a href="#__codelineno-69-5" id="__codelineno-69-5" name="__codelineno-69-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-legacy-01</span>
</span><span id="__span-69-6"><a href="#__codelineno-69-6" id="__codelineno-69-6" name="__codelineno-69-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-legacy-02</span>
</span><span id="__span-69-7"><a href="#__codelineno-69-7" id="__codelineno-69-7" name="__codelineno-69-7"></a><span class="nt">Plan de migración</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Q2 2026</span>
</span></code></pre></div><p></p>
</li>
<li>
<p><strong>Usa Resource Instances para todo lo demás</strong></p>
</li>
<li>Synapse, Data Factory, Databricks → Resource Instances</li>
<li>Solo Azure Backup usa Trusted Services</li>
<li>Documenta qué servicios usan cada método</li>
</ol>
<h4 id="ejemplo-de-configuracion-real-con-azure-backup"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#ejemplo-de-configuracion-real-con-azure-backup">Ejemplo de Configuración Real con Azure Backup</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-70-1"><a href="#__codelineno-70-1" id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="c"># Escenario: Necesitas Azure Backup + Synapse + Data Factory</span>
</span><span id="__span-70-2"><a href="#__codelineno-70-2" id="__codelineno-70-2" name="__codelineno-70-2"></a>
</span><span id="__span-70-3"><a href="#__codelineno-70-3" id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="nv">$rgName</span> <span class="p">=</span> <span class="s2">"myResourceGroup"</span>
</span><span id="__span-70-4"><a href="#__codelineno-70-4" id="__codelineno-70-4" name="__codelineno-70-4"></a><span class="nv">$storageAccount</span> <span class="p">=</span> <span class="s2">"mystorageaccount"</span>
</span><span id="__span-70-5"><a href="#__codelineno-70-5" id="__codelineno-70-5" name="__codelineno-70-5"></a><span class="nv">$tenantId</span> <span class="p">=</span> <span class="s2">"your-tenant-id"</span>
</span><span id="__span-70-6"><a href="#__codelineno-70-6" id="__codelineno-70-6" name="__codelineno-70-6"></a>
</span><span id="__span-70-7"><a href="#__codelineno-70-7" id="__codelineno-70-7" name="__codelineno-70-7"></a><span class="c"># 1. Configurar con Trusted Services (requerido para Azure Backup)</span>
</span><span id="__span-70-8"><a href="#__codelineno-70-8" id="__codelineno-70-8" name="__codelineno-70-8"></a><span class="nb">Update-AzStorageAccountNetworkRuleSet</span> <span class="p">`</span>
</span><span id="__span-70-9"><a href="#__codelineno-70-9" id="__codelineno-70-9" name="__codelineno-70-9"></a>    <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-70-10"><a href="#__codelineno-70-10" id="__codelineno-70-10" name="__codelineno-70-10"></a>    <span class="n">-Name</span> <span class="nv">$storageAccount</span> <span class="p">`</span>
</span><span id="__span-70-11"><a href="#__codelineno-70-11" id="__codelineno-70-11" name="__codelineno-70-11"></a>    <span class="n">-DefaultAction</span> <span class="n">Deny</span> <span class="p">`</span>
</span><span id="__span-70-12"><a href="#__codelineno-70-12" id="__codelineno-70-12" name="__codelineno-70-12"></a>    <span class="n">-Bypass</span> <span class="n">AzureServices</span><span class="p">,</span><span class="n">Logging</span><span class="p">,</span><span class="n">Metrics</span>
</span><span id="__span-70-13"><a href="#__codelineno-70-13" id="__codelineno-70-13" name="__codelineno-70-13"></a>
</span><span id="__span-70-14"><a href="#__codelineno-70-14" id="__codelineno-70-14" name="__codelineno-70-14"></a><span class="nb">Write-Host</span> <span class="s2">"✅ Trusted Services habilitado (Azure Backup)"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-70-15"><a href="#__codelineno-70-15" id="__codelineno-70-15" name="__codelineno-70-15"></a>
</span><span id="__span-70-16"><a href="#__codelineno-70-16" id="__codelineno-70-16" name="__codelineno-70-16"></a><span class="c"># 2. Agregar Resource Instances para control granular de otros servicios</span>
</span><span id="__span-70-17"><a href="#__codelineno-70-17" id="__codelineno-70-17" name="__codelineno-70-17"></a><span class="c"># Aunque Trusted Services está habilitado, esto añade trazabilidad</span>
</span><span id="__span-70-18"><a href="#__codelineno-70-18" id="__codelineno-70-18" name="__codelineno-70-18"></a><span class="nv">$resources</span> <span class="p">=</span> <span class="p">@(</span>
</span><span id="__span-70-19"><a href="#__codelineno-70-19" id="__codelineno-70-19" name="__codelineno-70-19"></a>    <span class="s2">"/subscriptions/xxx/resourceGroups/rg1/providers/Microsoft.Synapse/workspaces/prod-synapse"</span><span class="p">,</span>
</span><span id="__span-70-20"><a href="#__codelineno-70-20" id="__codelineno-70-20" name="__codelineno-70-20"></a>    <span class="s2">"/subscriptions/xxx/resourceGroups/rg1/providers/Microsoft.DataFactory/factories/prod-adf"</span>
</span><span id="__span-70-21"><a href="#__codelineno-70-21" id="__codelineno-70-21" name="__codelineno-70-21"></a><span class="p">)</span>
</span><span id="__span-70-22"><a href="#__codelineno-70-22" id="__codelineno-70-22" name="__codelineno-70-22"></a>
</span><span id="__span-70-23"><a href="#__codelineno-70-23" id="__codelineno-70-23" name="__codelineno-70-23"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$resourceId</span> <span class="k">in</span> <span class="nv">$resources</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-70-24"><a href="#__codelineno-70-24" id="__codelineno-70-24" name="__codelineno-70-24"></a>    <span class="nb">Add-AzStorageAccountNetworkRule</span> <span class="p">`</span>
</span><span id="__span-70-25"><a href="#__codelineno-70-25" id="__codelineno-70-25" name="__codelineno-70-25"></a>        <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-70-26"><a href="#__codelineno-70-26" id="__codelineno-70-26" name="__codelineno-70-26"></a>        <span class="n">-Name</span> <span class="nv">$storageAccount</span> <span class="p">`</span>
</span><span id="__span-70-27"><a href="#__codelineno-70-27" id="__codelineno-70-27" name="__codelineno-70-27"></a>        <span class="n">-TenantId</span> <span class="nv">$tenantId</span> <span class="p">`</span>
</span><span id="__span-70-28"><a href="#__codelineno-70-28" id="__codelineno-70-28" name="__codelineno-70-28"></a>        <span class="n">-ResourceId</span> <span class="nv">$resourceId</span>
</span><span id="__span-70-29"><a href="#__codelineno-70-29" id="__codelineno-70-29" name="__codelineno-70-29"></a>
</span><span id="__span-70-30"><a href="#__codelineno-70-30" id="__codelineno-70-30" name="__codelineno-70-30"></a>    <span class="nb">Write-Host</span> <span class="s2">"✅ Resource Instance agregada: </span><span class="p">$(</span><span class="nv">$resourceId</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)[-</span><span class="n">1</span><span class="p">])</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-70-31"><a href="#__codelineno-70-31" id="__codelineno-70-31" name="__codelineno-70-31"></a><span class="p">}</span>
</span><span id="__span-70-32"><a href="#__codelineno-70-32" id="__codelineno-70-32" name="__codelineno-70-32"></a>
</span><span id="__span-70-33"><a href="#__codelineno-70-33" id="__codelineno-70-33" name="__codelineno-70-33"></a><span class="c"># 3. Documentar en tags</span>
</span><span id="__span-70-34"><a href="#__codelineno-70-34" id="__codelineno-70-34" name="__codelineno-70-34"></a><span class="nv">$tags</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-70-35"><a href="#__codelineno-70-35" id="__codelineno-70-35" name="__codelineno-70-35"></a>    <span class="s2">"FirewallConfig"</span> <span class="p">=</span> <span class="s2">"TrustedServices+ResourceInstances"</span>
</span><span id="__span-70-36"><a href="#__codelineno-70-36" id="__codelineno-70-36" name="__codelineno-70-36"></a>    <span class="s2">"TrustedServicesReason"</span> <span class="p">=</span> <span class="s2">"Azure Backup - Unmanaged Disks"</span>
</span><span id="__span-70-37"><a href="#__codelineno-70-37" id="__codelineno-70-37" name="__codelineno-70-37"></a>    <span class="s2">"MigrationPlan"</span> <span class="p">=</span> <span class="s2">"Move to Managed Disks by Q2-2026"</span>
</span><span id="__span-70-38"><a href="#__codelineno-70-38" id="__codelineno-70-38" name="__codelineno-70-38"></a><span class="p">}</span>
</span><span id="__span-70-39"><a href="#__codelineno-70-39" id="__codelineno-70-39" name="__codelineno-70-39"></a>
</span><span id="__span-70-40"><a href="#__codelineno-70-40" id="__codelineno-70-40" name="__codelineno-70-40"></a><span class="nb">Update-AzStorageAccount</span> <span class="p">`</span>
</span><span id="__span-70-41"><a href="#__codelineno-70-41" id="__codelineno-70-41" name="__codelineno-70-41"></a>    <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-70-42"><a href="#__codelineno-70-42" id="__codelineno-70-42" name="__codelineno-70-42"></a>    <span class="n">-Name</span> <span class="nv">$storageAccount</span> <span class="p">`</span>
</span><span id="__span-70-43"><a href="#__codelineno-70-43" id="__codelineno-70-43" name="__codelineno-70-43"></a>    <span class="n">-Tag</span> <span class="nv">$tags</span>
</span><span id="__span-70-44"><a href="#__codelineno-70-44" id="__codelineno-70-44" name="__codelineno-70-44"></a>
</span><span id="__span-70-45"><a href="#__codelineno-70-45" id="__codelineno-70-45" name="__codelineno-70-45"></a><span class="nb">Write-Host</span> <span class="s2">"✅ Configuración documentada en tags"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Mejora Continua</p>
<p><strong>Planifica la eliminación de Trusted Services:</strong></p>
<ol>
<li>Identifica VMs con discos no administrados</li>
<li>Crea un plan de migración a managed disks</li>
<li>Una vez migrado, deshabilita Trusted Services</li>
<li>Usa solo Resource Instances para máxima seguridad</li>
</ol>
</div>
<h3 id="troubleshooting"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#troubleshooting">Troubleshooting</a></h3>
<h4 id="error-403-acceso-denegado"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#error-403-acceso-denegado">Error 403: Acceso Denegado</a></h4>
<p>Si recibes errores 403, verifica en este orden:</p>
<ol>
<li>
<p><strong>Firewall</strong>: ¿El recurso tiene una Resource Instance Rule?
   </p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-71-1"><a href="#__codelineno-71-1" id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="p">(</span><span class="nb">Get-AzStorageAccountNetworkRuleSet</span> <span class="n">-ResourceGroupName</span> <span class="s2">"rg"</span> <span class="n">-Name</span> <span class="s2">"sa"</span><span class="p">).</span><span class="n">ResourceAccessRules</span>
</span></code></pre></div><p></p>
</li>
<li>
<p><strong>RBAC</strong>: ¿La Managed Identity tiene roles asignados?
   </p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-72-1"><a href="#__codelineno-72-1" id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="nb">Get-AzRoleAssignment</span> <span class="n">-ObjectId</span> <span class="nv">$principalId</span> <span class="n">-Scope</span> <span class="nv">$storageScope</span>
</span></code></pre></div><p></p>
</li>
<li>
<p><strong>Managed Identity</strong>: ¿Está habilitada?
   </p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-73-1"><a href="#__codelineno-73-1" id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="nv">$workspace</span> <span class="p">=</span> <span class="nb">Get-AzSynapseWorkspace</span> <span class="n">-Name</span> <span class="s2">"myworkspace"</span>
</span><span id="__span-73-2"><a href="#__codelineno-73-2" id="__codelineno-73-2" name="__codelineno-73-2"></a><span class="nv">$workspace</span><span class="p">.</span><span class="n">Identity</span><span class="p">.</span><span class="nb">Type</span>
</span></code></pre></div><p></p>
</li>
<li>
<p><strong>Tenant</strong>: ¿Ambos recursos están en el mismo tenant?
   </p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-74-1"><a href="#__codelineno-74-1" id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="p">(</span><span class="nb">Get-AzResource</span> <span class="n">-ResourceId</span> <span class="nv">$resourceId</span><span class="p">).</span><span class="n">TenantId</span>
</span></code></pre></div><p></p>
</li>
</ol>
<h4 id="verificar-acceso-por-servicio"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#verificar-acceso-por-servicio">Verificar Acceso por Servicio</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-75-1"><a href="#__codelineno-75-1" id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="nv">$ctx</span> <span class="p">=</span> <span class="nb">New-AzStorageContext</span> <span class="n">-StorageAccountName</span> <span class="s2">"sa"</span> <span class="n">-UseConnectedAccount</span>
</span><span id="__span-75-2"><a href="#__codelineno-75-2" id="__codelineno-75-2" name="__codelineno-75-2"></a>
</span><span id="__span-75-3"><a href="#__codelineno-75-3" id="__codelineno-75-3" name="__codelineno-75-3"></a><span class="c"># Probar Blob</span>
</span><span id="__span-75-4"><a href="#__codelineno-75-4" id="__codelineno-75-4" name="__codelineno-75-4"></a><span class="k">try</span> <span class="p">{</span>
</span><span id="__span-75-5"><a href="#__codelineno-75-5" id="__codelineno-75-5" name="__codelineno-75-5"></a>    <span class="nb">Get-AzStorageContainer</span> <span class="n">-Context</span> <span class="nv">$ctx</span> <span class="n">-MaxCount</span> <span class="n">1</span>
</span><span id="__span-75-6"><a href="#__codelineno-75-6" id="__codelineno-75-6" name="__codelineno-75-6"></a>    <span class="nb">Write-Host</span> <span class="s2">"✅ Blob: Accesible"</span>
</span><span id="__span-75-7"><a href="#__codelineno-75-7" id="__codelineno-75-7" name="__codelineno-75-7"></a><span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-75-8"><a href="#__codelineno-75-8" id="__codelineno-75-8" name="__codelineno-75-8"></a>    <span class="nb">Write-Host</span> <span class="s2">"❌ Blob: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">"</span>
</span><span id="__span-75-9"><a href="#__codelineno-75-9" id="__codelineno-75-9" name="__codelineno-75-9"></a><span class="p">}</span>
</span><span id="__span-75-10"><a href="#__codelineno-75-10" id="__codelineno-75-10" name="__codelineno-75-10"></a>
</span><span id="__span-75-11"><a href="#__codelineno-75-11" id="__codelineno-75-11" name="__codelineno-75-11"></a><span class="c"># Probar Queue</span>
</span><span id="__span-75-12"><a href="#__codelineno-75-12" id="__codelineno-75-12" name="__codelineno-75-12"></a><span class="k">try</span> <span class="p">{</span>
</span><span id="__span-75-13"><a href="#__codelineno-75-13" id="__codelineno-75-13" name="__codelineno-75-13"></a>    <span class="nb">Get-AzStorageQueue</span> <span class="n">-Context</span> <span class="nv">$ctx</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-First</span> <span class="n">1</span>
</span><span id="__span-75-14"><a href="#__codelineno-75-14" id="__codelineno-75-14" name="__codelineno-75-14"></a>    <span class="nb">Write-Host</span> <span class="s2">"✅ Queue: Accesible"</span>
</span><span id="__span-75-15"><a href="#__codelineno-75-15" id="__codelineno-75-15" name="__codelineno-75-15"></a><span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-75-16"><a href="#__codelineno-75-16" id="__codelineno-75-16" name="__codelineno-75-16"></a>    <span class="nb">Write-Host</span> <span class="s2">"❌ Queue: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">"</span>
</span><span id="__span-75-17"><a href="#__codelineno-75-17" id="__codelineno-75-17" name="__codelineno-75-17"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="cuando-usar-private-endpoints"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#cuando-usar-private-endpoints">Cuándo Usar Private Endpoints</a></h3>
<p>Considera usar Private Endpoints en lugar de o además de las configuraciones de firewall cuando:</p>
<ul>
<li>✅ Necesitas cumplimiento estricto de compliance</li>
<li>✅ No quieres exponer endpoints públicos en absoluto</li>
<li>✅ Requieres conectividad desde On-Premises vía ExpressRoute</li>
<li>✅ La latencia es crítica y necesitas tráfico privado</li>
<li>✅ Presupuesto disponible (hay costos adicionales)</li>
</ul>
<p>La configuración con Resource Instances es suficiente cuando:</p>
<ul>
<li>✅ Los recursos están en Azure (no on-premises)</li>
<li>✅ El endpoint público con firewall es aceptable</li>
<li>✅ Quieres balancear seguridad y costos</li>
<li>✅ No hay requisitos de red privada obligatorios</li>
</ul>
<h3 id="conclusion"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#conclusion">Conclusión</a></h3>
<p>La seguridad de Azure Storage Account requiere una configuración cuidadosa del firewall. Las principales conclusiones son:</p>
<ol>
<li><strong>Resource Instances &gt; Trusted Services</strong> para control granular</li>
<li><strong>Siempre habilita Logging y Metrics</strong> para observabilidad</li>
<li><strong>Combina Firewall + RBAC</strong> para defensa en profundidad</li>
<li><strong>Un firewall protege todos los servicios</strong> (Blob, Files, Queue, Table)</li>
<li><strong>Sin Private Endpoints, usa Resource Instances</strong> como mejor práctica</li>
<li><strong>Azure Backup requiere Trusted Services</strong> para discos no administrados (considera migrar a managed disks)</li>
</ol>
<h4 id="configuracion-resumida-optima"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#configuracion-resumida-optima">Configuración Resumida Óptima</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio"><input id="__tabbed_9_2" name="__tabbed_9" type="radio"><div class="tabbed-labels"><label for="__tabbed_9_1">Sin Azure Backup</label><label for="__tabbed_9_2">Con Azure Backup</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-76-1"><a href="#__codelineno-76-1" id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="c"># La configuración perfecta para producción sin Private Endpoints</span>
</span><span id="__span-76-2"><a href="#__codelineno-76-2" id="__codelineno-76-2" name="__codelineno-76-2"></a><span class="nb">Update-AzStorageAccountNetworkRuleSet</span> <span class="p">`</span>
</span><span id="__span-76-3"><a href="#__codelineno-76-3" id="__codelineno-76-3" name="__codelineno-76-3"></a>    <span class="n">-DefaultAction</span> <span class="n">Deny</span> <span class="p">`</span>
</span><span id="__span-76-4"><a href="#__codelineno-76-4" id="__codelineno-76-4" name="__codelineno-76-4"></a>    <span class="n">-Bypass</span> <span class="n">Logging</span><span class="p">,</span><span class="n">Metrics</span>  <span class="c"># NO AzureServices</span>
</span><span id="__span-76-5"><a href="#__codelineno-76-5" id="__codelineno-76-5" name="__codelineno-76-5"></a>
</span><span id="__span-76-6"><a href="#__codelineno-76-6" id="__codelineno-76-6" name="__codelineno-76-6"></a><span class="c"># Agregar solo recursos específicos necesarios</span>
</span><span id="__span-76-7"><a href="#__codelineno-76-7" id="__codelineno-76-7" name="__codelineno-76-7"></a><span class="nb">Add-AzStorageAccountNetworkRule</span> <span class="n">-ResourceId</span> <span class="nv">$specificResourceId</span>
</span><span id="__span-76-8"><a href="#__codelineno-76-8" id="__codelineno-76-8" name="__codelineno-76-8"></a>
</span><span id="__span-76-9"><a href="#__codelineno-76-9" id="__codelineno-76-9" name="__codelineno-76-9"></a><span class="c"># Asignar roles RBAC mínimos necesarios</span>
</span><span id="__span-76-10"><a href="#__codelineno-76-10" id="__codelineno-76-10" name="__codelineno-76-10"></a><span class="nb">New-AzRoleAssignment</span> <span class="n">-ObjectId</span> <span class="nv">$principalId</span> <span class="n">-RoleDefinitionName</span> <span class="s2">"Storage Blob Data Reader"</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-77-1"><a href="#__codelineno-77-1" id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="c"># Si necesitas Azure Backup para discos no administrados</span>
</span><span id="__span-77-2"><a href="#__codelineno-77-2" id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="nb">Update-AzStorageAccountNetworkRuleSet</span> <span class="p">`</span>
</span><span id="__span-77-3"><a href="#__codelineno-77-3" id="__codelineno-77-3" name="__codelineno-77-3"></a>    <span class="n">-DefaultAction</span> <span class="n">Deny</span> <span class="p">`</span>
</span><span id="__span-77-4"><a href="#__codelineno-77-4" id="__codelineno-77-4" name="__codelineno-77-4"></a>    <span class="n">-Bypass</span> <span class="n">AzureServices</span><span class="p">,</span><span class="n">Logging</span><span class="p">,</span><span class="n">Metrics</span>  <span class="c"># Requerido para Azure Backup</span>
</span><span id="__span-77-5"><a href="#__codelineno-77-5" id="__codelineno-77-5" name="__codelineno-77-5"></a>
</span><span id="__span-77-6"><a href="#__codelineno-77-6" id="__codelineno-77-6" name="__codelineno-77-6"></a><span class="c"># Agregar Resource Instances para trazabilidad de otros servicios</span>
</span><span id="__span-77-7"><a href="#__codelineno-77-7" id="__codelineno-77-7" name="__codelineno-77-7"></a><span class="nb">Add-AzStorageAccountNetworkRule</span> <span class="n">-ResourceId</span> <span class="nv">$specificResourceId</span>
</span><span id="__span-77-8"><a href="#__codelineno-77-8" id="__codelineno-77-8" name="__codelineno-77-8"></a>
</span><span id="__span-77-9"><a href="#__codelineno-77-9" id="__codelineno-77-9" name="__codelineno-77-9"></a><span class="c"># Asignar roles RBAC</span>
</span><span id="__span-77-10"><a href="#__codelineno-77-10" id="__codelineno-77-10" name="__codelineno-77-10"></a><span class="nb">New-AzRoleAssignment</span> <span class="n">-ObjectId</span> <span class="nv">$principalId</span> <span class="n">-RoleDefinitionName</span> <span class="s2">"Storage Blob Data Reader"</span>
</span><span id="__span-77-11"><a href="#__codelineno-77-11" id="__codelineno-77-11" name="__codelineno-77-11"></a>
</span><span id="__span-77-12"><a href="#__codelineno-77-12" id="__codelineno-77-12" name="__codelineno-77-12"></a><span class="c"># Documentar y planificar migración a Managed Disks</span>
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="referencias"><a class="toclink" href="../../2025/12/18/seguridad-en-azure-storage-gu%C3%ADa-completa-de-firewall-resource-instances-y-mejores-pr%C3%A1cticas/#referencias">Referencias</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-network-security">Azure Storage network security</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-network-security-resource-instances">Resource instance network rules</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-network-security-trusted-azure-services">Trusted Azure services</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-network-security-manage-exceptions">Manage network security exceptions</a></li>
</ul>
<hr>
<div class="admonition tip">
<p class="admonition-title">¿Necesitas ayuda?</p>
<p>Si tienes dudas sobre la configuración de seguridad de tu Storage Account, revisa la documentación oficial o abre un caso de soporte con Microsoft Azure.</p>
</div>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-11-20 00:00:00+00:00">November 20, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure Services</a></li>
<li class="md-meta__item">
            
              6 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="autenticacion-python-en-maquinas-azure-arc-guia-practica"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/">Autenticación Python en Máquinas Azure Arc: Guía Práctica</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#resumen">Resumen</a></h3>
<p>Los servidores enrolados en Azure Arc pueden autenticarse contra recursos Azure usando managed identity sin almacenar credenciales. Python + Azure SDK (<code>azure-identity</code>) simplifica esto con <code>DefaultAzureCredential</code> o <code>ManagedIdentityCredential</code>, accediendo al endpoint IMDS local (<code>http://localhost:40342</code>) que expone el agente Azure Connected Machine.</p>
<h3 id="que-es-azure-arc-enabled-servers"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#que-es-azure-arc-enabled-servers">¿Qué es Azure Arc-enabled servers?</a></h3>
<p>Azure Arc extiende el plano de control de Azure a servidores físicos y VMs fuera de Azure (on-premises, otras clouds, edge). Una vez enrolado, el servidor obtiene:</p>
<ul>
<li>Representación como recurso Azure (<code>Microsoft.HybridCompute/machines</code>)</li>
<li>System-assigned managed identity automática</li>
<li>Acceso a servicios Azure (Key Vault, Storage, Log Analytics, etc.) sin credenciales hard-coded</li>
<li>Gestión unificada (Policy, Update Management, extensiones VM)</li>
</ul>
<h3 id="como-funciona-la-autenticacion-en-azure-arc"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#como-funciona-la-autenticacion-en-azure-arc">Cómo funciona la autenticación en Azure Arc</a></h3>
<p>Cuando el agente <code>azcmagent</code> se instala y conecta, ocurre:</p>
<ol>
<li>Azure Resource Manager crea un service principal en Microsoft Entra ID para la identidad del servidor.</li>
<li>El agente configura un endpoint IMDS local en <code>http://localhost:40342</code> (no enrutable, solo accesible desde localhost).</li>
<li>Variables de entorno se establecen automáticamente:</li>
<li><code>IMDS_ENDPOINT=http://localhost:40342</code></li>
<li><code>IDENTITY_ENDPOINT=http://localhost:40342/metadata/identity/oauth2/token</code></li>
<li>Las aplicaciones solicitan tokens a este endpoint, sin exponer secretos.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Diferencia con Azure VMs</p>
<p>Azure VMs usan <code>http://169.254.169.254</code> (Azure IMDS), mientras que Arc usa <code>localhost:40342</code>. El SDK de Azure detecta automáticamente el entorno correcto.</p>
</div>
<h3 id="metodos-de-autenticacion-en-python"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#metodos-de-autenticacion-en-python">Métodos de autenticación en Python</a></h3>
<h4 id="opcion-1-defaultazurecredential-recomendada"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#opcion-1-defaultazurecredential-recomendada">Opción 1: DefaultAzureCredential (recomendada)</a></h4>
<p>Cadena de credenciales que prueba múltiples métodos en orden (variables de entorno, managed identity, Azure CLI, etc.). Funciona tanto en desarrollo local como en producción Arc sin cambios de código.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-32-1"><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">azure.identity</span><span class="w"> </span><span class="kn">import</span> <span class="n">DefaultAzureCredential</span>
</span><span id="__span-32-2"><a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">azure.keyvault.secrets</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecretClient</span>
</span><span id="__span-32-3"><a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a>
</span><span id="__span-32-4"><a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="c1"># Credential chain automática (detecta Arc managed identity)</span>
</span><span id="__span-32-5"><a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="n">credential</span> <span class="o">=</span> <span class="n">DefaultAzureCredential</span><span class="p">()</span>
</span><span id="__span-32-6"><a href="#__codelineno-32-6" id="__codelineno-32-6" name="__codelineno-32-6"></a>
</span><span id="__span-32-7"><a href="#__codelineno-32-7" id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="c1"># Cliente Key Vault sin credenciales explícitas</span>
</span><span id="__span-32-8"><a href="#__codelineno-32-8" id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="n">vault_url</span> <span class="o">=</span> <span class="s2">"https://my-vault.vault.azure.net"</span>
</span><span id="__span-32-9"><a href="#__codelineno-32-9" id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="n">client</span> <span class="o">=</span> <span class="n">SecretClient</span><span class="p">(</span><span class="n">vault_url</span><span class="o">=</span><span class="n">vault_url</span><span class="p">,</span> <span class="n">credential</span><span class="o">=</span><span class="n">credential</span><span class="p">)</span>
</span><span id="__span-32-10"><a href="#__codelineno-32-10" id="__codelineno-32-10" name="__codelineno-32-10"></a>
</span><span id="__span-32-11"><a href="#__codelineno-32-11" id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="c1"># Obtener secreto</span>
</span><span id="__span-32-12"><a href="#__codelineno-32-12" id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="n">secret</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_secret</span><span class="p">(</span><span class="s2">"database-password"</span><span class="p">)</span>
</span><span id="__span-32-13"><a href="#__codelineno-32-13" id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Secret value: </span><span class="si">{</span><span class="n">secret</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="opcion-2-managedidentitycredential-explicita"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#opcion-2-managedidentitycredential-explicita">Opción 2: ManagedIdentityCredential (explícita)</a></h4>
<p>Fuerza el uso de managed identity exclusivamente, útil cuando no quieres la cadena de fallback.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-33-1"><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">azure.identity</span><span class="w"> </span><span class="kn">import</span> <span class="n">ManagedIdentityCredential</span>
</span><span id="__span-33-2"><a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">azure.storage.blob</span><span class="w"> </span><span class="kn">import</span> <span class="n">BlobServiceClient</span>
</span><span id="__span-33-3"><a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a>
</span><span id="__span-33-4"><a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="c1"># System-assigned managed identity</span>
</span><span id="__span-33-5"><a href="#__codelineno-33-5" id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="n">credential</span> <span class="o">=</span> <span class="n">ManagedIdentityCredential</span><span class="p">()</span>
</span><span id="__span-33-6"><a href="#__codelineno-33-6" id="__codelineno-33-6" name="__codelineno-33-6"></a>
</span><span id="__span-33-7"><a href="#__codelineno-33-7" id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="c1"># Cliente Blob Storage</span>
</span><span id="__span-33-8"><a href="#__codelineno-33-8" id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="n">account_url</span> <span class="o">=</span> <span class="s2">"https://mystorageaccount.blob.core.windows.net"</span>
</span><span id="__span-33-9"><a href="#__codelineno-33-9" id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="n">blob_service</span> <span class="o">=</span> <span class="n">BlobServiceClient</span><span class="p">(</span><span class="n">account_url</span><span class="o">=</span><span class="n">account_url</span><span class="p">,</span> <span class="n">credential</span><span class="o">=</span><span class="n">credential</span><span class="p">)</span>
</span><span id="__span-33-10"><a href="#__codelineno-33-10" id="__codelineno-33-10" name="__codelineno-33-10"></a>
</span><span id="__span-33-11"><a href="#__codelineno-33-11" id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="c1"># Listar containers</span>
</span><span id="__span-33-12"><a href="#__codelineno-33-12" id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">blob_service</span><span class="o">.</span><span class="n">list_containers</span><span class="p">():</span>
</span><span id="__span-33-13"><a href="#__codelineno-33-13" id="__codelineno-33-13" name="__codelineno-33-13"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Container: </span><span class="si">{</span><span class="n">container</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="opcion-3-user-assigned-managed-identity"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#opcion-3-user-assigned-managed-identity">Opción 3: User-assigned managed identity</a></h4>
<p>Si el servidor tiene múltiples identities user-assigned, especifica el <code>client_id</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-34-1"><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">azure.identity</span><span class="w"> </span><span class="kn">import</span> <span class="n">ManagedIdentityCredential</span>
</span><span id="__span-34-2"><a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a>
</span><span id="__span-34-3"><a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="c1"># User-assigned identity con client_id específico</span>
</span><span id="__span-34-4"><a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="n">client_id</span> <span class="o">=</span> <span class="s2">"12345678-abcd-1234-abcd-1234567890ab"</span>
</span><span id="__span-34-5"><a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="n">credential</span> <span class="o">=</span> <span class="n">ManagedIdentityCredential</span><span class="p">(</span><span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">)</span>
</span><span id="__span-34-6"><a href="#__codelineno-34-6" id="__codelineno-34-6" name="__codelineno-34-6"></a>
</span><span id="__span-34-7"><a href="#__codelineno-34-7" id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="c1"># Usa este credential con cualquier SDK Azure</span>
</span></code></pre></div>
<h4 id="opcion-4-msal-python-bajo-nivel"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#opcion-4-msal-python-bajo-nivel">Opción 4: MSAL Python (bajo nivel)</a></h4>
<p>Para casos avanzados, <code>msal</code> 1.29.0+ soporta managed identity directamente:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-35-1"><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">msal</span>
</span><span id="__span-35-2"><a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span><span id="__span-35-3"><a href="#__codelineno-35-3" id="__codelineno-35-3" name="__codelineno-35-3"></a>
</span><span id="__span-35-4"><a href="#__codelineno-35-4" id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="c1"># System-assigned managed identity</span>
</span><span id="__span-35-5"><a href="#__codelineno-35-5" id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="n">managed_identity</span> <span class="o">=</span> <span class="n">msal</span><span class="o">.</span><span class="n">SystemAssignedManagedIdentity</span><span class="p">()</span>
</span><span id="__span-35-6"><a href="#__codelineno-35-6" id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="n">app</span> <span class="o">=</span> <span class="n">msal</span><span class="o">.</span><span class="n">ManagedIdentityClient</span><span class="p">(</span><span class="n">managed_identity</span><span class="p">,</span> <span class="n">http_client</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">())</span>
</span><span id="__span-35-7"><a href="#__codelineno-35-7" id="__codelineno-35-7" name="__codelineno-35-7"></a>
</span><span id="__span-35-8"><a href="#__codelineno-35-8" id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="c1"># Obtener token para Key Vault</span>
</span><span id="__span-35-9"><a href="#__codelineno-35-9" id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="n">result</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">acquire_token_for_client</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="s2">"https://vault.azure.net"</span><span class="p">)</span>
</span><span id="__span-35-10"><a href="#__codelineno-35-10" id="__codelineno-35-10" name="__codelineno-35-10"></a>
</span><span id="__span-35-11"><a href="#__codelineno-35-11" id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="k">if</span> <span class="s2">"access_token"</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="__span-35-12"><a href="#__codelineno-35-12" id="__codelineno-35-12" name="__codelineno-35-12"></a>    <span class="n">token</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">"access_token"</span><span class="p">]</span>
</span><span id="__span-35-13"><a href="#__codelineno-35-13" id="__codelineno-35-13" name="__codelineno-35-13"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Token adquirido: </span><span class="si">{</span><span class="n">token</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
</span><span id="__span-35-14"><a href="#__codelineno-35-14" id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-35-15"><a href="#__codelineno-35-15" id="__codelineno-35-15" name="__codelineno-35-15"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'error_description'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="ejemplo-completo-leer-secreto-de-key-vault"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#ejemplo-completo-leer-secreto-de-key-vault">Ejemplo completo: Leer secreto de Key Vault</a></h3>
<p>Escenario: Script Python en servidor Arc que obtiene credenciales DB desde Key Vault.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-36-1"><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-36-2"><a href="#__codelineno-36-2" id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="sd">"""</span>
</span><span id="__span-36-3"><a href="#__codelineno-36-3" id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="sd">Script: get_db_credentials.py</span>
</span><span id="__span-36-4"><a href="#__codelineno-36-4" id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="sd">Descripción: Obtiene credenciales de base de datos desde Azure Key Vault</span>
</span><span id="__span-36-5"><a href="#__codelineno-36-5" id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="sd">             usando managed identity del servidor Azure Arc</span>
</span><span id="__span-36-6"><a href="#__codelineno-36-6" id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="sd">Requisitos: pip install azure-identity azure-keyvault-secrets</span>
</span><span id="__span-36-7"><a href="#__codelineno-36-7" id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="sd">"""</span>
</span><span id="__span-36-8"><a href="#__codelineno-36-8" id="__codelineno-36-8" name="__codelineno-36-8"></a>
</span><span id="__span-36-9"><a href="#__codelineno-36-9" id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">azure.identity</span><span class="w"> </span><span class="kn">import</span> <span class="n">DefaultAzureCredential</span>
</span><span id="__span-36-10"><a href="#__codelineno-36-10" id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">azure.keyvault.secrets</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecretClient</span>
</span><span id="__span-36-11"><a href="#__codelineno-36-11" id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-36-12"><a href="#__codelineno-36-12" id="__codelineno-36-12" name="__codelineno-36-12"></a>
</span><span id="__span-36-13"><a href="#__codelineno-36-13" id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_secret</span><span class="p">(</span><span class="n">vault_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">secret_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-36-14"><a href="#__codelineno-36-14" id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-36-15"><a href="#__codelineno-36-15" id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="sd">    Obtiene un secreto de Azure Key Vault usando managed identity.</span>
</span><span id="__span-36-16"><a href="#__codelineno-36-16" id="__codelineno-36-16" name="__codelineno-36-16"></a>
</span><span id="__span-36-17"><a href="#__codelineno-36-17" id="__codelineno-36-17" name="__codelineno-36-17"></a><span class="sd">    Args:</span>
</span><span id="__span-36-18"><a href="#__codelineno-36-18" id="__codelineno-36-18" name="__codelineno-36-18"></a><span class="sd">        vault_name: Nombre del Key Vault (sin .vault.azure.net)</span>
</span><span id="__span-36-19"><a href="#__codelineno-36-19" id="__codelineno-36-19" name="__codelineno-36-19"></a><span class="sd">        secret_name: Nombre del secreto</span>
</span><span id="__span-36-20"><a href="#__codelineno-36-20" id="__codelineno-36-20" name="__codelineno-36-20"></a>
</span><span id="__span-36-21"><a href="#__codelineno-36-21" id="__codelineno-36-21" name="__codelineno-36-21"></a><span class="sd">    Returns:</span>
</span><span id="__span-36-22"><a href="#__codelineno-36-22" id="__codelineno-36-22" name="__codelineno-36-22"></a><span class="sd">        Valor del secreto</span>
</span><span id="__span-36-23"><a href="#__codelineno-36-23" id="__codelineno-36-23" name="__codelineno-36-23"></a><span class="sd">    """</span>
</span><span id="__span-36-24"><a href="#__codelineno-36-24" id="__codelineno-36-24" name="__codelineno-36-24"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-36-25"><a href="#__codelineno-36-25" id="__codelineno-36-25" name="__codelineno-36-25"></a>        <span class="c1"># DefaultAzureCredential detecta automáticamente el entorno Arc</span>
</span><span id="__span-36-26"><a href="#__codelineno-36-26" id="__codelineno-36-26" name="__codelineno-36-26"></a>        <span class="n">credential</span> <span class="o">=</span> <span class="n">DefaultAzureCredential</span><span class="p">()</span>
</span><span id="__span-36-27"><a href="#__codelineno-36-27" id="__codelineno-36-27" name="__codelineno-36-27"></a>
</span><span id="__span-36-28"><a href="#__codelineno-36-28" id="__codelineno-36-28" name="__codelineno-36-28"></a>        <span class="n">vault_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://</span><span class="si">{</span><span class="n">vault_name</span><span class="si">}</span><span class="s2">.vault.azure.net"</span>
</span><span id="__span-36-29"><a href="#__codelineno-36-29" id="__codelineno-36-29" name="__codelineno-36-29"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">SecretClient</span><span class="p">(</span><span class="n">vault_url</span><span class="o">=</span><span class="n">vault_url</span><span class="p">,</span> <span class="n">credential</span><span class="o">=</span><span class="n">credential</span><span class="p">)</span>
</span><span id="__span-36-30"><a href="#__codelineno-36-30" id="__codelineno-36-30" name="__codelineno-36-30"></a>
</span><span id="__span-36-31"><a href="#__codelineno-36-31" id="__codelineno-36-31" name="__codelineno-36-31"></a>        <span class="c1"># Obtener secreto</span>
</span><span id="__span-36-32"><a href="#__codelineno-36-32" id="__codelineno-36-32" name="__codelineno-36-32"></a>        <span class="n">secret</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_secret</span><span class="p">(</span><span class="n">secret_name</span><span class="p">)</span>
</span><span id="__span-36-33"><a href="#__codelineno-36-33" id="__codelineno-36-33" name="__codelineno-36-33"></a>        <span class="k">return</span> <span class="n">secret</span><span class="o">.</span><span class="n">value</span>
</span><span id="__span-36-34"><a href="#__codelineno-36-34" id="__codelineno-36-34" name="__codelineno-36-34"></a>
</span><span id="__span-36-35"><a href="#__codelineno-36-35" id="__codelineno-36-35" name="__codelineno-36-35"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-36-36"><a href="#__codelineno-36-36" id="__codelineno-36-36" name="__codelineno-36-36"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error obteniendo secreto: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="__span-36-37"><a href="#__codelineno-36-37" id="__codelineno-36-37" name="__codelineno-36-37"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-36-38"><a href="#__codelineno-36-38" id="__codelineno-36-38" name="__codelineno-36-38"></a>
</span><span id="__span-36-39"><a href="#__codelineno-36-39" id="__codelineno-36-39" name="__codelineno-36-39"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-36-40"><a href="#__codelineno-36-40" id="__codelineno-36-40" name="__codelineno-36-40"></a>    <span class="c1"># Configuración</span>
</span><span id="__span-36-41"><a href="#__codelineno-36-41" id="__codelineno-36-41" name="__codelineno-36-41"></a>    <span class="n">VAULT_NAME</span> <span class="o">=</span> <span class="s2">"my-production-vault"</span>
</span><span id="__span-36-42"><a href="#__codelineno-36-42" id="__codelineno-36-42" name="__codelineno-36-42"></a>    <span class="n">DB_PASSWORD_SECRET</span> <span class="o">=</span> <span class="s2">"db-password"</span>
</span><span id="__span-36-43"><a href="#__codelineno-36-43" id="__codelineno-36-43" name="__codelineno-36-43"></a>
</span><span id="__span-36-44"><a href="#__codelineno-36-44" id="__codelineno-36-44" name="__codelineno-36-44"></a>    <span class="c1"># Obtener credencial</span>
</span><span id="__span-36-45"><a href="#__codelineno-36-45" id="__codelineno-36-45" name="__codelineno-36-45"></a>    <span class="n">password</span> <span class="o">=</span> <span class="n">get_secret</span><span class="p">(</span><span class="n">VAULT_NAME</span><span class="p">,</span> <span class="n">DB_PASSWORD_SECRET</span><span class="p">)</span>
</span><span id="__span-36-46"><a href="#__codelineno-36-46" id="__codelineno-36-46" name="__codelineno-36-46"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Credencial obtenida exitosamente (longitud: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span><span class="si">}</span><span class="s2"> caracteres)"</span><span class="p">)</span>
</span><span id="__span-36-47"><a href="#__codelineno-36-47" id="__codelineno-36-47" name="__codelineno-36-47"></a>
</span><span id="__span-36-48"><a href="#__codelineno-36-48" id="__codelineno-36-48" name="__codelineno-36-48"></a>    <span class="c1"># Usar password para conectar a DB (no imprimir en logs reales)</span>
</span><span id="__span-36-49"><a href="#__codelineno-36-49" id="__codelineno-36-49" name="__codelineno-36-49"></a>    <span class="c1"># connection_string = f"Server=myserver;Database=mydb;User=admin;Password={password}"</span>
</span></code></pre></div>
<p><strong>Requisitos previos:</strong></p>
<ol>
<li>Servidor enrolado en Azure Arc con managed identity habilitada (por defecto).</li>
<li>Identity del servidor con RBAC apropiado en Key Vault:</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a href="#__codelineno-37-1" id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1"># Variables</span>
</span><span id="__span-37-2"><a href="#__codelineno-37-2" id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="nv">RESOURCE_GROUP</span><span class="o">=</span><span class="s2">"my-rg"</span>
</span><span id="__span-37-3"><a href="#__codelineno-37-3" id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="nv">SERVER_NAME</span><span class="o">=</span><span class="s2">"my-arc-server"</span>
</span><span id="__span-37-4"><a href="#__codelineno-37-4" id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="nv">VAULT_NAME</span><span class="o">=</span><span class="s2">"my-production-vault"</span>
</span><span id="__span-37-5"><a href="#__codelineno-37-5" id="__codelineno-37-5" name="__codelineno-37-5"></a>
</span><span id="__span-37-6"><a href="#__codelineno-37-6" id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="c1"># Obtener el principal ID de la managed identity</span>
</span><span id="__span-37-7"><a href="#__codelineno-37-7" id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="nv">PRINCIPAL_ID</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>connectedmachine<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-8"><a href="#__codelineno-37-8" id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="w">    </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-9"><a href="#__codelineno-37-9" id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="w">    </span>--name<span class="w"> </span><span class="nv">$SERVER_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-10"><a href="#__codelineno-37-10" id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="w">    </span>--query<span class="w"> </span>identity.principalId<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>
</span><span id="__span-37-11"><a href="#__codelineno-37-11" id="__codelineno-37-11" name="__codelineno-37-11"></a>
</span><span id="__span-37-12"><a href="#__codelineno-37-12" id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="c1"># Asignar rol "Key Vault Secrets User" (RBAC)</span>
</span><span id="__span-37-13"><a href="#__codelineno-37-13" id="__codelineno-37-13" name="__codelineno-37-13"></a>az<span class="w"> </span>role<span class="w"> </span>assignment<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-14"><a href="#__codelineno-37-14" id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="w">    </span>--assignee<span class="w"> </span><span class="nv">$PRINCIPAL_ID</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-15"><a href="#__codelineno-37-15" id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="w">    </span>--role<span class="w"> </span><span class="s2">"Key Vault Secrets User"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-16"><a href="#__codelineno-37-16" id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="w">    </span>--scope<span class="w"> </span>/subscriptions/<span class="k">$(</span>az<span class="w"> </span>account<span class="w"> </span>show<span class="w"> </span>--query<span class="w"> </span>id<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>/resourceGroups/<span class="nv">$RESOURCE_GROUP</span>/providers/Microsoft.KeyVault/vaults/<span class="nv">$VAULT_NAME</span>
</span></code></pre></div>
<h3 id="validar-managed-identity-en-el-servidor"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#validar-managed-identity-en-el-servidor">Validar managed identity en el servidor</a></h3>
<p>Antes de ejecutar código Python, verifica que el endpoint IMDS responde:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="c1"># Variables de entorno expuestas por el agente Arc</span>
</span><span id="__span-38-2"><a href="#__codelineno-38-2" id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="nb">echo</span><span class="w"> </span><span class="nv">$IMDS_ENDPOINT</span>
</span><span id="__span-38-3"><a href="#__codelineno-38-3" id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="c1"># Salida esperada: http://localhost:40342</span>
</span><span id="__span-38-4"><a href="#__codelineno-38-4" id="__codelineno-38-4" name="__codelineno-38-4"></a>
</span><span id="__span-38-5"><a href="#__codelineno-38-5" id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="nb">echo</span><span class="w"> </span><span class="nv">$IDENTITY_ENDPOINT</span>
</span><span id="__span-38-6"><a href="#__codelineno-38-6" id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="c1"># Salida esperada: http://localhost:40342/metadata/identity/oauth2/token</span>
</span><span id="__span-38-7"><a href="#__codelineno-38-7" id="__codelineno-38-7" name="__codelineno-38-7"></a>
</span><span id="__span-38-8"><a href="#__codelineno-38-8" id="__codelineno-38-8" name="__codelineno-38-8"></a><span class="c1"># Test manual del endpoint (requiere header Metadata:true)</span>
</span><span id="__span-38-9"><a href="#__codelineno-38-9" id="__codelineno-38-9" name="__codelineno-38-9"></a>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">"Metadata:true"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-38-10"><a href="#__codelineno-38-10" id="__codelineno-38-10" name="__codelineno-38-10"></a><span class="w">    </span><span class="s2">"http://localhost:40342/metadata/identity/oauth2/token?api-version=2020-06-01&amp;resource=https://vault.azure.net"</span>
</span></code></pre></div>
<p>Respuesta exitosa (JSON con <code>access_token</code>, <code>expires_on</code>, etc.):</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-39-1"><a href="#__codelineno-39-1" id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="p">{</span>
</span><span id="__span-39-2"><a href="#__codelineno-39-2" id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="w">  </span><span class="nt">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJ0eXAiOiJKV1QiLCJhbGc..."</span><span class="p">,</span>
</span><span id="__span-39-3"><a href="#__codelineno-39-3" id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="w">  </span><span class="nt">"expires_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1700000000"</span><span class="p">,</span>
</span><span id="__span-39-4"><a href="#__codelineno-39-4" id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="w">  </span><span class="nt">"resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://vault.azure.net"</span><span class="p">,</span>
</span><span id="__span-39-5"><a href="#__codelineno-39-5" id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="w">  </span><span class="nt">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span>
</span><span id="__span-39-6"><a href="#__codelineno-39-6" id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="troubleshooting-comun"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#troubleshooting-comun">Troubleshooting común</a></h3>
<h4 id="error-no-managed-identity-endpoint-found"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#error-no-managed-identity-endpoint-found">Error: "No managed identity endpoint found"</a></h4>
<p><strong>Causa:</strong> El agente Arc no está instalado o no ha configurado el endpoint IMDS.</p>
<p><strong>Solución:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a href="#__codelineno-40-1" id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="c1"># Verificar estado del agente</span>
</span><span id="__span-40-2"><a href="#__codelineno-40-2" id="__codelineno-40-2" name="__codelineno-40-2"></a>sudo<span class="w"> </span>azcmagent<span class="w"> </span>show
</span><span id="__span-40-3"><a href="#__codelineno-40-3" id="__codelineno-40-3" name="__codelineno-40-3"></a>
</span><span id="__span-40-4"><a href="#__codelineno-40-4" id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="c1"># Si está desconectado, reconectar</span>
</span><span id="__span-40-5"><a href="#__codelineno-40-5" id="__codelineno-40-5" name="__codelineno-40-5"></a>sudo<span class="w"> </span>azcmagent<span class="w"> </span>connect<span class="w"> </span><span class="se">\</span>
</span><span id="__span-40-6"><a href="#__codelineno-40-6" id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">"my-rg"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-40-7"><a href="#__codelineno-40-7" id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="w">    </span>--tenant-id<span class="w"> </span><span class="s2">"tenant-id"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-40-8"><a href="#__codelineno-40-8" id="__codelineno-40-8" name="__codelineno-40-8"></a><span class="w">    </span>--location<span class="w"> </span><span class="s2">"westeurope"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-40-9"><a href="#__codelineno-40-9" id="__codelineno-40-9" name="__codelineno-40-9"></a><span class="w">    </span>--subscription-id<span class="w"> </span><span class="s2">"sub-id"</span>
</span></code></pre></div>
<h4 id="error-aadsts700016-application-not-found"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#error-aadsts700016-application-not-found">Error: "AADSTS700016: Application not found"</a></h4>
<p><strong>Causa:</strong> La managed identity no tiene permisos RBAC sobre el recurso destino.</p>
<p><strong>Solución:</strong> Asignar rol apropiado (ver ejemplo de Key Vault arriba). Roles comunes:</p>
<ul>
<li>Key Vault: <code>Key Vault Secrets User</code> (lectura secretos)</li>
<li>Storage: <code>Storage Blob Data Reader</code> (lectura blobs)</li>
<li>Log Analytics: <code>Log Analytics Reader</code> (consultas)</li>
</ul>
<h4 id="error-credentialunavailableerror-managedidentitycredential-authentication-unavailable"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#error-credentialunavailableerror-managedidentitycredential-authentication-unavailable">Error: "CredentialUnavailableError: ManagedIdentityCredential authentication unavailable"</a></h4>
<p><strong>Causa:</strong> Ejecutando código fuera de un entorno con managed identity (ej: laptop local).</p>
<p><strong>Solución:</strong> <code>DefaultAzureCredential</code> caerá en otros métodos (Azure CLI, variables de entorno). Para testing local:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a href="#__codelineno-41-1" id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="c1"># Autenticarse con Azure CLI (DefaultAzureCredential lo detectará)</span>
</span><span id="__span-41-2"><a href="#__codelineno-41-2" id="__codelineno-41-2" name="__codelineno-41-2"></a>az<span class="w"> </span>login
</span><span id="__span-41-3"><a href="#__codelineno-41-3" id="__codelineno-41-3" name="__codelineno-41-3"></a>
</span><span id="__span-41-4"><a href="#__codelineno-41-4" id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="c1"># O usar service principal con variables de entorno</span>
</span><span id="__span-41-5"><a href="#__codelineno-41-5" id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_CLIENT_ID</span><span class="o">=</span><span class="s2">"app-id"</span>
</span><span id="__span-41-6"><a href="#__codelineno-41-6" id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_CLIENT_SECRET</span><span class="o">=</span><span class="s2">"secret"</span>
</span><span id="__span-41-7"><a href="#__codelineno-41-7" id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_TENANT_ID</span><span class="o">=</span><span class="s2">"tenant-id"</span>
</span></code></pre></div>
<h3 id="permisos-y-seguridad"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#permisos-y-seguridad">Permisos y seguridad</a></h3>
<h4 id="principio-de-minimo-privilegio"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#principio-de-minimo-privilegio">Principio de mínimo privilegio</a></h4>
<p>Asigna solo los permisos necesarios:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a href="#__codelineno-42-1" id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="c1"># ❌ MAL: Owner en toda la suscripción</span>
</span><span id="__span-42-2"><a href="#__codelineno-42-2" id="__codelineno-42-2" name="__codelineno-42-2"></a>az<span class="w"> </span>role<span class="w"> </span>assignment<span class="w"> </span>create<span class="w"> </span>--assignee<span class="w"> </span><span class="nv">$PRINCIPAL_ID</span><span class="w"> </span>--role<span class="w"> </span><span class="s2">"Owner"</span><span class="w"> </span>--subscription<span class="w"> </span><span class="nv">$SUB_ID</span>
</span><span id="__span-42-3"><a href="#__codelineno-42-3" id="__codelineno-42-3" name="__codelineno-42-3"></a>
</span><span id="__span-42-4"><a href="#__codelineno-42-4" id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="c1"># ✅ BIEN: Lectura específica en un Key Vault</span>
</span><span id="__span-42-5"><a href="#__codelineno-42-5" id="__codelineno-42-5" name="__codelineno-42-5"></a>az<span class="w"> </span>role<span class="w"> </span>assignment<span class="w"> </span>create<span class="w"> </span>--assignee<span class="w"> </span><span class="nv">$PRINCIPAL_ID</span><span class="w"> </span>--role<span class="w"> </span><span class="s2">"Key Vault Secrets User"</span><span class="w"> </span>--scope<span class="w"> </span><span class="nv">$VAULT_ID</span>
</span></code></pre></div>
<h4 id="control-de-acceso-local"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#control-de-acceso-local">Control de acceso local</a></h4>
<p>Solo usuarios con privilegios elevados pueden obtener tokens managed identity:</p>
<ul>
<li><strong>Windows:</strong> Miembros de <code>Administrators</code> o grupo <code>Hybrid Agent Extension Applications</code></li>
<li><strong>Linux:</strong> Miembros del grupo <code>himds</code></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a href="#__codelineno-43-1" id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="c1"># Linux: Añadir usuario al grupo himds (con precaución)</span>
</span><span id="__span-43-2"><a href="#__codelineno-43-2" id="__codelineno-43-2" name="__codelineno-43-2"></a>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>himds<span class="w"> </span>myappuser
</span><span id="__span-43-3"><a href="#__codelineno-43-3" id="__codelineno-43-3" name="__codelineno-43-3"></a>
</span><span id="__span-43-4"><a href="#__codelineno-43-4" id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="c1"># Verificar membership</span>
</span><span id="__span-43-5"><a href="#__codelineno-43-5" id="__codelineno-43-5" name="__codelineno-43-5"></a>groups<span class="w"> </span>myappuser
</span></code></pre></div>
<h3 id="buenas-practicas"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#buenas-practicas">Buenas prácticas</a></h3>
<ol>
<li><strong>Usa <code>DefaultAzureCredential</code> por defecto:</strong> Funciona en dev y producción sin cambios.</li>
<li><strong>No almacenes tokens:</strong> Deja que el SDK los renueve automáticamente.</li>
<li><strong>Logging seguro:</strong> No imprimas tokens o secretos en logs (<code>print(token)</code> ❌).</li>
<li><strong>Auditoría:</strong> Habilita diagnostic logs en Key Vault/Storage para rastrear accesos:</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a href="#__codelineno-44-1" id="__codelineno-44-1" name="__codelineno-44-1"></a>az<span class="w"> </span>monitor<span class="w"> </span>diagnostic-settings<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-2"><a href="#__codelineno-44-2" id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="w">    </span>--resource<span class="w"> </span><span class="nv">$VAULT_ID</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-3"><a href="#__codelineno-44-3" id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="w">    </span>--name<span class="w"> </span><span class="s2">"audit-logs"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-4"><a href="#__codelineno-44-4" id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="w">    </span>--logs<span class="w"> </span><span class="s1">'[{"category":"AuditEvent","enabled":true}]'</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-5"><a href="#__codelineno-44-5" id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="w">    </span>--workspace<span class="w"> </span><span class="nv">$LOG_ANALYTICS_WORKSPACE_ID</span>
</span></code></pre></div>
<ol>
<li><strong>Timeout y reintentos:</strong> El SDK maneja reintentos, pero para scripts long-running:</li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-45-1"><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">azure.core.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">AzureError</span>
</span><span id="__span-45-2"><a href="#__codelineno-45-2" id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="__span-45-3"><a href="#__codelineno-45-3" id="__codelineno-45-3" name="__codelineno-45-3"></a>
</span><span id="__span-45-4"><a href="#__codelineno-45-4" id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_secret_with_retry</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">secret_name</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
</span><span id="__span-45-5"><a href="#__codelineno-45-5" id="__codelineno-45-5" name="__codelineno-45-5"></a>    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
</span><span id="__span-45-6"><a href="#__codelineno-45-6" id="__codelineno-45-6" name="__codelineno-45-6"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-45-7"><a href="#__codelineno-45-7" id="__codelineno-45-7" name="__codelineno-45-7"></a>            <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">get_secret</span><span class="p">(</span><span class="n">secret_name</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</span><span id="__span-45-8"><a href="#__codelineno-45-8" id="__codelineno-45-8" name="__codelineno-45-8"></a>        <span class="k">except</span> <span class="n">AzureError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-45-9"><a href="#__codelineno-45-9" id="__codelineno-45-9" name="__codelineno-45-9"></a>            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-45-10"><a href="#__codelineno-45-10" id="__codelineno-45-10" name="__codelineno-45-10"></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span>  <span class="c1"># Exponential backoff</span>
</span><span id="__span-45-11"><a href="#__codelineno-45-11" id="__codelineno-45-11" name="__codelineno-45-11"></a>                <span class="k">continue</span>
</span><span id="__span-45-12"><a href="#__codelineno-45-12" id="__codelineno-45-12" name="__codelineno-45-12"></a>            <span class="k">raise</span>
</span></code></pre></div>
<h3 id="instalacion-de-dependencias"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#instalacion-de-dependencias">Instalación de dependencias</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="c1"># Instalar Azure SDK para identidad y servicios específicos</span>
</span><span id="__span-46-2"><a href="#__codelineno-46-2" id="__codelineno-46-2" name="__codelineno-46-2"></a>pip<span class="w"> </span>install<span class="w"> </span>azure-identity<span class="w"> </span>azure-keyvault-secrets<span class="w"> </span>azure-storage-blob
</span><span id="__span-46-3"><a href="#__codelineno-46-3" id="__codelineno-46-3" name="__codelineno-46-3"></a>
</span><span id="__span-46-4"><a href="#__codelineno-46-4" id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="c1"># Para desarrollo, incluye azure-cli para testing local</span>
</span><span id="__span-46-5"><a href="#__codelineno-46-5" id="__codelineno-46-5" name="__codelineno-46-5"></a>pip<span class="w"> </span>install<span class="w"> </span>azure-cli
</span></code></pre></div>
<p>Archivo <code>requirements.txt</code> recomendado:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a>azure-identity&gt;=1.15.0
</span><span id="__span-47-2"><a href="#__codelineno-47-2" id="__codelineno-47-2" name="__codelineno-47-2"></a>azure-keyvault-secrets&gt;=4.7.0
</span><span id="__span-47-3"><a href="#__codelineno-47-3" id="__codelineno-47-3" name="__codelineno-47-3"></a>azure-storage-blob&gt;=12.19.0
</span></code></pre></div>
<h3 id="referencias"><a class="toclink" href="../../2025/11/20/autenticaci%C3%B3n-python-en-m%C3%A1quinas-azure-arc-gu%C3%ADa-pr%C3%A1ctica/#referencias">Referencias</a></h3>
<p>Documentación oficial validada:</p>
<ul>
<li>Autenticación managed identity en Azure Arc: <a href="https://learn.microsoft.com/en-us/azure/azure-arc/servers/managed-identity-authentication">https://learn.microsoft.com/en-us/azure/azure-arc/servers/managed-identity-authentication</a></li>
<li>Azure Identity library para Python: <a href="https://learn.microsoft.com/en-us/python/api/overview/azure/identity-readme">https://learn.microsoft.com/en-us/python/api/overview/azure/identity-readme</a></li>
<li>Managed identities overview: <a href="https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/overview">https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/overview</a></li>
<li>MSAL Python managed identity: <a href="https://learn.microsoft.com/en-us/entra/msal/python/advanced/managed-identity">https://learn.microsoft.com/en-us/entra/msal/python/advanced/managed-identity</a></li>
<li>Security overview Azure Arc: <a href="https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/scenarios/hybrid/arc-enabled-servers/eslz-identity-and-access-management">https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/scenarios/hybrid/arc-enabled-servers/eslz-identity-and-access-management</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-11-11 00:00:00+00:00">November 11, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure Services</a></li>
<li class="md-meta__item">
            
              9 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-storage-priority-replication-replicacion-acelerada-con-sla"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/">Azure Storage Priority Replication: Replicación acelerada con SLA</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#resumen">Resumen</a></h3>
<p>Priority Replication acelera la replicación de datos en Azure Storage con SLA de 15 minutos para cumplir requisitos estrictos de RPO (Recovery Point Objective). Disponible para geo-redundancia (GRS/GZRS) y Object Replication entre cuentas.</p>
<h3 id="que-es-priority-replication"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#que-es-priority-replication">¿Qué es Priority Replication?</a></h3>
<p>Priority Replication es una capacidad de Azure Storage que <strong>prioriza el tráfico de replicación</strong> y proporciona <strong>garantías SLA</strong> para sincronización de datos entre regiones. Diseñada para escenarios donde el tiempo de replicación es crítico para cumplimiento y continuidad de negocio.</p>
<p><strong>Dos variantes disponibles</strong>:</p>
<ol>
<li><strong>Geo Priority Replication</strong>: Para cuentas con GRS/GZRS (redundancia entre regiones)</li>
<li><strong>Object Replication Priority</strong>: Para políticas de Object Replication entre cuentas</li>
</ol>
<p><strong>SLA clave</strong>: 99.0% del mes de facturación con Last Sync Time (LST) ≤ 15 minutos</p>
<h3 id="geo-priority-replication"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#geo-priority-replication">Geo Priority Replication</a></h3>
<p>Acelera la replicación entre región primaria y secundaria para cuentas con GRS (Geo-Redundant Storage) o GZRS (Geo-Zone-Redundant Storage).</p>
<h4 id="disponibilidad-y-limitaciones"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#disponibilidad-y-limitaciones">Disponibilidad y limitaciones</a></h4>
<p><strong>Regiones soportadas</strong>: Todas las regiones públicas con GRS/GZRS <strong>excepto</strong>:</p>
<ul>
<li>West India</li>
<li>Switzerland West</li>
</ul>
<p><strong>Requisitos para GZRS</strong>:</p>
<ul>
<li>Región debe soportar Availability Zones</li>
<li>Región debe tener paired region</li>
</ul>
<h4 id="beneficios-principales"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#beneficios-principales">Beneficios principales</a></h4>
<ol>
<li><strong>RPO garantizado</strong>: Confianza en tiempo de sincronización para cumplimiento</li>
<li><strong>Failover sin sorpresas</strong>: LST predecible si ocurre failover no planificado</li>
<li><strong>Monitoreo mejorado</strong>: Telemetría detallada vía Azure Monitor</li>
<li><strong>SLA respaldado</strong>: Garantía de 99.0% del mes con lag ≤ 15 minutos</li>
</ol>
<h4 id="exclusiones-del-sla"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#exclusiones-del-sla">Exclusiones del SLA</a></h4>
<p>El SLA <strong>NO aplica</strong> en estos casos:</p>
<p><strong>Por tipo de blob</strong>:</p>
<ul>
<li>Page blobs y append blobs (SLA solo para Block Blobs)</li>
<li>Cuentas con llamadas API de Page/Append Blob en últimos 30 días</li>
<li>Cuentas con features que crean estos blobs (Change Feed, Object Replication, logs en Azure Monitor)</li>
</ul>
<p><strong>Por condición de cuenta</strong>:</p>
<ul>
<li>LST &gt; 15 minutos durante habilitación de la feature</li>
<li>Transfer rate &gt; 1 Gbps con backlog pendiente</li>
<li>
<blockquote>
<p>100 CopyBlob requests/segundo con backlog pendiente</p>
</blockquote>
</li>
</ul>
<p><strong>Por eventos operacionales</strong>:</p>
<ul>
<li>Unplanned failover (desactiva automáticamente la feature)</li>
<li>Durante conversión GRS ↔ GZRS (no afecta si se mantiene dentro de guardrails)</li>
</ul>
<h4 id="habilitar-geo-priority-replication"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#habilitar-geo-priority-replication">Habilitar Geo Priority Replication</a></h4>
<h5 id="durante-creacion-de-cuenta-nueva"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#durante-creacion-de-cuenta-nueva">Durante creación de cuenta nueva</a></h5>
<p><strong>Azure CLI</strong>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a href="#__codelineno-44-1" id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="c1"># Variables</span>
</span><span id="__span-44-2"><a href="#__codelineno-44-2" id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="nv">RESOURCE_GROUP</span><span class="o">=</span><span class="s2">"rg-storage-prod"</span>
</span><span id="__span-44-3"><a href="#__codelineno-44-3" id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="nv">STORAGE_ACCOUNT</span><span class="o">=</span><span class="s2">"stgeopriorityprod"</span>
</span><span id="__span-44-4"><a href="#__codelineno-44-4" id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="nv">LOCATION</span><span class="o">=</span><span class="s2">"westeurope"</span>
</span><span id="__span-44-5"><a href="#__codelineno-44-5" id="__codelineno-44-5" name="__codelineno-44-5"></a>
</span><span id="__span-44-6"><a href="#__codelineno-44-6" id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="c1"># Crear cuenta con Geo Priority Replication</span>
</span><span id="__span-44-7"><a href="#__codelineno-44-7" id="__codelineno-44-7" name="__codelineno-44-7"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-8"><a href="#__codelineno-44-8" id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-9"><a href="#__codelineno-44-9" id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-10"><a href="#__codelineno-44-10" id="__codelineno-44-10" name="__codelineno-44-10"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-11"><a href="#__codelineno-44-11" id="__codelineno-44-11" name="__codelineno-44-11"></a><span class="w">  </span>--sku<span class="w"> </span>Standard_GRS<span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-12"><a href="#__codelineno-44-12" id="__codelineno-44-12" name="__codelineno-44-12"></a><span class="w">  </span>--enable-blob-geo-priority-replication<span class="w"> </span><span class="nb">true</span>
</span></code></pre></div>
<p><strong>Azure PowerShell</strong>:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-45-1"><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="c"># Variables</span>
</span><span id="__span-45-2"><a href="#__codelineno-45-2" id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="nv">$rgName</span> <span class="p">=</span> <span class="s2">"rg-storage-prod"</span>
</span><span id="__span-45-3"><a href="#__codelineno-45-3" id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="nv">$storageAccountName</span> <span class="p">=</span> <span class="s2">"stgeopriorityprod"</span>
</span><span id="__span-45-4"><a href="#__codelineno-45-4" id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="nv">$location</span> <span class="p">=</span> <span class="s2">"westeurope"</span>
</span><span id="__span-45-5"><a href="#__codelineno-45-5" id="__codelineno-45-5" name="__codelineno-45-5"></a>
</span><span id="__span-45-6"><a href="#__codelineno-45-6" id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="c"># Crear cuenta con Geo Priority Replication</span>
</span><span id="__span-45-7"><a href="#__codelineno-45-7" id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="nv">$account</span> <span class="p">=</span> <span class="nb">New-AzStorageAccount</span> <span class="p">`</span>
</span><span id="__span-45-8"><a href="#__codelineno-45-8" id="__codelineno-45-8" name="__codelineno-45-8"></a>  <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-45-9"><a href="#__codelineno-45-9" id="__codelineno-45-9" name="__codelineno-45-9"></a>  <span class="n">-StorageAccountName</span> <span class="nv">$storageAccountName</span> <span class="p">`</span>
</span><span id="__span-45-10"><a href="#__codelineno-45-10" id="__codelineno-45-10" name="__codelineno-45-10"></a>  <span class="n">-SkuName</span> <span class="n">Standard_GRS</span> <span class="p">`</span>
</span><span id="__span-45-11"><a href="#__codelineno-45-11" id="__codelineno-45-11" name="__codelineno-45-11"></a>  <span class="n">-Location</span> <span class="nv">$location</span> <span class="p">`</span>
</span><span id="__span-45-12"><a href="#__codelineno-45-12" id="__codelineno-45-12" name="__codelineno-45-12"></a>  <span class="n">-EnableBlobGeoPriorityReplication</span> <span class="nv">$true</span>
</span></code></pre></div>
<h5 id="en-cuentas-existentes"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#en-cuentas-existentes">En cuentas existentes</a></h5>
<p><strong>Habilitar</strong>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="c1"># Azure CLI</span>
</span><span id="__span-46-2"><a href="#__codelineno-46-2" id="__codelineno-46-2" name="__codelineno-46-2"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-46-3"><a href="#__codelineno-46-3" id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-46-4"><a href="#__codelineno-46-4" id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-46-5"><a href="#__codelineno-46-5" id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="w">  </span>--enable-blob-geo-priority-replication<span class="w"> </span><span class="nb">true</span>
</span></code></pre></div>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-47-1"><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="c"># PowerShell</span>
</span><span id="__span-47-2"><a href="#__codelineno-47-2" id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="nb">Set-AzStorageAccount</span> <span class="p">`</span>
</span><span id="__span-47-3"><a href="#__codelineno-47-3" id="__codelineno-47-3" name="__codelineno-47-3"></a>  <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-47-4"><a href="#__codelineno-47-4" id="__codelineno-47-4" name="__codelineno-47-4"></a>  <span class="n">-StorageAccountName</span> <span class="nv">$storageAccountName</span> <span class="p">`</span>
</span><span id="__span-47-5"><a href="#__codelineno-47-5" id="__codelineno-47-5" name="__codelineno-47-5"></a>  <span class="n">-EnableBlobGeoPriorityReplication</span> <span class="nv">$true</span>
</span></code></pre></div>
<p><strong>Deshabilitar</strong>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a href="#__codelineno-48-1" id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="c1"># Azure CLI</span>
</span><span id="__span-48-2"><a href="#__codelineno-48-2" id="__codelineno-48-2" name="__codelineno-48-2"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-48-3"><a href="#__codelineno-48-3" id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-48-4"><a href="#__codelineno-48-4" id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-48-5"><a href="#__codelineno-48-5" id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="w">  </span>--enable-blob-geo-priority-replication<span class="w"> </span><span class="nb">false</span>
</span></code></pre></div>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-49-1"><a href="#__codelineno-49-1" id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="c"># PowerShell</span>
</span><span id="__span-49-2"><a href="#__codelineno-49-2" id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="nb">Set-AzStorageAccount</span> <span class="p">`</span>
</span><span id="__span-49-3"><a href="#__codelineno-49-3" id="__codelineno-49-3" name="__codelineno-49-3"></a>  <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-49-4"><a href="#__codelineno-49-4" id="__codelineno-49-4" name="__codelineno-49-4"></a>  <span class="n">-StorageAccountName</span> <span class="nv">$storageAccountName</span> <span class="p">`</span>
</span><span id="__span-49-5"><a href="#__codelineno-49-5" id="__codelineno-49-5" name="__codelineno-49-5"></a>  <span class="n">-EnableBlobGeoPriorityReplication</span> <span class="nv">$false</span>
</span></code></pre></div>
<h4 id="monitorear-cumplimiento-con-geo-blob-lag"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#monitorear-cumplimiento-con-geo-blob-lag">Monitorear cumplimiento con Geo Blob Lag</a></h4>
<p><strong>Métrica nueva (Preview)</strong>: <code>Geo Blob Lag</code> - segundos desde última copia completa entre regiones.</p>
<p><strong>Habilitar preview</strong>:</p>
<ol>
<li>Azure Portal → Subscriptions → Preview features</li>
<li>Feature: <code>AllowGeoPriorityReplicationMetricsInPortal</code></li>
<li>Provider: <code>Microsoft.Storage</code></li>
</ol>
<p><strong>Acceder a métricas</strong>:</p>
<ul>
<li>Portal: Storage Account → <strong>Redundancy</strong> o <strong>Metrics</strong></li>
<li>Métrica: <strong>Geo Blob Lag metric (preview)</strong></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Tiempo de activación</p>
<p>Las métricas pueden tardar hasta <strong>24 horas</strong> en aparecer tras registrar la feature.</p>
</div>
<p><strong>Uso para validar SLA</strong>:</p>
<p>Monitorear que el lag se mantiene ≤ 15 minutos durante el 99% del mes. Si excede, ese período se excluye del SLA.</p>
<h3 id="object-replication-priority"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#object-replication-priority">Object Replication Priority</a></h3>
<p>Acelera la replicación entre cuentas de storage usando Object Replication policies. Garantiza que 99.0% de objetos se replican en <strong>≤ 15 minutos</strong> cuando origen y destino están en el <strong>mismo continente</strong>.</p>
<h4 id="disponibilidad"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#disponibilidad">Disponibilidad</a></h4>
<p><strong>Regiones soportadas</strong>: Todas las regiones públicas <strong>excepto</strong>:</p>
<ul>
<li>West India</li>
<li>Switzerland West</li>
</ul>
<p><strong>Portal experience</strong> (Preview):</p>
<ul>
<li>Feature: <code>AllowPriorityObjectReplicationInPortal</code></li>
<li>Provider: <code>Microsoft.Storage</code></li>
</ul>
<h4 id="beneficios-principales_1"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#beneficios-principales_1">Beneficios principales</a></h4>
<ol>
<li><strong>SLA de rendimiento</strong>: 99% de objetos en ≤ 15 minutos (mismo continente)</li>
<li><strong>Métricas automáticas</strong>: Activación automática de OR metrics</li>
<li><strong>Visibilidad mejorada</strong>: Time buckets (0-5 min, 5-10 min, &gt;24h)</li>
<li><strong>DR garantizado</strong>: Confianza en tiempos para disaster recovery</li>
</ol>
<h4 id="exclusiones-del-sla_1"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#exclusiones-del-sla_1">Exclusiones del SLA</a></h4>
<p>El SLA <strong>NO aplica</strong> a:</p>
<p><strong>Por características del objeto</strong>:</p>
<ul>
<li>Objetos &gt; 5 GB</li>
<li>Objetos modificados &gt; 10 veces/segundo</li>
</ul>
<p><strong>Por geografía</strong>:</p>
<ul>
<li>Origen y destino en continentes diferentes</li>
</ul>
<p><strong>Por tamaño de cuenta</strong>:</p>
<ul>
<li>Cuentas &gt; 5 PB</li>
<li>Cuentas con &gt; 10 mil millones de blobs</li>
</ul>
<p><strong>Por condiciones operativas</strong>:</p>
<ul>
<li>Transfer rate &gt; 1 Gbps con backlog pendiente</li>
<li>
<blockquote>
<p>1,000 PUT/DELETE ops/segundo con backlog pendiente</p>
</blockquote>
</li>
<li>Durante replicación de blobs existentes tras crear/actualizar policy</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Limitación de políticas</p>
<p>Solo <strong>1 policy</strong> por cuenta origen puede tener Priority Replication habilitado (aunque la cuenta soporte hasta 2 policies).</p>
</div>
<h4 id="habilitar-object-replication-priority"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#habilitar-object-replication-priority">Habilitar Object Replication Priority</a></h4>
<h5 id="durante-creacion-de-nueva-policy"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#durante-creacion-de-nueva-policy">Durante creación de nueva policy</a></h5>
<p><strong>Azure CLI</strong>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-50-1"><a href="#__codelineno-50-1" id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="c1"># Variables</span>
</span><span id="__span-50-2"><a href="#__codelineno-50-2" id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="nv">SRC_ACCOUNT</span><span class="o">=</span><span class="s2">"stgsourceprod"</span>
</span><span id="__span-50-3"><a href="#__codelineno-50-3" id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="nv">DST_ACCOUNT</span><span class="o">=</span><span class="s2">"stgdestinationdr"</span>
</span><span id="__span-50-4"><a href="#__codelineno-50-4" id="__codelineno-50-4" name="__codelineno-50-4"></a><span class="nv">SRC_CONTAINER</span><span class="o">=</span><span class="s2">"data"</span>
</span><span id="__span-50-5"><a href="#__codelineno-50-5" id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="nv">DST_CONTAINER</span><span class="o">=</span><span class="s2">"data-replica"</span>
</span><span id="__span-50-6"><a href="#__codelineno-50-6" id="__codelineno-50-6" name="__codelineno-50-6"></a>
</span><span id="__span-50-7"><a href="#__codelineno-50-7" id="__codelineno-50-7" name="__codelineno-50-7"></a><span class="c1"># Crear policy con Priority Replication</span>
</span><span id="__span-50-8"><a href="#__codelineno-50-8" id="__codelineno-50-8" name="__codelineno-50-8"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>or-policy<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-50-9"><a href="#__codelineno-50-9" id="__codelineno-50-9" name="__codelineno-50-9"></a><span class="w">  </span>--account-name<span class="w"> </span><span class="nv">$DST_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-50-10"><a href="#__codelineno-50-10" id="__codelineno-50-10" name="__codelineno-50-10"></a><span class="w">  </span>--source-account<span class="w"> </span><span class="nv">$SRC_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-50-11"><a href="#__codelineno-50-11" id="__codelineno-50-11" name="__codelineno-50-11"></a><span class="w">  </span>--destination-container<span class="w"> </span><span class="nv">$DST_CONTAINER</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-50-12"><a href="#__codelineno-50-12" id="__codelineno-50-12" name="__codelineno-50-12"></a><span class="w">  </span>--source-container<span class="w"> </span><span class="nv">$SRC_CONTAINER</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-50-13"><a href="#__codelineno-50-13" id="__codelineno-50-13" name="__codelineno-50-13"></a><span class="w">  </span>--min-creation-time<span class="w"> </span><span class="s2">"2025-11-11T00:00:00Z"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-50-14"><a href="#__codelineno-50-14" id="__codelineno-50-14" name="__codelineno-50-14"></a><span class="w">  </span>--enable-metrics<span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-50-15"><a href="#__codelineno-50-15" id="__codelineno-50-15" name="__codelineno-50-15"></a><span class="w">  </span>--priority-replication<span class="w"> </span><span class="nb">true</span>
</span></code></pre></div>
<p><strong>Azure PowerShell</strong>:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-51-1"><a href="#__codelineno-51-1" id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="c"># Variables</span>
</span><span id="__span-51-2"><a href="#__codelineno-51-2" id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="nv">$rgName</span> <span class="p">=</span> <span class="s2">"rg-storage-prod"</span>
</span><span id="__span-51-3"><a href="#__codelineno-51-3" id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="nv">$srcAccountName</span> <span class="p">=</span> <span class="s2">"stgsourceprod"</span>
</span><span id="__span-51-4"><a href="#__codelineno-51-4" id="__codelineno-51-4" name="__codelineno-51-4"></a><span class="nv">$dstAccountName</span> <span class="p">=</span> <span class="s2">"stgdestinationdr"</span>
</span><span id="__span-51-5"><a href="#__codelineno-51-5" id="__codelineno-51-5" name="__codelineno-51-5"></a><span class="nv">$srcAccountResourceID</span> <span class="p">=</span> <span class="s2">"/subscriptions/{sub-id}/resourceGroups/{rg}/providers/Microsoft.Storage/storageAccounts/$srcAccountName"</span>
</span><span id="__span-51-6"><a href="#__codelineno-51-6" id="__codelineno-51-6" name="__codelineno-51-6"></a><span class="nv">$srcContainer</span> <span class="p">=</span> <span class="s2">"data"</span>
</span><span id="__span-51-7"><a href="#__codelineno-51-7" id="__codelineno-51-7" name="__codelineno-51-7"></a><span class="nv">$dstContainer</span> <span class="p">=</span> <span class="s2">"data-replica"</span>
</span><span id="__span-51-8"><a href="#__codelineno-51-8" id="__codelineno-51-8" name="__codelineno-51-8"></a>
</span><span id="__span-51-9"><a href="#__codelineno-51-9" id="__codelineno-51-9" name="__codelineno-51-9"></a><span class="c"># Crear regla y policy con Priority Replication</span>
</span><span id="__span-51-10"><a href="#__codelineno-51-10" id="__codelineno-51-10" name="__codelineno-51-10"></a><span class="nv">$rule</span> <span class="p">=</span> <span class="nb">New-AzStorageObjectReplicationPolicyRule</span> <span class="p">`</span>
</span><span id="__span-51-11"><a href="#__codelineno-51-11" id="__codelineno-51-11" name="__codelineno-51-11"></a>  <span class="n">-SourceContainer</span> <span class="nv">$srcContainer</span> <span class="p">`</span>
</span><span id="__span-51-12"><a href="#__codelineno-51-12" id="__codelineno-51-12" name="__codelineno-51-12"></a>  <span class="n">-DestinationContainer</span> <span class="nv">$dstContainer</span>
</span><span id="__span-51-13"><a href="#__codelineno-51-13" id="__codelineno-51-13" name="__codelineno-51-13"></a>
</span><span id="__span-51-14"><a href="#__codelineno-51-14" id="__codelineno-51-14" name="__codelineno-51-14"></a><span class="nv">$dstPolicy</span> <span class="p">=</span> <span class="nb">Set-AzStorageObjectReplicationPolicy</span> <span class="p">`</span>
</span><span id="__span-51-15"><a href="#__codelineno-51-15" id="__codelineno-51-15" name="__codelineno-51-15"></a>  <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-51-16"><a href="#__codelineno-51-16" id="__codelineno-51-16" name="__codelineno-51-16"></a>  <span class="n">-StorageAccountName</span> <span class="nv">$dstAccountName</span> <span class="p">`</span>
</span><span id="__span-51-17"><a href="#__codelineno-51-17" id="__codelineno-51-17" name="__codelineno-51-17"></a>  <span class="n">-PolicyId</span> <span class="k">default</span> <span class="p">`</span>
</span><span id="__span-51-18"><a href="#__codelineno-51-18" id="__codelineno-51-18" name="__codelineno-51-18"></a>  <span class="n">-SourceAccount</span> <span class="nv">$srcAccountResourceID</span> <span class="p">`</span>
</span><span id="__span-51-19"><a href="#__codelineno-51-19" id="__codelineno-51-19" name="__codelineno-51-19"></a>  <span class="n">-Rule</span> <span class="nv">$rule</span> <span class="p">`</span>
</span><span id="__span-51-20"><a href="#__codelineno-51-20" id="__codelineno-51-20" name="__codelineno-51-20"></a>  <span class="n">-EnableMetric</span> <span class="nv">$true</span> <span class="p">`</span>
</span><span id="__span-51-21"><a href="#__codelineno-51-21" id="__codelineno-51-21" name="__codelineno-51-21"></a>  <span class="n">-EnablePriorityReplication</span> <span class="nv">$true</span>
</span><span id="__span-51-22"><a href="#__codelineno-51-22" id="__codelineno-51-22" name="__codelineno-51-22"></a>
</span><span id="__span-51-23"><a href="#__codelineno-51-23" id="__codelineno-51-23" name="__codelineno-51-23"></a><span class="c"># Aplicar policy en cuenta origen</span>
</span><span id="__span-51-24"><a href="#__codelineno-51-24" id="__codelineno-51-24" name="__codelineno-51-24"></a><span class="nv">$srcPolicy</span> <span class="p">=</span> <span class="nb">Set-AzStorageObjectReplicationPolicy</span> <span class="p">`</span>
</span><span id="__span-51-25"><a href="#__codelineno-51-25" id="__codelineno-51-25" name="__codelineno-51-25"></a>  <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-51-26"><a href="#__codelineno-51-26" id="__codelineno-51-26" name="__codelineno-51-26"></a>  <span class="n">-StorageAccountName</span> <span class="nv">$srcAccountName</span> <span class="p">`</span>
</span><span id="__span-51-27"><a href="#__codelineno-51-27" id="__codelineno-51-27" name="__codelineno-51-27"></a>  <span class="n">-InputObject</span> <span class="nv">$dstPolicy</span>
</span><span id="__span-51-28"><a href="#__codelineno-51-28" id="__codelineno-51-28" name="__codelineno-51-28"></a>
</span><span id="__span-51-29"><a href="#__codelineno-51-29" id="__codelineno-51-29" name="__codelineno-51-29"></a><span class="c"># Verificar habilitación</span>
</span><span id="__span-51-30"><a href="#__codelineno-51-30" id="__codelineno-51-30" name="__codelineno-51-30"></a><span class="nv">$srcPolicy</span><span class="p">.</span><span class="n">PriorityReplication</span><span class="p">.</span><span class="n">Enabled</span>
</span></code></pre></div>
<h5 id="en-policies-existentes"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#en-policies-existentes">En policies existentes</a></h5>
<p><strong>Habilitar</strong>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-52-1"><a href="#__codelineno-52-1" id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="c1"># Azure CLI</span>
</span><span id="__span-52-2"><a href="#__codelineno-52-2" id="__codelineno-52-2" name="__codelineno-52-2"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>or-policy<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-52-3"><a href="#__codelineno-52-3" id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="w">  </span>--account-name<span class="w"> </span><span class="nv">$DST_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-52-4"><a href="#__codelineno-52-4" id="__codelineno-52-4" name="__codelineno-52-4"></a><span class="w">  </span>--source-account<span class="w"> </span><span class="nv">$SRC_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-52-5"><a href="#__codelineno-52-5" id="__codelineno-52-5" name="__codelineno-52-5"></a><span class="w">  </span>--destination-container<span class="w"> </span><span class="nv">$DST_CONTAINER</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-52-6"><a href="#__codelineno-52-6" id="__codelineno-52-6" name="__codelineno-52-6"></a><span class="w">  </span>--source-container<span class="w"> </span><span class="nv">$SRC_CONTAINER</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-52-7"><a href="#__codelineno-52-7" id="__codelineno-52-7" name="__codelineno-52-7"></a><span class="w">  </span>--min-creation-time<span class="w"> </span><span class="s2">"2025-11-11T00:00:00Z"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-52-8"><a href="#__codelineno-52-8" id="__codelineno-52-8" name="__codelineno-52-8"></a><span class="w">  </span>--enable-metrics<span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-52-9"><a href="#__codelineno-52-9" id="__codelineno-52-9" name="__codelineno-52-9"></a><span class="w">  </span>--priority-replication<span class="w"> </span><span class="nb">true</span>
</span></code></pre></div>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-53-1"><a href="#__codelineno-53-1" id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="c"># PowerShell</span>
</span><span id="__span-53-2"><a href="#__codelineno-53-2" id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="nv">$dstPolicy</span> <span class="p">=</span> <span class="nb">Set-AzStorageObjectReplicationPolicy</span> <span class="p">`</span>
</span><span id="__span-53-3"><a href="#__codelineno-53-3" id="__codelineno-53-3" name="__codelineno-53-3"></a>  <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-53-4"><a href="#__codelineno-53-4" id="__codelineno-53-4" name="__codelineno-53-4"></a>  <span class="n">-StorageAccountName</span> <span class="nv">$dstAccountName</span> <span class="p">`</span>
</span><span id="__span-53-5"><a href="#__codelineno-53-5" id="__codelineno-53-5" name="__codelineno-53-5"></a>  <span class="n">-PolicyId</span> <span class="k">default</span> <span class="p">`</span>
</span><span id="__span-53-6"><a href="#__codelineno-53-6" id="__codelineno-53-6" name="__codelineno-53-6"></a>  <span class="n">-SourceAccount</span> <span class="nv">$srcAccountResourceID</span> <span class="p">`</span>
</span><span id="__span-53-7"><a href="#__codelineno-53-7" id="__codelineno-53-7" name="__codelineno-53-7"></a>  <span class="n">-Rule</span> <span class="nv">$rule</span> <span class="p">`</span>
</span><span id="__span-53-8"><a href="#__codelineno-53-8" id="__codelineno-53-8" name="__codelineno-53-8"></a>  <span class="n">-EnableMetric</span> <span class="nv">$true</span> <span class="p">`</span>
</span><span id="__span-53-9"><a href="#__codelineno-53-9" id="__codelineno-53-9" name="__codelineno-53-9"></a>  <span class="n">-EnablePriorityReplication</span> <span class="nv">$true</span>
</span><span id="__span-53-10"><a href="#__codelineno-53-10" id="__codelineno-53-10" name="__codelineno-53-10"></a>
</span><span id="__span-53-11"><a href="#__codelineno-53-11" id="__codelineno-53-11" name="__codelineno-53-11"></a><span class="nv">$srcPolicy</span> <span class="p">=</span> <span class="nb">Set-AzStorageObjectReplicationPolicy</span> <span class="p">`</span>
</span><span id="__span-53-12"><a href="#__codelineno-53-12" id="__codelineno-53-12" name="__codelineno-53-12"></a>  <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-53-13"><a href="#__codelineno-53-13" id="__codelineno-53-13" name="__codelineno-53-13"></a>  <span class="n">-StorageAccountName</span> <span class="nv">$srcAccountName</span> <span class="p">`</span>
</span><span id="__span-53-14"><a href="#__codelineno-53-14" id="__codelineno-53-14" name="__codelineno-53-14"></a>  <span class="n">-InputObject</span> <span class="nv">$dstPolicy</span>
</span><span id="__span-53-15"><a href="#__codelineno-53-15" id="__codelineno-53-15" name="__codelineno-53-15"></a>
</span><span id="__span-53-16"><a href="#__codelineno-53-16" id="__codelineno-53-16" name="__codelineno-53-16"></a><span class="c"># Confirmar</span>
</span><span id="__span-53-17"><a href="#__codelineno-53-17" id="__codelineno-53-17" name="__codelineno-53-17"></a><span class="nv">$srcPolicy</span><span class="p">.</span><span class="n">PriorityReplication</span><span class="p">.</span><span class="n">Enabled</span>
</span></code></pre></div>
<p><strong>Deshabilitar</strong>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-54-1"><a href="#__codelineno-54-1" id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="c1"># Azure CLI</span>
</span><span id="__span-54-2"><a href="#__codelineno-54-2" id="__codelineno-54-2" name="__codelineno-54-2"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>or-policy<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-54-3"><a href="#__codelineno-54-3" id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="w">  </span>--account-name<span class="w"> </span><span class="nv">$DST_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-54-4"><a href="#__codelineno-54-4" id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="w">  </span>--source-account<span class="w"> </span><span class="nv">$SRC_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-54-5"><a href="#__codelineno-54-5" id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="w">  </span>--destination-container<span class="w"> </span><span class="nv">$DST_CONTAINER</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-54-6"><a href="#__codelineno-54-6" id="__codelineno-54-6" name="__codelineno-54-6"></a><span class="w">  </span>--source-container<span class="w"> </span><span class="nv">$SRC_CONTAINER</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-54-7"><a href="#__codelineno-54-7" id="__codelineno-54-7" name="__codelineno-54-7"></a><span class="w">  </span>--min-creation-time<span class="w"> </span><span class="s2">"2025-11-11T00:00:00Z"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-54-8"><a href="#__codelineno-54-8" id="__codelineno-54-8" name="__codelineno-54-8"></a><span class="w">  </span>--enable-metrics<span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-54-9"><a href="#__codelineno-54-9" id="__codelineno-54-9" name="__codelineno-54-9"></a><span class="w">  </span>--priority-replication<span class="w"> </span><span class="nb">false</span>
</span></code></pre></div>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-55-1"><a href="#__codelineno-55-1" id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="c"># PowerShell - cambiar a $false</span>
</span><span id="__span-55-2"><a href="#__codelineno-55-2" id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="nv">$dstPolicy</span> <span class="p">=</span> <span class="nb">Set-AzStorageObjectReplicationPolicy</span> <span class="p">`</span>
</span><span id="__span-55-3"><a href="#__codelineno-55-3" id="__codelineno-55-3" name="__codelineno-55-3"></a>  <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-55-4"><a href="#__codelineno-55-4" id="__codelineno-55-4" name="__codelineno-55-4"></a>  <span class="n">-StorageAccountName</span> <span class="nv">$dstAccountName</span> <span class="p">`</span>
</span><span id="__span-55-5"><a href="#__codelineno-55-5" id="__codelineno-55-5" name="__codelineno-55-5"></a>  <span class="n">-PolicyId</span> <span class="k">default</span> <span class="p">`</span>
</span><span id="__span-55-6"><a href="#__codelineno-55-6" id="__codelineno-55-6" name="__codelineno-55-6"></a>  <span class="n">-SourceAccount</span> <span class="nv">$srcAccountResourceID</span> <span class="p">`</span>
</span><span id="__span-55-7"><a href="#__codelineno-55-7" id="__codelineno-55-7" name="__codelineno-55-7"></a>  <span class="n">-Rule</span> <span class="nv">$rule</span> <span class="p">`</span>
</span><span id="__span-55-8"><a href="#__codelineno-55-8" id="__codelineno-55-8" name="__codelineno-55-8"></a>  <span class="n">-EnableMetric</span> <span class="nv">$true</span> <span class="p">`</span>
</span><span id="__span-55-9"><a href="#__codelineno-55-9" id="__codelineno-55-9" name="__codelineno-55-9"></a>  <span class="n">-EnablePriorityReplication</span> <span class="nv">$false</span>
</span></code></pre></div>
<h4 id="monitorear-sla-de-object-replication"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#monitorear-sla-de-object-replication">Monitorear SLA de Object Replication</a></h4>
<p>Cuando OR Priority Replication está habilitada, <strong>OR metrics se activan automáticamente</strong>.</p>
<p><strong>Métricas disponibles</strong>:</p>
<table>
<thead>
<tr>
<th>Métrica</th>
<th>Descripción</th>
<th>Dimensiones</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Operations pending for replication</code></td>
<td>Total de operaciones pendientes</td>
<td>Time buckets</td>
</tr>
<tr>
<td><code>Bytes pending for replication</code></td>
<td>Bytes pendientes de replicar</td>
<td>Time buckets</td>
</tr>
</tbody>
</table>
<p><strong>Time buckets</strong>:</p>
<ul>
<li>0-5 minutos</li>
<li>5-10 minutos</li>
<li>10-15 minutos</li>
<li>15-30 minutos</li>
<li>30 minutos - 2 horas</li>
<li>2-8 horas</li>
<li>8-24 horas</li>
<li>
<blockquote>
<p>24 horas</p>
</blockquote>
</li>
</ul>
<p><strong>Validar SLA</strong>:</p>
<p>Monitorear que buckets grandes (&gt;15 min) estén en <strong>cero o cerca de cero</strong> durante el mes.</p>
<p><strong>Verificar replicación de blob individual</strong>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-56-1"><a href="#__codelineno-56-1" id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="c1"># Comprobar estado de replicación</span>
</span><span id="__span-56-2"><a href="#__codelineno-56-2" id="__codelineno-56-2" name="__codelineno-56-2"></a>az<span class="w"> </span>storage<span class="w"> </span>blob<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-56-3"><a href="#__codelineno-56-3" id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="w">  </span>--account-name<span class="w"> </span><span class="nv">$SRC_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-56-4"><a href="#__codelineno-56-4" id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="w">  </span>--container-name<span class="w"> </span><span class="nv">$SRC_CONTAINER</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-56-5"><a href="#__codelineno-56-5" id="__codelineno-56-5" name="__codelineno-56-5"></a><span class="w">  </span>--name<span class="w"> </span>myblob.txt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-56-6"><a href="#__codelineno-56-6" id="__codelineno-56-6" name="__codelineno-56-6"></a><span class="w">  </span>--query<span class="w"> </span><span class="s1">'objectReplicationSourceProperties[].rules[].status'</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-56-7"><a href="#__codelineno-56-7" id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="w">  </span>--output<span class="w"> </span>tsv<span class="w"> </span><span class="se">\</span>
</span><span id="__span-56-8"><a href="#__codelineno-56-8" id="__codelineno-56-8" name="__codelineno-56-8"></a><span class="w">  </span>--auth-mode<span class="w"> </span>login
</span></code></pre></div>
<p>Estado <code>Completed</code> = blob disponible en destino garantizado.</p>
<h3 id="precios"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#precios">Precios</a></h3>
<h4 id="geo-priority-replication_1"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#geo-priority-replication_1">Geo Priority Replication</a></h4>
<p><strong>Inicio de facturación</strong>: 1 de enero de 2026</p>
<ul>
<li>Cuentas existentes con feature habilitada</li>
<li>Cuentas nuevas que habiliten la feature</li>
</ul>
<p><strong>Coste</strong>: Por GB (consultar <a href="https://azure.microsoft.com/pricing/details/storage/">Azure Storage Pricing</a>)</p>
<h4 id="object-replication-priority_1"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#object-replication-priority_1">Object Replication Priority</a></h4>
<p><strong>Coste</strong>: Por GB de nuevo ingress</p>
<p><strong>Costes adicionales estándar</strong> (igual que OR normal):</p>
<ul>
<li>Transacciones de lectura (origen)</li>
<li>Transacciones de escritura (destino)</li>
<li>Network egress</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Facturación post-desactivación</p>
<p>Ambas features facturan durante <strong>30 días</strong> adicionales tras deshabilitarlas.</p>
</div>
<h3 id="casos-de-uso"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#casos-de-uso">Casos de uso</a></h3>
<h4 id="cumplimiento-normativo-estricto"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#cumplimiento-normativo-estricto">Cumplimiento normativo estricto</a></h4>
<p><strong>Escenario</strong>: Sector financiero/salud con regulaciones de RPO &lt; 15 minutos.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-57-1"><a href="#__codelineno-57-1" id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="c1"># Storage account para datos regulados</span>
</span><span id="__span-57-2"><a href="#__codelineno-57-2" id="__codelineno-57-2" name="__codelineno-57-2"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-57-3"><a href="#__codelineno-57-3" id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="w">  </span>--name<span class="w"> </span>stgcomplianceprod<span class="w"> </span><span class="se">\</span>
</span><span id="__span-57-4"><a href="#__codelineno-57-4" id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="w">  </span>--resource-group<span class="w"> </span>rg-compliance<span class="w"> </span><span class="se">\</span>
</span><span id="__span-57-5"><a href="#__codelineno-57-5" id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="w">  </span>--location<span class="w"> </span>westeurope<span class="w"> </span><span class="se">\</span>
</span><span id="__span-57-6"><a href="#__codelineno-57-6" id="__codelineno-57-6" name="__codelineno-57-6"></a><span class="w">  </span>--sku<span class="w"> </span>Standard_GZRS<span class="w"> </span><span class="se">\</span>
</span><span id="__span-57-7"><a href="#__codelineno-57-7" id="__codelineno-57-7" name="__codelineno-57-7"></a><span class="w">  </span>--enable-blob-geo-priority-replication<span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-57-8"><a href="#__codelineno-57-8" id="__codelineno-57-8" name="__codelineno-57-8"></a><span class="w">  </span>--tags<span class="w"> </span><span class="s2">"Compliance=Financial"</span><span class="w"> </span><span class="s2">"RPO=15min"</span>
</span></code></pre></div>
<p><strong>Validación</strong>:</p>
<ul>
<li>Monitorear Geo Blob Lag diariamente</li>
<li>Alertas si lag &gt; 10 minutos</li>
<li>Reportes mensuales de LST para auditorías</li>
</ul>
<h4 id="disaster-recovery-con-rtorpo-garantizados"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#disaster-recovery-con-rtorpo-garantizados">Disaster Recovery con RTO/RPO garantizados</a></h4>
<p><strong>Escenario</strong>: Aplicación crítica con SLA de DR &lt; 1 hora.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-58-1"><a href="#__codelineno-58-1" id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="c1"># Source: Producción (North Europe)</span>
</span><span id="__span-58-2"><a href="#__codelineno-58-2" id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="nv">SRC_ACCOUNT</span><span class="o">=</span><span class="s2">"stgappprodneu"</span>
</span><span id="__span-58-3"><a href="#__codelineno-58-3" id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="c1"># Destination: DR (West Europe)</span>
</span><span id="__span-58-4"><a href="#__codelineno-58-4" id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="nv">DST_ACCOUNT</span><span class="o">=</span><span class="s2">"stgappdrweu"</span>
</span><span id="__span-58-5"><a href="#__codelineno-58-5" id="__codelineno-58-5" name="__codelineno-58-5"></a>
</span><span id="__span-58-6"><a href="#__codelineno-58-6" id="__codelineno-58-6" name="__codelineno-58-6"></a><span class="c1"># Policy OR con Priority Replication</span>
</span><span id="__span-58-7"><a href="#__codelineno-58-7" id="__codelineno-58-7" name="__codelineno-58-7"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>or-policy<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-58-8"><a href="#__codelineno-58-8" id="__codelineno-58-8" name="__codelineno-58-8"></a><span class="w">  </span>--account-name<span class="w"> </span><span class="nv">$DST_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-58-9"><a href="#__codelineno-58-9" id="__codelineno-58-9" name="__codelineno-58-9"></a><span class="w">  </span>--source-account<span class="w"> </span><span class="nv">$SRC_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-58-10"><a href="#__codelineno-58-10" id="__codelineno-58-10" name="__codelineno-58-10"></a><span class="w">  </span>--destination-container<span class="w"> </span>app-data<span class="w"> </span><span class="se">\</span>
</span><span id="__span-58-11"><a href="#__codelineno-58-11" id="__codelineno-58-11" name="__codelineno-58-11"></a><span class="w">  </span>--source-container<span class="w"> </span>app-data<span class="w"> </span><span class="se">\</span>
</span><span id="__span-58-12"><a href="#__codelineno-58-12" id="__codelineno-58-12" name="__codelineno-58-12"></a><span class="w">  </span>--min-creation-time<span class="w"> </span><span class="s2">"2025-11-11T00:00:00Z"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-58-13"><a href="#__codelineno-58-13" id="__codelineno-58-13" name="__codelineno-58-13"></a><span class="w">  </span>--enable-metrics<span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-58-14"><a href="#__codelineno-58-14" id="__codelineno-58-14" name="__codelineno-58-14"></a><span class="w">  </span>--priority-replication<span class="w"> </span><span class="nb">true</span>
</span></code></pre></div>
<p><strong>Beneficio</strong>: Confianza en que datos están en DR site en ≤ 15 minutos.</p>
<h4 id="arquitectura-multi-region-con-ha"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#arquitectura-multi-region-con-ha">Arquitectura multi-región con HA</a></h4>
<p><strong>Escenario</strong>: Servicio global con réplicas en múltiples continentes.</p>
<pre class="mermaid"><code>graph LR
    A[Primary<br>West Europe<br>GRS+Priority] --&gt; B[Secondary<br>North Europe<br>Paired region]
    A --&gt; C[OR Priority<br>East US<br>Read replica]
    A --&gt; D[OR Priority<br>Southeast Asia<br>Read replica]

    style A fill:#0078d4,color:#fff
    style B fill:#50e6ff,color:#000
    style C fill:#50e6ff,color:#000
    style D fill:#50e6ff,color:#000
</code></pre>
<p><strong>Configuración</strong>:</p>
<ol>
<li><strong>Primary (West Europe)</strong>: GRS + Geo Priority Replication</li>
<li><strong>Secondary paired (North Europe)</strong>: Automático con GRS</li>
<li><strong>US replica</strong>: Object Replication Priority (mismo continente que origen - garantiza SLA)</li>
<li><strong>Asia replica</strong>: Object Replication normal (diferente continente - sin SLA)</li>
</ol>
<h4 id="sincronizacion-de-entornos-devtest"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#sincronizacion-de-entornos-devtest">Sincronización de entornos Dev/Test</a></h4>
<p><strong>Escenario</strong>: Copiar producción a staging con datos frescos.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-59-1"><a href="#__codelineno-59-1" id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="c"># Policy OR Priority: Prod → Staging</span>
</span><span id="__span-59-2"><a href="#__codelineno-59-2" id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="nv">$rule</span> <span class="p">=</span> <span class="nb">New-AzStorageObjectReplicationPolicyRule</span> <span class="p">`</span>
</span><span id="__span-59-3"><a href="#__codelineno-59-3" id="__codelineno-59-3" name="__codelineno-59-3"></a>  <span class="n">-SourceContainer</span> <span class="s2">"production-data"</span> <span class="p">`</span>
</span><span id="__span-59-4"><a href="#__codelineno-59-4" id="__codelineno-59-4" name="__codelineno-59-4"></a>  <span class="n">-DestinationContainer</span> <span class="s2">"staging-data"</span>
</span><span id="__span-59-5"><a href="#__codelineno-59-5" id="__codelineno-59-5" name="__codelineno-59-5"></a>
</span><span id="__span-59-6"><a href="#__codelineno-59-6" id="__codelineno-59-6" name="__codelineno-59-6"></a><span class="nv">$policy</span> <span class="p">=</span> <span class="nb">Set-AzStorageObjectReplicationPolicy</span> <span class="p">`</span>
</span><span id="__span-59-7"><a href="#__codelineno-59-7" id="__codelineno-59-7" name="__codelineno-59-7"></a>  <span class="n">-ResourceGroupName</span> <span class="s2">"rg-prod"</span> <span class="p">`</span>
</span><span id="__span-59-8"><a href="#__codelineno-59-8" id="__codelineno-59-8" name="__codelineno-59-8"></a>  <span class="n">-StorageAccountName</span> <span class="s2">"stgstaging"</span> <span class="p">`</span>
</span><span id="__span-59-9"><a href="#__codelineno-59-9" id="__codelineno-59-9" name="__codelineno-59-9"></a>  <span class="n">-PolicyId</span> <span class="k">default</span> <span class="p">`</span>
</span><span id="__span-59-10"><a href="#__codelineno-59-10" id="__codelineno-59-10" name="__codelineno-59-10"></a>  <span class="n">-SourceAccount</span> <span class="s2">"/subscriptions/{id}/resourceGroups/rg-prod/providers/Microsoft.Storage/storageAccounts/stgprod"</span> <span class="p">`</span>
</span><span id="__span-59-11"><a href="#__codelineno-59-11" id="__codelineno-59-11" name="__codelineno-59-11"></a>  <span class="n">-Rule</span> <span class="nv">$rule</span> <span class="p">`</span>
</span><span id="__span-59-12"><a href="#__codelineno-59-12" id="__codelineno-59-12" name="__codelineno-59-12"></a>  <span class="n">-EnableMetric</span> <span class="nv">$true</span> <span class="p">`</span>
</span><span id="__span-59-13"><a href="#__codelineno-59-13" id="__codelineno-59-13" name="__codelineno-59-13"></a>  <span class="n">-EnablePriorityReplication</span> <span class="nv">$true</span>
</span></code></pre></div>
<p><strong>Beneficio</strong>: Staging siempre con datos &lt; 15 minutos antiguos.</p>
<h3 id="arquitectura-recomendada"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#arquitectura-recomendada">Arquitectura recomendada</a></h3>
<h4 id="patron-geo-redundant-object-replication"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#patron-geo-redundant-object-replication">Patrón Geo-Redundant + Object Replication</a></h4>
<pre class="mermaid"><code>graph TB
    subgraph "Región Primaria: West Europe"
        A[Storage Account<br>GRS + Geo Priority]
        A1[Block Blobs<br>Producción]
        A --&gt; A1
    end

    subgraph "Paired Region: North Europe"
        B[Secondary Storage<br>Automático GRS]
        B1[Block Blobs<br>Replica GRS]
        B --&gt; B1
    end

    subgraph "Región DR: East US"
        C[Storage Account<br>OR Destination]
        C1[Replica<br>OR Priority]
        C --&gt; C1
    end

    subgraph "Región Analítica: West US"
        D[Storage Account<br>OR Destination]
        D1[Replica<br>OR Normal]
        D --&gt; D1
    end

    A1 --&gt;|Geo Replication<br>LST ≤ 15min SLA| B1
    A1 --&gt;|OR Priority<br>99% ≤ 15min| C1
    A1 --&gt;|OR Standard<br>Async| D1

    style A fill:#0078d4,color:#fff
    style B fill:#50e6ff,color:#000
    style C fill:#50e6ff,color:#000
    style D fill:#e6e6e6,color:#000
</code></pre>
<p><strong>Capas de protección</strong>:</p>
<ol>
<li><strong>Local redundancy</strong>: ZRS/LRS en región primaria</li>
<li><strong>Geo redundancy con SLA</strong>: Geo Priority Replication a paired region</li>
<li><strong>DR cross-region con SLA</strong>: OR Priority a región DR (mismo continente)</li>
<li><strong>Analítica/archive</strong>: OR estándar a región de análisis</li>
</ol>
<h3 id="buenas-practicas"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#buenas-practicas">Buenas prácticas</a></h3>
<h4 id="diseno-de-cuenta"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#diseno-de-cuenta">Diseño de cuenta</a></h4>
<ol>
<li><strong>Segregar por SLA</strong>:</li>
<li>Cuentas con Priority Replication: Solo Block Blobs</li>
<li>
<p>Cuentas con Page/Append Blobs: Sin Priority Replication</p>
</li>
<li>
<p><strong>Evitar exclusiones del SLA</strong>:</p>
</li>
<li>No habilitar Change Feed si no es necesario</li>
<li>No activar diagnostic logs a storage en cuenta con Priority Replication</li>
<li>
<p>Usar cuentas dedicadas para logs (sin Priority)</p>
</li>
<li>
<p><strong>Tagging para governance</strong>:</p>
</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-60-1"><a href="#__codelineno-60-1" id="__codelineno-60-1" name="__codelineno-60-1"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-60-2"><a href="#__codelineno-60-2" id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-60-3"><a href="#__codelineno-60-3" id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-60-4"><a href="#__codelineno-60-4" id="__codelineno-60-4" name="__codelineno-60-4"></a><span class="w">  </span>--tags<span class="w"> </span><span class="se">\</span>
</span><span id="__span-60-5"><a href="#__codelineno-60-5" id="__codelineno-60-5" name="__codelineno-60-5"></a><span class="w">    </span><span class="s2">"PriorityReplication=Enabled"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-60-6"><a href="#__codelineno-60-6" id="__codelineno-60-6" name="__codelineno-60-6"></a><span class="w">    </span><span class="s2">"SLA-RPO=15min"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-60-7"><a href="#__codelineno-60-7" id="__codelineno-60-7" name="__codelineno-60-7"></a><span class="w">    </span><span class="s2">"CostCenter=IT-Production"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-60-8"><a href="#__codelineno-60-8" id="__codelineno-60-8" name="__codelineno-60-8"></a><span class="w">    </span><span class="s2">"Compliance=Required"</span>
</span></code></pre></div>
<h4 id="monitoreo-proactivo"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#monitoreo-proactivo">Monitoreo proactivo</a></h4>
<p><strong>Alertas recomendadas</strong>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-61-1"><a href="#__codelineno-61-1" id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="c1"># Alert si Geo Blob Lag &gt; 10 minutos (margen de seguridad)</span>
</span><span id="__span-61-2"><a href="#__codelineno-61-2" id="__codelineno-61-2" name="__codelineno-61-2"></a>az<span class="w"> </span>monitor<span class="w"> </span>metrics<span class="w"> </span>alert<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-61-3"><a href="#__codelineno-61-3" id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="s2">"High-Geo-Lag-Alert"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-61-4"><a href="#__codelineno-61-4" id="__codelineno-61-4" name="__codelineno-61-4"></a><span class="w">  </span>--resource<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT_ID</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-61-5"><a href="#__codelineno-61-5" id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="w">  </span>--condition<span class="w"> </span><span class="s2">"avg GeoBlobLag &gt; 600"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-61-6"><a href="#__codelineno-61-6" id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="w">  </span>--window-size<span class="w"> </span>5m<span class="w"> </span><span class="se">\</span>
</span><span id="__span-61-7"><a href="#__codelineno-61-7" id="__codelineno-61-7" name="__codelineno-61-7"></a><span class="w">  </span>--evaluation-frequency<span class="w"> </span>1m<span class="w"> </span><span class="se">\</span>
</span><span id="__span-61-8"><a href="#__codelineno-61-8" id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="w">  </span>--action-group-id<span class="w"> </span><span class="nv">$ACTION_GROUP_ID</span>
</span></code></pre></div>
<p><strong>Dashboard de cumplimiento</strong>:</p>
<ul>
<li>Geo Blob Lag (hourly average)</li>
<li>OR pending operations por time bucket</li>
<li>Throughput vs 1 Gbps threshold</li>
<li>CopyBlob operations vs 100 ops/sec threshold</li>
</ul>
<h4 id="optimizacion-de-costes"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#optimizacion-de-costes">Optimización de costes</a></h4>
<ol>
<li><strong>Evaluar necesidad real de SLA</strong>:</li>
<li>Priority Replication: Workloads críticos con RPO estricto</li>
<li>
<p>GRS/OR estándar: Workloads tolerantes a lag &gt; 15 min</p>
</li>
<li>
<p><strong>Lifecycle management</strong>:</p>
</li>
</ol>
<div class="language-json highlight"><pre><span></span><code><span id="__span-62-1"><a href="#__codelineno-62-1" id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="p">{</span>
</span><span id="__span-62-2"><a href="#__codelineno-62-2" id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="w">  </span><span class="nt">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-62-3"><a href="#__codelineno-62-3" id="__codelineno-62-3" name="__codelineno-62-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-62-4"><a href="#__codelineno-62-4" id="__codelineno-62-4" name="__codelineno-62-4"></a><span class="w">      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tierToCool"</span><span class="p">,</span>
</span><span id="__span-62-5"><a href="#__codelineno-62-5" id="__codelineno-62-5" name="__codelineno-62-5"></a><span class="w">      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Lifecycle"</span><span class="p">,</span>
</span><span id="__span-62-6"><a href="#__codelineno-62-6" id="__codelineno-62-6" name="__codelineno-62-6"></a><span class="w">      </span><span class="nt">"definition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-7"><a href="#__codelineno-62-7" id="__codelineno-62-7" name="__codelineno-62-7"></a><span class="w">        </span><span class="nt">"filters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-8"><a href="#__codelineno-62-8" id="__codelineno-62-8" name="__codelineno-62-8"></a><span class="w">          </span><span class="nt">"blobTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"blockBlob"</span><span class="p">]</span>
</span><span id="__span-62-9"><a href="#__codelineno-62-9" id="__codelineno-62-9" name="__codelineno-62-9"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-62-10"><a href="#__codelineno-62-10" id="__codelineno-62-10" name="__codelineno-62-10"></a><span class="w">        </span><span class="nt">"actions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-11"><a href="#__codelineno-62-11" id="__codelineno-62-11" name="__codelineno-62-11"></a><span class="w">          </span><span class="nt">"baseBlob"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-12"><a href="#__codelineno-62-12" id="__codelineno-62-12" name="__codelineno-62-12"></a><span class="w">            </span><span class="nt">"tierToCool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-13"><a href="#__codelineno-62-13" id="__codelineno-62-13" name="__codelineno-62-13"></a><span class="w">              </span><span class="nt">"daysAfterModificationGreaterThan"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span>
</span><span id="__span-62-14"><a href="#__codelineno-62-14" id="__codelineno-62-14" name="__codelineno-62-14"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-62-15"><a href="#__codelineno-62-15" id="__codelineno-62-15" name="__codelineno-62-15"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-62-16"><a href="#__codelineno-62-16" id="__codelineno-62-16" name="__codelineno-62-16"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-62-17"><a href="#__codelineno-62-17" id="__codelineno-62-17" name="__codelineno-62-17"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-62-18"><a href="#__codelineno-62-18" id="__codelineno-62-18" name="__codelineno-62-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-62-19"><a href="#__codelineno-62-19" id="__codelineno-62-19" name="__codelineno-62-19"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-62-20"><a href="#__codelineno-62-20" id="__codelineno-62-20" name="__codelineno-62-20"></a><span class="p">}</span>
</span></code></pre></div>
<p>Datos en Cool tier siguen replicándose con Priority pero con menor coste de storage.</p>
<ol>
<li><strong>Revisar policies OR</strong>:</li>
<li>Una sola policy con Priority Replication por cuenta origen</li>
<li>Otras policies: OR estándar</li>
</ol>
<h4 id="seguridad"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#seguridad">Seguridad</a></h4>
<ol>
<li><strong>Network security</strong>:</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-63-1"><a href="#__codelineno-63-1" id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="c1"># Restringir acceso a VNETs</span>
</span><span id="__span-63-2"><a href="#__codelineno-63-2" id="__codelineno-63-2" name="__codelineno-63-2"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-3"><a href="#__codelineno-63-3" id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-4"><a href="#__codelineno-63-4" id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-5"><a href="#__codelineno-63-5" id="__codelineno-63-5" name="__codelineno-63-5"></a><span class="w">  </span>--default-action<span class="w"> </span>Deny
</span><span id="__span-63-6"><a href="#__codelineno-63-6" id="__codelineno-63-6" name="__codelineno-63-6"></a>
</span><span id="__span-63-7"><a href="#__codelineno-63-7" id="__codelineno-63-7" name="__codelineno-63-7"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>network-rule<span class="w"> </span>add<span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-8"><a href="#__codelineno-63-8" id="__codelineno-63-8" name="__codelineno-63-8"></a><span class="w">  </span>--account-name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-9"><a href="#__codelineno-63-9" id="__codelineno-63-9" name="__codelineno-63-9"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-10"><a href="#__codelineno-63-10" id="__codelineno-63-10" name="__codelineno-63-10"></a><span class="w">  </span>--vnet-name<span class="w"> </span>my-vnet<span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-11"><a href="#__codelineno-63-11" id="__codelineno-63-11" name="__codelineno-63-11"></a><span class="w">  </span>--subnet<span class="w"> </span>app-subnet
</span></code></pre></div>
<ol>
<li><strong>Encryption</strong>:</li>
<li>Customer-managed keys (CMK) para datos en reposo</li>
<li>
<p>HTTPS obligatorio para datos en tránsito</p>
</li>
<li>
<p><strong>RBAC granular</strong>:</p>
</li>
<li>Storage Blob Data Contributor: Apps que escriben</li>
<li>Storage Blob Data Reader: Apps DR que solo leen</li>
<li>Storage Account Contributor: Operadores que gestionan replicación</li>
</ol>
<h3 id="troubleshooting"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#troubleshooting">Troubleshooting</a></h3>
<h4 id="geo-blob-lag-15-minutos"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#geo-blob-lag-15-minutos">Geo Blob Lag &gt; 15 minutos</a></h4>
<p><strong>Diagnóstico</strong>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-64-1"><a href="#__codelineno-64-1" id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="c1"># Ver LST actual</span>
</span><span id="__span-64-2"><a href="#__codelineno-64-2" id="__codelineno-64-2" name="__codelineno-64-2"></a>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-64-3"><a href="#__codelineno-64-3" id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-64-4"><a href="#__codelineno-64-4" id="__codelineno-64-4" name="__codelineno-64-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-64-5"><a href="#__codelineno-64-5" id="__codelineno-64-5" name="__codelineno-64-5"></a><span class="w">  </span>--query<span class="w"> </span><span class="s2">"geoReplicationStats.lastSyncTime"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-64-6"><a href="#__codelineno-64-6" id="__codelineno-64-6" name="__codelineno-64-6"></a><span class="w">  </span>--output<span class="w"> </span>tsv
</span><span id="__span-64-7"><a href="#__codelineno-64-7" id="__codelineno-64-7" name="__codelineno-64-7"></a>
</span><span id="__span-64-8"><a href="#__codelineno-64-8" id="__codelineno-64-8" name="__codelineno-64-8"></a><span class="c1"># Comprobar throughput</span>
</span><span id="__span-64-9"><a href="#__codelineno-64-9" id="__codelineno-64-9" name="__codelineno-64-9"></a>az<span class="w"> </span>monitor<span class="w"> </span>metrics<span class="w"> </span>list<span class="w"> </span><span class="se">\</span>
</span><span id="__span-64-10"><a href="#__codelineno-64-10" id="__codelineno-64-10" name="__codelineno-64-10"></a><span class="w">  </span>--resource<span class="w"> </span><span class="nv">$STORAGE_ACCOUNT_ID</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-64-11"><a href="#__codelineno-64-11" id="__codelineno-64-11" name="__codelineno-64-11"></a><span class="w">  </span>--metric<span class="w"> </span><span class="s2">"Egress"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-64-12"><a href="#__codelineno-64-12" id="__codelineno-64-12" name="__codelineno-64-12"></a><span class="w">  </span>--start-time<span class="w"> </span><span class="k">$(</span>date<span class="w"> </span>-u<span class="w"> </span>-d<span class="w"> </span><span class="s1">'1 hour ago'</span><span class="w"> </span>+%Y-%m-%dT%H:%M:%SZ<span class="k">)</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-64-13"><a href="#__codelineno-64-13" id="__codelineno-64-13" name="__codelineno-64-13"></a><span class="w">  </span>--interval<span class="w"> </span>PT5M<span class="w"> </span><span class="se">\</span>
</span><span id="__span-64-14"><a href="#__codelineno-64-14" id="__codelineno-64-14" name="__codelineno-64-14"></a><span class="w">  </span>--aggregation<span class="w"> </span>Average
</span></code></pre></div>
<p><strong>Causas comunes</strong>:</p>
<ol>
<li><strong>Throughput &gt; 1 Gbps</strong>: Reducir ingress o escalar a múltiples cuentas</li>
<li><strong>CopyBlob &gt; 100 ops/sec</strong>: Distribuir copies en el tiempo</li>
<li><strong>Page/Append blobs</strong>: Revisar si hay features creando estos blobs inadvertidamente</li>
</ol>
<h4 id="or-metrics-no-aparecen"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#or-metrics-no-aparecen">OR metrics no aparecen</a></h4>
<p><strong>Validaciones</strong>:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-65-1"><a href="#__codelineno-65-1" id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="c"># Comprobar que metrics están habilitadas</span>
</span><span id="__span-65-2"><a href="#__codelineno-65-2" id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="nv">$policy</span> <span class="p">=</span> <span class="nb">Get-AzStorageObjectReplicationPolicy</span> <span class="p">`</span>
</span><span id="__span-65-3"><a href="#__codelineno-65-3" id="__codelineno-65-3" name="__codelineno-65-3"></a>  <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="p">`</span>
</span><span id="__span-65-4"><a href="#__codelineno-65-4" id="__codelineno-65-4" name="__codelineno-65-4"></a>  <span class="n">-StorageAccountName</span> <span class="nv">$srcAccountName</span> <span class="p">`</span>
</span><span id="__span-65-5"><a href="#__codelineno-65-5" id="__codelineno-65-5" name="__codelineno-65-5"></a>  <span class="n">-PolicyId</span> <span class="nv">$policyId</span>
</span><span id="__span-65-6"><a href="#__codelineno-65-6" id="__codelineno-65-6" name="__codelineno-65-6"></a>
</span><span id="__span-65-7"><a href="#__codelineno-65-7" id="__codelineno-65-7" name="__codelineno-65-7"></a><span class="nv">$policy</span><span class="p">.</span><span class="n">EnableMetrics</span>
</span><span id="__span-65-8"><a href="#__codelineno-65-8" id="__codelineno-65-8" name="__codelineno-65-8"></a><span class="nv">$policy</span><span class="p">.</span><span class="n">PriorityReplication</span><span class="p">.</span><span class="n">Enabled</span>
</span></code></pre></div>
<p><strong>Solución</strong>:</p>
<ul>
<li>Esperar 24 horas tras habilitar</li>
<li>Verificar que hay tráfico de replicación activo</li>
<li>Comprobar que policy está en estado <code>Enabled</code></li>
</ul>
<h4 id="sla-no-se-cumple"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#sla-no-se-cumple">SLA no se cumple</a></h4>
<p><strong>Checklist de elegibilidad</strong>:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></label> Solo Block Blobs (no Page/Append)</li>
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></label> Sin llamadas API Page/Append en últimos 30 días</li>
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></label> Throughput &lt; 1 Gbps</li>
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></label> CopyBlob &lt; 100 ops/sec</li>
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></label> LST ≤ 15 min al habilitar feature</li>
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></label> OR: Origen y destino en mismo continente</li>
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></label> OR: Objetos &lt; 5 GB</li>
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></label> OR: No más de 10 modificaciones/segundo por objeto</li>
</ul>
<p><strong>Validar con Azure Support</strong>:</p>
<p>Abrir caso incluyendo:</p>
<ul>
<li>Storage Account ID</li>
<li>Período de incumplimiento (fechas/horas)</li>
<li>Métricas de Geo Blob Lag o OR pending operations</li>
<li>Confirmación de elegibilidad (checklist anterior)</li>
</ul>
<h3 id="referencias"><a class="toclink" href="../../2025/11/11/azure-storage-priority-replication-replicaci%C3%B3n-acelerada-con-sla/#referencias">Referencias</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-redundancy-priority-replication">Geo Priority Replication - Official Docs</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/object-replication-priority-replication">Object Replication Priority - Official Docs</a></li>
<li><a href="https://www.microsoft.com/licensing/docs/view/Service-Level-Agreements-SLA-for-Online-Services">Azure Storage SLA Terms</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/object-replication-overview">Object Replication Overview</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/storage/common/last-sync-time-get">Monitor Last Sync Time</a></li>
<li><a href="https://azure.microsoft.com/pricing/details/storage/">Azure Storage Pricing</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/reliability/regions-list">Azure Regions List</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-10-26 00:00:00+00:00">October 26, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure Services</a></li>
<li class="md-meta__item">
            
              7 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-event-hubs-con-kafka-streaming-sin-gestionar-clusters"><a class="toclink" href="../../2025/10/26/azure-event-hubs-con-kafka-streaming-sin-gestionar-clusters/">Azure Event Hubs con Kafka: Streaming sin gestionar clusters</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/10/26/azure-event-hubs-con-kafka-streaming-sin-gestionar-clusters/#resumen">Resumen</a></h3>
<p>Azure Event Hubs soporta el protocolo Kafka de forma nativa. Puedes apuntar tus aplicaciones Kafka existentes al endpoint de Event Hubs cambiando solo el connection string. Sin gestionar Zookeeper, sin actualizar brokers, sin parches de seguridad. Totalmente gestionado con auto-inflate, geo-replication y 99.99% SLA.</p>
<nav class="md-post__action">
<a href="../../2025/10/26/azure-event-hubs-con-kafka-streaming-sin-gestionar-clusters/">
          Continue reading
        </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-10-25 00:00:00+00:00">October 25, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure Services</a></li>
<li class="md-meta__item">
            
              5 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-openai-service-con-rag-chatea-con-tus-propios-datos"><a class="toclink" href="../../2025/10/25/azure-openai-service-con-rag-chatea-con-tus-propios-datos/">Azure OpenAI Service con RAG: Chatea con tus propios datos</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/10/25/azure-openai-service-con-rag-chatea-con-tus-propios-datos/#resumen">Resumen</a></h3>
<p>Retrieval Augmented Generation (RAG) es el patrón que permite a modelos como GPT-4 responder preguntas basándose en tus datos corporativos. combinar Azure OpenAI con Azure AI Search te permite crear chatbots que conocen tu documentación, productos o políticas internas sin tener que reentrenar modelos.</p>
<nav class="md-post__action">
<a href="../../2025/10/25/azure-openai-service-con-rag-chatea-con-tus-propios-datos/">
          Continue reading
        </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-10-24 00:00:00+00:00">October 24, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure Services</a></li>
<li class="md-meta__item">
            
              7 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-virtual-network-manager-gestion-centralizada-de-redes"><a class="toclink" href="../../2025/10/24/azure-virtual-network-manager-gesti%C3%B3n-centralizada-de-redes/">Azure Virtual Network Manager: Gestión centralizada de redes</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/10/24/azure-virtual-network-manager-gesti%C3%B3n-centralizada-de-redes/#resumen">Resumen</a></h3>
<p>Azure Virtual Network Manager (AVNM) centraliza la gestión de conectividad y seguridad de cientos o miles de VNets desde un solo panel. Creas topologías hub-spoke o mesh con clicks, defines security admin rules que se evalúan <strong>antes</strong> que los NSGs, y despliegas cambios por regiones de forma controlada. Sin scripts custom, sin gestionar peerings manualmente.</p>
<nav class="md-post__action">
<a href="../../2025/10/24/azure-virtual-network-manager-gesti%C3%B3n-centralizada-de-redes/">
          Continue reading
        </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-10-24 00:00:00+00:00">October 24, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure Services</a></li>
<li class="md-meta__item">
            
              7 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-deployment-environments-self-service-para-desarrolladores"><a class="toclink" href="../../2025/10/24/azure-deployment-environments-self-service-para-desarrolladores/">Azure Deployment Environments: Self-service para desarrolladores</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/10/24/azure-deployment-environments-self-service-para-desarrolladores/#resumen">Resumen</a></h3>
<p>Azure Deployment Environments es el reemplazo de DevTest Labs, diseñado para que equipos de desarrollo creen entornos completos (App Service + Cosmos + Key Vault + Storage) desde un catálogo de plantillas IaC sin esperar a Platform Engineering. Dev Centers centralizan la gobernanza, Projects definen permisos, y developers despliegan con CLI/Portal. Zero acceso a subscriptions de producción.</p>
<nav class="md-post__action">
<a href="../../2025/10/24/azure-deployment-environments-self-service-para-desarrolladores/">
          Continue reading
        </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-10-23 00:00:00+00:00">October 23, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure Services</a></li>
<li class="md-meta__item">
            
              8 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-ai-foundry-tu-hub-unificado-para-ia-generativa-en-azure"><a class="toclink" href="../../2025/10/23/azure-ai-foundry-tu-hub-unificado-para-ia-generativa-en-azure/">Azure AI Foundry: tu hub unificado para IA generativa en Azure</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/10/23/azure-ai-foundry-tu-hub-unificado-para-ia-generativa-en-azure/#resumen">Resumen</a></h3>
<p><strong>Azure AI Foundry</strong> (antes Azure AI Studio) es la plataforma unificada de Microsoft para desarrollar, desplegar y gestionar aplicaciones de IA generativa. Con acceso a <strong>1900+ modelos</strong> (GPT-4o, o1, DeepSeek, Llama...), un entorno colaborativo tipo MLOps, y herramientas para RAG, evaluación y monitorización, todo en un portal integrado.</p>
<p>Si trabajas con Azure OpenAI, LangChain, o quieres construir copilots/agents, este es tu punto de partida.</p>
<nav class="md-post__action">
<a href="../../2025/10/23/azure-ai-foundry-tu-hub-unificado-para-ia-generativa-en-azure/">
          Continue reading
        </a>
</nav>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-10-22 00:00:00+00:00">October 22, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure Services</a></li>
<li class="md-meta__item">
            
              10 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-container-apps-en-2025-la-evolucion-del-serverless-para-contenedores"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/">Azure Container Apps en 2025: La Evolución del Serverless para Contenedores</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#resumen">Resumen</a></h3>
<p>Azure Container Apps ha evolucionado significativamente desde su lanzamiento en 2022. Este artículo actualizado explora las capacidades actuales del servicio, las novedades incorporadas en 2024-2025, y cómo se posiciona como la solución ideal para ejecutar aplicaciones nativas de la nube sin la complejidad de gestionar Kubernetes directamente.</p>
<h3 id="tldr"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#tldr">TL;DR</a></h3>
<ul>
<li>Azure Container Apps es un servicio serverless que ejecuta contenedores sin gestionar infraestructura, construido sobre Kubernetes, KEDA, Dapr y Envoy</li>
<li>Novedades 2024-2025: GPUs serverless, Dynamic Sessions, Azure Functions integradas, workload profiles dedicados con GPUs A100/T4</li>
<li>Casos de uso: microservicios, APIs, procesamiento de eventos, cargas AI/ML, aplicaciones con IA generativa</li>
<li>Escalado automático (incluso a cero), revisiones, traffic splitting, integración nativa con servicios Azure</li>
</ul>
<h3 id="el-problema-que-resuelve"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#el-problema-que-resuelve">El Problema que Resuelve</a></h3>
<blockquote>
<p><strong>«Necesito ejecutar aplicaciones Cloud Native en contenedores, pero no quiero la complejidad operativa de Kubernetes, OpenShift, etc.»</strong></p>
</blockquote>
<p>Esta es una necesidad recurrente en equipos de desarrollo que quieren aprovechar las ventajas de los contenedores y arquitecturas de microservicios sin dedicar recursos a:</p>
<ul>
<li>Configurar y mantener clusters de Kubernetes</li>
<li>Gestionar nodos, redes, almacenamiento</li>
<li>Administrar actualizaciones y parches del orquestador</li>
<li>Implementar observabilidad y monitorización avanzada desde cero</li>
</ul>
<h3 id="azure-container-apps-la-solucion-serverless"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#azure-container-apps-la-solucion-serverless">Azure Container Apps: La Solución Serverless</a></h3>
<p>Azure Container Apps es un <strong>servicio gestionado serverless</strong> que permite ejecutar contenedores sin preocuparse por la infraestructura subyacente. Lanzado inicialmente en 2022 y con mejoras continuas, se ha convertido en una opción madura para desplegar aplicaciones modernas.</p>
<h4 id="arquitectura-subyacente"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#arquitectura-subyacente">Arquitectura Subyacente</a></h4>
<p>Aunque no gestionas directamente Kubernetes, bajo el telón Azure Container Apps funciona sobre:</p>
<ul>
<li><strong>Azure Kubernetes Service (AKS)</strong>: proporciona el orquestador</li>
<li><strong>KEDA</strong> (Kubernetes Event Driven Autoscaling): escalado basado en eventos</li>
<li><strong>Dapr</strong> (Distributed Application Runtime): integración nativa para microservicios</li>
<li><strong>Envoy</strong>: proxy para enrutamiento y observabilidad</li>
</ul>
<pre class="mermaid"><code>flowchart TB
  subgraph Internet["Internet / Usuarios"]
    USER["Cliente HTTP/API"]
  end

  subgraph ACA["Azure Container Apps Environment"]
    INGRESS["Ingress (Envoy)"]
    APP1["Container App 1"]
    APP2["Container App 2"]
    APP3["Container App 3"]
    DAPR["Dapr Sidecar"]
    KEDA["KEDA Scaler"]
  end

  subgraph Backend["Servicios Backend"]
    STORAGE["Azure Storage"]
    COSMOSDB["Cosmos DB"]
    SERVICEBUS["Service Bus"]
  end

  USER --&gt; INGRESS
  INGRESS --&gt; APP1
  INGRESS --&gt; APP2
  INGRESS --&gt; APP3
  APP1 --&gt; DAPR
  APP2 --&gt; DAPR
  DAPR --&gt; STORAGE
  DAPR --&gt; COSMOSDB
  SERVICEBUS --&gt; KEDA
  KEDA --&gt; APP3
</code></pre>
<h4 id="caracteristicas-distintivas"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#caracteristicas-distintivas">Características Distintivas</a></h4>
<p>Azure Container Apps se diferencia de otras soluciones de contenedores en Azure por:</p>
<ol>
<li>
<p><strong>Optimización para microservicios</strong>: diseñado específicamente para aplicaciones que abarcan múltiples contenedores desplegados como servicios independientes</p>
</li>
<li>
<p><strong>Tecnologías open-source integradas</strong>:</p>
</li>
<li><a href="https://dapr.io/">Dapr</a>: service-to-service invocation, pub/sub, state management</li>
<li><a href="https://keda.sh/">KEDA</a>: escalado basado en eventos y métricas</li>
<li>
<p><a href="https://www.envoyproxy.io/">Envoy</a>: balanceo de carga y observabilidad</p>
</li>
<li>
<p><strong>Arquitecturas event-driven</strong>: escalado basado en:</p>
</li>
<li>Tráfico HTTP</li>
<li>Mensajes en colas (Service Bus, Storage Queues, Event Hubs)</li>
<li>Métricas personalizadas</li>
<li>
<p><strong>Escalado a cero</strong> para reducir costes</p>
</li>
<li>
<p><strong>Soporte para cargas de larga duración</strong>: procesos background, jobs y tareas programadas</p>
</li>
</ol>
<h3 id="novedades-2024-2025-lo-que-ha-cambiado"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#novedades-2024-2025-lo-que-ha-cambiado">Novedades 2024-2025: Lo que ha Cambiado</a></h3>
<p>Desde el post original de 2022, Azure Container Apps ha incorporado capacidades empresariales significativas:</p>
<h4 id="1-gpus-serverless-y-dedicadas-2024"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#1-gpus-serverless-y-dedicadas-2024">1. GPUs Serverless y Dedicadas (2024)</a></h4>
<p><strong>Serverless GPUs</strong> disponibles en regiones West US 3, Australia East y Sweden Central:</p>
<ul>
<li><strong>NVIDIA T4</strong>: coste-efectivas para inferencia de modelos pequeños (&lt;10GB)</li>
<li><strong>NVIDIA A100</strong>: para modelos grandes (&gt;10GB), training, y cargas computacionales intensivas</li>
</ul>
<p><strong>Dedicated GPU workload profiles</strong>:</p>
<ul>
<li>Perfiles NC24-A100, NC48-A100, NC96-A100</li>
<li>Aislamiento garantizado con hardware dedicado</li>
<li>Ideal para cargas de IA/ML continuas con baja latencia</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># Ejemplo: Crear environment con GPU serverless</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>az<span class="w"> </span>containerapp<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">  </span>--name<span class="w"> </span>my-gpu-environment<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">  </span>--resource-group<span class="w"> </span>my-rg<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span>--location<span class="w"> </span>westus3<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">  </span>--enable-workload-profiles
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a>
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="c1"># Desplegar app con GPU T4</span>
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a>az<span class="w"> </span>containerapp<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-10"><a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">  </span>--name<span class="w"> </span>my-ai-app<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-11"><a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">  </span>--resource-group<span class="w"> </span>my-rg<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-12"><a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">  </span>--environment<span class="w"> </span>my-gpu-environment<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-13"><a href="#__codelineno-16-13" id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">  </span>--image<span class="w"> </span>myregistry.azurecr.io/ml-inference:latest<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-14"><a href="#__codelineno-16-14" id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="w">  </span>--cpu<span class="w"> </span><span class="m">8</span><span class="w"> </span>--memory<span class="w"> </span>56Gi<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-15"><a href="#__codelineno-16-15" id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w">  </span>--workload-profile-name<span class="w"> </span>Consumption-GPU-NC8as-T4<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-16"><a href="#__codelineno-16-16" id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="w">  </span>--target-port<span class="w"> </span><span class="m">8080</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-17"><a href="#__codelineno-16-17" id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="w">  </span>--ingress<span class="w"> </span>external
</span></code></pre></div>
<h4 id="2-dynamic-sessions-preview-2024"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#2-dynamic-sessions-preview-2024">2. Dynamic Sessions (Preview - 2024)</a></h4>
<p>Ejecución segura y aislada de código generado por IA, ideal para:</p>
<ul>
<li>Sandboxing de código no confiable</li>
<li>Evaluación de código generado por LLMs</li>
<li>Agentes de IA que ejecutan código dinámicamente</li>
</ul>
<p>Características:</p>
<ul>
<li>Aislamiento completo mediante Hyper-V</li>
<li>Contenedores gestionados (Python, Node.js) o personalizados</li>
<li>Escalado rápido y efímero</li>
</ul>
<h4 id="3-azure-functions-en-container-apps-ga-2024"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#3-azure-functions-en-container-apps-ga-2024">3. Azure Functions en Container Apps (GA - 2024)</a></h4>
<p>Despliegue de Azure Functions como contenedores dentro de Container Apps:</p>
<ul>
<li>Todos los triggers de Functions disponibles</li>
<li>Escalado basado en KEDA</li>
<li>Compartir infraestructura con microservicios y APIs</li>
<li><strong>Soporte para GPUs</strong> en funciones compute-intensive</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># Crear Function App optimizada para Container Apps</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>az<span class="w"> </span>containerapp<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">  </span>--name<span class="w"> </span>my-function-app<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">  </span>--resource-group<span class="w"> </span>my-rg<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">  </span>--environment<span class="w"> </span>my-environment<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">  </span>--image<span class="w"> </span>myregistry.azurecr.io/my-functions:latest<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">  </span>--kind<span class="w"> </span>functionapp<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">  </span>--ingress<span class="w"> </span>external<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-9"><a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">  </span>--target-port<span class="w"> </span><span class="m">80</span>
</span></code></pre></div>
<h4 id="4-workload-profiles-mejorados"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#4-workload-profiles-mejorados">4. Workload Profiles Mejorados</a></h4>
<p><strong>Consumption Profile</strong> (por defecto):</p>
<ul>
<li>Escalado automático</li>
<li>Pago solo por uso activo</li>
<li>Hasta 4 vCPU / 8 GiB memoria por réplica</li>
</ul>
<p><strong>Dedicated Profiles</strong> (opcionales):</p>
<ul>
<li>General purpose (D4, D8, D16, D32)</li>
<li>Memory optimized (E4, E8, E16, E32)</li>
<li>GPU enabled (NC24-A100, NC48-A100, NC96-A100)</li>
</ul>
<h4 id="5-networking-y-seguridad-avanzada"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#5-networking-y-seguridad-avanzada">5. Networking y Seguridad Avanzada</a></h4>
<ul>
<li><strong>Private Endpoints</strong>: acceso privado sin exposición pública</li>
<li><strong>User Defined Routes (UDR)</strong>: control total del tráfico de salida</li>
<li><strong>NAT Gateway integration</strong>: simplifica conectividad saliente</li>
<li><strong>Azure Front Door integration</strong>: CDN y WAF con Private Link</li>
<li><strong>Client certificate authentication (mTLS)</strong>: autenticación mutua TLS</li>
</ul>
<h4 id="6-certificados-gestionados-y-key-vault-ga-2024"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#6-certificados-gestionados-y-key-vault-ga-2024">6. Certificados Gestionados y Key Vault (GA - 2024)</a></h4>
<ul>
<li>Certificados TLS gratuitos gestionados automáticamente</li>
<li>Integración con Azure Key Vault para certificados personalizados</li>
<li>Renovación automática</li>
</ul>
<h4 id="7-componentes-java-gestionados-preview-2024"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#7-componentes-java-gestionados-preview-2024">7. Componentes Java Gestionados (Preview - 2024)</a></h4>
<p>Para aplicaciones Spring:</p>
<ul>
<li><strong>Eureka Server</strong>: service discovery gestionado</li>
<li><strong>Config Server</strong>: configuración centralizada</li>
<li><strong>Tomcat support</strong>: despliegue directo desde código</li>
<li><strong>JVM memory fit</strong>: configuración automática de memoria JVM</li>
</ul>
<h4 id="8-observabilidad-mejorada"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#8-observabilidad-mejorada">8. Observabilidad Mejorada</a></h4>
<ul>
<li><strong>OpenTelemetry Agent</strong> (Preview): exportación de métricas, logs y traces sin configurar colector</li>
<li><strong>Aspire Dashboard</strong> (Preview): dashboard interactivo para aplicaciones .NET</li>
<li><strong>Java metrics</strong>: métricas de garbage collection, memoria, threads</li>
<li>Integración completa con Azure Monitor y Application Insights</li>
</ul>
<h3 id="comparativa-cuando-usar-container-apps"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#comparativa-cuando-usar-container-apps">Comparativa: ¿Cuándo Usar Container Apps?</a></h3>
<table>
<thead>
<tr>
<th>Servicio</th>
<th>Caso de Uso Ideal</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Azure Container Apps</strong></td>
<td>Microservicios, APIs, event-driven apps, cargas AI/ML serverless, aplicaciones con escalado a cero</td>
</tr>
<tr>
<td><strong>Azure Kubernetes Service (AKS)</strong></td>
<td>Control total de Kubernetes API, workloads complejos con requisitos específicos de K8s</td>
</tr>
<tr>
<td><strong>Azure Red Hat OpenShift</strong></td>
<td>Despliegue OpenShift gestionado, migración desde on-premises OpenShift</td>
</tr>
<tr>
<td><strong>Azure Functions</strong></td>
<td>Funciones FaaS puras, integraciones rápidas con triggers Azure, sin contenedores</td>
</tr>
<tr>
<td><strong>Web App for Containers</strong></td>
<td>Aplicaciones web en contenedores Windows/Linux, migración lift-and-shift</td>
</tr>
<tr>
<td><strong>Container Instances</strong></td>
<td>Contenedores de corta duración, batch jobs simples, aislamiento por hipervisor</td>
</tr>
<tr>
<td><strong>Service Fabric</strong></td>
<td>Aplicaciones distribuidas legacy, necesidad de reliable services/actors</td>
</tr>
<tr>
<td><strong>Container Registry</strong></td>
<td>Almacenamiento, gestión y replicación de imágenes de contenedor</td>
</tr>
</tbody>
</table>
<h4 id="diagrama-de-decision-simplificado"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#diagrama-de-decision-simplificado">Diagrama de Decisión Simplificado</a></h4>
<pre class="mermaid"><code>flowchart TD
  START["¿Necesitas ejecutar contenedores?"]
  START --&gt; K8S_API{"¿Necesitas acceso directo a Kubernetes API?"}

  K8S_API --&gt;|Sí| AKS["Azure Kubernetes Service (AKS)"]
  K8S_API --&gt;|No| SERVERLESS{"¿Prefieres serverless con escalado a cero?"}

  SERVERLESS --&gt;|Sí| MICROSERVICES{"¿Es una arquitectura de microservicios / API?"}
  SERVERLESS --&gt;|No| DEDICATED{"¿Necesitas hardware dedicado/GPU?"}

  MICROSERVICES --&gt;|Sí| ACA["✅ Azure Container Apps"]
  MICROSERVICES --&gt;|No| FUNCTIONS{"¿Solo funciones event-driven?"}

  FUNCTIONS --&gt;|Sí| AZFUNC["Azure Functions"]
  FUNCTIONS --&gt;|No| ACA2["✅ Azure Container Apps"]

  DEDICATED --&gt;|Sí| ACA_DEDICATED["✅ Azure Container Apps<br>(Dedicated Workload Profiles)"]
  DEDICATED --&gt;|No| WEBAPP["Web App for Containers"]
</code></pre>
<h3 id="casos-de-uso-practicos"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#casos-de-uso-practicos">Casos de Uso Prácticos</a></h3>
<h4 id="1-aplicacion-de-ia-generativa-con-rag"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#1-aplicacion-de-ia-generativa-con-rag">1. Aplicación de IA Generativa con RAG</a></h4>
<p>Implementar un chatbot con Retrieval Augmented Generation:</p>
<ul>
<li><strong>Frontend</strong>: contenedor React/Vue en Container App con ingress externo</li>
<li><strong>API Gateway</strong>: contenedor .NET/Java con autenticación Entra ID</li>
<li><strong>RAG Service</strong>: contenedor Python con GPU T4 para embeddings y inference</li>
<li><strong>Vector Store</strong>: Cosmos DB con búsqueda vectorial</li>
<li>Escalado basado en peticiones HTTP, escala a cero en inactividad</li>
</ul>
<h4 id="2-procesamiento-de-eventos-iot"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#2-procesamiento-de-eventos-iot">2. Procesamiento de Eventos IoT</a></h4>
<p>Pipeline de procesamiento de telemetría:</p>
<ul>
<li><strong>Ingestion</strong>: Container App escalando con Event Hubs (KEDA scaler)</li>
<li><strong>Processing</strong>: múltiples Container Apps para transformación, enriquecimiento</li>
<li><strong>Storage</strong>: escritura en Azure Storage / Cosmos DB mediante Dapr</li>
<li>Escalado automático según volumen de mensajes</li>
</ul>
<h4 id="3-microservicios-con-dapr"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#3-microservicios-con-dapr">3. Microservicios con Dapr</a></h4>
<p>Arquitectura de e-commerce:</p>
<ul>
<li><strong>Catalog Service</strong>: gestión de productos</li>
<li><strong>Order Service</strong>: procesamiento de pedidos</li>
<li><strong>Inventory Service</strong>: control de stock</li>
<li><strong>Payment Service</strong>: integración con pasarelas de pago</li>
</ul>
<p>Comunicación via Dapr service invocation, state management en Redis/Cosmos DB, pub/sub con Service Bus.</p>
<h4 id="4-jobs-programados-y-batch-processing"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#4-jobs-programados-y-batch-processing">4. Jobs Programados y Batch Processing</a></h4>
<ul>
<li><strong>Jobs</strong> en Container Apps para tareas programadas (cron)</li>
<li>Procesamiento de archivos cargados en Storage</li>
<li>Generación de informes nocturnos</li>
<li>Limpieza de datos y mantenimiento</li>
</ul>
<h3 id="despliegue-ejemplos-practicos"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#despliegue-ejemplos-practicos">Despliegue: Ejemplos Prácticos</a></h3>
<h4 id="despliegue-rapido-con-azure-cli"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#despliegue-rapido-con-azure-cli">Despliegue Rápido con Azure CLI</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1"># Variables</span>
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="nv">RESOURCE_GROUP</span><span class="o">=</span><span class="s2">"my-container-apps-rg"</span>
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="nv">LOCATION</span><span class="o">=</span><span class="s2">"westeurope"</span>
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="nv">ENVIRONMENT</span><span class="o">=</span><span class="s2">"my-environment"</span>
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="nv">APP_NAME</span><span class="o">=</span><span class="s2">"my-api"</span>
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a>
</span><span id="__span-18-7"><a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="c1"># Crear resource group</span>
</span><span id="__span-18-8"><a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a>az<span class="w"> </span>group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span>--location<span class="w"> </span><span class="nv">$LOCATION</span>
</span><span id="__span-18-9"><a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a>
</span><span id="__span-18-10"><a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="c1"># Crear environment</span>
</span><span id="__span-18-11"><a href="#__codelineno-18-11" id="__codelineno-18-11" name="__codelineno-18-11"></a>az<span class="w"> </span>containerapp<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-12"><a href="#__codelineno-18-12" id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$ENVIRONMENT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-13"><a href="#__codelineno-18-13" id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-14"><a href="#__codelineno-18-14" id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span>
</span><span id="__span-18-15"><a href="#__codelineno-18-15" id="__codelineno-18-15" name="__codelineno-18-15"></a>
</span><span id="__span-18-16"><a href="#__codelineno-18-16" id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="c1"># Desplegar desde imagen pública</span>
</span><span id="__span-18-17"><a href="#__codelineno-18-17" id="__codelineno-18-17" name="__codelineno-18-17"></a>az<span class="w"> </span>containerapp<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-18"><a href="#__codelineno-18-18" id="__codelineno-18-18" name="__codelineno-18-18"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-19"><a href="#__codelineno-18-19" id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-20"><a href="#__codelineno-18-20" id="__codelineno-18-20" name="__codelineno-18-20"></a><span class="w">  </span>--environment<span class="w"> </span><span class="nv">$ENVIRONMENT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-21"><a href="#__codelineno-18-21" id="__codelineno-18-21" name="__codelineno-18-21"></a><span class="w">  </span>--image<span class="w"> </span>mcr.microsoft.com/k8se/quickstart:latest<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-22"><a href="#__codelineno-18-22" id="__codelineno-18-22" name="__codelineno-18-22"></a><span class="w">  </span>--target-port<span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-23"><a href="#__codelineno-18-23" id="__codelineno-18-23" name="__codelineno-18-23"></a><span class="w">  </span>--ingress<span class="w"> </span>external<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-24"><a href="#__codelineno-18-24" id="__codelineno-18-24" name="__codelineno-18-24"></a><span class="w">  </span>--min-replicas<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-25"><a href="#__codelineno-18-25" id="__codelineno-18-25" name="__codelineno-18-25"></a><span class="w">  </span>--max-replicas<span class="w"> </span><span class="m">10</span>
</span></code></pre></div>
<h4 id="despliegue-con-bicep"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#despliegue-con-bicep">Despliegue con Bicep</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a>param location string = resourceGroup().location
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>param environmentName string = 'my-environment'
</span><span id="__span-19-3"><a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a>param containerAppName string = 'my-api'
</span><span id="__span-19-4"><a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a>param containerImage string = 'mcr.microsoft.com/k8se/quickstart:latest'
</span><span id="__span-19-5"><a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a>
</span><span id="__span-19-6"><a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a>resource environment 'Microsoft.App/managedEnvironments@2023-05-01' = {
</span><span id="__span-19-7"><a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a>  name: environmentName
</span><span id="__span-19-8"><a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a>  location: location
</span><span id="__span-19-9"><a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a>  properties: {
</span><span id="__span-19-10"><a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a>    appLogsConfiguration: {
</span><span id="__span-19-11"><a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a>      destination: 'log-analytics'
</span><span id="__span-19-12"><a href="#__codelineno-19-12" id="__codelineno-19-12" name="__codelineno-19-12"></a>      logAnalyticsConfiguration: {
</span><span id="__span-19-13"><a href="#__codelineno-19-13" id="__codelineno-19-13" name="__codelineno-19-13"></a>        customerId: logAnalytics.properties.customerId
</span><span id="__span-19-14"><a href="#__codelineno-19-14" id="__codelineno-19-14" name="__codelineno-19-14"></a>        sharedKey: logAnalytics.listKeys().primarySharedKey
</span><span id="__span-19-15"><a href="#__codelineno-19-15" id="__codelineno-19-15" name="__codelineno-19-15"></a>      }
</span><span id="__span-19-16"><a href="#__codelineno-19-16" id="__codelineno-19-16" name="__codelineno-19-16"></a>    }
</span><span id="__span-19-17"><a href="#__codelineno-19-17" id="__codelineno-19-17" name="__codelineno-19-17"></a>  }
</span><span id="__span-19-18"><a href="#__codelineno-19-18" id="__codelineno-19-18" name="__codelineno-19-18"></a>}
</span><span id="__span-19-19"><a href="#__codelineno-19-19" id="__codelineno-19-19" name="__codelineno-19-19"></a>
</span><span id="__span-19-20"><a href="#__codelineno-19-20" id="__codelineno-19-20" name="__codelineno-19-20"></a>resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {
</span><span id="__span-19-21"><a href="#__codelineno-19-21" id="__codelineno-19-21" name="__codelineno-19-21"></a>  name: containerAppName
</span><span id="__span-19-22"><a href="#__codelineno-19-22" id="__codelineno-19-22" name="__codelineno-19-22"></a>  location: location
</span><span id="__span-19-23"><a href="#__codelineno-19-23" id="__codelineno-19-23" name="__codelineno-19-23"></a>  properties: {
</span><span id="__span-19-24"><a href="#__codelineno-19-24" id="__codelineno-19-24" name="__codelineno-19-24"></a>    managedEnvironmentId: environment.id
</span><span id="__span-19-25"><a href="#__codelineno-19-25" id="__codelineno-19-25" name="__codelineno-19-25"></a>    configuration: {
</span><span id="__span-19-26"><a href="#__codelineno-19-26" id="__codelineno-19-26" name="__codelineno-19-26"></a>      ingress: {
</span><span id="__span-19-27"><a href="#__codelineno-19-27" id="__codelineno-19-27" name="__codelineno-19-27"></a>        external: true
</span><span id="__span-19-28"><a href="#__codelineno-19-28" id="__codelineno-19-28" name="__codelineno-19-28"></a>        targetPort: 80
</span><span id="__span-19-29"><a href="#__codelineno-19-29" id="__codelineno-19-29" name="__codelineno-19-29"></a>        transport: 'auto'
</span><span id="__span-19-30"><a href="#__codelineno-19-30" id="__codelineno-19-30" name="__codelineno-19-30"></a>      }
</span><span id="__span-19-31"><a href="#__codelineno-19-31" id="__codelineno-19-31" name="__codelineno-19-31"></a>    }
</span><span id="__span-19-32"><a href="#__codelineno-19-32" id="__codelineno-19-32" name="__codelineno-19-32"></a>    template: {
</span><span id="__span-19-33"><a href="#__codelineno-19-33" id="__codelineno-19-33" name="__codelineno-19-33"></a>      containers: [
</span><span id="__span-19-34"><a href="#__codelineno-19-34" id="__codelineno-19-34" name="__codelineno-19-34"></a>        {
</span><span id="__span-19-35"><a href="#__codelineno-19-35" id="__codelineno-19-35" name="__codelineno-19-35"></a>          name: 'main'
</span><span id="__span-19-36"><a href="#__codelineno-19-36" id="__codelineno-19-36" name="__codelineno-19-36"></a>          image: containerImage
</span><span id="__span-19-37"><a href="#__codelineno-19-37" id="__codelineno-19-37" name="__codelineno-19-37"></a>          resources: {
</span><span id="__span-19-38"><a href="#__codelineno-19-38" id="__codelineno-19-38" name="__codelineno-19-38"></a>            cpu: json('0.5')
</span><span id="__span-19-39"><a href="#__codelineno-19-39" id="__codelineno-19-39" name="__codelineno-19-39"></a>            memory: '1Gi'
</span><span id="__span-19-40"><a href="#__codelineno-19-40" id="__codelineno-19-40" name="__codelineno-19-40"></a>          }
</span><span id="__span-19-41"><a href="#__codelineno-19-41" id="__codelineno-19-41" name="__codelineno-19-41"></a>        }
</span><span id="__span-19-42"><a href="#__codelineno-19-42" id="__codelineno-19-42" name="__codelineno-19-42"></a>      ]
</span><span id="__span-19-43"><a href="#__codelineno-19-43" id="__codelineno-19-43" name="__codelineno-19-43"></a>      scale: {
</span><span id="__span-19-44"><a href="#__codelineno-19-44" id="__codelineno-19-44" name="__codelineno-19-44"></a>        minReplicas: 0
</span><span id="__span-19-45"><a href="#__codelineno-19-45" id="__codelineno-19-45" name="__codelineno-19-45"></a>        maxReplicas: 10
</span><span id="__span-19-46"><a href="#__codelineno-19-46" id="__codelineno-19-46" name="__codelineno-19-46"></a>        rules: [
</span><span id="__span-19-47"><a href="#__codelineno-19-47" id="__codelineno-19-47" name="__codelineno-19-47"></a>          {
</span><span id="__span-19-48"><a href="#__codelineno-19-48" id="__codelineno-19-48" name="__codelineno-19-48"></a>            name: 'http-rule'
</span><span id="__span-19-49"><a href="#__codelineno-19-49" id="__codelineno-19-49" name="__codelineno-19-49"></a>            http: {
</span><span id="__span-19-50"><a href="#__codelineno-19-50" id="__codelineno-19-50" name="__codelineno-19-50"></a>              metadata: {
</span><span id="__span-19-51"><a href="#__codelineno-19-51" id="__codelineno-19-51" name="__codelineno-19-51"></a>                concurrentRequests: '100'
</span><span id="__span-19-52"><a href="#__codelineno-19-52" id="__codelineno-19-52" name="__codelineno-19-52"></a>              }
</span><span id="__span-19-53"><a href="#__codelineno-19-53" id="__codelineno-19-53" name="__codelineno-19-53"></a>            }
</span><span id="__span-19-54"><a href="#__codelineno-19-54" id="__codelineno-19-54" name="__codelineno-19-54"></a>          }
</span><span id="__span-19-55"><a href="#__codelineno-19-55" id="__codelineno-19-55" name="__codelineno-19-55"></a>        ]
</span><span id="__span-19-56"><a href="#__codelineno-19-56" id="__codelineno-19-56" name="__codelineno-19-56"></a>      }
</span><span id="__span-19-57"><a href="#__codelineno-19-57" id="__codelineno-19-57" name="__codelineno-19-57"></a>    }
</span><span id="__span-19-58"><a href="#__codelineno-19-58" id="__codelineno-19-58" name="__codelineno-19-58"></a>  }
</span><span id="__span-19-59"><a href="#__codelineno-19-59" id="__codelineno-19-59" name="__codelineno-19-59"></a>}
</span><span id="__span-19-60"><a href="#__codelineno-19-60" id="__codelineno-19-60" name="__codelineno-19-60"></a>
</span><span id="__span-19-61"><a href="#__codelineno-19-61" id="__codelineno-19-61" name="__codelineno-19-61"></a>resource logAnalytics 'Microsoft.OperationalInsights/workspaces@2022-10-01' = {
</span><span id="__span-19-62"><a href="#__codelineno-19-62" id="__codelineno-19-62" name="__codelineno-19-62"></a>  name: '${environmentName}-logs'
</span><span id="__span-19-63"><a href="#__codelineno-19-63" id="__codelineno-19-63" name="__codelineno-19-63"></a>  location: location
</span><span id="__span-19-64"><a href="#__codelineno-19-64" id="__codelineno-19-64" name="__codelineno-19-64"></a>  properties: {
</span><span id="__span-19-65"><a href="#__codelineno-19-65" id="__codelineno-19-65" name="__codelineno-19-65"></a>    sku: {
</span><span id="__span-19-66"><a href="#__codelineno-19-66" id="__codelineno-19-66" name="__codelineno-19-66"></a>      name: 'PerGB2018'
</span><span id="__span-19-67"><a href="#__codelineno-19-67" id="__codelineno-19-67" name="__codelineno-19-67"></a>    }
</span><span id="__span-19-68"><a href="#__codelineno-19-68" id="__codelineno-19-68" name="__codelineno-19-68"></a>  }
</span><span id="__span-19-69"><a href="#__codelineno-19-69" id="__codelineno-19-69" name="__codelineno-19-69"></a>}
</span></code></pre></div>
<h4 id="despliegue-con-dapr-habilitado"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#despliegue-con-dapr-habilitado">Despliegue con Dapr Habilitado</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># Crear app con Dapr</span>
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a>az<span class="w"> </span>containerapp<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">  </span>--name<span class="w"> </span>order-service<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-4"><a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-5"><a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="w">  </span>--environment<span class="w"> </span><span class="nv">$ENVIRONMENT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-6"><a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">  </span>--image<span class="w"> </span>myregistry.azurecr.io/order-service:v1<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-7"><a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="w">  </span>--target-port<span class="w"> </span><span class="m">3000</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-8"><a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w">  </span>--ingress<span class="w"> </span>internal<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-9"><a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">  </span>--min-replicas<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-10"><a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">  </span>--enable-dapr<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-11"><a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">  </span>--dapr-app-id<span class="w"> </span>order-service<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-12"><a href="#__codelineno-20-12" id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="w">  </span>--dapr-app-port<span class="w"> </span><span class="m">3000</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-13"><a href="#__codelineno-20-13" id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="w">  </span>--dapr-app-protocol<span class="w"> </span>http
</span><span id="__span-20-14"><a href="#__codelineno-20-14" id="__codelineno-20-14" name="__codelineno-20-14"></a>
</span><span id="__span-20-15"><a href="#__codelineno-20-15" id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="c1"># Invocar otro servicio via Dapr</span>
</span><span id="__span-20-16"><a href="#__codelineno-20-16" id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="c1"># Desde código: http://localhost:3500/v1.0/invoke/inventory-service/method/check-stock</span>
</span></code></pre></div>
<h3 id="administracion-del-ciclo-de-vida-revisiones"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#administracion-del-ciclo-de-vida-revisiones">Administración del Ciclo de Vida: Revisiones</a></h3>
<p>Una de las características más potentes de Container Apps son las <strong>revisiones</strong> (revisions):</p>
<ul>
<li>Cada cambio en la configuración o imagen crea una nueva revisión</li>
<li>Múltiples revisiones activas simultáneamente</li>
<li><strong>Traffic splitting</strong>: distribuir tráfico entre revisiones (A/B testing, blue/green)</li>
<li><strong>Labels</strong>: asignar etiquetas (blue, green, canary) para URLs estables</li>
</ul>
<h4 id="ejemplo-bluegreen-deployment"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#ejemplo-bluegreen-deployment">Ejemplo: Blue/Green Deployment</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="c1"># Desplegar revisión "blue" (producción actual)</span>
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a>az<span class="w"> </span>containerapp<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-3"><a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-4"><a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-5"><a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">  </span>--environment<span class="w"> </span><span class="nv">$ENVIRONMENT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-6"><a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">  </span>--image<span class="w"> </span>myregistry.azurecr.io/myapp:v1.0<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-7"><a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">  </span>--revision-suffix<span class="w"> </span>blue<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-8"><a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">  </span>--ingress<span class="w"> </span>external<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-9"><a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">  </span>--target-port<span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-10"><a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">  </span>--revisions-mode<span class="w"> </span>multiple
</span><span id="__span-21-11"><a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a>
</span><span id="__span-21-12"><a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="c1"># Fijar 100% tráfico a blue</span>
</span><span id="__span-21-13"><a href="#__codelineno-21-13" id="__codelineno-21-13" name="__codelineno-21-13"></a>az<span class="w"> </span>containerapp<span class="w"> </span>ingress<span class="w"> </span>traffic<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-14"><a href="#__codelineno-21-14" id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-15"><a href="#__codelineno-21-15" id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-16"><a href="#__codelineno-21-16" id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="w">  </span>--revision-weight<span class="w"> </span><span class="nv">$APP_NAME</span>--blue<span class="o">=</span><span class="m">100</span>
</span><span id="__span-21-17"><a href="#__codelineno-21-17" id="__codelineno-21-17" name="__codelineno-21-17"></a>
</span><span id="__span-21-18"><a href="#__codelineno-21-18" id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="c1"># Asignar label "blue"</span>
</span><span id="__span-21-19"><a href="#__codelineno-21-19" id="__codelineno-21-19" name="__codelineno-21-19"></a>az<span class="w"> </span>containerapp<span class="w"> </span>revision<span class="w"> </span>label<span class="w"> </span>add<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-20"><a href="#__codelineno-21-20" id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-21"><a href="#__codelineno-21-21" id="__codelineno-21-21" name="__codelineno-21-21"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-22"><a href="#__codelineno-21-22" id="__codelineno-21-22" name="__codelineno-21-22"></a><span class="w">  </span>--label<span class="w"> </span>blue<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-23"><a href="#__codelineno-21-23" id="__codelineno-21-23" name="__codelineno-21-23"></a><span class="w">  </span>--revision<span class="w"> </span><span class="nv">$APP_NAME</span>--blue
</span><span id="__span-21-24"><a href="#__codelineno-21-24" id="__codelineno-21-24" name="__codelineno-21-24"></a>
</span><span id="__span-21-25"><a href="#__codelineno-21-25" id="__codelineno-21-25" name="__codelineno-21-25"></a><span class="c1"># Desplegar revisión "green" (nueva versión)</span>
</span><span id="__span-21-26"><a href="#__codelineno-21-26" id="__codelineno-21-26" name="__codelineno-21-26"></a>az<span class="w"> </span>containerapp<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-27"><a href="#__codelineno-21-27" id="__codelineno-21-27" name="__codelineno-21-27"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-28"><a href="#__codelineno-21-28" id="__codelineno-21-28" name="__codelineno-21-28"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-29"><a href="#__codelineno-21-29" id="__codelineno-21-29" name="__codelineno-21-29"></a><span class="w">  </span>--image<span class="w"> </span>myregistry.azurecr.io/myapp:v2.0<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-30"><a href="#__codelineno-21-30" id="__codelineno-21-30" name="__codelineno-21-30"></a><span class="w">  </span>--revision-suffix<span class="w"> </span>green
</span><span id="__span-21-31"><a href="#__codelineno-21-31" id="__codelineno-21-31" name="__codelineno-21-31"></a>
</span><span id="__span-21-32"><a href="#__codelineno-21-32" id="__codelineno-21-32" name="__codelineno-21-32"></a><span class="c1"># Probar green en URL específica: https://my-app---green.&lt;environment-domain&gt;</span>
</span><span id="__span-21-33"><a href="#__codelineno-21-33" id="__codelineno-21-33" name="__codelineno-21-33"></a>
</span><span id="__span-21-34"><a href="#__codelineno-21-34" id="__codelineno-21-34" name="__codelineno-21-34"></a><span class="c1"># Traffic splitting progresivo: 80% blue, 20% green</span>
</span><span id="__span-21-35"><a href="#__codelineno-21-35" id="__codelineno-21-35" name="__codelineno-21-35"></a>az<span class="w"> </span>containerapp<span class="w"> </span>ingress<span class="w"> </span>traffic<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-36"><a href="#__codelineno-21-36" id="__codelineno-21-36" name="__codelineno-21-36"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-37"><a href="#__codelineno-21-37" id="__codelineno-21-37" name="__codelineno-21-37"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-38"><a href="#__codelineno-21-38" id="__codelineno-21-38" name="__codelineno-21-38"></a><span class="w">  </span>--revision-weight<span class="w"> </span><span class="nv">$APP_NAME</span>--blue<span class="o">=</span><span class="m">80</span><span class="w"> </span><span class="nv">$APP_NAME</span>--green<span class="o">=</span><span class="m">20</span>
</span><span id="__span-21-39"><a href="#__codelineno-21-39" id="__codelineno-21-39" name="__codelineno-21-39"></a>
</span><span id="__span-21-40"><a href="#__codelineno-21-40" id="__codelineno-21-40" name="__codelineno-21-40"></a><span class="c1"># Si green funciona bien, cambiar 100% a green</span>
</span><span id="__span-21-41"><a href="#__codelineno-21-41" id="__codelineno-21-41" name="__codelineno-21-41"></a>az<span class="w"> </span>containerapp<span class="w"> </span>ingress<span class="w"> </span>traffic<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-42"><a href="#__codelineno-21-42" id="__codelineno-21-42" name="__codelineno-21-42"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-43"><a href="#__codelineno-21-43" id="__codelineno-21-43" name="__codelineno-21-43"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-44"><a href="#__codelineno-21-44" id="__codelineno-21-44" name="__codelineno-21-44"></a><span class="w">  </span>--revision-weight<span class="w"> </span><span class="nv">$APP_NAME</span>--green<span class="o">=</span><span class="m">100</span>
</span><span id="__span-21-45"><a href="#__codelineno-21-45" id="__codelineno-21-45" name="__codelineno-21-45"></a>
</span><span id="__span-21-46"><a href="#__codelineno-21-46" id="__codelineno-21-46" name="__codelineno-21-46"></a><span class="c1"># Desactivar revisión blue</span>
</span><span id="__span-21-47"><a href="#__codelineno-21-47" id="__codelineno-21-47" name="__codelineno-21-47"></a>az<span class="w"> </span>containerapp<span class="w"> </span>revision<span class="w"> </span>deactivate<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-48"><a href="#__codelineno-21-48" id="__codelineno-21-48" name="__codelineno-21-48"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-49"><a href="#__codelineno-21-49" id="__codelineno-21-49" name="__codelineno-21-49"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-50"><a href="#__codelineno-21-50" id="__codelineno-21-50" name="__codelineno-21-50"></a><span class="w">  </span>--revision<span class="w"> </span><span class="nv">$APP_NAME</span>--blue
</span></code></pre></div>
<h3 id="networking-opciones-y-escenarios"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#networking-opciones-y-escenarios">Networking: Opciones y Escenarios</a></h3>
<h4 id="niveles-de-accesibilidad"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#niveles-de-accesibilidad">Niveles de Accesibilidad</a></h4>
<ol>
<li><strong>External ingress</strong>: aplicación accesible desde Internet</li>
<li><strong>Internal ingress</strong>: solo accesible dentro del environment o VNet</li>
<li><strong>No ingress</strong>: para background workers o jobs</li>
</ol>
<h4 id="integracion-con-vnet"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#integracion-con-vnet">Integración con VNet</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1"># Crear environment con VNet personalizada</span>
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a>az<span class="w"> </span>containerapp<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-3"><a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$ENVIRONMENT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-4"><a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-5"><a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-6"><a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">  </span>--infrastructure-subnet-resource-id<span class="w"> </span>/subscriptions/.../subnets/aca-subnet<span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-7"><a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">  </span>--internal-only<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-22-8"><a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a>
</span><span id="__span-22-9"><a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="c1"># Subnet mínimo: /27 (para workload profiles)</span>
</span><span id="__span-22-10"><a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="c1"># Subnet mínimo: /23 (para consumption only)</span>
</span></code></pre></div>
<h4 id="private-endpoints"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#private-endpoints">Private Endpoints</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="c1"># Crear environment con private endpoint</span>
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a>az<span class="w"> </span>containerapp<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-3"><a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$ENVIRONMENT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-4"><a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-5"><a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-6"><a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">  </span>--enable-workload-profiles<span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-7"><a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">  </span>--public-network-access<span class="w"> </span>Disabled
</span><span id="__span-23-8"><a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a>
</span><span id="__span-23-9"><a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="c1"># Crear private endpoint</span>
</span><span id="__span-23-10"><a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a>az<span class="w"> </span>network<span class="w"> </span>private-endpoint<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-11"><a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="w">  </span>--name<span class="w"> </span>my-private-endpoint<span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-12"><a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-13"><a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="w">  </span>--vnet-name<span class="w"> </span>my-vnet<span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-14"><a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">  </span>--subnet<span class="w"> </span>my-subnet<span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-15"><a href="#__codelineno-23-15" id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="w">  </span>--private-connection-resource-id<span class="w"> </span>/subscriptions/.../managedEnvironments/<span class="nv">$ENVIRONMENT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-16"><a href="#__codelineno-23-16" id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="w">  </span>--group-id<span class="w"> </span>managedEnvironment<span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-17"><a href="#__codelineno-23-17" id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="w">  </span>--connection-name<span class="w"> </span>my-connection
</span></code></pre></div>
<h3 id="observabilidad-y-monitorizacion"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#observabilidad-y-monitorizacion">Observabilidad y Monitorización</a></h3>
<h4 id="integracion-con-azure-monitor"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#integracion-con-azure-monitor">Integración con Azure Monitor</a></h4>
<p>Container Apps se integra automáticamente con:</p>
<ul>
<li><strong>Log Analytics</strong>: logs de contenedor, system logs</li>
<li><strong>Application Insights</strong>: telemetría de aplicaciones, distributed tracing</li>
<li><strong>Metrics</strong>: CPU, memoria, peticiones HTTP, réplicas activas</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1"># Habilitar Application Insights</span>
</span><span id="__span-24-2"><a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a>az<span class="w"> </span>containerapp<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-3"><a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$ENVIRONMENT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-4"><a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-5"><a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-6"><a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">  </span>--logs-workspace-id<span class="w"> </span>&lt;LOG_ANALYTICS_WORKSPACE_ID&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-7"><a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w">  </span>--logs-workspace-key<span class="w"> </span>&lt;LOG_ANALYTICS_WORKSPACE_KEY&gt;
</span></code></pre></div>
<h4 id="consultas-utiles-en-log-analytics"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#consultas-utiles-en-log-analytics">Consultas Útiles en Log Analytics</a></h4>
<div class="language-kusto highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c">// Logs de aplicación</span>
</span><span id="__span-25-2"><a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="n">ContainerAppConsoleLogs_CL</span>
</span><span id="__span-25-3"><a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ContainerAppName_s</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">"my-api"</span>
</span><span id="__span-25-4"><a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="n">ago</span><span class="p">(</span><span class="mi">1</span><span class="n">h</span><span class="p">)</span>
</span><span id="__span-25-5"><a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="p">,</span><span class="w"> </span><span class="n">Log_s</span>
</span><span id="__span-25-6"><a href="#__codelineno-25-6" id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="w"> </span><span class="n">desc</span>
</span><span id="__span-25-7"><a href="#__codelineno-25-7" id="__codelineno-25-7" name="__codelineno-25-7"></a>
</span><span id="__span-25-8"><a href="#__codelineno-25-8" id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="c">// Métricas de réplicas</span>
</span><span id="__span-25-9"><a href="#__codelineno-25-9" id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="n">ContainerAppSystemLogs_CL</span>
</span><span id="__span-25-10"><a href="#__codelineno-25-10" id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">"ContainerAppScaling"</span>
</span><span id="__span-25-11"><a href="#__codelineno-25-11" id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ContainerAppName_s</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">"my-api"</span>
</span><span id="__span-25-12"><a href="#__codelineno-25-12" id="__codelineno-25-12" name="__codelineno-25-12"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="p">,</span><span class="w"> </span><span class="n">ReplicaCount_d</span>
</span><span id="__span-25-13"><a href="#__codelineno-25-13" id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="p">|</span><span class="w"> </span><span class="k">render</span><span class="w"> </span><span class="n">timechart</span>
</span></code></pre></div>
<h4 id="opentelemetry-preview"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#opentelemetry-preview">OpenTelemetry (Preview)</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c1"># Habilitar agente OpenTelemetry</span>
</span><span id="__span-26-2"><a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a>az<span class="w"> </span>containerapp<span class="w"> </span>env<span class="w"> </span>telemetry<span class="w"> </span>app-insights<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-3"><a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$ENVIRONMENT</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-4"><a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-5"><a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="w">  </span>--connection-string<span class="w"> </span><span class="s2">"InstrumentationKey=...;IngestionEndpoint=..."</span>
</span><span id="__span-26-6"><a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a>
</span><span id="__span-26-7"><a href="#__codelineno-26-7" id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="c1"># Las apps envían automáticamente traces, metrics y logs a App Insights</span>
</span></code></pre></div>
<h3 id="costes-y-optimizacion"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#costes-y-optimizacion">Costes y Optimización</a></h3>
<h4 id="modelo-de-facturacion"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#modelo-de-facturacion">Modelo de Facturación</a></h4>
<p><strong>Consumption Plan</strong>:</p>
<ul>
<li><strong>Consumo activo</strong>: vCPU-segundos y GiB-segundos consumidos</li>
<li><strong>Consumo idle</strong>: tarifa reducida cuando réplicas están idle (no procesando, &lt;0.01 vCPU, &lt;1KB/s red)</li>
<li><strong>Requests</strong>: primeros 2 millones gratis/mes, luego por millón adicional</li>
<li><strong>GPUs serverless</strong>: sin cargo por idle, solo por uso activo</li>
</ul>
<p><strong>Dedicated Plan</strong> (workload profiles):</p>
<ul>
<li>Cargo fijo por gestión del plan si usas perfiles dedicados</li>
<li>Cargo por instancia de perfil (D4, E8, NC24-A100, etc.)</li>
<li>Escalado in/out ajusta coste según demanda</li>
</ul>
<h4 id="estrategias-de-optimizacion"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#estrategias-de-optimizacion">Estrategias de Optimización</a></h4>
<ol>
<li><strong>Escala a cero</strong>: configura <code>minReplicas: 0</code> para apps con tráfico intermitente</li>
<li><strong>Right-sizing</strong>: ajusta CPU/memoria a necesidades reales</li>
<li><strong>Workload profiles</strong>: agrupa apps similares en el mismo perfil dedicado</li>
<li><strong>Savings Plans</strong>: Azure Container Apps elegible para planes de ahorro</li>
<li><strong>GPUs serverless</strong>: para cargas AI/ML variables, usa serverless en lugar de dedicado</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="c1"># Configurar escalado a cero</span>
</span><span id="__span-27-2"><a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a>az<span class="w"> </span>containerapp<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-3"><a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-4"><a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-5"><a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">  </span>--min-replicas<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-6"><a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="w">  </span>--max-replicas<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-7"><a href="#__codelineno-27-7" id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="w">  </span>--scale-rule-name<span class="w"> </span>http-rule<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-8"><a href="#__codelineno-27-8" id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="w">  </span>--scale-rule-type<span class="w"> </span>http<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-9"><a href="#__codelineno-27-9" id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="w">  </span>--scale-rule-metadata<span class="w"> </span><span class="nv">concurrentRequests</span><span class="o">=</span><span class="m">50</span>
</span></code></pre></div>
<h3 id="seguridad-mejores-practicas"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#seguridad-mejores-practicas">Seguridad: Mejores Prácticas</a></h3>
<h4 id="1-managed-identities"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#1-managed-identities">1. Managed Identities</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1"># Habilitar system-assigned identity</span>
</span><span id="__span-28-2"><a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a>az<span class="w"> </span>containerapp<span class="w"> </span>identity<span class="w"> </span>assign<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-3"><a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-4"><a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-5"><a href="#__codelineno-28-5" id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">  </span>--system-assigned
</span><span id="__span-28-6"><a href="#__codelineno-28-6" id="__codelineno-28-6" name="__codelineno-28-6"></a>
</span><span id="__span-28-7"><a href="#__codelineno-28-7" id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="c1"># Asignar rol para acceder a Key Vault</span>
</span><span id="__span-28-8"><a href="#__codelineno-28-8" id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="nv">IDENTITY_ID</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>containerapp<span class="w"> </span>identity<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-9"><a href="#__codelineno-28-9" id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-10"><a href="#__codelineno-28-10" id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-11"><a href="#__codelineno-28-11" id="__codelineno-28-11" name="__codelineno-28-11"></a><span class="w">  </span>--query<span class="w"> </span>principalId<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>
</span><span id="__span-28-12"><a href="#__codelineno-28-12" id="__codelineno-28-12" name="__codelineno-28-12"></a>
</span><span id="__span-28-13"><a href="#__codelineno-28-13" id="__codelineno-28-13" name="__codelineno-28-13"></a>az<span class="w"> </span>keyvault<span class="w"> </span>set-policy<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-14"><a href="#__codelineno-28-14" id="__codelineno-28-14" name="__codelineno-28-14"></a><span class="w">  </span>--name<span class="w"> </span>my-keyvault<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-15"><a href="#__codelineno-28-15" id="__codelineno-28-15" name="__codelineno-28-15"></a><span class="w">  </span>--object-id<span class="w"> </span><span class="nv">$IDENTITY_ID</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-16"><a href="#__codelineno-28-16" id="__codelineno-28-16" name="__codelineno-28-16"></a><span class="w">  </span>--secret-permissions<span class="w"> </span>get<span class="w"> </span>list
</span></code></pre></div>
<h4 id="2-secretos"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#2-secretos">2. Secretos</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c1"># Añadir secreto</span>
</span><span id="__span-29-2"><a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a>az<span class="w"> </span>containerapp<span class="w"> </span>secret<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-3"><a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-4"><a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-5"><a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="w">  </span>--secrets<span class="w"> </span>db-connection<span class="o">=</span><span class="s2">"Server=...;Password=..."</span>
</span><span id="__span-29-6"><a href="#__codelineno-29-6" id="__codelineno-29-6" name="__codelineno-29-6"></a>
</span><span id="__span-29-7"><a href="#__codelineno-29-7" id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="c1"># Referenciar en variable de entorno</span>
</span><span id="__span-29-8"><a href="#__codelineno-29-8" id="__codelineno-29-8" name="__codelineno-29-8"></a>az<span class="w"> </span>containerapp<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-9"><a href="#__codelineno-29-9" id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-10"><a href="#__codelineno-29-10" id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-11"><a href="#__codelineno-29-11" id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="w">  </span>--set-env-vars<span class="w"> </span><span class="s2">"DB_CONNECTION=secretref:db-connection"</span>
</span></code></pre></div>
<h4 id="3-autenticacion-built-in-easyauth"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#3-autenticacion-built-in-easyauth">3. Autenticación Built-in (EasyAuth)</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="c1"># Habilitar autenticación con Entra ID</span>
</span><span id="__span-30-2"><a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a>az<span class="w"> </span>containerapp<span class="w"> </span>auth<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-3"><a href="#__codelineno-30-3" id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-4"><a href="#__codelineno-30-4" id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-5"><a href="#__codelineno-30-5" id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="w">  </span>--enable<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-6"><a href="#__codelineno-30-6" id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="w">  </span>--action<span class="w"> </span>RequireAuthentication<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-7"><a href="#__codelineno-30-7" id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="w">  </span>--aad-tenant-id<span class="w"> </span>&lt;TENANT_ID&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-8"><a href="#__codelineno-30-8" id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="w">  </span>--aad-client-id<span class="w"> </span>&lt;CLIENT_ID&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-9"><a href="#__codelineno-30-9" id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="w">  </span>--aad-client-secret<span class="w"> </span>&lt;CLIENT_SECRET&gt;
</span></code></pre></div>
<h4 id="4-restricciones-de-ip"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#4-restricciones-de-ip">4. Restricciones de IP</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="c1"># Limitar acceso por IP</span>
</span><span id="__span-31-2"><a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a>az<span class="w"> </span>containerapp<span class="w"> </span>ingress<span class="w"> </span>access-restriction<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-3"><a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$APP_NAME</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-4"><a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-5"><a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="w">  </span>--rule-name<span class="w"> </span>office-network<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-6"><a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">  </span>--ip-address<span class="w"> </span><span class="m">203</span>.0.113.0/24<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-7"><a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="w">  </span>--action<span class="w"> </span>Allow
</span></code></pre></div>
<h3 id="conclusion"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#conclusion">Conclusión</a></h3>
<p>Azure Container Apps en 2025 es una plataforma madura y completa para ejecutar aplicaciones Cloud Native sin la complejidad de gestionar Kubernetes directamente. Con las incorporaciones de 2024-2025, se ha convertido en una opción viable para:</p>
<ul>
<li><strong>Microservicios y APIs</strong>: escalado automático, revisiones, traffic splitting</li>
<li><strong>Event-driven architectures</strong>: integración con KEDA y múltiples event sources</li>
<li><strong>Cargas AI/ML</strong>: GPUs serverless y dedicadas, Dynamic Sessions</li>
<li><strong>Aplicaciones empresariales</strong>: networking avanzado, private endpoints, integración con Azure Functions</li>
</ul>
<h4 id="cuando-elegir-container-apps"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#cuando-elegir-container-apps">¿Cuándo Elegir Container Apps?</a></h4>
<p>✅ <strong>Sí</strong>, si:</p>
<ul>
<li>Quieres serverless con escalado a cero</li>
<li>Necesitas desplegar microservicios o APIs rápidamente</li>
<li>Prefieres no gestionar Kubernetes directamente</li>
<li>Quieres integración nativa con Dapr, KEDA, Envoy</li>
<li>Necesitas GPUs para cargas AI/ML con tráfico variable</li>
</ul>
<p>❌ <strong>No</strong>, si:</p>
<ul>
<li>Necesitas acceso completo a Kubernetes API y CRDs</li>
<li>Tienes requisitos muy específicos de configuración de K8s</li>
<li>Ya tienes inversión significativa en operadores y herramientas K8s personalizadas</li>
</ul>
<p>En resumen: <strong>si no necesitas acceso directo a Kubernetes API y trabajas con aplicaciones Cloud Native, Azure Container Apps es tu servicio en Azure</strong>.</p>
<h3 id="referencias-y-recursos"><a class="toclink" href="../../2025/10/22/azure-container-apps-en-2025-la-evoluci%C3%B3n-del-serverless-para-contenedores/#referencias-y-recursos">Referencias y Recursos</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/azure/container-apps/">Documentación oficial de Azure Container Apps</a></li>
<li><a href="https://aka.ms/aca/updates">Novedades en Azure Container Apps (GitHub)</a></li>
<li><a href="https://aka.ms/dapr-aca-updates">Dapr en Azure Container Apps (GitHub)</a></li>
<li><a href="https://azure.microsoft.com/pricing/details/container-apps/">Azure Container Apps - Precios</a></li>
<li><a href="https://aka.ms/aca-lza">Landing Zone Accelerators para Container Apps</a></li>
<li><a href="https://learn.microsoft.com/azure/architecture/browse/?expanded=azure&amp;products=azure-container-apps">Arquitecturas de referencia</a></li>
<li><a href="https://learn.microsoft.com/training/browse/?products=azure-container-apps">Azure Container Apps en Microsoft Learn</a></li>
</ul>
<hr>
<p><em>Artículo actualizado en octubre de 2025. Para la versión original de 2022, ver <a href="https://keepler.io/es/2022/09/14/introduccion-a-azure-container-apps/">Introducción a Azure Container Apps (Keepler Blog)</a>.</em></p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-10-20 00:00:00+00:00">October 20, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure Services</a></li>
<li class="md-meta__item">
            
              2 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="20251020-azure-service-bus-mensajeria"><a class="toclink" href="../../2025/10/20/20251020-azure-service-bus-mensajeria/">20251020 azure service bus mensajeria</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/10/20/20251020-azure-service-bus-mensajeria/#resumen">Resumen</a></h3>
<p><strong>Azure Service Bus</strong> es el servicio de mensajería empresarial de Azure. Permite desacoplar aplicaciones y servicios mediante colas y topics, ideal para arquitecturas distribuidas y microservicios. Este post va directo a admins y DevOps que necesitan integrar sistemas de forma fiable y segura.</p>
<h3 id="que-es-azure-service-bus"><a class="toclink" href="../../2025/10/20/20251020-azure-service-bus-mensajeria/#que-es-azure-service-bus">¿Qué es Azure Service Bus?</a></h3>
<p>Azure Service Bus es un servicio PaaS de mensajería que ofrece:</p>
<ul>
<li>Colas (Queues) para comunicación punto a punto</li>
<li>Topics y subscriptions para pub/sub</li>
<li>Entrega garantizada y ordenada</li>
<li>Soporte para mensajes transaccionales y sesiones</li>
<li>Integración con RBAC y Managed Identities</li>
</ul>
<h3 id="arquitectura-como-funciona"><a class="toclink" href="../../2025/10/20/20251020-azure-service-bus-mensajeria/#arquitectura-como-funciona">Arquitectura / Cómo funciona</a></h3>
<pre class="mermaid"><code>flowchart LR
  App1[Productor] -- Envia mensaje --&gt; SB[Service Bus Queue]
  SB -- Recibe mensaje --&gt; App2[Consumidor]
  SB -. Dead-letter .-&gt; DLQ[Dead Letter Queue]
</code></pre>
<ul>
<li>El productor envía mensajes a la cola</li>
<li>El consumidor los procesa de forma asíncrona</li>
<li>Mensajes fallidos van a la Dead Letter Queue</li>
</ul>
<h3 id="uso-practico-crear-y-usar-una-cola"><a class="toclink" href="../../2025/10/20/20251020-azure-service-bus-mensajeria/#uso-practico-crear-y-usar-una-cola">Uso práctico: crear y usar una cola</a></h3>
<h4 id="1-crear-un-service-bus-namespace-y-una-cola"><a class="toclink" href="../../2025/10/20/20251020-azure-service-bus-mensajeria/#1-crear-un-service-bus-namespace-y-una-cola">1. Crear un Service Bus Namespace y una cola</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># Variables</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nv">RESOURCE_GROUP</span><span class="o">=</span><span class="s2">"my-rg"</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="nv">LOCATION</span><span class="o">=</span><span class="s2">"westeurope"</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="nv">SB_NAMESPACE</span><span class="o">=</span><span class="s2">"my-sb-namespace"</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="nv">QUEUE</span><span class="o">=</span><span class="s2">"myqueue"</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="c1"># Crear namespace</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>az<span class="w"> </span>servicebus<span class="w"> </span>namespace<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$SB_NAMESPACE</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span>
</span><span id="__span-0-12"><a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a>
</span><span id="__span-0-13"><a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="c1"># Crear cola</span>
</span><span id="__span-0-14"><a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a>az<span class="w"> </span>servicebus<span class="w"> </span>queue<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-15"><a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-16"><a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">  </span>--namespace-name<span class="w"> </span><span class="nv">$SB_NAMESPACE</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-17"><a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$QUEUE</span>
</span></code></pre></div>
<h4 id="2-enviar-y-recibir-mensajes-python-passwordless-recomendado"><a class="toclink" href="../../2025/10/20/20251020-azure-service-bus-mensajeria/#2-enviar-y-recibir-mensajes-python-passwordless-recomendado">2. Enviar y recibir mensajes (Python, passwordless recomendado)</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">azure.servicebus.aio</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServiceBusClient</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">azure.servicebus</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServiceBusMessage</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">azure.identity.aio</span><span class="w"> </span><span class="kn">import</span> <span class="n">DefaultAzureCredential</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="n">FULLY_QUALIFIED_NAMESPACE</span> <span class="o">=</span> <span class="s2">"&lt;namespace&gt;.servicebus.windows.net"</span>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="n">QUEUE_NAME</span> <span class="o">=</span> <span class="s2">"myqueue"</span>
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a>
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">():</span>
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a>  <span class="n">credential</span> <span class="o">=</span> <span class="n">DefaultAzureCredential</span><span class="p">()</span>
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a>  <span class="k">async</span> <span class="k">with</span> <span class="n">ServiceBusClient</span><span class="p">(</span><span class="n">FULLY_QUALIFIED_NAMESPACE</span><span class="p">,</span> <span class="n">credential</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
</span><span id="__span-1-12"><a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a>    <span class="n">sender</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_queue_sender</span><span class="p">(</span><span class="n">QUEUE_NAME</span><span class="p">)</span>
</span><span id="__span-1-13"><a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">sender</span><span class="p">:</span>
</span><span id="__span-1-14"><a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a>      <span class="n">msg</span> <span class="o">=</span> <span class="n">ServiceBusMessage</span><span class="p">(</span><span class="s2">"Hola Azure Service Bus!"</span><span class="p">)</span>
</span><span id="__span-1-15"><a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a>      <span class="k">await</span> <span class="n">sender</span><span class="o">.</span><span class="n">send_messages</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-1-16"><a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a>    <span class="k">await</span> <span class="n">credential</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-1-17"><a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a>
</span><span id="__span-1-18"><a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">receive_message</span><span class="p">():</span>
</span><span id="__span-1-19"><a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a>  <span class="n">credential</span> <span class="o">=</span> <span class="n">DefaultAzureCredential</span><span class="p">()</span>
</span><span id="__span-1-20"><a href="#__codelineno-1-20" id="__codelineno-1-20" name="__codelineno-1-20"></a>  <span class="k">async</span> <span class="k">with</span> <span class="n">ServiceBusClient</span><span class="p">(</span><span class="n">FULLY_QUALIFIED_NAMESPACE</span><span class="p">,</span> <span class="n">credential</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
</span><span id="__span-1-21"><a href="#__codelineno-1-21" id="__codelineno-1-21" name="__codelineno-1-21"></a>    <span class="n">receiver</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_queue_receiver</span><span class="p">(</span><span class="n">QUEUE_NAME</span><span class="p">)</span>
</span><span id="__span-1-22"><a href="#__codelineno-1-22" id="__codelineno-1-22" name="__codelineno-1-22"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">receiver</span><span class="p">:</span>
</span><span id="__span-1-23"><a href="#__codelineno-1-23" id="__codelineno-1-23" name="__codelineno-1-23"></a>      <span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">receiver</span><span class="p">:</span>
</span><span id="__span-1-24"><a href="#__codelineno-1-24" id="__codelineno-1-24" name="__codelineno-1-24"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Mensaje recibido:"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="__span-1-25"><a href="#__codelineno-1-25" id="__codelineno-1-25" name="__codelineno-1-25"></a>        <span class="k">await</span> <span class="n">receiver</span><span class="o">.</span><span class="n">complete_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-1-26"><a href="#__codelineno-1-26" id="__codelineno-1-26" name="__codelineno-1-26"></a>    <span class="k">await</span> <span class="n">credential</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-1-27"><a href="#__codelineno-1-27" id="__codelineno-1-27" name="__codelineno-1-27"></a>
</span><span id="__span-1-28"><a href="#__codelineno-1-28" id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="c1"># Ejecutar</span>
</span><span id="__span-1-29"><a href="#__codelineno-1-29" id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">send_message</span><span class="p">())</span>
</span><span id="__span-1-30"><a href="#__codelineno-1-30" id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">receive_message</span><span class="p">())</span>
</span></code></pre></div>
<p>Más detalles y ejemplos oficiales:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-python-how-to-use-queues#authenticate-the-app-to-azure">Quickstart: Python passwordless</a></li>
<li><a href="https://learn.microsoft.com/en-us/security/benchmark/azure/baselines/service-bus-security-baseline">Service Bus security baseline</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-dead-letter-queues">Dead-letter queues</a></li>
</ul>
<h3 id="buenas-practicas-seguridad"><a class="toclink" href="../../2025/10/20/20251020-azure-service-bus-mensajeria/#buenas-practicas-seguridad">Buenas prácticas / Seguridad</a></h3>
<ul>
<li>Usa Managed Identities en vez de connection strings</li>
<li>Activa el cifrado con claves gestionadas por el cliente (CMK) si es necesario</li>
<li>Configura reglas de red y firewall</li>
<li>Usa colas de dead-letter para mensajes no procesables</li>
<li>Monitoriza con Azure Monitor y alertas</li>
</ul>
<h3 id="referencias"><a class="toclink" href="../../2025/10/20/20251020-azure-service-bus-mensajeria/#referencias">Referencias</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/es-es/azure/service-bus-messaging/service-bus-messaging-overview">Documentación oficial Azure Service Bus</a></li>
<li><a href="https://learn.microsoft.com/es-es/python/api/overview/azure/servicebus">SDK Python Azure Service Bus</a></li>
</ul>
</div>
</article>
<nav class="md-pagination">
<span class="md-pagination__current">1</span> <a class="md-pagination__link" href="page/2/">2</a> <a class="md-pagination__link" href="page/3/">3</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="page/9/">9</a>
</nav>
</div>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2023-now Rafael Fernández
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://www.linkedin.com/in/rafaelfernandezd/" rel="noopener" target="_blank" title="LinkedIn">
<svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg>
</a>
<a class="md-social__link" href="https://github.com/rfernandezdo" rel="noopener" target="_blank" title="GitHub">
<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
<a class="md-social__link" href="https://rfernandezdo.github.io/feed_rss_created.xml" rel="noopener" target="_blank" title="RSS feed">
<svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h320c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64zm32 104c0-13.3 10.7-24 24-24 137 0 248 111 248 248 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200-13.3 0-24-10.7-24-24m0 96c0-13.3 10.7-24 24-24 83.9 0 152 68.1 152 152 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104-13.3 0-24-10.7-24-24m0 120a32 32 0 1 1 64 0 32 32 0 1 1-64 0"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-progress" data-md-component="progress" role="progressbar"></div>
<script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.sections", "navigation.top", "navigation.tracking", "toc.integrate", "toc.nested", "toc.smoothscroll", "footer", "content.code.copy", "content.code.select", "content.code.annotate", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
<script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
<script src="../../../javascripts/tablesort.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>