<!DOCTYPE html><html class="no-js" lang="en"><head>
<meta charset="utf-8">
<meta content="width=device-width,initial-scale=1" name="viewport">
<meta content="A blog about Azure, DevOps and other stuff" name="description">
<meta content="Rafael Fernández" name="author">
<link href="https://rfernandezdo.github.io/blog/category/azure/" rel="canonical">
<link href="../../tags/" rel="prev">
<link href="../azure-ad/" rel="next">
<link href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=es&amp;_x_tr_hl=es&amp;_x_tr_pto=wapp" hreflang="en" rel="alternate">
<link href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=en&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp" hreflang="es" rel="alternate">
<link href="../../../feed_rss_created.xml" rel="alternate" title="RSS feed" type="application/rss+xml">
<link href="../../../feed_rss_updated.xml" rel="alternate" title="RSS feed of updated content" type="application/rss+xml">
<link href="../../../assets/images/favicon.png" rel="icon">
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.1" name="generator">
<title>Azure - Un Rinconcito donde contar lo que quiera</title>
<link href="../../../assets/stylesheets/main.484c7ddc.min.css" rel="stylesheet">
<link href="../../../assets/stylesheets/palette.ab4e12ef.min.css" rel="stylesheet">
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet">
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<meta content="website" property="og:type">
<meta content="Azure - Un Rinconcito donde contar lo que quiera" property="og:title">
<meta content="A blog about Azure, DevOps and other stuff" property="og:description">
<meta content="https://rfernandezdo.github.io/assets/images/social/blog/category/azure.png" property="og:image">
<meta content="image/png" property="og:image:type">
<meta content="1200" property="og:image:width">
<meta content="630" property="og:image:height">
<meta content="https://rfernandezdo.github.io/blog/category/azure/" property="og:url">
<meta content="summary_large_image" property="twitter:card">
<meta content="Azure - Un Rinconcito donde contar lo que quiera" property="twitter:title">
<meta content="A blog about Azure, DevOps and other stuff" property="twitter:description">
<meta content="https://rfernandezdo.github.io/assets/images/social/blog/category/azure.png" property="twitter:image">
<link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox">
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox">
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#azure">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Un Rinconcito donde contar lo que quiera" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="Un Rinconcito donde contar lo que quiera">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Un Rinconcito donde contar lo que quiera
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Azure
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio">
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio">
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<div class="md-header__option">
<div class="md-select">
<button aria-label="Select language" class="md-header__button md-icon">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"></path></svg>
</button>
<div class="md-select__inner">
<ul class="md-select__list">
<li class="md-select__item">
<a class="md-select__link" href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=es&amp;_x_tr_hl=es&amp;_x_tr_pto=wapp" hreflang="en">
              English
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=en&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp" hreflang="es">
              Spanish
            </a>
</li>
</ul>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text">
<label class="md-search__icon md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../">
          
  
  
  Blog

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
        
  
  
    
  
  About

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../contributions/">
        
  
  
    
  
  Contributions

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../Azure/Security/MCSB/Readme/">
          
  
  
  Azure

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../Tools/Federated_Identity_Credentials_Report/README-federated-identity-credentials/">
          
  
  
  Tools

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Un Rinconcito donde contar lo que quiera" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="Un Rinconcito donde contar lo que quiera">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Un Rinconcito donde contar lo que quiera
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox">
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
<span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tags/">
<span class="md-ellipsis">
    
  
    Posts by Tags
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1_3" type="checkbox">
<label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="">
<span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_3">
<span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/12/">
<span class="md-ellipsis">
    
  
    2025/12
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/11/">
<span class="md-ellipsis">
    
  
    2025/11
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/10/">
<span class="md-ellipsis">
    
  
    2025/10
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/09/">
<span class="md-ellipsis">
    
  
    2025/09
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/08/">
<span class="md-ellipsis">
    
  
    2025/08
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/07/">
<span class="md-ellipsis">
    
  
    2025/07
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/06/">
<span class="md-ellipsis">
    
  
    2025/06
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/05/">
<span class="md-ellipsis">
    
  
    2025/05
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/04/">
<span class="md-ellipsis">
    
  
    2025/04
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/03/">
<span class="md-ellipsis">
    
  
    2025/03
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/02/">
<span class="md-ellipsis">
    
  
    2025/02
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2025/01/">
<span class="md-ellipsis">
    
  
    2025/01
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/12/">
<span class="md-ellipsis">
    
  
    2024/12
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/11/">
<span class="md-ellipsis">
    
  
    2024/11
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/10/">
<span class="md-ellipsis">
    
  
    2024/10
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/09/">
<span class="md-ellipsis">
    
  
    2024/09
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/06/">
<span class="md-ellipsis">
    
  
    2024/06
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/05/">
<span class="md-ellipsis">
    
  
    2024/05
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/04/">
<span class="md-ellipsis">
    
  
    2024/04
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/03/">
<span class="md-ellipsis">
    
  
    2024/03
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2024/02/">
<span class="md-ellipsis">
    
  
    2024/02
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2023/12/">
<span class="md-ellipsis">
    
  
    2023/12
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2023/11/">
<span class="md-ellipsis">
    
  
    2023/11
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../2023/10/">
<span class="md-ellipsis">
    
  
    2023/10
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_1_4" type="checkbox">
<label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="">
<span class="md-ellipsis">
    
  
    Categories
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_1_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Categories
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox">
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    Azure
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-ad/">
<span class="md-ellipsis">
    
  
    Azure AD
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-automation/">
<span class="md-ellipsis">
    
  
    Azure Automation
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-devops/">
<span class="md-ellipsis">
    
  
    Azure DevOps
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-frameworks/">
<span class="md-ellipsis">
    
  
    Azure Frameworks
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-governance/">
<span class="md-ellipsis">
    
  
    Azure Governance
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-networking/">
<span class="md-ellipsis">
    
  
    Azure Networking
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-security/">
<span class="md-ellipsis">
    
  
    Azure Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-services/">
<span class="md-ellipsis">
    
  
    Azure Services
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure-updates/">
<span class="md-ellipsis">
    
  
    Azure Updates
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../caf/">
<span class="md-ellipsis">
    
  
    CAF
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cicd/">
<span class="md-ellipsis">
    
  
    CI/CD
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../devops/">
<span class="md-ellipsis">
    
  
    DevOps
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/">
<span class="md-ellipsis">
    
  
    Development
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../drift-detection/">
<span class="md-ellipsis">
    
  
    Drift Detection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../english/">
<span class="md-ellipsis">
    
  
    English
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../enterprise-policy-as-code/">
<span class="md-ellipsis">
    
  
    Enterprise Policy as Code
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../finops/">
<span class="md-ellipsis">
    
  
    FinOps
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../firewall/">
<span class="md-ellipsis">
    
  
    Firewall
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../gtd/">
<span class="md-ellipsis">
    
  
    GTD
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../git/">
<span class="md-ellipsis">
    
  
    Git
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../github-actions/">
<span class="md-ellipsis">
    
  
    GitHub Actions
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../hashicorp/">
<span class="md-ellipsis">
    
  
    HashiCorp
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../hello_world/">
<span class="md-ellipsis">
    
  
    Hello_World
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../infrastructure-as-code/">
<span class="md-ellipsis">
    
  
    Infrastructure as Code
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../learning/">
<span class="md-ellipsis">
    
  
    Learning
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../m365/">
<span class="md-ellipsis">
    
  
    M365
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../microsoft-365/">
<span class="md-ellipsis">
    
  
    Microsoft 365
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../microsoft-entra/">
<span class="md-ellipsis">
    
  
    Microsoft Entra
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../microsoft-entra-external-id/">
<span class="md-ellipsis">
    
  
    Microsoft Entra External ID
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../microsoft-entra-id/">
<span class="md-ellipsis">
    
  
    Microsoft Entra ID
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../networking/">
<span class="md-ellipsis">
    
  
    Networking
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../outlook/">
<span class="md-ellipsis">
    
  
    Outlook
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../pim/">
<span class="md-ellipsis">
    
  
    PIM
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../power-automate/">
<span class="md-ellipsis">
    
  
    Power Automate
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../power-bi/">
<span class="md-ellipsis">
    
  
    Power BI
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../productividad/">
<span class="md-ellipsis">
    
  
    Productividad
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../productividad--microsoft-365/">
<span class="md-ellipsis">
    
  
    Productividad / Microsoft 365
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../security/">
<span class="md-ellipsis">
    
  
    Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../seguridad/">
<span class="md-ellipsis">
    
  
    Seguridad
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../snowflake/">
<span class="md-ellipsis">
    
  
    Snowflake
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../terraform/">
<span class="md-ellipsis">
    
  
    Terraform
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../threat-intelligence/">
<span class="md-ellipsis">
    
  
    Threat Intelligence
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tools/">
<span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../troubleshooting/">
<span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../visual-studio-code/">
<span class="md-ellipsis">
    
  
    Visual Studio Code
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../viva-insights/">
<span class="md-ellipsis">
    
  
    Viva Insights
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../windows/">
<span class="md-ellipsis">
    
  
    Windows
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    
  
    About
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../contributions/">
<span class="md-ellipsis">
    
  
    Contributions
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox">
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Azure
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Azure
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1" type="checkbox">
<label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Security
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1_1" type="checkbox">
<label class="md-nav__link" for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
<span class="md-ellipsis">
    
  
    MCSB v1
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_1">
<span class="md-nav__icon md-icon"></span>
            
  
    MCSB v1
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Readme/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Readme
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Asset%20Management/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Asset Management
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Backup%20and%20Recovery/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Backup and Recovery
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Data%20Protection/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Data Protection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/DevOps%20Security/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - DevOps Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Endpoint%20Security/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Endpoint Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Governance%20and%20Strategy/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Governance and Strategy
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Identity%20Management/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Identity Management
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Incident%20Response/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Incident Response
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Logging%20and%20Threat%20Detection/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Logging and Threat Detection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Network%20Security/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Network Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Posture%20and%20Vulnerability%20Mgmt/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Posture and Vulnerability Mgmt
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSB/Privileged%20Access/">
<span class="md-ellipsis">
    
  
    MCSB_v1 - Privileged Access
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1_2" type="checkbox">
<label class="md-nav__link" for="__nav_4_1_2" id="__nav_4_1_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    MCSB v2
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_2">
<span class="md-nav__icon md-icon"></span>
            
  
    MCSB v2
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Index/">
<span class="md-ellipsis">
    
  
    Microsoft Cloud Security Benchmark v2
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Network%20Security/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Network Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Identity%20Management/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Identity Management
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Privileged%20Access/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Privileged Access
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Data%20Protection/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Data Protection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Asset%20Management/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Asset Management
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Logging%20and%20Threat%20Detection/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Logging and Threat Detection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Incident%20Response/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Incident Response
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Posture%20and%20Vulnerability%20Manag/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Posture and Vulnerability Manag
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Endpoint%20Security/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Endpoint Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Backup%20and%20Recovery/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Backup and Recovery
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Azure/Security/MCSBv2/Artificial%20Intelligence%20Securit/">
<span class="md-ellipsis">
    
  
    MCSB v2 - Artificial Intelligence Securit
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox">
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            
  
    Tools
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_1" type="checkbox">
<label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Federated Identity Credentials Report
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Federated Identity Credentials Report
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Tools/Federated_Identity_Credentials_Report/README-federated-identity-credentials/">
<span class="md-ellipsis">
    
  
    Script de Reporte para Federated Identity Credentials
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_2" type="checkbox">
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Analyze Virtual Network Flows
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Analyze Virtual Network Flows
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Tools/Analyze_Virtual_Network_Flows/">
<span class="md-ellipsis">
    
  
    Analyze-VNETFlowLogs
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<div class="md-content__inner">
<header class="md-typeset">
<h1 id="azure">Azure</h1>
</header>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-10-18 00:00:00+00:00">October 18, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../terraform/">Terraform</a>, 
              <a class="md-meta__link" href="./">Azure</a>, 
              <a class="md-meta__link" href="../drift-detection/">Drift Detection</a></li>
<li class="md-meta__item">
            
              1 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="terraform-en-azure-deteccion-y-correccion-de-drift"><a class="toclink" href="../../2025/10/18/terraform-en-azure-detecci%C3%B3n-y-correcci%C3%B3n-de-drift/">Terraform en Azure: detección y corrección de drift</a></h2>
<h3 id="resumen"><a class="toclink" href="../../2025/10/18/terraform-en-azure-detecci%C3%B3n-y-correcci%C3%B3n-de-drift/#resumen">Resumen</a></h3>
<p>Cómo detectar y corregir drift en recursos Azure gestionados con Terraform. Post directo para admins y DevOps: comandos prácticos y ejemplos reproducibles.</p>
<h3 id="que-es-el-drift"><a class="toclink" href="../../2025/10/18/terraform-en-azure-detecci%C3%B3n-y-correcci%C3%B3n-de-drift/#que-es-el-drift">¿Qué es el drift?</a></h3>
<ul>
<li>Cambios fuera de Terraform (portal, scripts, etc)</li>
<li>Recursos "fuera de sync" con el estado deseado</li>
<li>Impacto: errores, inseguridad, compliance roto</li>
</ul>
<h3 id="arquitectura-funcionamiento"><a class="toclink" href="../../2025/10/18/terraform-en-azure-detecci%C3%B3n-y-correcci%C3%B3n-de-drift/#arquitectura-funcionamiento">Arquitectura / Funcionamiento</a></h3>
<pre class="mermaid"><code>flowchart LR
    TF[Terraform State] --&gt; Azure[Azure Resource]
    Azure -.-&gt; Portal[Portal]
    Azure -.-&gt; Script[Script]
    TF -.-&gt; Drift[Drift Detection]
</code></pre>
<h3 id="deteccion-de-drift"><a class="toclink" href="../../2025/10/18/terraform-en-azure-detecci%C3%B3n-y-correcci%C3%B3n-de-drift/#deteccion-de-drift">Detección de drift</a></h3>
<ol>
<li>
<p>Comprobar estado:
</p><div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>terraform<span class="w"> </span>plan
</span></code></pre></div><p></p>
</li>
<li>
<p>Usar azurerm_resource_drifts:
</p><div class="language-hcl highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_resource_drifts"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">  </span><span class="na">resource_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_virtual_machine.example.id</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="p">}</span>
</span></code></pre></div><p></p>
</li>
<li>
<p>Validar con Azure Policy:
</p><div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>az<span class="w"> </span>policy<span class="w"> </span>state<span class="w"> </span>list<span class="w"> </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span>--policy-assignment<span class="w"> </span><span class="nv">$POLICY</span>
</span></code></pre></div><p></p>
</li>
</ol>
<h3 id="correccion-de-drift"><a class="toclink" href="../../2025/10/18/terraform-en-azure-detecci%C3%B3n-y-correcci%C3%B3n-de-drift/#correccion-de-drift">Corrección de drift</a></h3>
<ol>
<li>
<p>Aplicar cambios:
</p><div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>terraform<span class="w"> </span>apply
</span></code></pre></div><p></p>
</li>
<li>
<p>Forzar recreación:
</p><div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>terraform<span class="w"> </span>taint<span class="w"> </span>azurerm_virtual_machine.example
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>terraform<span class="w"> </span>apply
</span></code></pre></div><p></p>
</li>
<li>
<p>Reimportar recursos:
</p><div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a>terraform<span class="w"> </span>import<span class="w"> </span>azurerm_virtual_machine.example<span class="w"> </span>/subscriptions/xxx/resourceGroups/xxx/providers/Microsoft.Compute/virtualMachines/xxx
</span></code></pre></div><p></p>
</li>
</ol>
<h3 id="buenas-practicas"><a class="toclink" href="../../2025/10/18/terraform-en-azure-detecci%C3%B3n-y-correcci%C3%B3n-de-drift/#buenas-practicas">Buenas prácticas</a></h3>
<ul>
<li>Auditar drift semanalmente</li>
<li>Usar Policy para detectar cambios manuales</li>
<li>Documentar excepciones</li>
<li>Validar con MCP y Terraform Registry</li>
</ul>
<h3 id="referencias"><a class="toclink" href="../../2025/10/18/terraform-en-azure-detecci%C3%B3n-y-correcci%C3%B3n-de-drift/#referencias">Referencias</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/developer/terraform/overview">Terraform Drift Detection</a></li>
<li><a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs">Terraform Registry azurerm</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/governance/policy/overview">Azure Policy</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-07-01 00:00:00+00:00">July 1, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure</a>, 
              <a class="md-meta__link" href="../security/">Security</a></li>
<li class="md-meta__item">
            
              5 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/"><strong>Scripts de Reporte para Credenciales Federadas de Azure: Visibilidad Total de tus Identidades Administradas</strong></a></h2>
<p>¡Hola a todos! En el mundo de la seguridad en la nube, mantener un control exhaustivo sobre las credenciales federadas es fundamental para una gestión de identidades robusta. Hoy quiero compartir con vosotros una solución que he desarrollado para resolver uno de los retos más comunes: <strong>generar reportes completos de las credenciales federadas de identidades administradas en Azure</strong>.</p>
<p>Si habéis trabajado con <strong>GitHub Actions</strong>, <strong>Azure DevOps</strong>, o cualquier sistema CI/CD que se integre con Azure usando identidades administradas, sabréis lo importante que es tener visibilidad sobre qué credenciales están configuradas, dónde y cómo.</p>
<h3 id="el-problema-falta-de-visibilidad"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#el-problema-falta-de-visibilidad"><strong>El Problema: Falta de Visibilidad</strong></a></h3>
<p>Cuando gestionáis múltiples suscripciones de Azure con decenas o cientos de identidades administradas, es muy difícil responder a preguntas básicas como:</p>
<ul>
<li>¿Qué credenciales federadas tengo configuradas en todas mis suscripciones?</li>
<li>¿Qué repositorios de GitHub tienen acceso a mis recursos de Azure?</li>
<li>¿Hay credenciales obsoletas que debería eliminar?</li>
<li>¿Cómo puedo auditar todas mis configuraciones de identidad federada?</li>
</ul>
<p>El portal de Azure nos permite ver esto recurso por recurso, pero no hay una vista consolidada que nos permita tener el "big picture" de toda nuestra configuración de seguridad.</p>
<h3 id="la-solucion-scripts-de-reporte-automatizados"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#la-solucion-scripts-de-reporte-automatizados"><strong>La Solución: Scripts de Reporte Automatizados</strong></a></h3>
<p>He desarrollado una solución completa que incluye scripts tanto en <strong>Python</strong> como en <strong>PowerShell</strong> para generar reportes detallados de todas las credenciales federadas de identidades administradas en vuestro entorno Azure.</p>
<h4 id="caracteristicas-principales"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#caracteristicas-principales"><strong>Características Principales</strong></a></h4>
<p>✅ <strong>Soporte Multi-Suscripción</strong>: Procesa todas las suscripciones disponibles o las que especifiquéis<br>
✅ <strong>Filtrado por Tenant</strong>: Permite filtrar suscripciones por tenant específico<br>
✅ <strong>Múltiples Formatos</strong>: Exporta a JSON, CSV y Excel<br>
✅ <strong>Logging Robusto</strong>: Logs detallados separados de los datos de salida<br>
✅ <strong>Validación de Datos</strong>: Evita procesar identidades con datos inválidos<br>
✅ <strong>Autenticación Flexible</strong>: Soporta Managed Identity, Azure CLI, MFA, etc.<br>
✅ <strong>Archivo de Tuplas</strong>: Genera un archivo adicional con solo las tuplas de credenciales  </p>
<h4 id="que-informacion-captura"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#que-informacion-captura"><strong>¿Qué Información Captura?</strong></a></h4>
<p>Los scripts capturan información completa tanto de las identidades administradas como de sus credenciales federadas:</p>
<p><strong>Información de la Identidad:</strong>
- Nombre y ID de la identidad
- Grupo de recursos y ubicación
- Principal ID y Client ID
- Tenant ID</p>
<p><strong>Información de las Credenciales Federadas:</strong>
- Nombre e ID de la credencial
- Issuer (emisor)
- Subject (sujeto)
- Audiences (audiencias)
- Descripción y tipo</p>
<p><strong>Metadatos del Reporte:</strong>
- ID y nombre de la suscripción
- Tenant ID
- Timestamp del reporte</p>
<h3 id="como-empezar"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#como-empezar"><strong>¿Cómo Empezar?</strong></a></h3>
<h4 id="requisitos-previos"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#requisitos-previos"><strong>Requisitos Previos</strong></a></h4>
<p><strong>Para Python:</strong>
</p><div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a>pip<span class="w"> </span>install<span class="w"> </span>azure-identity<span class="w"> </span>azure-mgmt-msi<span class="w"> </span>azure-mgmt-resource<span class="w"> </span>pandas<span class="w"> </span>openpyxl
</span></code></pre></div><p></p>
<p><strong>Para PowerShell:</strong>
</p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">Az</span><span class="p">.</span><span class="n">Accounts</span><span class="p">,</span> <span class="n">Az</span><span class="p">.</span><span class="n">ManagedServiceIdentity</span><span class="p">,</span> <span class="n">Az</span><span class="p">.</span><span class="n">Resources</span><span class="p">,</span> <span class="n">ImportExcel</span>
</span></code></pre></div><p></p>
<h4 id="ejemplos-de-uso"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#ejemplos-de-uso"><strong>Ejemplos de Uso</strong></a></h4>
<p><strong>Script de Python:</strong>
</p><div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c1"># Reporte de todas las suscripciones</span>
</span><span id="__span-26-2"><a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a>python<span class="w"> </span>federated-identity-credentials-report.py<span class="w"> </span>--all-subscriptions<span class="w"> </span>--format<span class="w"> </span>excel
</span><span id="__span-26-3"><a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a>
</span><span id="__span-26-4"><a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="c1"># Reporte filtrado por tenant</span>
</span><span id="__span-26-5"><a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a>python<span class="w"> </span>federated-identity-credentials-report.py<span class="w"> </span>--tenant-id<span class="w"> </span><span class="s2">"your-tenant-id"</span><span class="w"> </span>--all-subscriptions<span class="w"> </span>--format<span class="w"> </span>json
</span><span id="__span-26-6"><a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a>
</span><span id="__span-26-7"><a href="#__codelineno-26-7" id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="c1"># Reporte de una suscripción específica</span>
</span><span id="__span-26-8"><a href="#__codelineno-26-8" id="__codelineno-26-8" name="__codelineno-26-8"></a>python<span class="w"> </span>federated-identity-credentials-report.py<span class="w"> </span>--subscription-id<span class="w"> </span><span class="s2">"12345678-1234-1234-1234-123456789012"</span><span class="w"> </span>--format<span class="w"> </span>csv
</span></code></pre></div><p></p>
<p><strong>Script de PowerShell:</strong>
</p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-27-1"><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="c"># Reporte de todas las suscripciones</span>
</span><span id="__span-27-2"><a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="p">.\</span><span class="n">federated-identity-credentials-report</span><span class="p">.</span><span class="n">ps1</span> <span class="n">-AllSubscriptions</span> <span class="n">-Format</span> <span class="n">Excel</span>
</span><span id="__span-27-3"><a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a>
</span><span id="__span-27-4"><a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="c"># Reporte filtrado por tenant</span>
</span><span id="__span-27-5"><a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="p">.\</span><span class="n">federated-identity-credentials-report</span><span class="p">.</span><span class="n">ps1</span> <span class="n">-TenantId</span> <span class="s2">"your-tenant-id"</span> <span class="n">-AllSubscriptions</span> <span class="n">-Format</span> <span class="n">JSON</span>
</span><span id="__span-27-6"><a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a>
</span><span id="__span-27-7"><a href="#__codelineno-27-7" id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="c"># Reporte de un grupo de recursos específico</span>
</span><span id="__span-27-8"><a href="#__codelineno-27-8" id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="p">.\</span><span class="n">federated-identity-credentials-report</span><span class="p">.</span><span class="n">ps1</span> <span class="n">-SubscriptionId</span> <span class="s2">"12345678-1234-1234-1234-123456789012"</span> <span class="n">-ResourceGroupName</span> <span class="s2">"my-rg"</span> <span class="n">-Format</span> <span class="n">CSV</span>
</span></code></pre></div><p></p>
<h3 id="caracteristicas-avanzadas"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#caracteristicas-avanzadas"><strong>Características Avanzadas</strong></a></h3>
<h4 id="archivo-de-tuplas-de-credenciales"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#archivo-de-tuplas-de-credenciales"><strong>Archivo de Tuplas de Credenciales</strong></a></h4>
<p>Además del reporte principal, los scripts generan automáticamente un archivo adicional con solo las tuplas de credenciales (<code>credential_issuer</code>, <code>credential_subject</code>, <code>credential_audiences</code>, <code>credential_type</code>). Esto es especialmente útil para:</p>
<ul>
<li>Análisis de patrones de configuración</li>
<li>Auditorías de seguridad</li>
<li>Integración con otras herramientas de análisis</li>
</ul>
<h4 id="logging-separado"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#logging-separado"><strong>Logging Separado</strong></a></h4>
<p>Una característica importante es que los logs nunca se mezclan con los datos de salida. Los logs van a <code>stderr</code> y a un archivo de log separado, mientras que los datos puros van a <code>stdout</code> o al archivo especificado. Esto es crucial para la automatización y integración con pipelines de CI/CD.</p>
<h4 id="validacion-de-datos"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#validacion-de-datos"><strong>Validación de Datos</strong></a></h4>
<p>Los scripts incluyen validación robusta para evitar procesar identidades con nombres vacíos o nulos, lo que puede ocurrir en ciertos escenarios de configuración incompleta.</p>
<h3 id="casos-de-uso-reales"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#casos-de-uso-reales"><strong>Casos de Uso Reales</strong></a></h3>
<h4 id="1-auditoria-de-seguridad"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#1-auditoria-de-seguridad"><strong>1. Auditoría de Seguridad</strong></a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1"># Generar reporte completo en Excel para auditoría</span>
</span><span id="__span-28-2"><a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a>python<span class="w"> </span>federated-identity-credentials-report.py<span class="w"> </span>--all-subscriptions<span class="w"> </span>--format<span class="w"> </span>excel<span class="w"> </span>--output<span class="w"> </span>security-audit-<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>.xlsx
</span></code></pre></div>
<h4 id="2-cleanup-de-credenciales-obsoletas"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#2-cleanup-de-credenciales-obsoletas"><strong>2. Cleanup de Credenciales Obsoletas</strong></a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c1"># Exportar a CSV para análisis con herramientas de datos</span>
</span><span id="__span-29-2"><a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a>python<span class="w"> </span>federated-identity-credentials-report.py<span class="w"> </span>--all-subscriptions<span class="w"> </span>--format<span class="w"> </span>csv<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"old-repo-name"</span>
</span></code></pre></div>
<h4 id="3-monitoreo-continuo"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#3-monitoreo-continuo"><strong>3. Monitoreo Continuo</strong></a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="c1"># Integrar en pipeline de CI/CD para monitoreo continuo</span>
</span><span id="__span-30-2"><a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a>python<span class="w"> </span>federated-identity-credentials-report.py<span class="w"> </span>--tenant-id<span class="w"> </span><span class="s2">"</span><span class="nv">$TENANT_ID</span><span class="s2">"</span><span class="w"> </span>--all-subscriptions<span class="w"> </span>--format<span class="w"> </span>json<span class="w"> </span>&gt;<span class="w"> </span>daily-report.json
</span></code></pre></div>
<h3 id="estructura-de-archivos-generados"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#estructura-de-archivos-generados"><strong>Estructura de Archivos Generados</strong></a></h3>
<p><strong>Archivo Principal</strong> (<code>federated_identity_credentials_report_YYYYMMDD_HHMMSS.json/csv/xlsx</code>):
</p><div class="language-json highlight"><pre><span></span><code><span id="__span-31-1"><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="p">[</span>
</span><span id="__span-31-2"><a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-31-3"><a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="w">    </span><span class="nt">"identity_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"github-actions-identity"</span><span class="p">,</span>
</span><span id="__span-31-4"><a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">    </span><span class="nt">"identity_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/subscriptions/.../userAssignedIdentities/github-actions-identity"</span><span class="p">,</span>
</span><span id="__span-31-5"><a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="w">    </span><span class="nt">"identity_resource_group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"security-rg"</span><span class="p">,</span>
</span><span id="__span-31-6"><a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">    </span><span class="nt">"identity_location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eastus"</span><span class="p">,</span>
</span><span id="__span-31-7"><a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="w">    </span><span class="nt">"credential_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GitHub-Main-Branch"</span><span class="p">,</span>
</span><span id="__span-31-8"><a href="#__codelineno-31-8" id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="w">    </span><span class="nt">"credential_issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://token.actions.githubusercontent.com"</span><span class="p">,</span>
</span><span id="__span-31-9"><a href="#__codelineno-31-9" id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="w">    </span><span class="nt">"credential_subject"</span><span class="p">:</span><span class="w"> </span><span class="s2">"repo:myorg/myrepo:ref:refs/heads/main"</span><span class="p">,</span>
</span><span id="__span-31-10"><a href="#__codelineno-31-10" id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="w">    </span><span class="nt">"credential_audiences"</span><span class="p">:</span><span class="w"> </span><span class="s2">"api://AzureADTokenExchange"</span><span class="p">,</span>
</span><span id="__span-31-11"><a href="#__codelineno-31-11" id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="w">    </span><span class="nt">"subscription_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Production"</span><span class="p">,</span>
</span><span id="__span-31-12"><a href="#__codelineno-31-12" id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="w">    </span><span class="nt">"tenant_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345678-1234-1234-1234-123456789012"</span><span class="p">,</span>
</span><span id="__span-31-13"><a href="#__codelineno-31-13" id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="w">    </span><span class="nt">"report_timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-07-01T10:30:00"</span>
</span><span id="__span-31-14"><a href="#__codelineno-31-14" id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-31-15"><a href="#__codelineno-31-15" id="__codelineno-31-15" name="__codelineno-31-15"></a><span class="p">]</span>
</span></code></pre></div><p></p>
<p><strong>Archivo de Tuplas</strong> (<code>credential_tuples_YYYYMMDD_HHMMSS.json/csv/xlsx</code>):
</p><div class="language-json highlight"><pre><span></span><code><span id="__span-32-1"><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="p">[</span>
</span><span id="__span-32-2"><a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-32-3"><a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="w">    </span><span class="nt">"credential_issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://token.actions.githubusercontent.com"</span><span class="p">,</span>
</span><span id="__span-32-4"><a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="w">    </span><span class="nt">"credential_subject"</span><span class="p">:</span><span class="w"> </span><span class="s2">"repo:myorg/myrepo:ref:refs/heads/main"</span><span class="p">,</span>
</span><span id="__span-32-5"><a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="w">    </span><span class="nt">"credential_audiences"</span><span class="p">:</span><span class="w"> </span><span class="s2">"api://AzureADTokenExchange"</span><span class="p">,</span>
</span><span id="__span-32-6"><a href="#__codelineno-32-6" id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="w">    </span><span class="nt">"credential_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.ManagedIdentity/userAssignedIdentities/federatedIdentityCredentials"</span>
</span><span id="__span-32-7"><a href="#__codelineno-32-7" id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-32-8"><a href="#__codelineno-32-8" id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="p">]</span>
</span></code></pre></div><p></p>
<h3 id="mejores-practicas-de-uso"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#mejores-practicas-de-uso"><strong>Mejores Prácticas de Uso</strong></a></h3>
<h4 id="1-automatizacion"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#1-automatizacion"><strong>1. Automatización</strong></a></h4>
<p>Integrad estos scripts en vuestros pipelines de CI/CD para generar reportes automáticos:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-33-1"><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="c1"># GitHub Actions ejemplo</span>
</span><span id="__span-33-2"><a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate Federated Credentials Report</span>
</span><span id="__span-33-3"><a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-33-4"><a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="w">    </span><span class="no">python federated-identity-credentials-report.py --all-subscriptions --format json --output report-${{ github.run_number }}.json</span>
</span><span id="__span-33-5"><a href="#__codelineno-33-5" id="__codelineno-33-5" name="__codelineno-33-5"></a>
</span><span id="__span-33-6"><a href="#__codelineno-33-6" id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload Report as Artifact</span>
</span><span id="__span-33-7"><a href="#__codelineno-33-7" id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v3</span>
</span><span id="__span-33-8"><a href="#__codelineno-33-8" id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="w">  </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-33-9"><a href="#__codelineno-33-9" id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">federated-credentials-report</span>
</span><span id="__span-33-10"><a href="#__codelineno-33-10" id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">report-*.json</span>
</span></code></pre></div>
<h4 id="2-monitoreo-regular"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#2-monitoreo-regular"><strong>2. Monitoreo Regular</strong></a></h4>
<p>Ejecutad los scripts de forma regular (diaria o semanal) para detectar cambios no autorizados:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="c1"># Cron job ejemplo</span>
</span><span id="__span-34-2"><a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="m">0</span><span class="w"> </span><span class="m">6</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span><span class="m">1</span><span class="w"> </span>/usr/bin/python3<span class="w"> </span>/path/to/federated-identity-credentials-report.py<span class="w"> </span>--all-subscriptions<span class="w"> </span>--format<span class="w"> </span>excel<span class="w"> </span>--output<span class="w"> </span>/reports/weekly-<span class="k">$(</span>date<span class="w"> </span>+<span class="se">\%</span>Y<span class="se">\%</span>m<span class="se">\%</span>d<span class="k">)</span>.xlsx
</span></code></pre></div>
<h4 id="3-analisis-de-drift"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#3-analisis-de-drift"><strong>3. Análisis de Drift</strong></a></h4>
<p>Comparad reportes de diferentes fechas para detectar cambios de configuración:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="c1"># Comparar reportes para detectar cambios</span>
</span><span id="__span-35-2"><a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a>diff<span class="w"> </span>&lt;<span class="o">(</span>jq<span class="w"> </span>-S<span class="w"> </span>.<span class="w"> </span>report-20250701.json<span class="o">)</span><span class="w"> </span>&lt;<span class="o">(</span>jq<span class="w"> </span>-S<span class="w"> </span>.<span class="w"> </span>report-20250708.json<span class="o">)</span>
</span></code></pre></div>
<h3 id="consideraciones-de-seguridad"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#consideraciones-de-seguridad"><strong>Consideraciones de Seguridad</strong></a></h3>
<p>⚠️ <strong>Permisos Mínimos</strong>: Los scripts requieren permisos de lectura sobre las identidades administradas y sus credenciales federadas<br>
⚠️ <strong>Datos Sensibles</strong>: Los reportes contienen información de configuración sensible - almacenadlos de forma segura<br>
⚠️ <strong>Logs</strong>: Revisad los logs regularmente para detectar errores de autenticación o acceso  </p>
<h3 id="conclusion"><a class="toclink" href="../../2025/07/01/scripts-de-reporte-para-credenciales-federadas-de-azure-visibilidad-total-de-tus-identidades-administradas/#conclusion"><strong>Conclusión</strong></a></h3>
<p>Tener visibilidad completa sobre las credenciales federadas de vuestras identidades administradas es fundamental para mantener una postura de seguridad sólida en Azure. Estos scripts os permitirán:</p>
<ul>
<li><strong>Reducir el riesgo de seguridad</strong> mediante auditorías regulares</li>
<li><strong>Cumplir con requisitos de compliance</strong> generando reportes detallados</li>
<li><strong>Optimizar la gestión</strong> identificando credenciales obsoletas o mal configuradas</li>
<li><strong>Automatizar el monitoreo</strong> integrando los scripts en vuestros procesos existentes</li>
</ul>
<p>Los scripts están disponibles en mi repositorio y son completamente gratuitos y de código abierto. Si os resultan útiles, no dudéis en contribuir con mejoras o reportar issues.</p>
<p>¡Espero que esta herramienta os ayude a mantener vuestros entornos Azure más seguros y mejor documentados!</p>
<p><strong>Enlaces útiles:</strong>
- 📖 <a href="https://rfernandezdo.github.io/Tools/Federated_Identity_Credentials_Report/README-federated-identity-credentials/">Documentación completa y scripts</a></p>
<hr>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2025-06-22 00:00:00+00:00">June 22, 2025</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure</a></li>
<li class="md-meta__item">
            
              3 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="os-presento-inventariographdrawio-de-vuestro-azure-a-un-diagrama-automaticamente"><a class="toclink" href="../../2025/06/22/os-presento-inventariographdrawio-de-vuestro-azure-a-un-diagrama-autom%C3%A1ticamente/"><strong>Os presento <code>inventariographdrawio</code>: De vuestro Azure a un Diagrama, Automáticamente</strong></a></h2>
<p>¡Hola a todos! Como muchos profesionales que trabajáis día a día con la nube, seguro que os habéis enfrentado al mismo reto que yo una y otra vez: mantener una documentación visual de la infraestructura que sea fiel a la realidad. Dibujar diagramas a mano es tedioso y, peor aún, quedan obsoletos casi al instante.</p>
<p>Cansado de esta tarea manual y de la eterna duda de si un diagrama reflejaba o no el estado real de los recursos, decidí que tenía que haber una forma mejor de hacerlo.</p>
<p>Por eso, hoy quiero presentaros con mucha ilusión un proyecto personal en el que he estado trabajando: <strong><a href="https://github.com/rfernandezdo/inventariographdrawio">inventariographdrawio</a></strong>.</p>
<h3 id="que-es-inventariographdrawio"><a class="toclink" href="../../2025/06/22/os-presento-inventariographdrawio-de-vuestro-azure-a-un-diagrama-autom%C3%A1ticamente/#que-es-inventariographdrawio"><strong>¿Qué es <code>inventariographdrawio</code>?</strong></a></h3>
<p>Es una herramienta de línea de comandos que he creado para solucionar este problema de raíz. Se conecta a una suscripción de <strong>Microsoft Azure</strong>, analiza los recursos que tienes desplegados y genera automáticamente un diagrama limpio y organizado en formato <strong>Draw.io</strong> (diagrams.net).</p>
<p>En pocas palabras, es mi solución para pasar de la infraestructura real en Azure a un diagrama editable, sin esfuerzo y en segundos.</p>
<h5 id="por-que-lo-cree-mis-objetivos-principales"><a class="toclink" href="../../2025/06/22/os-presento-inventariographdrawio-de-vuestro-azure-a-un-diagrama-autom%C3%A1ticamente/#por-que-lo-cree-mis-objetivos-principales"><strong>¿Por qué lo creé? (Mis Objetivos Principales)</strong></a></h5>
<p>Cuando empecé a desarrollar esta herramienta, tenía varios objetivos en mente:</p>
<ol>
<li><strong>Ahorrar tiempo:</strong> Mi primer objetivo era eliminar las horas que todos perdemos en tareas de documentación repetitivas. Quería que el análisis y el dibujo lo hiciera una máquina, para poder dedicar mi tiempo a lo que de verdad importa: diseñar y mejorar la arquitectura.</li>
<li><strong>Tener una fuente de la verdad:</strong> Necesitaba un diagrama en el que pudiera confiar. Con <code>inventariographdrawio</code>, el resultado es un reflejo exacto de lo que hay desplegado, perfecto para auditorías, revisiones o para explicarle la arquitectura a un nuevo compañero.</li>
<li><strong>Mejorar la visibilidad:</strong> A veces, en el portal de Azure es difícil ver el "big picture". Representar los recursos de forma gráfica me ayuda a entender las dependencias y la estructura general de un solo vistazo.</li>
<li><strong>Enfocarme en Azure:</strong> Decidí centrarme exclusivamente en Azure para poder ofrecer un buen nivel de detalle y precisión en los recursos y servicios específicos de la plataforma, que es donde trabajo principalmente.</li>
</ol>
<h3 id="como-podeis-empezar-a-usarlo"><a class="toclink" href="../../2025/06/22/os-presento-inventariographdrawio-de-vuestro-azure-a-un-diagrama-autom%C3%A1ticamente/#como-podeis-empezar-a-usarlo"><strong>¿Cómo podéis empezar a usarlo?</strong></a></h3>
<p>He intentado que sea lo más sencillo posible. Solo tenéis que seguir estos pasos:</p>
<ol>
<li>
<p><strong>Clonar el repositorio:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/rfernandezdo/inventariographdrawio.git
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="nb">cd</span><span class="w"> </span>inventariographdrawio
</span></code></pre></div>
</li>
<li>
<p><strong>Instalar las dependencias:</strong>
    La herramienta tiene unas pocas dependencias que podéis instalar fácilmente (revisad el fichero <code>README.md</code> para las instrucciones exactas).</p>
</li>
<li>
<p><strong>Configurar el acceso a Azure:</strong>
    Aseguraos de tener vuestra sesión de Azure activa (por ejemplo, con <code>az login</code> desde Azure CLI) para que la herramienta pueda autenticarse y leer los recursos.</p>
</li>
<li>
<p><strong>Ejecutar y ¡listo!</strong>
    Lanzad el script y veréis cómo aparece un nuevo fichero <code>.drawio</code> en la carpeta del proyecto, listo para abrir y editar.</p>
</li>
</ol>
<p>Aquí un ejemplo navegable de un diagrama de Azure con iconos, creado con <a href="https://draw.io">draw.io</a> y exportado como un enlace para visualizarlo directamente en el navegador, es navegable:</p>
<p><a href="https://viewer.diagrams.net/?p=ex&amp;?tags=%7B%7D&amp;lightbox=1&amp;highlight=0000ff&amp;layers=1&amp;nav=1&amp;title=azure_full_hierarchy_with_icons.drawio&amp;dark=auto#R%3Cmxfile%3E%3Cdiagram%20id%3D%22main-diagram%22%20name%3D%22Azure%20Infrastructure%22%3E7V1tb%2BM2Ev41%2BzGC%2BE5%2B7O52ewXaQ3EL3H0MZFt21NpWICvJpr%2F%2BaFuKLVLURInoMEyzQNamNY6keTSceWY4%2FES%2BbH78UmW3N7%2BXi3z9CaeLH5%2FI108YU5oy%2Fd9%2B5PE4gpCSx5FVVSyasdPA9%2BLvvBlMm9G7YpHvOgfWZbmui9vu4LzcbvN53RnLqqp86B62LNfdv3qbrXJr4Ps8W9uj%2FysW9c1xFBOiTh%2F8Ky9WN%2B2f5oweP9lk7dHNpexuskX5cDZEfv5EvlRlWR9fbX58ydf729femKPcN8enT2dW5du6R6Cc%2Fbm%2FIThdZzOtlcMBnzBf62M%2Fz%2FSL1f7F4vE%2Bv6pWV1m2WOyuFvmmbA%2FR3%2FN0VHPfH2%2Bbm7Ip5lW5K5d1UuW78q6aaw3hb7u72W5eFbd1UW7379vPVlV5p7V1%2BI725LcaKVenm%2FB0cbv6sb3zxeagms%2FZ7vao2GXxI9fin2%2Fqzf5ykH55Wxbb%2BqBh9vkT%2B7o%2Fel2stnpgrm9KXumBZbmtG1gh%2Fdc%2BN1%2F7tdis9DmuC32R37K%2F76p8f%2BdW%2BTavMn0i3%2F7TnPz1L4ezT3b3K%2Ft%2BNyq4z6s6%2F3E21FzTL3m5yevqUR%2FSfpoicpRpngeZNmh5OIFLNni5OYNVO5Y1cF49ffVJ4fpFcx%2Fbtw0ERsIhWyxfjActpw9clJus2O7y6r44QMPSPApO89rKbOui1jf028%2Fbusquvx6u4fp7cxFTAUAhFZzCF7u%2Frh6K7f0GXZW7cfqel5vbuzrf67zY%2FdWnahycqk%2Fn%2FHV%2FzpNpNmDFYg%2BKJR9EsZymwSn2ftM8sC9V6n1R1XfZepPNb4ptr4mmAav3v8ezv%2F79ePoTKZpIlEjBOvMzTlGwysf%2BlM8%2BnPKFlAnH70D5q4erJtbRbvbV%2FTav0VVdHl6MBISWeCirvw43t%2F3CPjDw4MDQnHmx3X%2F25XTyU03lCNOEhaT6ozvOlgvEST4TizmibDabZTOylCnBSzSnKeZX69lLEbAus8UsW2fbeV71YUCEjYHf9Olff27PfyIYUKRCRAHPab5ckuWMZ4yqNJfLbDbHfDFfLMQs5wuPKJAfEAWSBYkCIWZKZIIvsnxBZwuVZYpLxZbzlOQso4urbTF%2FKQyebqpWyDLrj%2BBV2FD49%2FHN9a9P1zARHDCiMkQ8KIznqUILRPic4pm2CoLOZ3QusrmQSKa%2B8YDCI%2FMuAwhEFAsREMtcZct8oYikc0oxVrM0Q7NsucxyMcvm0jsgwuP4LgQIrgLzHg%2BBg1Z3S%2FKlXvUeHuF3Gb0LknTDR56ScFGAPaMgPHbwMijgKXoPMNi1Kb8qH8khWjjY5fO7qqgfnWk%2BFB6V2IuF782FTJzyY0q9E0Tcb0YmCV6AhfCYxUtiQTAeNhaeSTTdFrcvRcrt3WxdzItb%2FYeqfLfrnz0Cpxz%2FOFzD9a9%2FXP%2FUXsVU4aXC7wEgIAflGyCB85H%2BACKpChkeh7lEK%2F%2Fqfrt6uNYvXuxdPAsGgROS%2FmCAkErDNhQWErBXJATOR3pEAiHsHSBhn7fcPK6yOn%2FIHl%2BKhCZx3Qw0X9ZbdBQ4G9nmsFt385fmUqbCBKZdRGinLTxE6DtyDEKngUMvDgInIQ0cTKZ%2Fimnw%2Bq9WV1W%2BKev80mXHODyG0nvdMU3NwDPEyuOe4hbcFre82JEcLm7BgROV01e3YIrTEPMTZ5Tki13F59JQ%2BENTkno6EO%2FAZbwQJYk%2FNCWJGafvAAttIIm9cwr443KPqF10916A4JVSwB%2BWY0SKyeCB0CEUXgyE5zMKgVONvhkFpswAIsSY8sApHKNKj6RC4FyjL1JBSLO0ITAINJj%2FfjfT92My%2Fe8JBv2udwlc4DTj8U5MxiHw8GeF3fSk4pD%2BA6cXJ9a%2FFB39h7g86qD%2FVwSNo7QfHo%2FoUftIdBPPggS1LPbytj9w4nBS7Wt1839sf1f%2FgVOI0z79nOJ%2FbP%2B59gMnDad9%2BnmKE%2FxW6SOr8VG%2BWDW9gzr3fD%2F8vXlbVvVNuSq32frn0%2BjnqrzbLvZq%2BJrqd6djfivL20Ypf%2BZ1%2Fdjc8uyuLrsqy7eLn%2FY9pfY6Wme7XTHXg9vy7G8cDjt9czPg1MEx13eGq%2Bam1lm1yuuz8eZy99c4qLEqX2d1cZ93%2FkrfvT%2BI6ovZF2M8HdBA8vTNf%2BwHTkAgClsdEsixvPvUpsqU6XKKhOExhzNGPB4u2PC5o1QDn2LJBGp%2Bd8VVp%2BGWfnG8oSdQP2mmD%2Bf9wG6RERmw295tYQIbKdb1btGxUN2NDJ6aaRPE0FgR6GFAjJqUywtEoIcCqVS8TgB8jlBKktNDhFWXSPDyHOFInyMe9INEiFm%2FLpozdttYRBJ%2B%2FtMVl3x6bJA4sYGFAxsYBwEOpMwHH8IGUTJJT3bDIKCEwtNjg0aKDdcE3Ex0b44NKniCznyt7oyEgblVWOkpptD04GCRgiN1gIOEMasggkVCjMCDQS4alSgh5z%2F%2B8cEjxYd0TSw8DHxwbDm9xyViTnRoRzn1jwcRJx6Yy1wEgQaZcoulQFINwoHLLhqM%2BG8aNMg40eCKSFqr8dbGAZM0kc55ACEg2CXSXL8PRvq2CBi2c6tAn%2FiIilWcEHQFPiiM%2BYlo79TgzyHYMSPhBmHOPB4C3GuPB5lWiwjwMsGiSPMAbo8rkFCes9EeF6ZoFIQsAZBmpNrSkxPP2DX0QkoP%2BIuUrnd5eGHEg0Ipq1kzlIeSLDVtMGTzekQgzDKjcnrs8XBGSkOcYSJTdfxtsqU%2BMlI4Tow7WY92i463trFYwxyZAASsLCLCbAfgZ%2BKNlUN3TbwkjOAWcasKGyLCtCFTHSLsEvCIlUZ3Uh9h0OjYTjILJIfhwZEl4iOxgiIlz1vDYLvqYUwj2jMyQjeAC0NC4kSdVb0YxLkPagxFypy7sm4EBYENpHA3xALZMMbYQFLFoFknwkakLHprH2zDQcMAh0xlwp0pWSjc36ffpNvr8IKUSBl2V1VoG5m9MVAotjfOIkBpB0M4MUUgCtIWgcJr7fia8ZMXbzdSWt3l2YTBAnHaLceF5i7BUiuchmj1PhkIp1PJgNwRHsk14bFcE6aJSqng6PAbd6WlhxgBR0rnO93AQGZ6pbqTO%2BgGcp6attiL7%2Fd0RyMDBHEhAgWCCKqYbcQAih0Ri5sC8962CFh9zlN9amf1woZf6mOCxzhSGLo8y1BCEN43l0IwFMSqpYBgaIuA2UmKSAeGF%2FAzcayku7OEKIwAxyoWBAvXKaIJPitnvsSCl0gpd%2BSaKsOIQhAXtisEuU%2BUjq4ps0VAo4aUuSXVC0TA6RiZ%2FPBYATgO4fphOqW8jaV6QnhYIYQjTVY4l4EE8jBR3o3pGYJyFXhcXZolAKNP4XPG2yAdvKxPw5FmQ1x8Uhi5U2HkyaA1wPvyIHNRip8gONIEiCuX3s4Pb72OAMueKrNhx09KNrrKzBaBjBhH4iK8No40n4JdhgiHMQ1iouhAbAm6l2L8kgVbBKZudABsYt1LYBNpdqXN3lkoDIR7IcJKt6lhFDE8OkPXIwIBj%2Bp5F0g3TgM8Emk2wm3%2BAqFbGOYDpQOQ%2BcOCjjN%2BlgCEwNcLgOziqwXgxRJ6jnFXeXkpAWyzHrE9UMRVSd5KvLUpZ6mRKoZKACkW5w17pFn746EEkOA4weGc5tsLfmtw2PM8SG8jKQdScH5sR6S5D%2BKKgnEYrAjmZHBm6BHAciB4McrRJwJHrLkP18QSRpyKCFfjcx9ofO7DEoETGXx87sMSAcnkVI7MfZgCMPvMZNLUX%2B1%2FN0VXp9xHR3yihynW3Ier3jqUKiyhupktg03pST0qDDGUE0Ei0oSEMx0Wim9GtaN13n%2B2%2B%2FiD2TEpDAHIPpkCoH3C2nuk6vRjFDr4WHNPIk2HuNeDBAJG2dNlaxiAmLW29bk0hikA0xgcuxep%2BMFfpFkRdyQSyEJGu%2BeIAGZIq68XBCdLALaYVAxUehkPyEQAjDUh4uKlA5mNdSg7minBaTqM2WkgQWNNVTjnxDDYESQJdbccgtrW9qzW95LHb%2FsoxYYO5JqxAjEYPW2JoW4MSP8b6FboxaFpo4ro4IEd8AiDPbMXp8K98lOZnBbkIXUBbERKuyNXy8hAsCHVSGRoN%2FSsRBobcZAPnrCthI0OGq5FUWFAA3FisuEwOiRPzrK5Zr5O%2BkBHpCyyczlKKC1dhJJjm80i014gKTwg4sORyIEgglK7xg5KLTAiLpNaoJGyuc6VtUFggqY9vTCAoiBMuj6Jlx75NFJy1cVjhOFTYMzo6ES%2BYOOrzC0RuHISvVIArpx8rcAztr9TySmHL0wO0cs2VpFyxGGH9Djt0jXOZwh6YCCwP%2FNzJ5Sf%2BTmEbKV4chZ0GhOEF2CzSJluZ%2FIjDGT3LDmDo07S3dLNoDKFB7qKfTSmOwx0ICEGWWsQKUokJytiFrn54DUbwxkfUFz9ywMByn4zprFmRLDkjPM2F6r42PKARcp6O6mKYNqOMZRIZzoV2vuACzJghby0nGWRkuDuNYJh7OqGKTcNCbhnuxxfeW6LwDu58Yvs5MZi5dfDbhLSUwMErYqWanSDhx4ReLOiCxG2LFYa34G7MGZGbLFzw8aOUmLBwUtzGhYpf09ceAhlw3RtRYaW2UmgzkjidGgJp49VeixSbh8HvkoPU3uZELh7uuV8g239zP0W4bZ%2BquPrG33ZvNBDkbLiznWioaSgWYpGFyVQJRPutFBeJjMeKbkcNikkCR%2BbfFRU2r33gGCuTwbyqqeSgaynGBkgmMfDxpai5MShpYa0jxaqPFIq3tm6P5hmL0yO3o4H0Z7GhT5oi3YXkdhQ4fQBURh8GcLC7poGEqo2W%2B9lfQr%2FaHQ7CWPi1U63Oq8LthYvAjECI3TAQ%2FPCt7f9oaODirM5RRjNcJFQLBEDnQiAPYjJPgZ175bhBSqRMuTY5c23RdxvDRU9R4zcohqZjSP8TDOxMtdO2xEIVSl5mqQD3QSBumOuxq3JtwTgVf%2FCEPDi%2BkbKlDs37wnEyUHcXGQNZooxtsuhoVRxjwyYK8bMYj78RF2RMu9hL%2BLs6W0N8Vpcg8iM0iDk9clAyJtKBjLF1JzXRx4P81pIDTTI8rKykceaRHAtWQoliWAvfIVKLxCxXVEoj2WLgGacIW6zxMgD9ESk%2BQmXCxGGHUepGmp3DCayEDEbi4LOhC0Cty%2BdQgRuYMpGpoVNgWd0PCVJevZjpio61zTRYxVrqsK5CDWMjm5IIDI%2BVSGNLdi8eMxtH8zYIOGkCgIpc9Nh1OhCAZFaGxF5qQ4QsaYpnI0fcRigYDId2A8G3oxXyAHq2gvXIyJNUyCX%2FQjEU9Ne%2BPjeOChxL2GVPtyNWBMTzgAykMmFUjE2gBR07MbwPSLwmhGBLhRAxpoCcXq6gUxhNvTgacvCkZfNhkWkaQlnAX8odVqYqo5XY6gaqt83V0lDcbUpANoxlqYJdW4Q56WztYg0T%2BHK2KMwMvaKjw%2B6UkUtGYjV6pEBp8aJZMAVd0bDzVcWIOi3VVnW54dX2e3N71rp%2ByP%2BDw%3D%3D%3C%2Fdiagram%3E%3C%2Fmxfile%3E#%7B%22pageId%22%3A%22main-diagram%22%7D">Microsoft Entra Domain Services con Replica Set en una vpn Vnet2Vnet</a></p>
<h3 id="el-futuro"><a class="toclink" href="../../2025/06/22/os-presento-inventariographdrawio-de-vuestro-azure-a-un-diagrama-autom%C3%A1ticamente/#el-futuro"><strong>El futuro</strong></a></h3>
<p>Este es solo el comienzo del proyecto. Mi idea es seguir ampliándolo para que sea compatible con más servicios de Azure y añadir nuevas funcionalidades que lo hagan aún más útil.</p>
<p>Al ser un proyecto de código abierto, cualquier ayuda es bienvenida. Si os animáis, podéis abrir <em>issues</em> con sugerencias o incluso enviar vuestros propios <em>pull requests</em>.</p>
<p>Espero de corazón que esta herramienta os resulte útil y os ahorre tanto tiempo como a mí. </p>
<p>¡Gracias por leer!</p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-09-20 00:00:00+00:00">September 20, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure</a></li>
<li class="md-meta__item">
            
              2 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="microsoft-defender-for-storage"><a class="toclink" href="../../2024/09/20/microsoft-defender-for-storage/">Microsoft Defender for Storage</a></h2>
<p>Microsoft Defender for Storage is part of the Microsoft Defender for Cloud suite of security solutions.</p>
<h3 id="introduction"><a class="toclink" href="../../2024/09/20/microsoft-defender-for-storage/#introduction">Introduction</a></h3>
<p>Microsoft Defender for Storage is a cloud-native security solution that provides advanced threat protection for your Azure Storage accounts. </p>
<p>Microsoft Defender for Storage provides comprehensive security by analyzing the data plane and control plane telemetry generated by Azure Blob Storage, Azure Files, and Azure Data Lake Storage services. It uses advanced threat detection capabilities powered by Microsoft Threat Intelligence, Microsoft Defender Antivirus, and Sensitive Data Discovery to help you discover and mitigate potential threats.</p>
<p>Defender for Storage includes:</p>
<ul>
<li>Activity Monitoring</li>
<li>Sensitive data threat detection (new plan only)</li>
<li>Malware Scanning (new plan only)</li>
</ul>
<h3 id="how-it-works"><a class="toclink" href="../../2024/09/20/microsoft-defender-for-storage/#how-it-works">How it works</a></h3>
<p>Microsoft Defender for Storage uses advanced threat detection capabilities powered by Microsoft Threat Intelligence, Microsoft Defender Antivirus, and Sensitive Data Discovery to help you discover and mitigate potential threats.</p>
<h4 id="activity-monitoring"><a class="toclink" href="../../2024/09/20/microsoft-defender-for-storage/#activity-monitoring">Activity Monitoring</a></h4>
<p>Activity Monitoring provides insights into the operations performed on your storage accounts. It helps you understand the access patterns and operations performed on your storage accounts, and provides insights into the data plane and control plane activities.</p>
<h4 id="sensitive-data-threat-detection"><a class="toclink" href="../../2024/09/20/microsoft-defender-for-storage/#sensitive-data-threat-detection">Sensitive data threat detection</a></h4>
<p>Sensitive data threat detection helps you discover and protect sensitive data stored in your storage accounts. It uses advanced machine learning models to detect sensitive data patterns and provides recommendations to help you protect your sensitive data.</p>
<h4 id="malware-scanning"><a class="toclink" href="../../2024/09/20/microsoft-defender-for-storage/#malware-scanning">Malware Scanning</a></h4>
<p>Malware Scanning helps you detect and mitigate malware threats in your storage accounts. It uses advanced threat detection capabilities powered by Microsoft Defender Antivirus to scan your storage accounts for malware threats and provides recommendations to help you mitigate these threats.</p>
<h3 id="pricing"><a class="toclink" href="../../2024/09/20/microsoft-defender-for-storage/#pricing">Pricing</a></h3>
<p>The pricing for Microsoft Defender for Storage is as follows:</p>
<table>
<thead>
<tr>
<th>Resource Type</th>
<th>Resource</th>
<th>Price</th>
</tr>
</thead>
<tbody>
<tr>
<td>Storage</td>
<td>Microsoft Defender for Storage</td>
<td>€9 per storage account/month6</td>
</tr>
<tr>
<td>Storage</td>
<td>Malware Scanning (add-on to Defender for Storage)</td>
<td>€0.135/GB of data scanned</td>
</tr>
</tbody>
</table>
<p>For more information about pricing, see the <a href="https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/">Microsoft Defender for Cloud pricing</a>.</p>
<h3 id="conclusion"><a class="toclink" href="../../2024/09/20/microsoft-defender-for-storage/#conclusion">Conclusion</a></h3>
<p>Microsoft Defender for Storage is a cloud-native security solution that provides advanced threat protection for your Azure Storage accounts. It uses advanced threat detection capabilities powered by Microsoft Threat Intelligence, Microsoft Defender Antivirus, and Sensitive Data Discovery to help you discover and mitigate potential threats. </p>
<p>For more information about Microsoft Defender for Storage, see the <a href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-storage-introduction">Overview of Microsoft Defender for Storage</a></p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-04-20 00:00:00+00:00">April 20, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure</a></li>
<li class="md-meta__item">
            
              6 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="how-to-create-assigment-reports-for-azure-rbac"><a class="toclink" href="../../2024/04/20/how-to-create-assigment-reports-for-azure-rbac/">How to create assigment Reports for Azure RBAC</a></h2>
<p>Role-Based Access Control (RBAC) is a key feature of Azure that allows you to manage access to Azure resources. With RBAC, you can grant permissions to users, groups, and applications at a certain scope, such as a subscription, resource group, or resource. RBAC uses role assignments to determine what actions a user, group, or application can perform on a resource.</p>
<p>In this article, we will show you how to create reports for role assignments in Azure using PowerShell and the ImportExcel module. We will generate separate Excel files for role assignments at the subscription and management group levels, including information such as the role, principal, scope, and whether the assignment is inherited.</p>
<h3 id="role-assignment-report-in-excel"><a class="toclink" href="../../2024/04/20/how-to-create-assigment-reports-for-azure-rbac/#role-assignment-report-in-excel">Role assignment report in Excel</a></h3>
<p>This is the PowerShell script that generates the role assignment reports:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="cm">&lt;#</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="sd">.SYNOPSIS</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="cm">A script to get role assignments for Azure subscriptions and management groups.</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="sd">.DESCRIPTION</span>
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="cm">This script gets role assignments for specified or all Azure subscriptions and management groups,</span>
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="cm">and exports them to Excel files. It uses the ImportExcel module to create the Excel files.</span>
</span><span id="__span-2-8"><a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>
</span><span id="__span-2-9"><a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="sd">.PARAMETER</span><span class="cm"> SubscriptionId</span>
</span><span id="__span-2-10"><a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="cm">The ID of the Azure subscription. If not provided, the script gets role assignments for all subscriptions.</span>
</span><span id="__span-2-11"><a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a>
</span><span id="__span-2-12"><a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="sd">.PARAMETER</span><span class="cm"> ManagementGroupName</span>
</span><span id="__span-2-13"><a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="cm">The name of the Azure management group. If not provided, the script gets role assignments for all management groups.</span>
</span><span id="__span-2-14"><a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a>
</span><span id="__span-2-15"><a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="sd">.PARAMETER</span><span class="cm"> GetSubscriptions</span>
</span><span id="__span-2-16"><a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="cm">Specifies whether to get role assignments for subscriptions. Default is false.</span>
</span><span id="__span-2-17"><a href="#__codelineno-2-17" id="__codelineno-2-17" name="__codelineno-2-17"></a>
</span><span id="__span-2-18"><a href="#__codelineno-2-18" id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="sd">.PARAMETER</span><span class="cm"> GetManagementGroups</span>
</span><span id="__span-2-19"><a href="#__codelineno-2-19" id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="cm">Specifies whether to get role assignments for management groups. Default is true.</span>
</span><span id="__span-2-20"><a href="#__codelineno-2-20" id="__codelineno-2-20" name="__codelineno-2-20"></a>
</span><span id="__span-2-21"><a href="#__codelineno-2-21" id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="sd">.EXAMPLE</span>
</span><span id="__span-2-22"><a href="#__codelineno-2-22" id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="cm">.\get-azroleassigments.ps1 -SubscriptionId "sub-id"</span>
</span><span id="__span-2-23"><a href="#__codelineno-2-23" id="__codelineno-2-23" name="__codelineno-2-23"></a>
</span><span id="__span-2-24"><a href="#__codelineno-2-24" id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="cm">This example gets role assignments for the specified subscription and management group.</span>
</span><span id="__span-2-25"><a href="#__codelineno-2-25" id="__codelineno-2-25" name="__codelineno-2-25"></a>
</span><span id="__span-2-26"><a href="#__codelineno-2-26" id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="cm">.\get-azroleassigments.ps1 -ManagementGroupName "mg-name" -GetSubscriptions $true -GetManagementGroups $false</span>
</span><span id="__span-2-27"><a href="#__codelineno-2-27" id="__codelineno-2-27" name="__codelineno-2-27"></a>
</span><span id="__span-2-28"><a href="#__codelineno-2-28" id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="cm">This example gets role assignments for the specified management group.</span>
</span><span id="__span-2-29"><a href="#__codelineno-2-29" id="__codelineno-2-29" name="__codelineno-2-29"></a>
</span><span id="__span-2-30"><a href="#__codelineno-2-30" id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="cm">.\get-azroleassigments.ps1  -GetSubscriptions $true -GetManagementGroups $true</span>
</span><span id="__span-2-31"><a href="#__codelineno-2-31" id="__codelineno-2-31" name="__codelineno-2-31"></a>
</span><span id="__span-2-32"><a href="#__codelineno-2-32" id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="cm">This example gets role assignments for all subscriptions and management groups.</span>
</span><span id="__span-2-33"><a href="#__codelineno-2-33" id="__codelineno-2-33" name="__codelineno-2-33"></a>
</span><span id="__span-2-34"><a href="#__codelineno-2-34" id="__codelineno-2-34" name="__codelineno-2-34"></a><span class="sd">.NOTES</span>
</span><span id="__span-2-35"><a href="#__codelineno-2-35" id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="cm">You can not provide both SubscriptionId and GetSubscriptions parameters at the same time.</span>
</span><span id="__span-2-36"><a href="#__codelineno-2-36" id="__codelineno-2-36" name="__codelineno-2-36"></a><span class="cm">You can not provide both ManagementGroupName and GetManagementGroups parameters at the same time.</span>
</span><span id="__span-2-37"><a href="#__codelineno-2-37" id="__codelineno-2-37" name="__codelineno-2-37"></a>
</span><span id="__span-2-38"><a href="#__codelineno-2-38" id="__codelineno-2-38" name="__codelineno-2-38"></a><span class="cm">#&gt;</span>
</span><span id="__span-2-39"><a href="#__codelineno-2-39" id="__codelineno-2-39" name="__codelineno-2-39"></a>
</span><span id="__span-2-40"><a href="#__codelineno-2-40" id="__codelineno-2-40" name="__codelineno-2-40"></a><span class="c"># Parameters setup</span>
</span><span id="__span-2-41"><a href="#__codelineno-2-41" id="__codelineno-2-41" name="__codelineno-2-41"></a><span class="k">param</span> <span class="p">(</span>
</span><span id="__span-2-42"><a href="#__codelineno-2-42" id="__codelineno-2-42" name="__codelineno-2-42"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$false</span><span class="p">)]</span>
</span><span id="__span-2-43"><a href="#__codelineno-2-43" id="__codelineno-2-43" name="__codelineno-2-43"></a>    <span class="no">[string]</span><span class="nv">$SubscriptionId</span><span class="p">,</span>
</span><span id="__span-2-44"><a href="#__codelineno-2-44" id="__codelineno-2-44" name="__codelineno-2-44"></a>
</span><span id="__span-2-45"><a href="#__codelineno-2-45" id="__codelineno-2-45" name="__codelineno-2-45"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$false</span><span class="p">)]</span>
</span><span id="__span-2-46"><a href="#__codelineno-2-46" id="__codelineno-2-46" name="__codelineno-2-46"></a>    <span class="no">[string]</span><span class="nv">$ManagementGroupName</span><span class="p">,</span>
</span><span id="__span-2-47"><a href="#__codelineno-2-47" id="__codelineno-2-47" name="__codelineno-2-47"></a>
</span><span id="__span-2-48"><a href="#__codelineno-2-48" id="__codelineno-2-48" name="__codelineno-2-48"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$false</span><span class="p">)]</span>
</span><span id="__span-2-49"><a href="#__codelineno-2-49" id="__codelineno-2-49" name="__codelineno-2-49"></a>    <span class="no">[bool]</span><span class="nv">$GetSubscriptions</span> <span class="p">=</span> <span class="nv">$false</span><span class="p">,</span>
</span><span id="__span-2-50"><a href="#__codelineno-2-50" id="__codelineno-2-50" name="__codelineno-2-50"></a>
</span><span id="__span-2-51"><a href="#__codelineno-2-51" id="__codelineno-2-51" name="__codelineno-2-51"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$false</span><span class="p">)]</span>
</span><span id="__span-2-52"><a href="#__codelineno-2-52" id="__codelineno-2-52" name="__codelineno-2-52"></a>    <span class="no">[bool]</span><span class="nv">$GetManagementGroups</span> <span class="p">=</span> <span class="nv">$true</span>
</span><span id="__span-2-53"><a href="#__codelineno-2-53" id="__codelineno-2-53" name="__codelineno-2-53"></a><span class="p">)</span>
</span><span id="__span-2-54"><a href="#__codelineno-2-54" id="__codelineno-2-54" name="__codelineno-2-54"></a>
</span><span id="__span-2-55"><a href="#__codelineno-2-55" id="__codelineno-2-55" name="__codelineno-2-55"></a><span class="c"># The rest of your script...</span>
</span><span id="__span-2-56"><a href="#__codelineno-2-56" id="__codelineno-2-56" name="__codelineno-2-56"></a>
</span><span id="__span-2-57"><a href="#__codelineno-2-57" id="__codelineno-2-57" name="__codelineno-2-57"></a><span class="c"># Parameters setup</span>
</span><span id="__span-2-58"><a href="#__codelineno-2-58" id="__codelineno-2-58" name="__codelineno-2-58"></a><span class="k">param</span> <span class="p">(</span>
</span><span id="__span-2-59"><a href="#__codelineno-2-59" id="__codelineno-2-59" name="__codelineno-2-59"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$false</span><span class="p">)]</span>
</span><span id="__span-2-60"><a href="#__codelineno-2-60" id="__codelineno-2-60" name="__codelineno-2-60"></a>    <span class="no">[string]</span><span class="nv">$SubscriptionId</span><span class="p">,</span>
</span><span id="__span-2-61"><a href="#__codelineno-2-61" id="__codelineno-2-61" name="__codelineno-2-61"></a>
</span><span id="__span-2-62"><a href="#__codelineno-2-62" id="__codelineno-2-62" name="__codelineno-2-62"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$false</span><span class="p">)]</span>
</span><span id="__span-2-63"><a href="#__codelineno-2-63" id="__codelineno-2-63" name="__codelineno-2-63"></a>    <span class="no">[string]</span><span class="nv">$ManagementGroupName</span><span class="p">,</span>
</span><span id="__span-2-64"><a href="#__codelineno-2-64" id="__codelineno-2-64" name="__codelineno-2-64"></a>
</span><span id="__span-2-65"><a href="#__codelineno-2-65" id="__codelineno-2-65" name="__codelineno-2-65"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$false</span><span class="p">)]</span>
</span><span id="__span-2-66"><a href="#__codelineno-2-66" id="__codelineno-2-66" name="__codelineno-2-66"></a>    <span class="no">[bool]</span><span class="nv">$GetSubscriptions</span> <span class="p">=</span> <span class="nv">$false</span><span class="p">,</span>
</span><span id="__span-2-67"><a href="#__codelineno-2-67" id="__codelineno-2-67" name="__codelineno-2-67"></a>
</span><span id="__span-2-68"><a href="#__codelineno-2-68" id="__codelineno-2-68" name="__codelineno-2-68"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$false</span><span class="p">)]</span>
</span><span id="__span-2-69"><a href="#__codelineno-2-69" id="__codelineno-2-69" name="__codelineno-2-69"></a>    <span class="no">[bool]</span><span class="nv">$GetManagementGroups</span> <span class="p">=</span> <span class="nv">$true</span>
</span><span id="__span-2-70"><a href="#__codelineno-2-70" id="__codelineno-2-70" name="__codelineno-2-70"></a><span class="p">)</span>
</span><span id="__span-2-71"><a href="#__codelineno-2-71" id="__codelineno-2-71" name="__codelineno-2-71"></a>
</span><span id="__span-2-72"><a href="#__codelineno-2-72" id="__codelineno-2-72" name="__codelineno-2-72"></a><span class="c"># Install the ImportExcel module if not already installed</span>
</span><span id="__span-2-73"><a href="#__codelineno-2-73" id="__codelineno-2-73" name="__codelineno-2-73"></a><span class="k">if</span> <span class="p">(!(</span><span class="nb">Get-Module</span> <span class="n">-ListAvailable</span> <span class="n">-Name</span> <span class="n">ImportExcel</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-2-74"><a href="#__codelineno-2-74" id="__codelineno-2-74" name="__codelineno-2-74"></a>    <span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">ImportExcel</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>
</span><span id="__span-2-75"><a href="#__codelineno-2-75" id="__codelineno-2-75" name="__codelineno-2-75"></a><span class="p">}</span>
</span><span id="__span-2-76"><a href="#__codelineno-2-76" id="__codelineno-2-76" name="__codelineno-2-76"></a>
</span><span id="__span-2-77"><a href="#__codelineno-2-77" id="__codelineno-2-77" name="__codelineno-2-77"></a><span class="c"># Define the path to your Excel file for Managing Group role assignments</span>
</span><span id="__span-2-78"><a href="#__codelineno-2-78" id="__codelineno-2-78" name="__codelineno-2-78"></a><span class="nv">$managementGroupPath</span> <span class="p">=</span> <span class="s2">".\AzRoleAssignmentMg.xlsx"</span>
</span><span id="__span-2-79"><a href="#__codelineno-2-79" id="__codelineno-2-79" name="__codelineno-2-79"></a><span class="c"># Define the path to your Excel file for Subscription role assignments</span>
</span><span id="__span-2-80"><a href="#__codelineno-2-80" id="__codelineno-2-80" name="__codelineno-2-80"></a><span class="nv">$subscriptionPath</span> <span class="p">=</span> <span class="s2">".\AzRoleAssignmentSub.xlsx"</span>
</span><span id="__span-2-81"><a href="#__codelineno-2-81" id="__codelineno-2-81" name="__codelineno-2-81"></a>
</span><span id="__span-2-82"><a href="#__codelineno-2-82" id="__codelineno-2-82" name="__codelineno-2-82"></a><span class="c"># Initialize an empty array to hold all role assignments</span>
</span><span id="__span-2-83"><a href="#__codelineno-2-83" id="__codelineno-2-83" name="__codelineno-2-83"></a><span class="nv">$subscriptionRoleAssignments</span> <span class="p">=</span> <span class="p">@()</span>
</span><span id="__span-2-84"><a href="#__codelineno-2-84" id="__codelineno-2-84" name="__codelineno-2-84"></a><span class="nv">$managementGroupRoleAssignments</span> <span class="p">=</span> <span class="p">@()</span>
</span><span id="__span-2-85"><a href="#__codelineno-2-85" id="__codelineno-2-85" name="__codelineno-2-85"></a>
</span><span id="__span-2-86"><a href="#__codelineno-2-86" id="__codelineno-2-86" name="__codelineno-2-86"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$GetManagementGroups</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-2-87"><a href="#__codelineno-2-87" id="__codelineno-2-87" name="__codelineno-2-87"></a>    <span class="c"># Check if ManagementGroupName is provided</span>
</span><span id="__span-2-88"><a href="#__codelineno-2-88" id="__codelineno-2-88" name="__codelineno-2-88"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$ManagementGroupName</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-2-89"><a href="#__codelineno-2-89" id="__codelineno-2-89" name="__codelineno-2-89"></a>        <span class="c"># Get role assignments for the specified management group</span>
</span><span id="__span-2-90"><a href="#__codelineno-2-90" id="__codelineno-2-90" name="__codelineno-2-90"></a>        <span class="nv">$roleAssignments</span> <span class="p">=</span> <span class="nb">Get-AzRoleAssignment</span> <span class="n">-Scope</span> <span class="s2">"/providers/Microsoft.Management/managementGroups/$ManagementGroupName"</span>
</span><span id="__span-2-91"><a href="#__codelineno-2-91" id="__codelineno-2-91" name="__codelineno-2-91"></a>
</span><span id="__span-2-92"><a href="#__codelineno-2-92" id="__codelineno-2-92" name="__codelineno-2-92"></a>        <span class="c"># Add these role assignments to the management group role assignments array</span>
</span><span id="__span-2-93"><a href="#__codelineno-2-93" id="__codelineno-2-93" name="__codelineno-2-93"></a>        <span class="nv">$managementGroupRoleAssignments</span> <span class="p">+=</span> <span class="nv">$roleAssignments</span>
</span><span id="__span-2-94"><a href="#__codelineno-2-94" id="__codelineno-2-94" name="__codelineno-2-94"></a>
</span><span id="__span-2-95"><a href="#__codelineno-2-95" id="__codelineno-2-95" name="__codelineno-2-95"></a>        <span class="c"># Add 'GroupName' and 'IsInherited' properties to each role assignment object</span>
</span><span id="__span-2-96"><a href="#__codelineno-2-96" id="__codelineno-2-96" name="__codelineno-2-96"></a>        <span class="nv">$roleAssignments</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-2-97"><a href="#__codelineno-2-97" id="__codelineno-2-97" name="__codelineno-2-97"></a>            <span class="nv">$_</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-NotePropertyName</span> <span class="s1">'GroupDisplayName'</span> <span class="n">-NotePropertyValue</span> <span class="p">(</span><span class="nb">Get-AzManagementGroup</span> <span class="n">-GroupName</span> <span class="nv">$ManagementGroupName</span><span class="p">).</span><span class="n">DisplayName</span>
</span><span id="__span-2-98"><a href="#__codelineno-2-98" id="__codelineno-2-98" name="__codelineno-2-98"></a>            <span class="nv">$_</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-NotePropertyName</span> <span class="s1">'GroupName'</span> <span class="n">-NotePropertyValue</span> <span class="nv">$ManagementGroupName</span>
</span><span id="__span-2-99"><a href="#__codelineno-2-99" id="__codelineno-2-99" name="__codelineno-2-99"></a>            <span class="c"># If the Scope of the role assignment is equal to the Id of the management group,</span>
</span><span id="__span-2-100"><a href="#__codelineno-2-100" id="__codelineno-2-100" name="__codelineno-2-100"></a>            <span class="c"># then the role assignment is not inherited; otherwise, it is inherited.</span>
</span><span id="__span-2-101"><a href="#__codelineno-2-101" id="__codelineno-2-101" name="__codelineno-2-101"></a>            <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Scope</span> <span class="o">-eq</span> <span class="s2">"/providers/Microsoft.Management/managementGroups/$ManagementGroupName"</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-2-102"><a href="#__codelineno-2-102" id="__codelineno-2-102" name="__codelineno-2-102"></a>                <span class="nv">$_</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-NotePropertyName</span> <span class="s1">'IsInherited'</span> <span class="n">-NotePropertyValue</span> <span class="nv">$false</span>
</span><span id="__span-2-103"><a href="#__codelineno-2-103" id="__codelineno-2-103" name="__codelineno-2-103"></a>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-2-104"><a href="#__codelineno-2-104" id="__codelineno-2-104" name="__codelineno-2-104"></a>                <span class="nv">$_</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-NotePropertyName</span> <span class="s1">'IsInherited'</span> <span class="n">-NotePropertyValue</span> <span class="nv">$true</span>
</span><span id="__span-2-105"><a href="#__codelineno-2-105" id="__codelineno-2-105" name="__codelineno-2-105"></a>            <span class="p">}</span>
</span><span id="__span-2-106"><a href="#__codelineno-2-106" id="__codelineno-2-106" name="__codelineno-2-106"></a>        <span class="p">}</span>
</span><span id="__span-2-107"><a href="#__codelineno-2-107" id="__codelineno-2-107" name="__codelineno-2-107"></a>
</span><span id="__span-2-108"><a href="#__codelineno-2-108" id="__codelineno-2-108" name="__codelineno-2-108"></a>        <span class="c"># Export the role assignments to a new sheet in the Excel file</span>
</span><span id="__span-2-109"><a href="#__codelineno-2-109" id="__codelineno-2-109" name="__codelineno-2-109"></a>        <span class="nv">$roleAssignments</span> <span class="p">|</span> <span class="nb">Export-Excel</span> <span class="n">-Path</span> <span class="nv">$managementGroupPath</span> <span class="n">-WorksheetName</span> <span class="p">(</span><span class="nb">Get-AzManagementGroup</span> <span class="n">-GroupName</span> <span class="nv">$ManagementGroupName</span><span class="p">).</span><span class="n">DisplayName</span> <span class="n">-AutoSize</span> <span class="n">-AutoFilter</span>
</span><span id="__span-2-110"><a href="#__codelineno-2-110" id="__codelineno-2-110" name="__codelineno-2-110"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-2-111"><a href="#__codelineno-2-111" id="__codelineno-2-111" name="__codelineno-2-111"></a>        <span class="c"># Get all management groups</span>
</span><span id="__span-2-112"><a href="#__codelineno-2-112" id="__codelineno-2-112" name="__codelineno-2-112"></a>        <span class="nv">$managementGroups</span> <span class="p">=</span> <span class="nb">Get-AzManagementGroup</span>
</span><span id="__span-2-113"><a href="#__codelineno-2-113" id="__codelineno-2-113" name="__codelineno-2-113"></a>        <span class="c"># Loop through each management group</span>
</span><span id="__span-2-114"><a href="#__codelineno-2-114" id="__codelineno-2-114" name="__codelineno-2-114"></a>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$mg</span> <span class="k">in</span> <span class="nv">$managementGroups</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-2-115"><a href="#__codelineno-2-115" id="__codelineno-2-115" name="__codelineno-2-115"></a>            <span class="c"># Get role assignments for the current management group</span>
</span><span id="__span-2-116"><a href="#__codelineno-2-116" id="__codelineno-2-116" name="__codelineno-2-116"></a>            <span class="nv">$roleAssignments</span> <span class="p">=</span> <span class="nb">Get-AzRoleAssignment</span> <span class="n">-Scope</span> <span class="s2">"/providers/Microsoft.Management/managementGroups/</span><span class="p">$(</span><span class="nv">$mg</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">"</span>
</span><span id="__span-2-117"><a href="#__codelineno-2-117" id="__codelineno-2-117" name="__codelineno-2-117"></a>
</span><span id="__span-2-118"><a href="#__codelineno-2-118" id="__codelineno-2-118" name="__codelineno-2-118"></a>            <span class="c"># Add these role assignments to the management group role assignments array</span>
</span><span id="__span-2-119"><a href="#__codelineno-2-119" id="__codelineno-2-119" name="__codelineno-2-119"></a>            <span class="nv">$managementGroupRoleAssignments</span> <span class="p">+=</span> <span class="nv">$roleAssignments</span>
</span><span id="__span-2-120"><a href="#__codelineno-2-120" id="__codelineno-2-120" name="__codelineno-2-120"></a>
</span><span id="__span-2-121"><a href="#__codelineno-2-121" id="__codelineno-2-121" name="__codelineno-2-121"></a>            <span class="c"># Add 'GroupName' and 'IsInherited' properties to each role assignment object</span>
</span><span id="__span-2-122"><a href="#__codelineno-2-122" id="__codelineno-2-122" name="__codelineno-2-122"></a>            <span class="nv">$roleAssignments</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-2-123"><a href="#__codelineno-2-123" id="__codelineno-2-123" name="__codelineno-2-123"></a>                <span class="nv">$_</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-NotePropertyName</span> <span class="s1">'GroupDisplayName'</span> <span class="n">-NotePropertyValue</span> <span class="nv">$mg</span><span class="p">.</span><span class="n">DisplayName</span>
</span><span id="__span-2-124"><a href="#__codelineno-2-124" id="__codelineno-2-124" name="__codelineno-2-124"></a>                <span class="nv">$_</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-NotePropertyName</span> <span class="s1">'GroupName'</span> <span class="n">-NotePropertyValue</span> <span class="nv">$mg</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-2-125"><a href="#__codelineno-2-125" id="__codelineno-2-125" name="__codelineno-2-125"></a>                <span class="c"># If the Scope of the role assignment is equal to the Id of the management group,</span>
</span><span id="__span-2-126"><a href="#__codelineno-2-126" id="__codelineno-2-126" name="__codelineno-2-126"></a>                <span class="c"># then the role assignment is not inherited; otherwise, it is inherited.</span>
</span><span id="__span-2-127"><a href="#__codelineno-2-127" id="__codelineno-2-127" name="__codelineno-2-127"></a>                <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Scope</span> <span class="o">-eq</span> <span class="nv">$mg</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-2-128"><a href="#__codelineno-2-128" id="__codelineno-2-128" name="__codelineno-2-128"></a>                    <span class="nv">$_</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-NotePropertyName</span> <span class="s1">'IsInherited'</span> <span class="n">-NotePropertyValue</span> <span class="nv">$false</span>
</span><span id="__span-2-129"><a href="#__codelineno-2-129" id="__codelineno-2-129" name="__codelineno-2-129"></a>                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-2-130"><a href="#__codelineno-2-130" id="__codelineno-2-130" name="__codelineno-2-130"></a>                    <span class="nv">$_</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-NotePropertyName</span> <span class="s1">'IsInherited'</span> <span class="n">-NotePropertyValue</span> <span class="nv">$true</span>
</span><span id="__span-2-131"><a href="#__codelineno-2-131" id="__codelineno-2-131" name="__codelineno-2-131"></a>                <span class="p">}</span>
</span><span id="__span-2-132"><a href="#__codelineno-2-132" id="__codelineno-2-132" name="__codelineno-2-132"></a>            <span class="p">}</span>
</span><span id="__span-2-133"><a href="#__codelineno-2-133" id="__codelineno-2-133" name="__codelineno-2-133"></a>
</span><span id="__span-2-134"><a href="#__codelineno-2-134" id="__codelineno-2-134" name="__codelineno-2-134"></a>            <span class="c"># Export the role assignments to a new sheet in the Excel file</span>
</span><span id="__span-2-135"><a href="#__codelineno-2-135" id="__codelineno-2-135" name="__codelineno-2-135"></a>            <span class="nv">$roleAssignments</span> <span class="p">|</span> <span class="nb">Export-Excel</span> <span class="n">-Path</span> <span class="nv">$managementGroupPath</span> <span class="n">-WorksheetName</span> <span class="nv">$mg</span><span class="p">.</span><span class="n">DisplayName</span> <span class="n">-AutoSize</span> <span class="n">-AutoFilter</span>
</span><span id="__span-2-136"><a href="#__codelineno-2-136" id="__codelineno-2-136" name="__codelineno-2-136"></a>        <span class="p">}</span>
</span><span id="__span-2-137"><a href="#__codelineno-2-137" id="__codelineno-2-137" name="__codelineno-2-137"></a>    <span class="p">}</span>
</span><span id="__span-2-138"><a href="#__codelineno-2-138" id="__codelineno-2-138" name="__codelineno-2-138"></a><span class="p">}</span>
</span><span id="__span-2-139"><a href="#__codelineno-2-139" id="__codelineno-2-139" name="__codelineno-2-139"></a>
</span><span id="__span-2-140"><a href="#__codelineno-2-140" id="__codelineno-2-140" name="__codelineno-2-140"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$GetSubscriptions</span><span class="p">)</span> <span class="p">{</span>   
</span><span id="__span-2-141"><a href="#__codelineno-2-141" id="__codelineno-2-141" name="__codelineno-2-141"></a>    <span class="c"># Check if SubscriptionId is provided</span>
</span><span id="__span-2-142"><a href="#__codelineno-2-142" id="__codelineno-2-142" name="__codelineno-2-142"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$SubscriptionId</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-2-143"><a href="#__codelineno-2-143" id="__codelineno-2-143" name="__codelineno-2-143"></a>        <span class="c"># Get role assignments for the specified subscription</span>
</span><span id="__span-2-144"><a href="#__codelineno-2-144" id="__codelineno-2-144" name="__codelineno-2-144"></a>        <span class="nv">$roleAssignments</span> <span class="p">=</span> <span class="nb">Get-AzRoleAssignment</span> <span class="n">-Scope</span> <span class="s2">"/subscriptions/$SubscriptionId"</span>
</span><span id="__span-2-145"><a href="#__codelineno-2-145" id="__codelineno-2-145" name="__codelineno-2-145"></a>
</span><span id="__span-2-146"><a href="#__codelineno-2-146" id="__codelineno-2-146" name="__codelineno-2-146"></a>        <span class="c"># Add these role assignments to the subscription role assignments array</span>
</span><span id="__span-2-147"><a href="#__codelineno-2-147" id="__codelineno-2-147" name="__codelineno-2-147"></a>        <span class="nv">$subscriptionRoleAssignments</span> <span class="p">+=</span> <span class="nv">$roleAssignments</span>
</span><span id="__span-2-148"><a href="#__codelineno-2-148" id="__codelineno-2-148" name="__codelineno-2-148"></a>
</span><span id="__span-2-149"><a href="#__codelineno-2-149" id="__codelineno-2-149" name="__codelineno-2-149"></a>        <span class="c"># Add 'SubscriptionName' and 'IsInherited' properties to each role assignment object</span>
</span><span id="__span-2-150"><a href="#__codelineno-2-150" id="__codelineno-2-150" name="__codelineno-2-150"></a>        <span class="nv">$roleAssignments</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span> 
</span><span id="__span-2-151"><a href="#__codelineno-2-151" id="__codelineno-2-151" name="__codelineno-2-151"></a>            <span class="nv">$_</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-NotePropertyName</span> <span class="s1">'SubscriptionName'</span> <span class="n">-NotePropertyValue</span> <span class="p">(</span><span class="nb">Get-AzSubscription</span> <span class="n">-SubscriptionId</span> <span class="nv">$SubscriptionId</span><span class="p">).</span><span class="n">Name</span> 
</span><span id="__span-2-152"><a href="#__codelineno-2-152" id="__codelineno-2-152" name="__codelineno-2-152"></a>            <span class="nv">$_</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-NotePropertyName</span> <span class="s1">'IsInherited'</span> <span class="n">-NotePropertyValue</span> <span class="nv">$false</span>
</span><span id="__span-2-153"><a href="#__codelineno-2-153" id="__codelineno-2-153" name="__codelineno-2-153"></a>        <span class="p">}</span>
</span><span id="__span-2-154"><a href="#__codelineno-2-154" id="__codelineno-2-154" name="__codelineno-2-154"></a>
</span><span id="__span-2-155"><a href="#__codelineno-2-155" id="__codelineno-2-155" name="__codelineno-2-155"></a>        <span class="c"># Export the role assignments to a new sheet in the Excel file</span>
</span><span id="__span-2-156"><a href="#__codelineno-2-156" id="__codelineno-2-156" name="__codelineno-2-156"></a>        <span class="nv">$roleAssignments</span> <span class="p">|</span> <span class="nb">Export-Excel</span> <span class="n">-Path</span> <span class="nv">$subscriptionPath</span> <span class="n">-WorksheetName</span> <span class="p">(</span><span class="nb">Get-AzSubscription</span> <span class="n">-SubscriptionId</span> <span class="nv">$SubscriptionId</span><span class="p">).</span><span class="n">Name</span> <span class="n">-AutoSize</span> <span class="n">-AutoFilter</span>
</span><span id="__span-2-157"><a href="#__codelineno-2-157" id="__codelineno-2-157" name="__codelineno-2-157"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-2-158"><a href="#__codelineno-2-158" id="__codelineno-2-158" name="__codelineno-2-158"></a>        <span class="c"># Get all subscriptions</span>
</span><span id="__span-2-159"><a href="#__codelineno-2-159" id="__codelineno-2-159" name="__codelineno-2-159"></a>        <span class="nv">$subscriptions</span> <span class="p">=</span> <span class="nb">Get-AzSubscription</span>
</span><span id="__span-2-160"><a href="#__codelineno-2-160" id="__codelineno-2-160" name="__codelineno-2-160"></a>
</span><span id="__span-2-161"><a href="#__codelineno-2-161" id="__codelineno-2-161" name="__codelineno-2-161"></a>        <span class="c"># Loop through each subscription</span>
</span><span id="__span-2-162"><a href="#__codelineno-2-162" id="__codelineno-2-162" name="__codelineno-2-162"></a>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$sub</span> <span class="k">in</span> <span class="nv">$subscriptions</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-2-163"><a href="#__codelineno-2-163" id="__codelineno-2-163" name="__codelineno-2-163"></a>            <span class="c"># Get role assignments for the current subscription</span>
</span><span id="__span-2-164"><a href="#__codelineno-2-164" id="__codelineno-2-164" name="__codelineno-2-164"></a>            <span class="nv">$roleAssignments</span> <span class="p">=</span> <span class="nb">Get-AzRoleAssignment</span> <span class="n">-Scope</span> <span class="s2">"/subscriptions/</span><span class="p">$(</span><span class="nv">$sub</span><span class="p">.</span><span class="n">SubscriptionId</span><span class="p">)</span><span class="s2">"</span>
</span><span id="__span-2-165"><a href="#__codelineno-2-165" id="__codelineno-2-165" name="__codelineno-2-165"></a>
</span><span id="__span-2-166"><a href="#__codelineno-2-166" id="__codelineno-2-166" name="__codelineno-2-166"></a>            <span class="c"># Add these role assignments to the subscription role assignments array</span>
</span><span id="__span-2-167"><a href="#__codelineno-2-167" id="__codelineno-2-167" name="__codelineno-2-167"></a>            <span class="nv">$subscriptionRoleAssignments</span> <span class="p">+=</span> <span class="nv">$roleAssignments</span>
</span><span id="__span-2-168"><a href="#__codelineno-2-168" id="__codelineno-2-168" name="__codelineno-2-168"></a>
</span><span id="__span-2-169"><a href="#__codelineno-2-169" id="__codelineno-2-169" name="__codelineno-2-169"></a>            <span class="c"># Add 'SubscriptionName' and 'IsInherited' properties to each role assignment object</span>
</span><span id="__span-2-170"><a href="#__codelineno-2-170" id="__codelineno-2-170" name="__codelineno-2-170"></a>            <span class="nv">$roleAssignments</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span> 
</span><span id="__span-2-171"><a href="#__codelineno-2-171" id="__codelineno-2-171" name="__codelineno-2-171"></a>                <span class="nv">$_</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-NotePropertyName</span> <span class="s1">'SubscriptionName'</span> <span class="n">-NotePropertyValue</span> <span class="nv">$sub</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-2-172"><a href="#__codelineno-2-172" id="__codelineno-2-172" name="__codelineno-2-172"></a>                 <span class="c"># If the Scope of the role assignment is equal to the subscription Id,</span>
</span><span id="__span-2-173"><a href="#__codelineno-2-173" id="__codelineno-2-173" name="__codelineno-2-173"></a>                 <span class="c"># then the role assignment is not inherited; otherwise, it is inherited.</span>
</span><span id="__span-2-174"><a href="#__codelineno-2-174" id="__codelineno-2-174" name="__codelineno-2-174"></a>                <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Scope</span> <span class="o">-eq</span> <span class="s2">"/subscriptions/</span><span class="p">$(</span><span class="nv">$sub</span><span class="p">.</span><span class="n">SubscriptionId</span><span class="p">)</span><span class="s2">"</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-2-175"><a href="#__codelineno-2-175" id="__codelineno-2-175" name="__codelineno-2-175"></a>                    <span class="nv">$_</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-NotePropertyName</span> <span class="s1">'IsInherited'</span> <span class="n">-NotePropertyValue</span> <span class="nv">$false</span>
</span><span id="__span-2-176"><a href="#__codelineno-2-176" id="__codelineno-2-176" name="__codelineno-2-176"></a>                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-2-177"><a href="#__codelineno-2-177" id="__codelineno-2-177" name="__codelineno-2-177"></a>                    <span class="nv">$_</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-NotePropertyName</span> <span class="s1">'IsInherited'</span> <span class="n">-NotePropertyValue</span> <span class="nv">$true</span>
</span><span id="__span-2-178"><a href="#__codelineno-2-178" id="__codelineno-2-178" name="__codelineno-2-178"></a>                <span class="p">}</span>
</span><span id="__span-2-179"><a href="#__codelineno-2-179" id="__codelineno-2-179" name="__codelineno-2-179"></a>            <span class="p">}</span>
</span><span id="__span-2-180"><a href="#__codelineno-2-180" id="__codelineno-2-180" name="__codelineno-2-180"></a>
</span><span id="__span-2-181"><a href="#__codelineno-2-181" id="__codelineno-2-181" name="__codelineno-2-181"></a>            <span class="c"># Export the role assignments to a new sheet in the Excel file</span>
</span><span id="__span-2-182"><a href="#__codelineno-2-182" id="__codelineno-2-182" name="__codelineno-2-182"></a>            <span class="nv">$roleAssignments</span> <span class="p">|</span> <span class="nb">Export-Excel</span> <span class="n">-Path</span> <span class="nv">$subscriptionPath</span> <span class="n">-WorksheetName</span> <span class="nv">$sub</span><span class="p">.</span><span class="n">Name</span> <span class="n">-AutoSize</span> <span class="n">-AutoFilter</span>
</span><span id="__span-2-183"><a href="#__codelineno-2-183" id="__codelineno-2-183" name="__codelineno-2-183"></a>        <span class="p">}</span>
</span><span id="__span-2-184"><a href="#__codelineno-2-184" id="__codelineno-2-184" name="__codelineno-2-184"></a>    <span class="p">}</span>
</span><span id="__span-2-185"><a href="#__codelineno-2-185" id="__codelineno-2-185" name="__codelineno-2-185"></a><span class="p">}</span>
</span></code></pre></div>
<p>This script takes the following parameters:</p>
<ul>
<li><code>GetSubscriptions</code>: A switch parameter that specifies whether to generate reports for subscriptions. The default value is <code>$false</code>.</li>
<li><code>GetManagementGroups</code>: A switch parameter that specifies whether to generate reports for management groups. The default value is <code>$true</code>.</li>
<li><code>SubscriptionId</code>: The ID of the subscription for which you want to generate the report. If this parameter is not provided, the script will generate reports for all subscriptions.</li>
<li><code>ManagementGroupName</code>: The name of the management group for which you want to generate the report. If this parameter is not provided, the script will generate reports for all management groups.</li>
</ul>
<h3 id="role-definition-report-in-excel-1"><a class="toclink" href="../../2024/04/20/how-to-create-assigment-reports-for-azure-rbac/#role-definition-report-in-excel-1">Role definition report in Excel 1</a></h3>
<p>You can also generate a report for role definitions in Azure using the following PowerShell script:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">param</span><span class="p">(</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$false</span><span class="p">)]</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>    <span class="p">[</span><span class="k">ValidateSet</span><span class="p">(</span><span class="s1">'Console'</span><span class="p">,</span> <span class="s1">'Excel'</span><span class="p">)]</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span class="no">[string]</span><span class="nv">$OutputType</span> <span class="p">=</span> <span class="s1">'Console'</span><span class="p">,</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$false</span><span class="p">)]</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>    <span class="no">[string]</span><span class="nv">$ExcelFilePath</span> <span class="p">=</span> <span class="s2">".\AzRoleDefinition.xlsx"</span>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="p">)</span>
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>
</span><span id="__span-3-10"><a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="c"># Install the ImportExcel module if not already installed</span>
</span><span id="__span-3-11"><a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="k">if</span> <span class="p">(!(</span><span class="nb">Get-Module</span> <span class="n">-ListAvailable</span> <span class="n">-Name</span> <span class="n">ImportExcel</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-3-12"><a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a>    <span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">ImportExcel</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>
</span><span id="__span-3-13"><a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="p">}</span>
</span><span id="__span-3-14"><a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a>
</span><span id="__span-3-15"><a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="c"># Install the  AzureRM module if not already installed</span>
</span><span id="__span-3-16"><a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="k">if</span> <span class="p">(!(</span><span class="nb">Get-Module</span> <span class="n">-ListAvailable</span> <span class="n">-Name</span>  <span class="n">Az</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-3-17"><a href="#__codelineno-3-17" id="__codelineno-3-17" name="__codelineno-3-17"></a>    <span class="nb">Set-ExecutionPolicy</span> <span class="n">-ExecutionPolicy</span> <span class="n">RemoteSigned</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>
</span><span id="__span-3-18"><a href="#__codelineno-3-18" id="__codelineno-3-18" name="__codelineno-3-18"></a>    <span class="nb">Install-Module</span> <span class="n">-Name</span>  <span class="n">Az</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>
</span><span id="__span-3-19"><a href="#__codelineno-3-19" id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="p">}</span>
</span><span id="__span-3-20"><a href="#__codelineno-3-20" id="__codelineno-3-20" name="__codelineno-3-20"></a>
</span><span id="__span-3-21"><a href="#__codelineno-3-21" id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="c"># Get all role definitions</span>
</span><span id="__span-3-22"><a href="#__codelineno-3-22" id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="nv">$roleDefinitions</span> <span class="p">=</span> <span class="nb">Get-AzRoleDefinition</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-3-23"><a href="#__codelineno-3-23" id="__codelineno-3-23" name="__codelineno-3-23"></a>    <span class="c"># Create a custom object with ordered properties</span>
</span><span id="__span-3-24"><a href="#__codelineno-3-24" id="__codelineno-3-24" name="__codelineno-3-24"></a>    <span class="nv">$customObject</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">PSObject</span> <span class="n">-Property</span> <span class="p">@{</span>
</span><span id="__span-3-25"><a href="#__codelineno-3-25" id="__codelineno-3-25" name="__codelineno-3-25"></a>        <span class="n">Name</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-3-26"><a href="#__codelineno-3-26" id="__codelineno-3-26" name="__codelineno-3-26"></a>        <span class="n">Id</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Id</span>
</span><span id="__span-3-27"><a href="#__codelineno-3-27" id="__codelineno-3-27" name="__codelineno-3-27"></a>        <span class="n">IsCustom</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">IsCustom</span>
</span><span id="__span-3-28"><a href="#__codelineno-3-28" id="__codelineno-3-28" name="__codelineno-3-28"></a>        <span class="n">Description</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Description</span>
</span><span id="__span-3-29"><a href="#__codelineno-3-29" id="__codelineno-3-29" name="__codelineno-3-29"></a>        <span class="n">Actions</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Actions</span> <span class="n">-join</span> <span class="s1">', '</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="s2">",</span><span class="se">`n</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-3-30"><a href="#__codelineno-3-30" id="__codelineno-3-30" name="__codelineno-3-30"></a>        <span class="n">NotActions</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">NotActions</span> <span class="n">-join</span> <span class="s1">', '</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="s2">",</span><span class="se">`n</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-3-31"><a href="#__codelineno-3-31" id="__codelineno-3-31" name="__codelineno-3-31"></a>        <span class="n">DataActions</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">DataActions</span> <span class="n">-join</span> <span class="s1">', '</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="s2">",</span><span class="se">`n</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-3-32"><a href="#__codelineno-3-32" id="__codelineno-3-32" name="__codelineno-3-32"></a>        <span class="n">NotDataActions</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">NotDataActions</span> <span class="n">-join</span> <span class="s1">', '</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="s2">",</span><span class="se">`n</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-3-33"><a href="#__codelineno-3-33" id="__codelineno-3-33" name="__codelineno-3-33"></a>        <span class="n">AssignableScopes</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">AssignableScopes</span> <span class="n">-join</span> <span class="s1">', '</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="s2">",</span><span class="se">`n</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-3-34"><a href="#__codelineno-3-34" id="__codelineno-3-34" name="__codelineno-3-34"></a>    <span class="p">}</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Id</span><span class="p">,</span> <span class="n">IsCustom</span><span class="p">,</span> <span class="n">Description</span><span class="p">,</span> <span class="n">Actions</span><span class="p">,</span> <span class="n">NotActions</span><span class="p">,</span> <span class="n">DataActions</span><span class="p">,</span> <span class="n">NotDataActions</span><span class="p">,</span> <span class="n">AssignableScopes</span>
</span><span id="__span-3-35"><a href="#__codelineno-3-35" id="__codelineno-3-35" name="__codelineno-3-35"></a>
</span><span id="__span-3-36"><a href="#__codelineno-3-36" id="__codelineno-3-36" name="__codelineno-3-36"></a>    <span class="k">return</span> <span class="nv">$customObject</span>
</span><span id="__span-3-37"><a href="#__codelineno-3-37" id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="p">}</span>
</span><span id="__span-3-38"><a href="#__codelineno-3-38" id="__codelineno-3-38" name="__codelineno-3-38"></a>
</span><span id="__span-3-39"><a href="#__codelineno-3-39" id="__codelineno-3-39" name="__codelineno-3-39"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$OutputType</span> <span class="o">-eq</span> <span class="s1">'Console'</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-3-40"><a href="#__codelineno-3-40" id="__codelineno-3-40" name="__codelineno-3-40"></a>    <span class="c"># Output to console</span>
</span><span id="__span-3-41"><a href="#__codelineno-3-41" id="__codelineno-3-41" name="__codelineno-3-41"></a>    <span class="nv">$roleDefinitions</span> <span class="p">|</span> <span class="nb">Format-Table</span> <span class="n">-AutoSize</span>
</span><span id="__span-3-42"><a href="#__codelineno-3-42" id="__codelineno-3-42" name="__codelineno-3-42"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-3-43"><a href="#__codelineno-3-43" id="__codelineno-3-43" name="__codelineno-3-43"></a>    <span class="c"># Export to Excel</span>
</span><span id="__span-3-44"><a href="#__codelineno-3-44" id="__codelineno-3-44" name="__codelineno-3-44"></a>    <span class="nv">$roleDefinitions</span> <span class="p">|</span> <span class="nb">Export-Excel</span> <span class="n">-Path</span> <span class="nv">$ExcelFilePath</span> <span class="n">-WorksheetName</span> <span class="s1">'Role Definitions'</span> <span class="n">-AutoSize</span> <span class="n">-AutoFilter</span>    
</span><span id="__span-3-45"><a href="#__codelineno-3-45" id="__codelineno-3-45" name="__codelineno-3-45"></a><span class="p">}</span>
</span></code></pre></div>
<p>This script takes the following parameters:</p>
<ul>
<li><code>OutputType</code>: A string parameter that specifies the output type. The default value is <code>'Console'</code>. You can also specify <code>'Excel'</code> to export the report to an Excel file.</li>
<li><code>ExcelFilePath</code>: The path to the Excel file where you want to export the report. The default value is <code>".\AzRoleDefinition.xlsx"</code>.</li>
</ul>
<p>In the Excel report, you will see the following columns for each role definition: <code>Name</code>, <code>Id</code>, <code>IsCustom</code>, <code>Description</code>, <code>Actions</code>, <code>NotActions</code>, <code>DataActions</code>, <code>NotDataActions</code>, and <code>AssignableScopes</code>.</p>
<h3 id="conclusion"><a class="toclink" href="../../2024/04/20/how-to-create-assigment-reports-for-azure-rbac/#conclusion">Conclusion</a></h3>
<p>In this article, we have shown you how to create reports for role assignments and role definitions in Azure using PowerShell and the ImportExcel module. These reports can help you better understand the permissions assigned to users, groups, and applications in your Azure environment and ensure that they are configured correctly. You can customize the scripts to include additional information or export the reports in different formats to suit your needs.</p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-04-19 00:00:00+00:00">April 19, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure</a></li>
<li class="md-meta__item">
            
              2 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-role-based-access-control-rbac"><a class="toclink" href="../../2024/04/19/azure-role-based-access-control-rbac/">Azure Role-Based Access Control (RBAC)</a></h2>
<p>Azure Role-Based Access Control (RBAC) is a system that provides fine-grained access management of resources in Azure. This allows administrators to grant only the amount of access that users need to perform their jobs.</p>
<h3 id="overview"><a class="toclink" href="../../2024/04/19/azure-role-based-access-control-rbac/#overview">Overview</a></h3>
<p>In Azure RBAC, you can assign roles to user accounts, groups, service principals, and managed identities at different scopes. The scope could be a management group, subscription, resource group, or a single resource. </p>
<p>Here are some key terms you should know:</p>
<ul>
<li><strong>Role</strong>: A collection of permissions. For example, the "Virtual Machine Contributor" role allows the user to create and manage virtual machines.</li>
<li><strong>Scope</strong>: The set of resources that the access applies to. </li>
<li><strong>Assignment</strong>: The act of granting a role to a security principal at a particular scope.</li>
</ul>
<h3 id="built-in-roles"><a class="toclink" href="../../2024/04/19/azure-role-based-access-control-rbac/#built-in-roles">Built-in Roles</a></h3>
<p>Azure provides several built-in roles that you can assign to users, groups, service principals, and managed identities. Here are a few examples:</p>
<ul>
<li><strong>Owner</strong>: Has full access to all resources including the right to delegate access to others.</li>
<li><strong>Contributor</strong>: Can create and manage all types of Azure resources but can’t grant access to others.</li>
<li><strong>Reader</strong>: Can view existing Azure resources.</li>
</ul>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="nt">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Contributor"</span><span class="p">,</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="nt">"Id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b24988ac-6180-42a0-ab88-20f7382dd24c"</span><span class="p">,</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">  </span><span class="nt">"IsCustom"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">  </span><span class="nt">"Description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Lets you manage everything except access to resources."</span><span class="p">,</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">  </span><span class="nt">"Actions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="s2">"*"</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">  </span><span class="nt">"NotActions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">    </span><span class="s2">"Microsoft.Authorization/*/Delete"</span><span class="p">,</span>
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="s2">"Microsoft.Authorization/*/Write"</span><span class="p">,</span>
</span><span id="__span-0-12"><a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">    </span><span class="s2">"Microsoft.Authorization/elevateAccess/Action"</span>
</span><span id="__span-0-13"><a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-14"><a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">  </span><span class="nt">"DataActions"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-0-15"><a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">  </span><span class="nt">"NotDataActions"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-0-16"><a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">  </span><span class="nt">"AssignableScopes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-17"><a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="s2">"/"</span>
</span><span id="__span-0-18"><a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-0-19"><a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="custom-roles"><a class="toclink" href="../../2024/04/19/azure-role-based-access-control-rbac/#custom-roles">Custom Roles</a></h3>
<p>If the built-in roles don't meet your specific needs, you can create your own custom roles. Just like built-in roles, you can assign permissions to custom roles and then assign those roles to users.</p>
<p></p><div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">  </span><span class="nt">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Custom Role"</span><span class="p">,</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">  </span><span class="nt">"Id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00000000-0000-0000-0000-000000000000"</span><span class="p">,</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">  </span><span class="nt">"IsCustom"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">  </span><span class="nt">"Description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Custom role description"</span><span class="p">,</span>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">  </span><span class="nt">"Actions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="s2">"Microsoft.Compute/virtualMachines/start/action"</span><span class="p">,</span>
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span><span class="s2">"Microsoft.Compute/virtualMachines/restart/action"</span>
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">  </span><span class="nt">"NotActions"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">  </span><span class="nt">"DataActions"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-1-12"><a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">  </span><span class="nt">"NotDataActions"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-1-13"><a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">  </span><span class="nt">"AssignableScopes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-1-14"><a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">    </span><span class="s2">"/subscriptions/{subscriptionId}"</span>
</span><span id="__span-1-15"><a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-1-16"><a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="p">}</span>
</span></code></pre></div>
Custom Roles has the same structure as built-in roles:<p></p>
<ul>
<li><strong>Name</strong>: The name of the custom role.</li>
<li><strong>Id</strong>: A unique identifier for the custom role.</li>
<li><strong>IsCustom</strong>: Indicates whether the role is custom or built-in.</li>
<li><strong>Description</strong>: A description of the custom role.</li>
<li><strong>Actions</strong>: The list of actions that the role can perform.</li>
<li><strong>NotActions</strong>: The list of actions that the role cannot perform.</li>
<li><strong>DataActions</strong>: The list of data actions that the role can perform.</li>
<li><strong>NotDataActions</strong>: The list of data actions that the role cannot perform.</li>
<li><strong>AssignableScopes</strong>: The list of scopes where the role can be assigned.</li>
</ul>
<p>You can check how to create a custom role <a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles#custom-role-properties">here</a> and not forget to check limitations <a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles#custom-role-limits">here</a>.</p>
<h3 id="recommendations"><a class="toclink" href="../../2024/04/19/azure-role-based-access-control-rbac/#recommendations">Recommendations</a></h3>
<p>Here are some best practices for managing access with Azure RBAC:</p>
<ul>
<li><strong>Use the principle of least privilege</strong>: Only grant the permissions that users need to do their jobs.</li>
<li><strong>Use built-in roles when possible</strong>: <a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles">Built-in roles</a> are already defined and tested by Microsoft. Only create custom roles when necessary.</li>
<li><strong>Regularly review role assignments</strong>: Make sure that users have the appropriate level of access for their job. Remove any unnecessary role assignments.</li>
</ul>
<h3 id="conclusion"><a class="toclink" href="../../2024/04/19/azure-role-based-access-control-rbac/#conclusion">Conclusion</a></h3>
<p>Azure RBAC is a powerful tool for managing access to your Azure resources. By understanding its core concepts and how to apply them, you can ensure that users have the appropriate level of access for their job.</p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael Fernández" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-04-18 00:00:00+00:00">April 18, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="./">Azure</a></li>
<li class="md-meta__item">
            
              3 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-role-assignment-conditions"><a class="toclink" href="../../2024/04/18/azure-role-assignment-conditions/">Azure role assignment conditions</a></h2>
<p>First of all, let's understand what is ABAc (Attribute-Based Access Control) and how it can be used in Azure.</p>
<h3 id="what-is-abac"><a class="toclink" href="../../2024/04/18/azure-role-assignment-conditions/#what-is-abac">What is ABAC?</a></h3>
<p>Attribute-Based Access Control (ABAC) is an access control model that uses attributes to determine access rights. In ABAC, access decisions are based on the attributes of the user, the resource, and the environment. This allows for fine-grained access control based on a wide range of attributes, such as user roles, resource types, and time of day.</p>
<p>ABAC is a flexible and scalable access control model that can be used to enforce complex access policies. It allows organizations to define access control rules based on a wide range of attributes and to adapt those rules as their needs change.</p>
<p>ABAC is build on Azure RBAC.</p>
<h3 id="what-is-azure-role-assignment-conditions"><a class="toclink" href="../../2024/04/18/azure-role-assignment-conditions/#what-is-azure-role-assignment-conditions">What is Azure role assignment conditions?</a></h3>
<p>Azure role assignment conditions allow you to define conditions that must be met for a role assignment to be effective. </p>
<h3 id="how-to-configure-azure-role-assignment-conditions"><a class="toclink" href="../../2024/04/18/azure-role-assignment-conditions/#how-to-configure-azure-role-assignment-conditions">How to configure Azure role assignment conditions?</a></h3>
<p>To configure Azure role assignment conditions, configure the role assignment as usual, and then click on the "Conditions" tab. Here you can define the conditions that must be met for the role assignment to be effective.</p>
<p><img alt="alt text" src="../../2024/09/Screenshot%202024-09-18%20111639.png"></p>
<p>Options for configuring Conditions:</p>
<ul>
<li>Allow user to only assign selected roles to selected principals (fewer privileges)</li>
<li>Allow user to assign all roles except privileged administrator roles Owner, UAA, RBAC (Recommended)</li>
<li>Allow user to assign all roles (highly privileged)</li>
</ul>
<p>The first one is the most restrictive, for example, allowing the user to only assign selected roles to selected principals. This is useful when you want to limit the privileges of a user to only a subset of roles and principals.</p>
<p>These are the options available for "Allow user to only assign selected roles to selected principals (fewer privileges)":</p>
<p><img alt="alt text" src="../../2024/09/Screenshot%202024-09-18%20111646.png"></p>
<ul>
<li>Constrain roles:<ul>
<li>Allow user to only assign roles you select</li>
</ul>
</li>
<li>Constrain roles and principal types:<ul>
<li>Allow user to only assign roles you select</li>
<li>Allow user to only assign these roles to principal types you select (users, groups, or service principals)</li>
</ul>
</li>
<li>Constrain roles and principals<ul>
<li>Allow user to only assign roles you select</li>
<li>Allow user to only assign these roles to principals you select</li>
<li>Allow all except specific roles</li>
<li>Allow user to assign all roles except the roles you select</li>
</ul>
</li>
</ul>
<h3 id="conclusion"><a class="toclink" href="../../2024/04/18/azure-role-assignment-conditions/#conclusion">Conclusion</a></h3>
<p>Azure role assignment conditions provide a flexible and powerful way to control access to Azure resources. By defining conditions that must be met for a role assignment to be effective, you can enforce fine-grained access control policies that meet the specific needs of your organization. This allows you to limit the privileges of users, assign roles to specific principals, and control access to sensitive resources. Azure role assignment conditions are a valuable tool for organizations that need to enforce strict access control policies and protect their critical resources.</p>
<h3 id="references"><a class="toclink" href="../../2024/04/18/azure-role-assignment-conditions/#references">References</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/conditions-overview">What is Azure attribute-based access control (Azure ABAC)?</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/conditions-format">Azure role assignment condition format and syntax</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/delegate-role-assignments-examples?tabs=template">Examples to delegate Azure role assignment management with conditions</a></li>
</ul>
</div>
</article>
<nav class="md-pagination">
</nav>
</div>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2023-now Rafael Fernández
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://www.linkedin.com/in/rafaelfernandezd/" rel="noopener" target="_blank" title="LinkedIn">
<svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg>
</a>
<a class="md-social__link" href="https://github.com/rfernandezdo" rel="noopener" target="_blank" title="GitHub">
<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
<a class="md-social__link" href="https://rfernandezdo.github.io/feed_rss_created.xml" rel="noopener" target="_blank" title="RSS feed">
<svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h320c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64zm32 104c0-13.3 10.7-24 24-24 137 0 248 111 248 248 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200-13.3 0-24-10.7-24-24m0 96c0-13.3 10.7-24 24-24 83.9 0 152 68.1 152 152 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104-13.3 0-24-10.7-24-24m0 120a32 32 0 1 1 64 0 32 32 0 1 1-64 0"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-progress" data-md-component="progress" role="progressbar"></div>
<script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.sections", "navigation.top", "navigation.tracking", "toc.integrate", "toc.nested", "toc.smoothscroll", "footer", "content.code.copy", "content.code.select", "content.code.annotate", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
<script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
<script src="../../../javascripts/tablesort.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>