<!DOCTYPE html><html class="no-js" lang="en"><head>
<meta charset="utf-8">
<meta content="width=device-width,initial-scale=1" name="viewport">
<meta content="A blog about Azure, DevOps and other stuff" name="description">
<meta content="Rafael FernÃ¡ndez" name="author">
<link href="https://rfernandezdo.github.io/blog/2024/04/page/2/" rel="canonical">
<link href="../../../05/" rel="prev">
<link href="../../../03/" rel="next">
<link href="../../../../../feed_rss_created.xml" rel="alternate" title="RSS feed" type="application/rss+xml">
<link href="../../../../../feed_rss_updated.xml" rel="alternate" title="RSS feed of updated content" type="application/rss+xml">
<link href="../../../../../assets/images/favicon.png" rel="icon">
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.22" name="generator">
<title>2024/04 - Un Rinconcito donde contar lo que quiera</title>
<link href="../../../../../assets/stylesheets/main.84d31ad4.min.css" rel="stylesheet">
<link href="../../../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet">
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet">
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<meta content="website" property="og:type">
<meta content="2024/04 - Un Rinconcito donde contar lo que quiera" property="og:title">
<meta content="A blog about Azure, DevOps and other stuff" property="og:description">
<meta content="https://rfernandezdo.github.io/assets/images/social/blog/2024/04/page/2.png" property="og:image">
<meta content="image/png" property="og:image:type">
<meta content="1200" property="og:image:width">
<meta content="630" property="og:image:height">
<meta content="https://rfernandezdo.github.io/blog/2024/04/page/2/" property="og:url">
<meta content="summary_large_image" name="twitter:card">
<meta content="2024/04 - Un Rinconcito donde contar lo que quiera" name="twitter:title">
<meta content="A blog about Azure, DevOps and other stuff" name="twitter:description">
<meta content="https://rfernandezdo.github.io/assets/images/social/blog/2024/04/page/2.png" name="twitter:image">
<link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox">
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox">
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#202404">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Un Rinconcito donde contar lo que quiera" class="md-header__button md-logo" data-md-component="logo" href="../../../../.." title="Un Rinconcito donde contar lo que quiera">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Un Rinconcito donde contar lo que quiera
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              2024/04
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio">
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio">
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<div class="md-header__option">
<div class="md-select">
<button aria-label="Select language" class="md-header__button md-icon">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"></path></svg>
</button>
<div class="md-select__inner">
<ul class="md-select__list">
<li class="md-select__item">
<a class="md-select__link" href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=es&amp;_x_tr_hl=es&amp;_x_tr_pto=wapp" hreflang="en">
              English
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="https://rfernandezdo-github-io.translate.goog/?_x_tr_sl=auto&amp;_x_tr_tl=en&amp;_x_tr_hl=en&amp;_x_tr_pto=wapp" hreflang="es">
              Spanish
            </a>
</li>
</ul>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text">
<label class="md-search__icon md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../../../">
          
  
  
  Blog

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../..">
        
  
  
    
  
  About

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../contributions/">
        
  
  
    
  
  Contributions

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../Azure/Security/MCSB/Readme/">
          
  
  
  Azure

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../Tools/Federated_Identity_Credentials_Report/README-federated-identity-credentials/">
          
  
  
  Tools

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Un Rinconcito donde contar lo que quiera" class="md-nav__button md-logo" data-md-component="logo" href="../../../../.." title="Un Rinconcito donde contar lo que quiera">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Un Rinconcito donde contar lo que quiera
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox">
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
<span class="md-ellipsis">
    Blog
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            Blog
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../">
<span class="md-ellipsis">
    Blog
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../tags/">
<span class="md-ellipsis">
    Posts by Tags
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_1_3" type="checkbox">
<label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="">
<span class="md-ellipsis">
    Archive
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_1_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_3">
<span class="md-nav__icon md-icon"></span>
            Archive
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../2025/10/">
<span class="md-ellipsis">
    2025/10
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../2025/09/">
<span class="md-ellipsis">
    2025/09
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../2025/08/">
<span class="md-ellipsis">
    2025/08
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../2025/07/">
<span class="md-ellipsis">
    2025/07
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../2025/06/">
<span class="md-ellipsis">
    2025/06
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../2025/05/">
<span class="md-ellipsis">
    2025/05
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../2025/04/">
<span class="md-ellipsis">
    2025/04
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../2025/03/">
<span class="md-ellipsis">
    2025/03
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../2025/02/">
<span class="md-ellipsis">
    2025/02
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../2025/01/">
<span class="md-ellipsis">
    2025/01
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../12/">
<span class="md-ellipsis">
    2024/12
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../11/">
<span class="md-ellipsis">
    2024/11
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../10/">
<span class="md-ellipsis">
    2024/10
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../09/">
<span class="md-ellipsis">
    2024/09
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../06/">
<span class="md-ellipsis">
    2024/06
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../05/">
<span class="md-ellipsis">
    2024/05
    
  </span>
</a>
</li>
<li class="md-nav__item">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox">
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    2024/04
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="../../">
<span class="md-ellipsis">
    2024/04
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#azure-network-hub-and-spoke-topology">
<span class="md-ellipsis">
      Azure Network, Hub-and-Spoke Topology
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#azure-role-based-access-control-rbac">
<span class="md-ellipsis">
      Azure Role-Based Access Control (RBAC)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kusto-query-language-kql-for-azure-resource-graph">
<span class="md-ellipsis">
      Kusto Query Language (KQL) for Azure Resource Graph
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#azure-role-assignment-conditions">
<span class="md-ellipsis">
      Azure role assignment conditions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#using-enterprise-azure-policy-as-code-epac">
<span class="md-ellipsis">
      Using Enterprise Azure Policy as Code (EPAC)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cambio-de-nombres-de-los-niveles-de-servicio-de-microsoft-defender-para-cloud">
<span class="md-ellipsis">
      Cambio de nombres de los niveles de servicio de Microsoft Defender para Cloud
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#azure-policy-useful-queries">
<span class="md-ellipsis">
      Azure Policy useful queries
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account">
<span class="md-ellipsis">
      How to use Azue ARC-enabled servers with managed identity to access to Azure Storage Account
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#azure-arc">
<span class="md-ellipsis">
      Azure ARC
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#microsoft-azure-certifications">
<span class="md-ellipsis">
      Microsoft Azure Certifications
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../03/">
<span class="md-ellipsis">
    2024/03
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../02/">
<span class="md-ellipsis">
    2024/02
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../2023/12/">
<span class="md-ellipsis">
    2023/12
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../2023/11/">
<span class="md-ellipsis">
    2023/11
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../2023/10/">
<span class="md-ellipsis">
    2023/10
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1_4" type="checkbox">
<label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="">
<span class="md-ellipsis">
    Categories
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_4">
<span class="md-nav__icon md-icon"></span>
            Categories
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/azure/">
<span class="md-ellipsis">
    Azure
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/azure-ad/">
<span class="md-ellipsis">
    Azure AD
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/azure-automation/">
<span class="md-ellipsis">
    Azure Automation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/azure-devops/">
<span class="md-ellipsis">
    Azure DevOps
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/azure-frameworks/">
<span class="md-ellipsis">
    Azure Frameworks
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/azure-governance/">
<span class="md-ellipsis">
    Azure Governance
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/azure-networking/">
<span class="md-ellipsis">
    Azure Networking
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/azure-security/">
<span class="md-ellipsis">
    Azure Security
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/azure-services/">
<span class="md-ellipsis">
    Azure Services
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/azure-updates/">
<span class="md-ellipsis">
    Azure Updates
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/caf/">
<span class="md-ellipsis">
    CAF
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/cicd/">
<span class="md-ellipsis">
    CI/CD
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/devops/">
<span class="md-ellipsis">
    DevOps
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/development/">
<span class="md-ellipsis">
    Development
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/drift-detection/">
<span class="md-ellipsis">
    Drift Detection
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/english/">
<span class="md-ellipsis">
    English
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/enterprise-policy-as-code/">
<span class="md-ellipsis">
    Enterprise Policy as Code
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/finops/">
<span class="md-ellipsis">
    FinOps
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/firewall/">
<span class="md-ellipsis">
    Firewall
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/gtd/">
<span class="md-ellipsis">
    GTD
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/git/">
<span class="md-ellipsis">
    Git
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/github-actions/">
<span class="md-ellipsis">
    GitHub Actions
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/hashicorp/">
<span class="md-ellipsis">
    HashiCorp
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/hello_world/">
<span class="md-ellipsis">
    Hello_World
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/infrastructure-as-code/">
<span class="md-ellipsis">
    Infrastructure as Code
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/learning/">
<span class="md-ellipsis">
    Learning
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/m365/">
<span class="md-ellipsis">
    M365
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/microsoft-365/">
<span class="md-ellipsis">
    Microsoft 365
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/microsoft-entra/">
<span class="md-ellipsis">
    Microsoft Entra
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/microsoft-entra-external-id/">
<span class="md-ellipsis">
    Microsoft Entra External ID
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/microsoft-entra-id/">
<span class="md-ellipsis">
    Microsoft Entra ID
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/networking/">
<span class="md-ellipsis">
    Networking
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/outlook/">
<span class="md-ellipsis">
    Outlook
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/pim/">
<span class="md-ellipsis">
    PIM
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/power-automate/">
<span class="md-ellipsis">
    Power Automate
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/power-bi/">
<span class="md-ellipsis">
    Power BI
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/productividad/">
<span class="md-ellipsis">
    Productividad
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/productividad--microsoft-365/">
<span class="md-ellipsis">
    Productividad / Microsoft 365
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/security/">
<span class="md-ellipsis">
    Security
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/seguridad/">
<span class="md-ellipsis">
    Seguridad
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/snowflake/">
<span class="md-ellipsis">
    Snowflake
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/terraform/">
<span class="md-ellipsis">
    Terraform
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/threat-intelligence/">
<span class="md-ellipsis">
    Threat Intelligence
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/tools/">
<span class="md-ellipsis">
    Tools
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/troubleshooting/">
<span class="md-ellipsis">
    Troubleshooting
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/visual-studio-code/">
<span class="md-ellipsis">
    Visual Studio Code
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/viva-insights/">
<span class="md-ellipsis">
    Viva Insights
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../category/windows/">
<span class="md-ellipsis">
    Windows
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../..">
<span class="md-ellipsis">
    About
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../contributions/">
<span class="md-ellipsis">
    Contributions
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox">
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Azure
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Azure
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1" type="checkbox">
<label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
<span class="md-ellipsis">
    Security
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_1">
<span class="md-nav__icon md-icon"></span>
            Security
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1_1" type="checkbox">
<label class="md-nav__link" for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
<span class="md-ellipsis">
    MCSB
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_1">
<span class="md-nav__icon md-icon"></span>
            MCSB
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Azure/Security/MCSB/Readme/">
<span class="md-ellipsis">
    MCSB_v1 - Readme
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Azure/Security/MCSB/Asset%20Management/">
<span class="md-ellipsis">
    MCSB_v1 - Asset Management
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Azure/Security/MCSB/Backup%20and%20Recovery/">
<span class="md-ellipsis">
    MCSB_v1 - Backup and Recovery
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Azure/Security/MCSB/Data%20Protection/">
<span class="md-ellipsis">
    MCSB_v1 - Data Protection
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Azure/Security/MCSB/DevOps%20Security/">
<span class="md-ellipsis">
    MCSB_v1 - DevOps Security
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Azure/Security/MCSB/Endpoint%20Security/">
<span class="md-ellipsis">
    MCSB_v1 - Endpoint Security
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Azure/Security/MCSB/Governance%20and%20Strategy/">
<span class="md-ellipsis">
    MCSB_v1 - Governance and Strategy
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Azure/Security/MCSB/Identity%20Management/">
<span class="md-ellipsis">
    MCSB_v1 - Identity Management
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Azure/Security/MCSB/Incident%20Response/">
<span class="md-ellipsis">
    MCSB_v1 - Incident Response
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Azure/Security/MCSB/Logging%20and%20Threat%20Detection/">
<span class="md-ellipsis">
    MCSB_v1 - Logging and Threat Detection
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Azure/Security/MCSB/Network%20Security/">
<span class="md-ellipsis">
    MCSB_v1 - Network Security
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Azure/Security/MCSB/Posture%20and%20Vulnerability%20Mgmt/">
<span class="md-ellipsis">
    MCSB_v1 - Posture and Vulnerability Mgmt
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Azure/Security/MCSB/Privileged%20Access/">
<span class="md-ellipsis">
    MCSB_v1 - Privileged Access
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox">
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Tools
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Tools
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_1" type="checkbox">
<label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
<span class="md-ellipsis">
    Federated Identity Credentials Report
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_1">
<span class="md-nav__icon md-icon"></span>
            Federated Identity Credentials Report
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Tools/Federated_Identity_Credentials_Report/README-federated-identity-credentials/">
<span class="md-ellipsis">
    Script de Reporte para Federated Identity Credentials
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_2" type="checkbox">
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-ellipsis">
    Analyze Virtual Network Flows
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            Analyze Virtual Network Flows
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Tools/Analyze_Virtual_Network_Flows/">
<span class="md-ellipsis">
    Analyze-VNETFlowLogs
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<div class="md-content__inner">
<header class="md-typeset">
<h1 id="202404">2024/04</h1>
</header>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-04-19 00:00:00+00:00">April 19, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../../../category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              5 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-network-hub-and-spoke-topology"><a class="toclink" href="../../19/azure-network-hub-and-spoke-topology/">Azure Network, Hub-and-Spoke Topology</a></h2>
<p>Hub and Spoke is a network topology where a central Hub is connected to multiple Spokes. The Hub acts as a central point of connectivity and control, while the Spokes are isolated networks that connect to the Hub. This topology is common in Azure to simplify the connectivity and management of virtual networks.</p>
<pre class="mermaid"><code>graph TD
    HUB(("Central Hub"))
    SPOKE1[Spoke1]
    SPOKE2[Spoke2]
    SPOKE3[Spoke3]
    SPOKEN[Spoke...]
    HUB --- SPOKE1
    HUB --- SPOKE2
    HUB --- SPOKE3
    HUB --- SPOKEN
</code></pre>
<h3 id="key-features-of-the-hub-and-spoke-topology"><a class="toclink" href="../../19/azure-network-hub-and-spoke-topology/#key-features-of-the-hub-and-spoke-topology">Key Features of the Hub and Spoke Topology</a></h3>
<ol>
<li>
<p><strong>Centralized Connectivity:</strong> The Hub centralizes the connectivity between the Spoke networks. This simplifies the administration and maintenance of the network.</p>
</li>
<li>
<p><strong>Traffic Control:</strong> The Hub acts as a traffic control point between the Spoke networks. This allows for centralized application of security and routing policies.</p>
</li>
<li>
<p><strong>Scalability:</strong> The Hub and Spoke topology is highly scalable and can grow to meet the organization's connectivity needs.</p>
</li>
<li>
<p><strong>Resilience:</strong> The Hub and Spoke topology provides redundancy and resilience in case of network failures.</p>
</li>
</ol>
<h3 id="how-to-use-the-hub-and-spoke-topology-in-azure"><a class="toclink" href="../../19/azure-network-hub-and-spoke-topology/#how-to-use-the-hub-and-spoke-topology-in-azure">How to Use the Hub and Spoke Topology in Azure</a></h3>
<p>To implement the Hub and Spoke topology in Azure, follow these steps:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># Step 1: Create a virtual network for the Hub</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>HubVnet<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--location<span class="w"> </span>eastus<span class="w"> </span>--address-prefix
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="c1"># Step 2: Create virtual networks for the Spokes</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>Spoke1Vnet<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--location<span class="w"> </span>eastus<span class="w"> </span>--address-prefix
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>Spoke2Vnet<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--location<span class="w"> </span>eastus<span class="w"> </span>--address-prefix
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>Spoke3Vnet<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--location<span class="w"> </span>eastus<span class="w"> </span>--address-prefix
</span><span id="__span-2-8"><a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>
</span><span id="__span-2-9"><a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="c1"># Step 3: Connect the Spokes to the Hub</span>
</span><span id="__span-2-10"><a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>peering<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>Spoke1ToHub<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--vnet-name<span class="w"> </span>Spoke1Vnet<span class="w"> </span>--remote-vnet<span class="w"> </span>HubVnet<span class="w"> </span>--allow-vnet-access
</span><span id="__span-2-11"><a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>peering<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>Spoke2ToHub<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--vnet-name<span class="w"> </span>Spoke2Vnet<span class="w"> </span>--remote-vnet<span class="w"> </span>HubVnet<span class="w"> </span>--allow-vnet-access
</span><span id="__span-2-12"><a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>peering<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>Spoke3ToHub<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--vnet-name<span class="w"> </span>Spoke3Vnet<span class="w"> </span>--remote-vnet<span class="w"> </span>HubVnet<span class="w"> </span>--allow-vnet-access
</span><span id="__span-2-13"><a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a>
</span><span id="__span-2-14"><a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="c1"># Step 4: Configure routing between the Hub and the Spokes</span>
</span><span id="__span-2-15"><a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>peering<span class="w"> </span>update<span class="w"> </span>--name<span class="w"> </span>Spoke1ToHub<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--vnet-name<span class="w"> </span>Spoke1Vnet<span class="w"> </span>--set<span class="w"> </span>virtualNetworkGateway:AllowGatewayTransit<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-2-16"><a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>peering<span class="w"> </span>update<span class="w"> </span>--name<span class="w"> </span>Spoke2ToHub<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--vnet-name<span class="w"> </span>Spoke2Vnet<span class="w"> </span>--set<span class="w"> </span>virtualNetworkGateway:AllowGatewayTransit<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-2-17"><a href="#__codelineno-2-17" id="__codelineno-2-17" name="__codelineno-2-17"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>peering<span class="w"> </span>update<span class="w"> </span>--name<span class="w"> </span>Spoke3ToHub<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--vnet-name<span class="w"> </span>Spoke3Vnet<span class="w"> </span>--set<span class="w"> </span>virtualNetworkGateway:AllowGatewayTransit<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-2-18"><a href="#__codelineno-2-18" id="__codelineno-2-18" name="__codelineno-2-18"></a>
</span><span id="__span-2-19"><a href="#__codelineno-2-19" id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="c1"># Step 5: Configure routing in the Hub</span>
</span><span id="__span-2-20"><a href="#__codelineno-2-20" id="__codelineno-2-20" name="__codelineno-2-20"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>peering<span class="w"> </span>update<span class="w"> </span>--name<span class="w"> </span>HubToSpoke1<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--vnet-name<span class="w"> </span>HubVnet<span class="w"> </span>--set<span class="w"> </span>virtualNetworkGateway:UseRemoteGateways<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-2-21"><a href="#__codelineno-2-21" id="__codelineno-2-21" name="__codelineno-2-21"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>peering<span class="w"> </span>update<span class="w"> </span>--name<span class="w"> </span>HubToSpoke2<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--vnet-name<span class="w"> </span>HubVnet<span class="w"> </span>--set<span class="w"> </span>virtualNetworkGateway:UseRemoteGateways<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-2-22"><a href="#__codelineno-2-22" id="__codelineno-2-22" name="__codelineno-2-22"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>peering<span class="w"> </span>update<span class="w"> </span>--name<span class="w"> </span>HubToSpoke3<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--vnet-name<span class="w"> </span>HubVnet<span class="w"> </span>--set<span class="w"> </span>virtualNetworkGateway:UseRemoteGateways<span class="o">=</span><span class="nb">true</span>
</span></code></pre></div>
<h3 id="variant-of-the-hub-and-spoke-topology"><a class="toclink" href="../../19/azure-network-hub-and-spoke-topology/#variant-of-the-hub-and-spoke-topology">Variant of the Hub and Spoke Topology</a></h3>
<p>A variant of the Hub and Spoke topology is the Hub and Spoke with peering between spokes that is generally used to allow direct connectivity between the Spoke networks without going through the Hub. This can be useful in scenarios where direct connectivity between the Spoke networks is required, such as data replication or application communication.</p>
<p></p><pre class="mermaid"><code>graph TD
    HUB(("Central Hub"))
    SPOKE1[Spoke1]
    SPOKE2[Spoke2]
    SPOKE3[Spoke3]
    SPOKEN[Spoke...]
    HUB --- SPOKE1
    HUB --- SPOKE2
    HUB --- SPOKE3
    HUB --- SPOKEN
    SPOKE1 -.- SPOKE2    
</code></pre>
In this case, it would be connecting the Spoke networks to each other via virtual network peering, for example:<p></p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1"># Connect Spoke1 to Spoke2</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>peering<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>Spoke1ToSpoke2<span class="w"> </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span>--vnet-name<span class="w"> </span>Spoke1Vnet<span class="w"> </span>--remote-vnet<span class="w"> </span>Spoke2Vnet<span class="w"> </span>--allow-vnet-access
</span></code></pre></div>
<h3 id="scalability-and-performance"><a class="toclink" href="../../19/azure-network-hub-and-spoke-topology/#scalability-and-performance">Scalability and Performance</a></h3>
<p>The Hub and Spoke topology in Azure is highly scalable and can handle thousands of virtual networks and subnets. In terms of performance, the Hub and Spoke topology provides efficient and low-latency connectivity between the Spoke networks and the Hub.</p>
<h3 id="security-and-compliance"><a class="toclink" href="../../19/azure-network-hub-and-spoke-topology/#security-and-compliance">Security and Compliance</a></h3>
<p>The Hub and Spoke topology in Azure provides centralized control over network security and compliance. Security and routing policies can be applied centrally at the Hub, ensuring consistency and compliance with the organization's network policies.</p>
<h3 id="monitoring-and-logging"><a class="toclink" href="../../19/azure-network-hub-and-spoke-topology/#monitoring-and-logging">Monitoring and Logging</a></h3>
<p>Use Network Watcher to monitor and diagnose network problems in the Hub and Spoke topology. Network Watcher provides the following tools: </p>
<ul>
<li>Monitoring<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/network-watcher/view-network-topology">Topology view</a> shows you the resources in your virtual network and the relationships between them.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/network-watcher/connection-monitor-overview">Connection monitor</a> allows you to monitor connectivity and latency between endpoints within and outside of Azure.</li>
</ul>
</li>
<li>Network diagnostic tools<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-ip-flow-verify-overview">IP flow verify</a> helps you detect traffic filtering issues at the virtual machine level.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-network-configuration-diagnostics-overview">NSG diagnostics</a> helps you detect traffic filtering issues at the virtual machine, virtual machine scale set, or application gateway level.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-next-hop-overview">Next hop</a> helps you verify traffic routes and detect routing issues.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-connectivity-portal">Connection troubleshoot</a> enables a one-time check of connectivity and latency between a virtual machine and the Bastion host, application gateway, or another virtual machine.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-packet-capture-overview">Packet capture</a> allows you to capture traffic from your virtual machine.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-troubleshoot-overview">VPN troubleshoot</a> runs multiple diagnostic checks on your gateways and VPN connections to help debug issues.</li>
</ul>
</li>
<li>Traffic<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-nsg-flow-logging-overview">Network security group flow logs</a> and <a href="https://docs.microsoft.com/en-us/azure/network-watcher/vnet-flow-logs-overview">virtual network flow logs</a> let you log network traffic passing through your network security groups (NSGs) and virtual networks respectively.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/network-watcher/traffic-analytics">Traffic analytics</a> processes data from your network security group flow log allowing you to visualize, query, analyze, and understand your network traffic.</li>
</ul>
</li>
</ul>
<p>Virtual network flow logs have recently been released which allows for monitoring network traffic in Azure virtual networks.</p>
<h3 id="use-cases-and-examples"><a class="toclink" href="../../19/azure-network-hub-and-spoke-topology/#use-cases-and-examples">Use Cases and Examples</a></h3>
<p>The Hub and Spoke topology is ideal for organizations that require centralized connectivity and traffic control between multiple virtual networks in Azure. For example, an organization with multiple branches or departments can use the Hub and Spoke topology to securely and efficiently connect their virtual networks in the cloud.</p>
<h3 id="best-practices-and-tips"><a class="toclink" href="../../19/azure-network-hub-and-spoke-topology/#best-practices-and-tips">Best Practices and Tips</a></h3>
<p>When implementing the Hub and Spoke topology in Azure, it is recommended to follow these best practices:</p>
<ul>
<li><strong>Security:</strong> Apply consistent security policies at the Hub and Spokes to ensure network protection.</li>
<li><strong>Resilience:</strong> Configure redundancy and resilience in the topology to ensure network availability in case of failures.</li>
<li><strong>Monitoring:</strong> Use monitoring tools like Azure Monitor to monitor network traffic and detect potential performance issues.</li>
</ul>
<h3 id="conclusion"><a class="toclink" href="../../19/azure-network-hub-and-spoke-topology/#conclusion">Conclusion</a></h3>
<p>The Hub and Spoke topology is an effective way to simplify the connectivity and management of virtual networks in Azure. It provides centralized control over network connectivity and traffic, making it easier to implement security and routing policies consistently across the network. By following the recommended best practices and tips, organizations can make the most of the Hub and Spoke topology to meet their cloud connectivity needs.</p>
<h3 id="references"><a class="toclink" href="../../19/azure-network-hub-and-spoke-topology/#references">References</a></h3>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/network-watcher/frequently-asked-questions">Network Watcher frequently asked questions (FAQ)</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/hybrid-networking/hub-spoke">Azure Topology</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-04-19 00:00:00+00:00">April 19, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../../../category/azure/">Azure</a></li>
<li class="md-meta__item">
            
              2 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-role-based-access-control-rbac"><a class="toclink" href="../../19/azure-role-based-access-control-rbac/">Azure Role-Based Access Control (RBAC)</a></h2>
<p>Azure Role-Based Access Control (RBAC) is a system that provides fine-grained access management of resources in Azure. This allows administrators to grant only the amount of access that users need to perform their jobs.</p>
<h3 id="overview"><a class="toclink" href="../../19/azure-role-based-access-control-rbac/#overview">Overview</a></h3>
<p>In Azure RBAC, you can assign roles to user accounts, groups, service principals, and managed identities at different scopes. The scope could be a management group, subscription, resource group, or a single resource. </p>
<p>Here are some key terms you should know:</p>
<ul>
<li><strong>Role</strong>: A collection of permissions. For example, the "Virtual Machine Contributor" role allows the user to create and manage virtual machines.</li>
<li><strong>Scope</strong>: The set of resources that the access applies to. </li>
<li><strong>Assignment</strong>: The act of granting a role to a security principal at a particular scope.</li>
</ul>
<h3 id="built-in-roles"><a class="toclink" href="../../19/azure-role-based-access-control-rbac/#built-in-roles">Built-in Roles</a></h3>
<p>Azure provides several built-in roles that you can assign to users, groups, service principals, and managed identities. Here are a few examples:</p>
<ul>
<li><strong>Owner</strong>: Has full access to all resources including the right to delegate access to others.</li>
<li><strong>Contributor</strong>: Can create and manage all types of Azure resources but canât grant access to others.</li>
<li><strong>Reader</strong>: Can view existing Azure resources.</li>
</ul>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">  </span><span class="nt">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Contributor"</span><span class="p">,</span>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">  </span><span class="nt">"Id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b24988ac-6180-42a0-ab88-20f7382dd24c"</span><span class="p">,</span>
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">  </span><span class="nt">"IsCustom"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-4-5"><a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">  </span><span class="nt">"Description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Lets you manage everything except access to resources."</span><span class="p">,</span>
</span><span id="__span-4-6"><a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">  </span><span class="nt">"Actions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-4-7"><a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">    </span><span class="s2">"*"</span>
</span><span id="__span-4-8"><a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-4-9"><a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">  </span><span class="nt">"NotActions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-4-10"><a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w">    </span><span class="s2">"Microsoft.Authorization/*/Delete"</span><span class="p">,</span>
</span><span id="__span-4-11"><a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="w">    </span><span class="s2">"Microsoft.Authorization/*/Write"</span><span class="p">,</span>
</span><span id="__span-4-12"><a href="#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">    </span><span class="s2">"Microsoft.Authorization/elevateAccess/Action"</span>
</span><span id="__span-4-13"><a href="#__codelineno-4-13" id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-4-14"><a href="#__codelineno-4-14" id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="w">  </span><span class="nt">"DataActions"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-4-15"><a href="#__codelineno-4-15" id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="w">  </span><span class="nt">"NotDataActions"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-4-16"><a href="#__codelineno-4-16" id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="w">  </span><span class="nt">"AssignableScopes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-4-17"><a href="#__codelineno-4-17" id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="w">    </span><span class="s2">"/"</span>
</span><span id="__span-4-18"><a href="#__codelineno-4-18" id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-4-19"><a href="#__codelineno-4-19" id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="custom-roles"><a class="toclink" href="../../19/azure-role-based-access-control-rbac/#custom-roles">Custom Roles</a></h3>
<p>If the built-in roles don't meet your specific needs, you can create your own custom roles. Just like built-in roles, you can assign permissions to custom roles and then assign those roles to users.</p>
<p></p><div class="language-json highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="p">{</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">  </span><span class="nt">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Custom Role"</span><span class="p">,</span>
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">  </span><span class="nt">"Id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00000000-0000-0000-0000-000000000000"</span><span class="p">,</span>
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">  </span><span class="nt">"IsCustom"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">  </span><span class="nt">"Description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Custom role description"</span><span class="p">,</span>
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">  </span><span class="nt">"Actions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-7"><a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">    </span><span class="s2">"Microsoft.Compute/virtualMachines/start/action"</span><span class="p">,</span>
</span><span id="__span-5-8"><a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">    </span><span class="s2">"Microsoft.Compute/virtualMachines/restart/action"</span>
</span><span id="__span-5-9"><a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-5-10"><a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">  </span><span class="nt">"NotActions"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-5-11"><a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">  </span><span class="nt">"DataActions"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-5-12"><a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">  </span><span class="nt">"NotDataActions"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-5-13"><a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">  </span><span class="nt">"AssignableScopes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-14"><a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="w">    </span><span class="s2">"/subscriptions/{subscriptionId}"</span>
</span><span id="__span-5-15"><a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-5-16"><a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="p">}</span>
</span></code></pre></div>
Custom Roles has the same structure as built-in roles:<p></p>
<ul>
<li><strong>Name</strong>: The name of the custom role.</li>
<li><strong>Id</strong>: A unique identifier for the custom role.</li>
<li><strong>IsCustom</strong>: Indicates whether the role is custom or built-in.</li>
<li><strong>Description</strong>: A description of the custom role.</li>
<li><strong>Actions</strong>: The list of actions that the role can perform.</li>
<li><strong>NotActions</strong>: The list of actions that the role cannot perform.</li>
<li><strong>DataActions</strong>: The list of data actions that the role can perform.</li>
<li><strong>NotDataActions</strong>: The list of data actions that the role cannot perform.</li>
<li><strong>AssignableScopes</strong>: The list of scopes where the role can be assigned.</li>
</ul>
<p>You can check how to create a custom role <a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles#custom-role-properties">here</a> and not forget to check limitations <a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles#custom-role-limits">here</a>.</p>
<h3 id="recommendations"><a class="toclink" href="../../19/azure-role-based-access-control-rbac/#recommendations">Recommendations</a></h3>
<p>Here are some best practices for managing access with Azure RBAC:</p>
<ul>
<li><strong>Use the principle of least privilege</strong>: Only grant the permissions that users need to do their jobs.</li>
<li><strong>Use built-in roles when possible</strong>: <a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles">Built-in roles</a> are already defined and tested by Microsoft. Only create custom roles when necessary.</li>
<li><strong>Regularly review role assignments</strong>: Make sure that users have the appropriate level of access for their job. Remove any unnecessary role assignments.</li>
</ul>
<h3 id="conclusion"><a class="toclink" href="../../19/azure-role-based-access-control-rbac/#conclusion">Conclusion</a></h3>
<p>Azure RBAC is a powerful tool for managing access to your Azure resources. By understanding its core concepts and how to apply them, you can ensure that users have the appropriate level of access for their job.</p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-04-18 00:00:00+00:00">April 18, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../../../category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              3 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="kusto-query-language-kql-for-azure-resource-graph"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/">Kusto Query Language (KQL) for Azure Resource Graph</a></h2>
<p>Azure Graph is a powerful tool provided by Microsoft to query data across all your Azure resources. It uses the Kusto Query Language (KQL), a read-only language similar to SQL, designed to query vast amounts of data in Azure services.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Only a subset of KQL is supported in Azure Resource Graph. For more information, see the <a href="https://learn.microsoft.com/en-us/azure/governance/resource-graph/concepts/query-language#supported-kql-language-elements">Azure Resource Graph Supported KQL Language Elements</a>.</p>
</div>
<h3 id="what-is-kql"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/#what-is-kql"><strong>What is KQL?</strong></a></h3>
<p>KQL stands for Kusto Query Language. It's a request to process data and return results. The syntax is easy to read and author, making it ideal for data exploration and ad-hoc data mining tasks.</p>
<h3 id="using-kql-with-azure-graph"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/#using-kql-with-azure-graph"><strong>Using KQL with Azure Graph</strong></a></h3>
<p>Azure Graph allows you to use KQL to create complex queries that fetch information from your Azure resources. You can filter, sort, aggregate, and join data from different resources using KQL.</p>
<p>Here's an example of how you might use KQL to query Azure Graph:</p>
<div class="language-kql highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="n">Resources</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=~</span><span class="w"> </span><span class="s">'microsoft.web/sites'</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">location</span><span class="p">,</span><span class="w"> </span><span class="n">resourceGroup</span>
</span></code></pre></div>
<p>This query retrieves all Azure Web Apps (websites) and projects their <code>name</code>, <code>location</code>, and <code>resourceGroup</code>.</p>
<h3 id="key-characteristics-of-kql"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/#key-characteristics-of-kql"><strong>Key Characteristics of KQL</strong></a></h3>
<ol>
<li><strong>Case Sensitivity</strong>: Unlike SQL, KQL is case-sensitive. So 'Name' and 'name' would be considered different identifiers.</li>
<li><strong>Schema-Free</strong>: Kusto (Azure Data Explorer) doesn't require a fixed schema, allowing storage of diverse types of data.</li>
<li><strong>Extensibility</strong>: While KQL has a wide array of functions, you can also create custom functions as per your needs.</li>
</ol>
<h3 id="common-operators-in-kql"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/#common-operators-in-kql"><strong>Common Operators in KQL</strong></a></h3>
<ul>
<li><code>|</code> : This operator creates a pipeline where the output of one command becomes the input of another.</li>
<li><code>where</code> : Filters rows based on specified conditions.</li>
<li><code>summarize</code> : Groups rows and calculates aggregate expressions.</li>
<li><code>join</code> : Combines rows from two tables based on a common column.</li>
<li><code>project</code> : Selects specific columns from the input.</li>
<li><code>extend</code> : Adds new columns to the input.</li>
<li><code>order by</code> : Sorts rows based on specified columns.</li>
</ul>
<h3 id="kql-query-examples"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/#kql-query-examples"><strong>KQL Query Examples</strong></a></h3>
<h4 id="1-list-all-azure-resources-in-a-subscription"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/#1-list-all-azure-resources-in-a-subscription"><strong>1. List all Azure resources in a subscription</strong></a></h4>
<div class="language-kql highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">Resources</span>
</span></code></pre></div>
<h4 id="2-list-all-azure-resources-in-a-resource-group"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/#2-list-all-azure-resources-in-a-resource-group"><strong>2. List all Azure resources in a resource group</strong></a></h4>
<div class="language-kql highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="n">Resources</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">resourceGroup</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">'myResourceGroup'</span>
</span></code></pre></div>
<h4 id="3-list-all-azure-resources-of-a-specific-type"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/#3-list-all-azure-resources-of-a-specific-type"><strong>3. List all Azure resources of a specific type</strong></a></h4>
<div class="language-kql highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">Resources</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=~</span><span class="w"> </span><span class="s">'Microsoft.Compute/virtualMachines'</span>
</span></code></pre></div>
<h3 id="pagination-in-kql"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/#pagination-in-kql"><strong>Pagination in KQL</strong></a></h3>
<p>KQL supports pagination using the <code>limit</code> and <code>offset</code> operators. You can use these operators to control the number of rows returned and skip a certain number of rows.</p>
<div class="language-kql highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="n">Resources</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="p">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="p">|</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mi">5</span>
</span></code></pre></div>
<p>If you exceed payload limits, you can paginate Azure Resource Graph query results with powershell:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="nv">$kqlQuery</span> <span class="p">=</span> <span class="s2">"policyResources | where type =~'Microsoft.Authorization/PolicySetDefinitions' or type =~'Microsoft.Authorization/PolicyDefinitions' | project definitionId = tolower(id), category = tostring(properties.metadata.category), definitionType = iff(type =~ 'Microsoft.Authorization/PolicysetDefinitions', 'initiative', 'policy'),PolicyDefinition=properties"</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="nv">$batchSize</span> <span class="p">=</span> <span class="n">5</span>
</span><span id="__span-11-4"><a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="nv">$skipResult</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-11-5"><a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a>
</span><span id="__span-11-6"><a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="no">[System.Collections.Generic.List[string]]</span><span class="nv">$kqlResult</span>
</span><span id="__span-11-7"><a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a>
</span><span id="__span-11-8"><a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="k">while</span> <span class="p">(</span><span class="nv">$true</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-11-9"><a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a>
</span><span id="__span-11-10"><a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a>  <span class="k">if</span> <span class="p">(</span><span class="nv">$skipResult</span> <span class="o">-gt</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-11-11"><a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a>    <span class="nv">$graphResult</span> <span class="p">=</span> <span class="nb">Search-AzGraph</span> <span class="n">-Query</span> <span class="nv">$kqlQuery</span> <span class="n">-First</span> <span class="nv">$batchSize</span> <span class="n">-SkipToken</span> <span class="nv">$graphResult</span><span class="p">.</span><span class="n">SkipToken</span>
</span><span id="__span-11-12"><a href="#__codelineno-11-12" id="__codelineno-11-12" name="__codelineno-11-12"></a>  <span class="p">}</span>
</span><span id="__span-11-13"><a href="#__codelineno-11-13" id="__codelineno-11-13" name="__codelineno-11-13"></a>  <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-11-14"><a href="#__codelineno-11-14" id="__codelineno-11-14" name="__codelineno-11-14"></a>    <span class="nv">$graphResult</span> <span class="p">=</span> <span class="nb">Search-AzGraph</span> <span class="n">-Query</span> <span class="nv">$kqlQuery</span> <span class="n">-First</span> <span class="nv">$batchSize</span>
</span><span id="__span-11-15"><a href="#__codelineno-11-15" id="__codelineno-11-15" name="__codelineno-11-15"></a>  <span class="p">}</span>
</span><span id="__span-11-16"><a href="#__codelineno-11-16" id="__codelineno-11-16" name="__codelineno-11-16"></a>
</span><span id="__span-11-17"><a href="#__codelineno-11-17" id="__codelineno-11-17" name="__codelineno-11-17"></a>  <span class="nv">$kqlResult</span> <span class="p">+=</span> <span class="nv">$graphResult</span><span class="p">.</span><span class="n">data</span>
</span><span id="__span-11-18"><a href="#__codelineno-11-18" id="__codelineno-11-18" name="__codelineno-11-18"></a>
</span><span id="__span-11-19"><a href="#__codelineno-11-19" id="__codelineno-11-19" name="__codelineno-11-19"></a>  <span class="k">if</span> <span class="p">(</span><span class="nv">$graphResult</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Count</span> <span class="o">-lt</span> <span class="nv">$batchSize</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-11-20"><a href="#__codelineno-11-20" id="__codelineno-11-20" name="__codelineno-11-20"></a>    <span class="k">break</span><span class="p">;</span>
</span><span id="__span-11-21"><a href="#__codelineno-11-21" id="__codelineno-11-21" name="__codelineno-11-21"></a>  <span class="p">}</span>
</span><span id="__span-11-22"><a href="#__codelineno-11-22" id="__codelineno-11-22" name="__codelineno-11-22"></a>  <span class="nv">$skipResult</span> <span class="p">+=</span> <span class="nv">$skipResult</span> <span class="p">+</span> <span class="nv">$batchSize</span>
</span><span id="__span-11-23"><a href="#__codelineno-11-23" id="__codelineno-11-23" name="__codelineno-11-23"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="best-practices-for-writing-kql-queries"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/#best-practices-for-writing-kql-queries"><strong>Best Practices for Writing KQL Queries</strong></a></h3>
<ol>
<li><strong>Use <code>project</code> to Select Columns</strong>: Only select the columns you need to reduce the amount of data returned.</li>
<li><strong>Use <code>where</code> to Filter Rows</strong>: Apply filters to reduce the number of rows processed.</li>
<li><strong>Use <code>summarize</code> to Aggregate Data</strong>: Aggregate data to reduce the number of rows returned.</li>
<li><strong>Use <code>join</code> to Combine Data</strong>: Combine data from different tables using the <code>join</code> operator.</li>
<li><strong>Use <code>order by</code> to Sort Data</strong>: Sort data based on specific columns to make it easier to read.</li>
</ol>
<h3 id="limitations-of-kql"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/#limitations-of-kql"><strong>Limitations of KQL</strong></a></h3>
<ol>
<li><strong>No DDL Operations</strong>: KQL doesn't support Data Definition Language (DDL) operations like creating tables or indexes.</li>
<li><strong>No DML Operations</strong>: KQL doesn't support Data Manipulation Language (DML) operations like inserting, updating, or deleting data.</li>
<li><strong>Limited Data Types</strong>: KQL has a limited set of data types compared to SQL.</li>
<li><strong>No Transactions</strong>: KQL doesn't support transactions, so you can't group multiple operations into a single transaction.</li>
</ol>
<h3 id="conclusion"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/#conclusion"><strong>Conclusion</strong></a></h3>
<p>KQL is a potent tool for querying large datasets in Azure. Its SQL-like syntax makes it accessible for anyone familiar with SQL, and its rich set of features makes it a flexible solution for a variety of data processing needs. Practice writing KQL queries to uncover valuable insights from your Azure resources!</p>
<h3 id="references"><a class="toclink" href="../../18/kusto-query-language-kql-for-azure-resource-graph/#references">References</a></h3>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/sqlcheatsheet">SQL to Kusto Query Language cheat sheet</a></li>
<li><a href="https://portal.azure.com/#view/Microsoft_OperationsManagementSuite_Workspace/LogsDemo.ReactView">Demo for play</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-04-18 00:00:00+00:00">April 18, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../../../category/azure/">Azure</a></li>
<li class="md-meta__item">
            
              3 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-role-assignment-conditions"><a class="toclink" href="../../18/azure-role-assignment-conditions/">Azure role assignment conditions</a></h2>
<p>First of all, let's understand what is ABAc (Attribute-Based Access Control) and how it can be used in Azure.</p>
<h3 id="what-is-abac"><a class="toclink" href="../../18/azure-role-assignment-conditions/#what-is-abac">What is ABAC?</a></h3>
<p>Attribute-Based Access Control (ABAC) is an access control model that uses attributes to determine access rights. In ABAC, access decisions are based on the attributes of the user, the resource, and the environment. This allows for fine-grained access control based on a wide range of attributes, such as user roles, resource types, and time of day.</p>
<p>ABAC is a flexible and scalable access control model that can be used to enforce complex access policies. It allows organizations to define access control rules based on a wide range of attributes and to adapt those rules as their needs change.</p>
<p>ABAC is build on Azure RBAC.</p>
<h3 id="what-is-azure-role-assignment-conditions"><a class="toclink" href="../../18/azure-role-assignment-conditions/#what-is-azure-role-assignment-conditions">What is Azure role assignment conditions?</a></h3>
<p>Azure role assignment conditions allow you to define conditions that must be met for a role assignment to be effective. </p>
<h3 id="how-to-configure-azure-role-assignment-conditions"><a class="toclink" href="../../18/azure-role-assignment-conditions/#how-to-configure-azure-role-assignment-conditions">How to configure Azure role assignment conditions?</a></h3>
<p>To configure Azure role assignment conditions, configure the role assignment as usual, and then click on the "Conditions" tab. Here you can define the conditions that must be met for the role assignment to be effective.</p>
<p><img alt="alt text" src="../../../09/Screenshot%202024-09-18%20111639.png"></p>
<p>Options for configuring Conditions:</p>
<ul>
<li>Allow user to only assign selected roles to selected principals (fewer privileges)</li>
<li>Allow user to assign all roles except privileged administrator roles Owner, UAA, RBAC (Recommended)</li>
<li>Allow user to assign all roles (highly privileged)</li>
</ul>
<p>The first one is the most restrictive, for example, allowing the user to only assign selected roles to selected principals. This is useful when you want to limit the privileges of a user to only a subset of roles and principals.</p>
<p>These are the options available for "Allow user to only assign selected roles to selected principals (fewer privileges)":</p>
<p><img alt="alt text" src="../../../09/Screenshot%202024-09-18%20111646.png"></p>
<ul>
<li>Constrain roles:<ul>
<li>Allow user to only assign roles you select</li>
</ul>
</li>
<li>Constrain roles and principal types:<ul>
<li>Allow user to only assign roles you select</li>
<li>Allow user to only assign these roles to principal types you select (users, groups, or service principals)</li>
</ul>
</li>
<li>Constrain roles and principals<ul>
<li>Allow user to only assign roles you select</li>
<li>Allow user to only assign these roles to principals you select</li>
<li>Allow all except specific roles</li>
<li>Allow user to assign all roles except the roles you select</li>
</ul>
</li>
</ul>
<h3 id="conclusion"><a class="toclink" href="../../18/azure-role-assignment-conditions/#conclusion">Conclusion</a></h3>
<p>Azure role assignment conditions provide a flexible and powerful way to control access to Azure resources. By defining conditions that must be met for a role assignment to be effective, you can enforce fine-grained access control policies that meet the specific needs of your organization. This allows you to limit the privileges of users, assign roles to specific principals, and control access to sensitive resources. Azure role assignment conditions are a valuable tool for organizations that need to enforce strict access control policies and protect their critical resources.</p>
<h3 id="references"><a class="toclink" href="../../18/azure-role-assignment-conditions/#references">References</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/conditions-overview">What is Azure attribute-based access control (Azure ABAC)?</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/conditions-format">Azure role assignment condition format and syntax</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/delegate-role-assignments-examples?tabs=template">Examples to delegate Azure role assignment management with conditions</a></li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-04-17 00:00:00+00:00">April 17, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../../../category/tools/">Tools</a></li>
<li class="md-meta__item">
            
              6 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="using-enterprise-azure-policy-as-code-epac"><a class="toclink" href="../../17/using-enterprise-azure-policy-as-code-epac/">Using Enterprise Azure Policy as Code (EPAC)</a></h2>
<p>In this blog post, we will show how to use Enterprise Azure Policy as Code (EPAC) to manage your Azure environment.</p>
<h3 id="use-case"><a class="toclink" href="../../17/using-enterprise-azure-policy-as-code-epac/#use-case">Use case</a></h3>
<ul>
<li>Determine desired state strategy.</li>
<li>We have some existing Azure Policies that we want to manage as code.</li>
<li>For simplicity, we will suppose that we have a unique Centralized Team that manages the policies.</li>
<li>We will use a Git repository to store the policies and the CI/CD process to deploy them.</li>
<li>We doesn't have any exclude resources in the environment.</li>
<li>How to handle Defender for Cloud Policy Assignments:</li>
<li>We will use Defender for Cloud to manage the Policy Assignments for Defender Plans when a plan is enabled.</li>
<li>EPAC will manage Defender for Cloud Security Policy Assignments at the management group level. This is the default behavior.</li>
<li>Design your CI/CD process:</li>
<li>We will use Release Flow</li>
</ul>
<h4 id="management-groups-for-enterprise-scale-landing-zone"><a class="toclink" href="../../17/using-enterprise-azure-policy-as-code-epac/#management-groups-for-enterprise-scale-landing-zone">Management Groups for Enterprise Scale Landing Zone</a></h4>
<p>This is the common structure for the Management Groups in the Enterprise Scale Landing Zone, now Accelerator Landing Zone: </p>
<pre class="mermaid"><code>    graph TD
        A[Root Management Group] --&gt; B[Intermediary-Management-Group]
        B --&gt; C[Decommissioned]
        B --&gt; D[Landing Zones]
        B --&gt; E[Platform]
        B --&gt; F[Sandboxes]
        D --&gt; G[Corp]
        D --&gt; H[Online]
        E --&gt; I[Connectivity]
        E --&gt; J[Identity]
        E --&gt; K[Management]
</code></pre>
<p>For this use case, we will use the <code>Landing Zones</code> Management Group for duplicate and old Management Group hierarchy (manage-azure-policy):</p>
<pre class="mermaid"><code>  graph TD
      A[Root Management Group] --&gt; B[epac-dev]
      B --&gt; C[dev-decommissioned]
      B --&gt; D[dev-landingzones]
      B --&gt; E[dev-platform]
      B --&gt; F[dev-sandbox]
      D --&gt; G[dev-corp]
      D --&gt; H[dev-online]
      E --&gt; I[dev-connectivity]
      E --&gt; J[dev-identity]
      E --&gt; K[dev-management]
      A[Root Management Group] --&gt; L[epac-prod]
      L --&gt; M[prod-decommissioned]
      L --&gt; N[prod-landingzones]
      L --&gt; O[prod-platform]
      L --&gt; P[prod-sandbox]
      N --&gt; Q[prod-corp]
      N --&gt; R[prod-online]
      O --&gt; S[prod-connectivity]
      O --&gt; T[prod-identity]
      O --&gt; U[prod-management]
      A[Root Management Group] --&gt; V[manage-azure-policy]

      classDef dev fill:#f90,stroke:#333,stroke-width:2px;
      classDef prod fill:#f9f,stroke:#333,stroke-width:2px;
      class dev A,B,C,D,E,F,G,H,I,J,K;
      class prod L,M,N,O,P,Q,R,S,T,U;   

</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You could also use two different tenants for the different environments, but this is not the case for this use case.</p>
</div>
<p>You can create this Management Groups hierarcly using the Azure CLI with the following commands:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="n">az</span> <span class="n">account</span> <span class="n">management-group</span> <span class="n">create</span> <span class="p">-</span><span class="n">-name</span> <span class="s2">"MyManagementGroup"</span>
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="n">az</span> <span class="n">account</span> <span class="n">management-group</span> <span class="nb">move </span><span class="p">-</span><span class="n">-name</span> <span class="s2">"ChildGroup"</span> <span class="p">-</span><span class="n">-new-parent</span> <span class="s2">"NewParentGroup"</span>
</span></code></pre></div>
<p>For the use case, we will use the following commands:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"epac-dev"</span>
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"dev-decommissioned"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"epac-dev"</span>
</span><span id="__span-23-3"><a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"dev-landingzones"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"epac-dev"</span>
</span><span id="__span-23-4"><a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"dev-platform"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"epac-dev"</span>
</span><span id="__span-23-5"><a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"dev-sandbox"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"dev-landingzones"</span>
</span><span id="__span-23-6"><a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"dev-corp"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"dev-landingzones"</span>
</span><span id="__span-23-7"><a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"dev-online"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"dev-landingzones"</span>
</span><span id="__span-23-8"><a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"dev-connectivity"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"dev-platform"</span>
</span><span id="__span-23-9"><a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"dev-identity"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"dev-platform"</span>
</span><span id="__span-23-10"><a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"dev-management"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"dev-platform"</span>
</span><span id="__span-23-11"><a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"epac-prod"</span>
</span><span id="__span-23-12"><a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"prod-decommissioned"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"epac-prod"</span>
</span><span id="__span-23-13"><a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"prod-landingzones"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"epac-prod"</span>
</span><span id="__span-23-14"><a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"prod-platform"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"epac-prod"</span>
</span><span id="__span-23-15"><a href="#__codelineno-23-15" id="__codelineno-23-15" name="__codelineno-23-15"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"prod-sandbox"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"prod-landingzones"</span>
</span><span id="__span-23-16"><a href="#__codelineno-23-16" id="__codelineno-23-16" name="__codelineno-23-16"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"prod-corp"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"prod-landingzones"</span>
</span><span id="__span-23-17"><a href="#__codelineno-23-17" id="__codelineno-23-17" name="__codelineno-23-17"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"prod-online"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"prod-landingzones"</span>
</span><span id="__span-23-18"><a href="#__codelineno-23-18" id="__codelineno-23-18" name="__codelineno-23-18"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"prod-connectivity"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"prod-platform"</span>
</span><span id="__span-23-19"><a href="#__codelineno-23-19" id="__codelineno-23-19" name="__codelineno-23-19"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"prod-identity"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"prod-platform"</span>
</span><span id="__span-23-20"><a href="#__codelineno-23-20" id="__codelineno-23-20" name="__codelineno-23-20"></a>az<span class="w"> </span>account<span class="w"> </span>management-group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">"prod-management"</span><span class="w"> </span>--parent<span class="w"> </span><span class="s2">"prod-platform"</span>
</span></code></pre></div>
<h3 id="installation"><a class="toclink" href="../../17/using-enterprise-azure-policy-as-code-epac/#installation">Installation</a></h3>
<p>To install EPAC, follow these steps:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a>    <span class="nb">Install-Module</span> <span class="n">Az</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>
</span><span id="__span-24-2"><a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a>    <span class="nb">Install-Module</span> <span class="n">EnterprisePolicyAsCode</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>
</span></code></pre></div>
<h3 id="create-an-empty-repository-in-github-and-clone-it"><a class="toclink" href="../../17/using-enterprise-azure-policy-as-code-epac/#create-an-empty-repository-in-github-and-clone-it">Create an empty repository in github and clone it</a></h3>
<p>Create a <a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/quickstart-for-repositories">repository in github</a>  and clone it</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a>    <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">user</span><span class="p">/</span><span class="n">demo-EPAC</span><span class="p">.</span><span class="n">git</span>
</span></code></pre></div>
<p>Create a branch for the feature/firstcommit</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-26-1"><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a>    <span class="n">git</span> <span class="n">checkout</span> <span class="n">-b</span> <span class="n">feature</span><span class="p">/</span><span class="n">firstcommit</span>
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>From this moment on, we will execute all commands within the repository directory.</p>
</div>
<h3 id="create-definitions"><a class="toclink" href="../../17/using-enterprise-azure-policy-as-code-epac/#create-definitions">Create Definitions</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-27-1"><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="nb">New-EPACDefinitionFolder</span> <span class="n">-DefinitionsRootFolder</span> <span class="n">Definitions</span>
</span></code></pre></div>
<p>This command creates a folder structure for the definitions. The  <code>Definitions</code>&nbsp;folder Structure is as follows:</p>
<ul>
<li>Define the Azure environment(s) in file&nbsp;<code>global-settings.jsonc</code></li>
<li>Create custom Policies (optional) in folder&nbsp;<code>policyDefinitions</code></li>
<li>Create custom Policy Sets (optional) in folder&nbsp;<code>policySetDefinitions</code></li>
<li>efine the Policy Assignments in folder&nbsp;<code>policyAssignments</code></li>
<li>Define the Policy Exemptions (optional) in folder&nbsp;<code>policyExemptions</code></li>
<li>Define Documentation in folder&nbsp;<code>policyDocumentations]</code></li>
</ul>
<h3 id="configure-global-settingsjsonc"><a class="toclink" href="../../17/using-enterprise-azure-policy-as-code-epac/#configure-global-settingsjsonc">Configure global-settings.jsonc</a></h3>
<p>global-settings.jsonc is the file where you define the Azure environment(s) that you want to manage with EPAC. The file should be located in the Definitions folder. Here is an example of the content of the file:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-28-1"><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="p">{</span>
</span><span id="__span-28-2"><a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="w">    </span><span class="nt">"$schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://raw.githubusercontent.com/Azure/enterprise-azure-policy-as-code/main/Schemas/global-settings-schema.json"</span><span class="p">,</span>
</span><span id="__span-28-3"><a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="w">    </span><span class="nt">"pacOwnerId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ff2ce5e1-da8a-4cfb-883b-aee9fbfb85d6"</span><span class="p">,</span>
</span><span id="__span-28-4"><a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="w">    </span><span class="nt">"pacEnvironments"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-28-5"><a href="#__codelineno-28-5" id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-28-6"><a href="#__codelineno-28-6" id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="w">            </span><span class="nt">"pacSelector"</span><span class="p">:</span><span class="w"> </span><span class="s2">"epac-dev"</span><span class="p">,</span>
</span><span id="__span-28-7"><a href="#__codelineno-28-7" id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="w">            </span><span class="nt">"cloud"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AzureCloud"</span><span class="p">,</span>
</span><span id="__span-28-8"><a href="#__codelineno-28-8" id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="w">            </span><span class="nt">"tenantId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e18e4e7e-d0cc-40af-9907-84923ca55499"</span><span class="p">,</span>
</span><span id="__span-28-9"><a href="#__codelineno-28-9" id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="w">            </span><span class="nt">"deploymentRootScope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/providers/Microsoft.Management/managementGroups/epac-dev"</span><span class="p">,</span>
</span><span id="__span-28-10"><a href="#__codelineno-28-10" id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="w">            </span><span class="nt">"desiredState"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-11"><a href="#__codelineno-28-11" id="__codelineno-28-11" name="__codelineno-28-11"></a><span class="w">                </span><span class="nt">"strategy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"full"</span><span class="p">,</span>
</span><span id="__span-28-12"><a href="#__codelineno-28-12" id="__codelineno-28-12" name="__codelineno-28-12"></a><span class="w">                </span><span class="nt">"keepDfcSecurityAssignments"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-28-13"><a href="#__codelineno-28-13" id="__codelineno-28-13" name="__codelineno-28-13"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-28-14"><a href="#__codelineno-28-14" id="__codelineno-28-14" name="__codelineno-28-14"></a><span class="w">            </span><span class="nt">"managedIdentityLocation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"france"</span>
</span><span id="__span-28-15"><a href="#__codelineno-28-15" id="__codelineno-28-15" name="__codelineno-28-15"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-28-16"><a href="#__codelineno-28-16" id="__codelineno-28-16" name="__codelineno-28-16"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-28-17"><a href="#__codelineno-28-17" id="__codelineno-28-17" name="__codelineno-28-17"></a><span class="w">            </span><span class="nt">"pacSelector"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tenant"</span><span class="p">,</span>
</span><span id="__span-28-18"><a href="#__codelineno-28-18" id="__codelineno-28-18" name="__codelineno-28-18"></a><span class="w">            </span><span class="nt">"cloud"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AzureCloud"</span><span class="p">,</span>
</span><span id="__span-28-19"><a href="#__codelineno-28-19" id="__codelineno-28-19" name="__codelineno-28-19"></a><span class="w">            </span><span class="nt">"tenantId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e18e4e7e-d0cc-40af-9907-84923ca55499"</span><span class="p">,</span>
</span><span id="__span-28-20"><a href="#__codelineno-28-20" id="__codelineno-28-20" name="__codelineno-28-20"></a><span class="w">            </span><span class="nt">"deploymentRootScope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/providers/Microsoft.Management/managementGroups/epac-prod"</span><span class="p">,</span>
</span><span id="__span-28-21"><a href="#__codelineno-28-21" id="__codelineno-28-21" name="__codelineno-28-21"></a><span class="w">            </span><span class="nt">"desiredState"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-22"><a href="#__codelineno-28-22" id="__codelineno-28-22" name="__codelineno-28-22"></a><span class="w">                </span><span class="nt">"strategy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"full"</span><span class="p">,</span>
</span><span id="__span-28-23"><a href="#__codelineno-28-23" id="__codelineno-28-23" name="__codelineno-28-23"></a><span class="w">                </span><span class="nt">"keepDfcSecurityAssignments"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-28-24"><a href="#__codelineno-28-24" id="__codelineno-28-24" name="__codelineno-28-24"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-28-25"><a href="#__codelineno-28-25" id="__codelineno-28-25" name="__codelineno-28-25"></a><span class="w">            </span><span class="nt">"managedIdentityLocation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"france"</span><span class="p">,</span>
</span><span id="__span-28-26"><a href="#__codelineno-28-26" id="__codelineno-28-26" name="__codelineno-28-26"></a><span class="w">            </span><span class="nt">"globalNotScopes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-28-27"><a href="#__codelineno-28-27" id="__codelineno-28-27" name="__codelineno-28-27"></a><span class="w">                </span><span class="s2">"/providers/Microsoft.Management/managementGroups/mg-Epac-Dev"</span><span class="p">,</span>
</span><span id="__span-28-28"><a href="#__codelineno-28-28" id="__codelineno-28-28" name="__codelineno-28-28"></a><span class="w">                </span><span class="s2">"/providers/Microsoft.Management/managementGroups/manage-azure-policy"</span>
</span><span id="__span-28-29"><a href="#__codelineno-28-29" id="__codelineno-28-29" name="__codelineno-28-29"></a><span class="w">            </span><span class="p">]</span>
</span><span id="__span-28-30"><a href="#__codelineno-28-30" id="__codelineno-28-30" name="__codelineno-28-30"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-28-31"><a href="#__codelineno-28-31" id="__codelineno-28-31" name="__codelineno-28-31"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-28-32"><a href="#__codelineno-28-32" id="__codelineno-28-32" name="__codelineno-28-32"></a><span class="w">            </span><span class="nt">"pacSelector"</span><span class="p">:</span><span class="w"> </span><span class="s2">"manage-azure-policy"</span><span class="p">,</span>
</span><span id="__span-28-33"><a href="#__codelineno-28-33" id="__codelineno-28-33" name="__codelineno-28-33"></a><span class="w">            </span><span class="nt">"cloud"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AzureCloud"</span><span class="p">,</span>
</span><span id="__span-28-34"><a href="#__codelineno-28-34" id="__codelineno-28-34" name="__codelineno-28-34"></a><span class="w">            </span><span class="nt">"tenantId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e18e4e7e-d0cc-40af-9907-84923ca55499"</span><span class="p">,</span>
</span><span id="__span-28-35"><a href="#__codelineno-28-35" id="__codelineno-28-35" name="__codelineno-28-35"></a><span class="w">            </span><span class="nt">"deploymentRootScope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/providers/Microsoft.Management/managementGroups/manage-azure-policy"</span><span class="p">,</span>
</span><span id="__span-28-36"><a href="#__codelineno-28-36" id="__codelineno-28-36" name="__codelineno-28-36"></a><span class="w">            </span><span class="nt">"desiredState"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-37"><a href="#__codelineno-28-37" id="__codelineno-28-37" name="__codelineno-28-37"></a><span class="w">                </span><span class="nt">"strategy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"full"</span><span class="p">,</span>
</span><span id="__span-28-38"><a href="#__codelineno-28-38" id="__codelineno-28-38" name="__codelineno-28-38"></a><span class="w">                </span><span class="nt">"keepDfcSecurityAssignments"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-28-39"><a href="#__codelineno-28-39" id="__codelineno-28-39" name="__codelineno-28-39"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-28-40"><a href="#__codelineno-28-40" id="__codelineno-28-40" name="__codelineno-28-40"></a><span class="w">            </span><span class="nt">"managedIdentityLocation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"france"</span>
</span><span id="__span-28-41"><a href="#__codelineno-28-41" id="__codelineno-28-41" name="__codelineno-28-41"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-28-42"><a href="#__codelineno-28-42" id="__codelineno-28-42" name="__codelineno-28-42"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-28-43"><a href="#__codelineno-28-43" id="__codelineno-28-43" name="__codelineno-28-43"></a>
</span><span id="__span-28-44"><a href="#__codelineno-28-44" id="__codelineno-28-44" name="__codelineno-28-44"></a><span class="p">}</span>
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The pacOwner helps to identify who or what owns an Assignment or Policy definition deployment and needs to be unique to your EPAC environment. The pacOwnerId is used to identity policy resources that are deployed by your EPAC repository, or another EPAC isntance, legacy or another solution entirely.</p>
<p>You can generate a new id with <code>New-Guid</code></p>
</div>
<h3 id="extracting-existing-policy-resources"><a class="toclink" href="../../17/using-enterprise-azure-policy-as-code-epac/#extracting-existing-policy-resources">Extracting existing Policy Resources</a></h3>
<div class="language-PowerShell highlight"><pre><span></span><code><span id="__span-29-1"><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="nb">Export-AzPolicyResources</span>
</span></code></pre></div>
<p>This command extracts all existing Policy Resources in the Azure environment(s) defined in the global-settings.jsonc file. The extracted resources are saved in the Output/Definitions folder. </p>
<p>You needs review the extracted resources and move them to the correct folder in the Definitions folder.</p>
<h3 id="syncing-alz-definitions"><a class="toclink" href="../../17/using-enterprise-azure-policy-as-code-epac/#syncing-alz-definitions">Syncing ALZ Definitions</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-30-1"><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="nb">Sync-ALZPolicies</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-CloudEnvironment</span> <span class="n">AzureCloud</span> <span class="c"># Also accepts AzureUSGovernment or AzureChinaCloud</span>
</span></code></pre></div>
<p>You can sync the ALZ Definitions manually or use a GitHub action creating <code>.github\workflows\alz-sync.yaml</code> in your repository with the following content:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-31-1"><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Sync ALZ Policy Objects</span>
</span><span id="__span-31-2"><a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a>
</span><span id="__span-31-3"><a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-31-4"><a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">  </span><span class="nt">REVIEWER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">anwather</span><span class="w"> </span><span class="c1"># Change this to your GitHub username</span>
</span><span id="__span-31-5"><a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="w">  </span><span class="nt">DefinitionsRootFolder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Definitions</span><span class="w"> </span><span class="c1"># Change this to the folder where your policy definitions are stored</span>
</span><span id="__span-31-6"><a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a>
</span><span id="__span-31-7"><a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="nt">on</span><span class="p">:</span>
</span><span id="__span-31-8"><a href="#__codelineno-31-8" id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">workflow_dispatch</span>
</span><span id="__span-31-9"><a href="#__codelineno-31-9" id="__codelineno-31-9" name="__codelineno-31-9"></a>
</span><span id="__span-31-10"><a href="#__codelineno-31-10" id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-31-11"><a href="#__codelineno-31-11" id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="w">    </span><span class="nt">sync</span><span class="p">:</span>
</span><span id="__span-31-12"><a href="#__codelineno-31-12" id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="w">        </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-31-13"><a href="#__codelineno-31-13" id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="w">        </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-31-14"><a href="#__codelineno-31-14" id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span>
</span><span id="__span-31-15"><a href="#__codelineno-31-15" id="__codelineno-31-15" name="__codelineno-31-15"></a><span class="w">          </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
</span><span id="__span-31-16"><a href="#__codelineno-31-16" id="__codelineno-31-16" name="__codelineno-31-16"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pwsh</span>
</span><span id="__span-31-17"><a href="#__codelineno-31-17" id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Required Modules</span>
</span><span id="__span-31-18"><a href="#__codelineno-31-18" id="__codelineno-31-18" name="__codelineno-31-18"></a><span class="w">          </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-31-19"><a href="#__codelineno-31-19" id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="w">            </span><span class="no">Install-Module EnterprisePolicyAsCode -Force</span>
</span><span id="__span-31-20"><a href="#__codelineno-31-20" id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="w">            </span><span class="no">Sync-ALZPolicies -DefinitionsRootFolder $env:DefinitionsRootFolder</span>
</span><span id="__span-31-21"><a href="#__codelineno-31-21" id="__codelineno-31-21" name="__codelineno-31-21"></a><span class="w">            </span><span class="no">$branchName = "caf-sync-$(Get-Date -Format yyyy-MM-dd-HH-mm)"</span>
</span><span id="__span-31-22"><a href="#__codelineno-31-22" id="__codelineno-31-22" name="__codelineno-31-22"></a><span class="w">            </span><span class="no">git config user.name "GitHub Actions Bot"</span>
</span><span id="__span-31-23"><a href="#__codelineno-31-23" id="__codelineno-31-23" name="__codelineno-31-23"></a><span class="w">            </span><span class="no">git config user.email "&lt;&gt;"</span>
</span><span id="__span-31-24"><a href="#__codelineno-31-24" id="__codelineno-31-24" name="__codelineno-31-24"></a><span class="w">            </span><span class="no">git checkout -b $branchName</span>
</span><span id="__span-31-25"><a href="#__codelineno-31-25" id="__codelineno-31-25" name="__codelineno-31-25"></a><span class="w">            </span><span class="no">git add .</span>
</span><span id="__span-31-26"><a href="#__codelineno-31-26" id="__codelineno-31-26" name="__codelineno-31-26"></a><span class="w">            </span><span class="no">git commit -m "Updated ALZ policy objects"</span>
</span><span id="__span-31-27"><a href="#__codelineno-31-27" id="__codelineno-31-27" name="__codelineno-31-27"></a><span class="w">            </span><span class="no">git push --set-upstream origin $branchName</span>
</span><span id="__span-31-28"><a href="#__codelineno-31-28" id="__codelineno-31-28" name="__codelineno-31-28"></a><span class="w">            </span><span class="no">gh pr create -B main -H $branchName --title "Verify Synced Policies - $branchName" -b "Checkout this PR branch and validate changes before merging." --reviewer $env:REVIEWER</span>
</span><span id="__span-31-29"><a href="#__codelineno-31-29" id="__codelineno-31-29" name="__codelineno-31-29"></a><span class="w">        </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-31-30"><a href="#__codelineno-31-30" id="__codelineno-31-30" name="__codelineno-31-30"></a><span class="w">            </span><span class="nt">GITHUB_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
</span></code></pre></div>
<h3 id="cicd-with-github-flow"><a class="toclink" href="../../17/using-enterprise-azure-policy-as-code-epac/#cicd-with-github-flow">CI/CD with Github Flow</a></h3>
<p>We will use the Github Flow to manage the CI/CD process. We will create a Github Actions to deploy the policies to the Azure environment(s) defined in the global-settings.jsonc file.</p>
<p><img alt="Github Flow" src="../../image.png"></p>
<p>We can open a second terminal and execute the following command to create the Github Actions in one upper level folder of our repository. This command will create the Github Actions in the <code>.github\workflows</code> folder of the repository. :</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-32-1"><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">Azure</span><span class="p">/</span><span class="n">enterprise-azure-policy</span><span class="o">-as</span><span class="n">-code</span>
</span><span id="__span-32-2"><a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="nb">cd </span><span class="n">enterprise-azure-policy</span><span class="o">-as</span><span class="n">-code</span>
</span><span id="__span-32-3"><a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="nb">New-PipelinesFromStarterKit</span> <span class="n">-StarterKitFolder</span> <span class="p">.\</span><span class="n">StarterKit</span> <span class="n">-PipelinesFolder</span> <span class="p">..\</span><span class="n">global-azure</span><span class="p">-</span><span class="n">2024-demo-EPAC</span><span class="p">\.</span><span class="n">github</span><span class="p">\</span><span class="n">workflows</span> <span class="n">-PipelineType</span> <span class="n">GitHubActions</span> <span class="n">-BranchingFlow</span> <span class="n">github</span> <span class="n">-ScriptType</span> <span class="n">Module</span> 
</span></code></pre></div>
<p>Now, we need to create some environments with secrets in the repository to use in the Github Actions. We need to create the following environments:</p>
<table>
<thead>
<tr>
<th>Environment</th>
<th>Purpose</th>
<th><a href="https://azure.github.io/enterprise-azure-policy-as-code/ci-cd-app-registrations/">App Registration</a>&nbsp;(SPN)</th>
</tr>
</thead>
<tbody>
<tr>
<td>EPAC-DEV</td>
<td>Plan and deploy to&nbsp;<code>epac-dev</code></td>
<td>ci-cd-epac-dev-owner</td>
</tr>
<tr>
<td>TENANT-PLAN</td>
<td>Build deployment plan for&nbsp;<code>tenant</code></td>
<td>ci-cd-root-policy-reader</td>
</tr>
<tr>
<td>TENANT-DEPLOY-POLICY</td>
<td>Deploy Policy resources for&nbsp;<code>tenant</code></td>
<td>ci-cd-root-policy-contributor</td>
</tr>
<tr>
<td>TENANT-DEPLOY-ROLES</td>
<td>Deploy Roles for&nbsp;<code>tenant</code></td>
<td>ci-cd-root-user-assignments</td>
</tr>
<tr>
<td>TENANT-REMEDIATE-POLICY</td>
<td>Remediate Policy resources for&nbsp;<code>tenant</code></td>
<td>ci-cd-root-policy-contributor</td>
</tr>
</tbody>
</table>
<p>You need  to <a href="https://learn.microsoft.com/en-us/entra/workload-id/workload-identity-federation-create-trust?pivots=identity-wif-apps-methods-azp#configure-a-federated-identity-credential-on-an-app">Configure a federated identity credential on an app</a> too.</p>
<h3 id="first-commit"><a class="toclink" href="../../17/using-enterprise-azure-policy-as-code-epac/#first-commit">First Commit</a></h3>
<p>Now we can commit the changes to the repository and make a pull request to the main branch.</p>
<h3 id="references"><a class="toclink" href="../../17/using-enterprise-azure-policy-as-code-epac/#references">References</a></h3>
<ul>
<li><a href="https://azure.github.io/enterprise-azure-policy-as-code/">EPAC official documentation</a>.</li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-04-17 00:00:00+00:00">April 17, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../../../category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              1 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="cambio-de-nombres-de-los-niveles-de-servicio-de-microsoft-defender-para-cloud"><a class="toclink" href="../../17/cambio-de-nombres-de-los-niveles-de-servicio-de-microsoft-defender-para-cloud/">Cambio de nombres de los niveles de servicio de Microsoft Defender para Cloud</a></h2>
<p>No es nuevo pero me gustarÃ­a recordar que Microsoft ha cambiado los nombres de los niveles de servicio de Microsoft Defender para Cloud. A continuaciÃ³n, se muestra una tabla con los nombres anteriores y los nuevos nombres de los niveles de servicio de Microsoft Defender para Cloud:</p>
<table>
<thead>
<tr>
<th>Nombre ANTERIOR del nivel de servicio&nbsp;2</th>
<th>Nombre NUEVO del nivel de servicio&nbsp;2</th>
<th>Nivel de servicio: nivel de servicio&nbsp;4 (sin cambios)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Advanced Data Security</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender para SQL</td>
</tr>
<tr>
<td>Advanced Threat Protection</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender para registros de contenedor</td>
</tr>
<tr>
<td>Advanced Threat Protection</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender para DNS</td>
</tr>
<tr>
<td>Advanced Threat Protection</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender para Key Vault</td>
</tr>
<tr>
<td>Advanced Threat Protection</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender para Kubernetes</td>
</tr>
<tr>
<td>Advanced Threat Protection</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender para MySQL</td>
</tr>
<tr>
<td>Advanced Threat Protection</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender para PostgreSQL</td>
</tr>
<tr>
<td>Advanced Threat Protection</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender para Resource Manager</td>
</tr>
<tr>
<td>Advanced Threat Protection</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender para Storage</td>
</tr>
<tr>
<td>Azure Defender</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>AdministraciÃ³n de superficie expuesta a ataques externos de Defender</td>
</tr>
<tr>
<td>Azure Defender</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender para Azure Cosmos&nbsp;DB</td>
</tr>
<tr>
<td>Azure Defender</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender para contenedores</td>
</tr>
<tr>
<td>Azure Defender</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender for MariaDB</td>
</tr>
<tr>
<td>Security Center</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender para App Service</td>
</tr>
<tr>
<td>Security Center</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>Defender para servidores</td>
</tr>
<tr>
<td>Security Center</td>
<td>Microsoft&nbsp;Defender&nbsp;for&nbsp;Cloud</td>
<td>AdministraciÃ³n de la posiciÃ³n de seguridad en la nube de Defender</td>
</tr>
</tbody>
</table>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-04-17 00:00:00+00:00">April 17, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../../../category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              2 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-policy-useful-queries"><a class="toclink" href="../../17/azure-policy-useful-queries/">Azure Policy useful queries</a></h2>
<h3 id="policy-assignments-and-information-about-each-of-its-respective-definitions"><a class="toclink" href="../../17/azure-policy-useful-queries/#policy-assignments-and-information-about-each-of-its-respective-definitions">Policy assignments and information about each of its respective definitions</a></h3>
<div class="language-kusto highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c">// Policy assignments and information about each of its respective definitions</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="c">// Gets policy assignments in your environment with the respective assignment name,definition associated, category of definition (if applicable), as well as whether the definition type is an initiative or a single policy.</span>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="n">policyResources</span>
</span><span id="__span-4-5"><a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=~</span><span class="s">'Microsoft.Authorization/PolicyAssignments'</span>
</span><span id="__span-4-6"><a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">policyAssignmentId</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="n">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)),</span><span class="w"> </span><span class="n">policyAssignmentDisplayName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tostring</span><span class="p">(</span><span class="n">properties</span><span class="err">.</span><span class="n">displayName</span><span class="p">),</span><span class="w"> </span><span class="n">policyAssignmentDefinitionId</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="n">properties</span><span class="err">.</span><span class="n">policyDefinitionId</span><span class="p">)</span>
</span><span id="__span-4-7"><a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="p">|</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">kind</span><span class="p">=</span><span class="n">leftouter</span><span class="p">(</span>
</span><span id="__span-4-8"><a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w"> </span><span class="n">policyResources</span>
</span><span id="__span-4-9"><a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=~</span><span class="s">'Microsoft.Authorization/PolicySetDefinitions'</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=~</span><span class="s">'Microsoft.Authorization/PolicyDefinitions'</span>
</span><span id="__span-4-10"><a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">definitionId</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tostring</span><span class="p">(</span><span class="n">properties</span><span class="err">.</span><span class="n">metadata</span><span class="err">.</span><span class="n">category</span><span class="p">),</span><span class="w"> </span><span class="n">definitionType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iff</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="p">=~</span><span class="w"> </span><span class="s">'Microsoft.Authorization/PolicysetDefinitions'</span><span class="p">,</span><span class="w"> </span><span class="s">'initiative'</span><span class="p">,</span><span class="w"> </span><span class="s">'policy'</span><span class="p">)</span>
</span><span id="__span-4-11"><a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="p">)</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="err">$</span><span class="n">left</span><span class="err">.</span><span class="n">policyAssignmentDefinitionId</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="err">$</span><span class="n">right</span><span class="err">.</span><span class="n">definitionId</span>
</span></code></pre></div>
<ul>
<li><a href="https://https://gist.github.com/timothywarner/8e5b6dea296f506871223883eb33059e">Original Gist</a></li>
</ul>
<h3 id="list-subscriptionid-and-subscriptionname"><a class="toclink" href="../../17/azure-policy-useful-queries/#list-subscriptionid-and-subscriptionname">List SubscriptionId and SubscriptionName</a></h3>
<div class="language-kusto highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">ResourceContainers</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=~</span><span class="w"> </span><span class="s">'microsoft.resources/subscriptions'</span>
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">subscriptionId</span><span class="p">,</span><span class="w"> </span><span class="n">subscriptionName</span><span class="p">=</span><span class="n">name</span>
</span></code></pre></div>
<h3 id="list-managementgroupid-and-managementgroupname"><a class="toclink" href="../../17/azure-policy-useful-queries/#list-managementgroupid-and-managementgroupname">List ManagementGroupId and ManagementGroupName</a></h3>
<div class="language-kusto highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="n">ResourceContainers</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=~</span><span class="w"> </span><span class="s">'microsoft.management/managementgroups'</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">mgname</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">displayName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">properties</span><span class="err">.</span><span class="n">displayName</span>
</span></code></pre></div>
<h3 id="policy-assignments-and-information-about-each-of-its-respective-definitions-displaying-the-scope-of-the-assignment-the-subscription-display-name-the-management-group-id-the-resource-group-name-the-definition-type-the-assignment-name-the-category-of-the-definition-and-the-policy-assignment-id"><a class="toclink" href="../../17/azure-policy-useful-queries/#policy-assignments-and-information-about-each-of-its-respective-definitions-displaying-the-scope-of-the-assignment-the-subscription-display-name-the-management-group-id-the-resource-group-name-the-definition-type-the-assignment-name-the-category-of-the-definition-and-the-policy-assignment-id">Policy assignments and information about each of its respective definitions displaying the scope of the assignment, the subscription display name, the management group id, the resource group name, the definition type, the assignment name, the category of the definition, and the policy assignment ID.</a></h3>
<div class="language-kusto highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">policyResources</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=~</span><span class="s">'Microsoft.Authorization/PolicyAssignments'</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">policyAssignmentId</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="n">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)),</span><span class="w"> </span><span class="n">policyAssignmentDisplayName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tostring</span><span class="p">(</span><span class="n">properties</span><span class="err">.</span><span class="n">displayName</span><span class="p">),</span><span class="w"> </span><span class="n">policyAssignmentDefinitionId</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="n">properties</span><span class="err">.</span><span class="n">policyDefinitionId</span><span class="p">),</span><span class="w"> </span><span class="n">subscriptionId</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tostring</span><span class="p">(</span><span class="n">subscriptionId</span><span class="p">),</span><span class="n">resourceGroup</span><span class="p">=</span><span class="n">tostring</span><span class="p">(</span><span class="n">resourceGroup</span><span class="p">),</span><span class="w"> </span><span class="n">AssignmentDefinition</span><span class="p">=</span><span class="n">properties</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="p">|</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">kind</span><span class="p">=</span><span class="n">leftouter</span><span class="p">(</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="n">policyResources</span>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=~</span><span class="s">'Microsoft.Authorization/PolicySetDefinitions'</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=~</span><span class="s">'Microsoft.Authorization/PolicyDefinitions'</span>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">definitionId</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tostring</span><span class="p">(</span><span class="n">properties</span><span class="err">.</span><span class="n">metadata</span><span class="err">.</span><span class="n">category</span><span class="p">),</span><span class="w"> </span><span class="n">definitionType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iff</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="p">=~</span><span class="w"> </span><span class="s">'Microsoft.Authorization/PolicysetDefinitions'</span><span class="p">,</span><span class="w"> </span><span class="s">'initiative'</span><span class="p">,</span><span class="w"> </span><span class="s">'policy'</span><span class="p">),</span><span class="n">PolicyDefinition</span><span class="p">=</span><span class="n">properties</span>
</span><span id="__span-7-8"><a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="p">)</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="err">$</span><span class="n">left</span><span class="err">.</span><span class="n">policyAssignmentDefinitionId</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="err">$</span><span class="n">right</span><span class="err">.</span><span class="n">definitionId</span>
</span><span id="__span-7-9"><a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iff</span><span class="p">(</span><span class="n">policyAssignmentId</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">'/subscriptions/'</span><span class="p">,</span><span class="w"> </span><span class="s">'Subscription'</span><span class="p">,</span><span class="w"> </span><span class="n">iff</span><span class="p">(</span><span class="n">policyAssignmentId</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">'/providers/microsoft.management/managementgroups'</span><span class="p">,</span><span class="w"> </span><span class="s">'Management Group'</span><span class="p">,</span><span class="w"> </span><span class="s">'Resource Group'</span><span class="p">))</span>
</span><span id="__span-7-10"><a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="p">|</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">kind</span><span class="p">=</span><span class="n">leftouter</span><span class="w"> </span><span class="p">(</span><span class="n">ResourceContainers</span>
</span><span id="__span-7-11"><a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=~</span><span class="w"> </span><span class="s">'microsoft.resources/subscriptions'</span>
</span><span id="__span-7-12"><a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">subscriptionId</span><span class="p">,</span><span class="w"> </span><span class="n">subscriptionName</span><span class="p">=</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="err">$</span><span class="n">left</span><span class="err">.</span><span class="n">subscriptionId</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="err">$</span><span class="n">right</span><span class="err">.</span><span class="n">subscriptionId</span>
</span><span id="__span-7-13"><a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">SubscriptionDisplayName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iff</span><span class="p">(</span><span class="n">isnotempty</span><span class="p">(</span><span class="n">subscriptionId</span><span class="p">),</span><span class="w"> </span><span class="n">subscriptionName</span><span class="p">,</span><span class="w"> </span><span class="s">''</span><span class="p">)</span>
</span><span id="__span-7-14"><a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">ManagementGroupName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iff</span><span class="p">(</span><span class="n">policyAssignmentId</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">'/providers/microsoft.management/'</span><span class="p">,</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">policyAssignmentId</span><span class="p">,</span><span class="w"> </span><span class="s">'/'</span><span class="p">)[</span><span class="mi">4</span><span class="p">],</span><span class="s">''</span><span class="p">)</span>
</span><span id="__span-7-15"><a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">resourceGroupDisplayName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iff</span><span class="p">(</span><span class="n">isnotempty</span><span class="p">(</span><span class="n">resourceGroup</span><span class="p">),</span><span class="w"> </span><span class="n">resourceGroup</span><span class="p">,</span><span class="w"> </span><span class="s">''</span><span class="p">)</span>
</span><span id="__span-7-16"><a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">ManagementGroupName</span><span class="p">,</span><span class="n">SubscriptionDisplayName</span><span class="p">,</span><span class="n">resourceGroupDisplayName</span><span class="p">,</span><span class="w"> </span><span class="n">scope</span><span class="p">,</span><span class="n">definitionType</span><span class="p">,</span><span class="n">policyAssignmentDisplayName</span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="p">,</span><span class="n">policyAssignmentId</span><span class="p">,</span><span class="w"> </span><span class="n">AssignmentDefinition</span><span class="p">,</span><span class="w"> </span><span class="n">PolicyDefinition</span>
</span></code></pre></div>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></label> Add Management Group Display Name</li>
</ul>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-04-07 00:00:00+00:00">April 7, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../../../category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              4 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/">How to use Azue ARC-enabled servers with managed identity to access to Azure Storage Account</a></h2>
<p>In this demo we will show how to use Azure ARC-enabled servers with managed identity to access to Azure Storage Account.</p>
<h3 id="prerequisites"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#prerequisites">Prerequisites</a></h3>
<ul>
<li>An Azure subscription. If you don't have an Azure subscription, create a <a href="https://azure.microsoft.com/en-us/free/">free account</a> before you begin.</li>
</ul>
<h3 id="required-permissions"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#required-permissions">Required permissions</a></h3>
<p>You'll need the following Azure built-in roles for different aspects of managing connected machines:</p>
<ul>
<li>To onboard machines, you must have the&nbsp;<a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#azure-connected-machine-onboarding">Azure Connected Machine Onboarding</a>&nbsp;or&nbsp;<a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#contributor">Contributor</a>&nbsp;role for the resource group where you're managing the servers.</li>
<li>To read, modify, and delete a machine, you must have the&nbsp;<a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#azure-connected-machine-resource-administrator">Azure Connected Machine Resource Administrator</a>&nbsp;role for the resource group.</li>
<li>To select a resource group from the drop-down list when using the&nbsp;<strong>Generate script</strong>&nbsp;method, you'll also need the&nbsp;<a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#reader">Reader</a>&nbsp;role for that resource group (or another role that includes&nbsp;<strong>Reader</strong>&nbsp;access).</li>
</ul>
<h3 id="register-azure-resource-providers"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#register-azure-resource-providers">Register Azure resource providers</a></h3>
<p>To use Azure Arc-enabled servers with managed identity, you need to register the following resource providers:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>az<span class="w"> </span>account<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--subscription<span class="w"> </span><span class="s2">"{Your Subscription Name}"</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>az<span class="w"> </span>provider<span class="w"> </span>register<span class="w"> </span>--namespace<span class="w"> </span><span class="s1">'Microsoft.HybridCompute'</span>
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>az<span class="w"> </span>provider<span class="w"> </span>register<span class="w"> </span>--namespace<span class="w"> </span><span class="s1">'Microsoft.GuestConfiguration'</span>
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a>az<span class="w"> </span>provider<span class="w"> </span>register<span class="w"> </span>--namespace<span class="w"> </span><span class="s1">'Microsoft.HybridConnectivity'</span>
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a>az<span class="w"> </span>provider<span class="w"> </span>register<span class="w"> </span>--namespace<span class="w"> </span><span class="s1">'Microsoft.AzureArcData'</span>
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Microsoft.AzureArcData (if you plan to Arc-enable SQL Servers)
Microsoft.Compute (for Azure Update Manager and automatic extension upgrades)</p>
</div>
<h3 id="networking-requirements"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#networking-requirements">Networking requirements</a></h3>
<p>The Azure Connected Machine agent for Linux and Windows communicates outbound securely to Azure Arc over TCP port 443. In this demo, we have use <a href="https://learn.microsoft.com/en-us/azure/azure-arc/servers/private-link-security#network-configuration">Azure Private Link</a>. </p>
<h3 id="azure-arc-enabled-enabled-server"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#azure-arc-enabled-enabled-server">Azure ARC-enabled enabled server</a></h3>
<p>We use  <a href="https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/day2/arc_privatelink">Use Azure Private Link to securely connect networks to Azure Arc-enabled servers</a> to achieve this.</p>
<p>Some tips:</p>
<ul>
<li>
<p>If you have any issue registerin de VM: generate a script to register a machine with Azure Arc following that instructions <a href="https://learn.microsoft.com/en-us/azure/azure-arc/servers/learn/quick-enable-hybrid-vm#generate-installation-script">here</a></p>
</li>
<li>
<p>If you have an error that says "Path C:\ProgramData\AzureConnectedMachineAgent\Log\himds.log is busy. Retrying..." you can use the following command to resolve it if you know that you are doing:</p>
</li>
</ul>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a> <span class="p">(</span><span class="nb">get-wmiobject</span> <span class="n">-class</span> <span class="n">win32_product</span> <span class="p">|</span> <span class="nb">where </span><span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">name</span> <span class="o">-like</span> <span class="s2">"Azure *"</span><span class="p">}).</span><span class="n">uninstall</span><span class="p">()</span> 
</span></code></pre></div>
- Review /etc/hosts file and add the following entries:<p></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="nv">$Env:PEname</span> <span class="p">=</span> <span class="s2">"myprivatelink"</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="nv">$Env:resourceGroup</span> <span class="p">=</span> <span class="s2">"myResourceGroup"</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="nv">$file</span> <span class="p">=</span> <span class="s2">"C:\Windows\System32\drivers\etc\hosts"</span>
</span><span id="__span-11-4"><a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a>
</span><span id="__span-11-5"><a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="nv">$gisfqdn</span> <span class="p">=</span> <span class="p">(</span><span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">dns-zone-group</span> <span class="n">list</span> <span class="p">-</span><span class="n">-endpoint-name</span> <span class="nv">$Env:PEname</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$Env:resourceGroup</span> <span class="n">-o</span> <span class="n">json</span> <span class="p">-</span><span class="n">-query</span> <span class="s1">'[0].privateDnsZoneConfigs[0].recordSets[0].fqdn'</span> <span class="n">-o</span> <span class="n">json</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.privatelink'</span><span class="p">,</span><span class="s1">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">`"</span><span class="s2">"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span>
</span><span id="__span-11-6"><a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="nv">$gisIP</span> <span class="p">=</span> <span class="p">(</span><span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">dns-zone-group</span> <span class="n">list</span> <span class="p">-</span><span class="n">-endpoint-name</span> <span class="nv">$Env:PEname</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$Env:resourceGroup</span> <span class="n">-o</span> <span class="n">json</span> <span class="p">-</span><span class="n">-query</span> <span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">privateDnsZoneConfigs</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">recordSets</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">ipAddresses</span><span class="p">[</span><span class="n">0</span><span class="p">]</span> <span class="n">-o</span> <span class="n">json</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">`"</span><span class="s2">"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span>
</span><span id="__span-11-7"><a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="nv">$hisfqdn</span> <span class="p">=</span> <span class="p">(</span><span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">dns-zone-group</span> <span class="n">list</span> <span class="p">-</span><span class="n">-endpoint-name</span> <span class="nv">$Env:PEname</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$Env:resourceGroup</span> <span class="n">-o</span> <span class="n">json</span> <span class="p">-</span><span class="n">-query</span> <span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">privateDnsZoneConfigs</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">recordSets</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">fqdn</span> <span class="n">-o</span> <span class="n">json</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.privatelink'</span><span class="p">,</span><span class="s1">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">`"</span><span class="s2">"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span>
</span><span id="__span-11-8"><a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="nv">$hisIP</span> <span class="p">=</span> <span class="p">(</span><span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">dns-zone-group</span> <span class="n">list</span> <span class="p">-</span><span class="n">-endpoint-name</span> <span class="nv">$Env:PEname</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$Env:resourceGroup</span> <span class="n">-o</span> <span class="n">json</span> <span class="p">-</span><span class="n">-query</span> <span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">privateDnsZoneConfigs</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">recordSets</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">ipAddresses</span><span class="p">[</span><span class="n">0</span><span class="p">]</span> <span class="n">-o</span> <span class="n">json</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.privatelink'</span><span class="p">,</span><span class="s1">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">`"</span><span class="s2">"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span>
</span><span id="__span-11-9"><a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="nv">$agentfqdn</span> <span class="p">=</span> <span class="p">(</span><span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">dns-zone-group</span> <span class="n">list</span> <span class="p">-</span><span class="n">-endpoint-name</span> <span class="nv">$Env:PEname</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$Env:resourceGroup</span> <span class="n">-o</span> <span class="n">json</span> <span class="p">-</span><span class="n">-query</span> <span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">privateDnsZoneConfigs</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">recordSets</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">fqdn</span> <span class="n">-o</span> <span class="n">json</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.privatelink'</span><span class="p">,</span><span class="s1">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">`"</span><span class="s2">"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span>
</span><span id="__span-11-10"><a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="nv">$agentIp</span> <span class="p">=</span> <span class="p">(</span><span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">dns-zone-group</span> <span class="n">list</span> <span class="p">-</span><span class="n">-endpoint-name</span> <span class="nv">$Env:PEname</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$Env:resourceGroup</span> <span class="n">-o</span> <span class="n">json</span> <span class="p">-</span><span class="n">-query</span> <span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">privateDnsZoneConfigs</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">recordSets</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">ipAddresses</span><span class="p">[</span><span class="n">0</span><span class="p">]</span> <span class="n">-o</span> <span class="n">json</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.privatelink'</span><span class="p">,</span><span class="s1">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">`"</span><span class="s2">"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span>
</span><span id="__span-11-11"><a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="nv">$gasfqdn</span> <span class="p">=</span> <span class="p">(</span><span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">dns-zone-group</span> <span class="n">list</span> <span class="p">-</span><span class="n">-endpoint-name</span> <span class="nv">$Env:PEname</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$Env:resourceGroup</span> <span class="n">-o</span> <span class="n">json</span> <span class="p">-</span><span class="n">-query</span> <span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">privateDnsZoneConfigs</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">recordSets</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">fqdn</span> <span class="n">-o</span> <span class="n">json</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.privatelink'</span><span class="p">,</span><span class="s1">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">`"</span><span class="s2">"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span>
</span><span id="__span-11-12"><a href="#__codelineno-11-12" id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="nv">$gasIp</span> <span class="p">=</span> <span class="p">(</span><span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">dns-zone-group</span> <span class="n">list</span> <span class="p">-</span><span class="n">-endpoint-name</span> <span class="nv">$Env:PEname</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$Env:resourceGroup</span> <span class="n">-o</span> <span class="n">json</span> <span class="p">-</span><span class="n">-query</span> <span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">privateDnsZoneConfigs</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">recordSets</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">ipAddresses</span><span class="p">[</span><span class="n">0</span><span class="p">]</span> <span class="n">-o</span> <span class="n">json</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.privatelink'</span><span class="p">,</span><span class="s1">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">`"</span><span class="s2">"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span>
</span><span id="__span-11-13"><a href="#__codelineno-11-13" id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="nv">$dpfqdn</span> <span class="p">=</span> <span class="p">(</span><span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">dns-zone-group</span> <span class="n">list</span> <span class="p">-</span><span class="n">-endpoint-name</span> <span class="nv">$Env:PEname</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$Env:resourceGroup</span> <span class="n">-o</span> <span class="n">json</span> <span class="p">-</span><span class="n">-query</span> <span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">privateDnsZoneConfigs</span><span class="p">[</span><span class="n">2</span><span class="p">].</span><span class="n">recordSets</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">fqdn</span> <span class="n">-o</span> <span class="n">json</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.privatelink'</span><span class="p">,</span><span class="s1">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">`"</span><span class="s2">"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span>
</span><span id="__span-11-14"><a href="#__codelineno-11-14" id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="nv">$dpIp</span> <span class="p">=</span> <span class="p">(</span><span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">dns-zone-group</span> <span class="n">list</span> <span class="p">-</span><span class="n">-endpoint-name</span> <span class="nv">$Env:PEname</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$Env:resourceGroup</span> <span class="n">-o</span> <span class="n">json</span> <span class="p">-</span><span class="n">-query</span> <span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">privateDnsZoneConfigs</span><span class="p">[</span><span class="n">2</span><span class="p">].</span><span class="n">recordSets</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">ipAddresses</span><span class="p">[</span><span class="n">0</span><span class="p">]</span> <span class="n">-o</span> <span class="n">json</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.privatelink'</span><span class="p">,</span><span class="s1">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">`"</span><span class="s2">"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span>
</span><span id="__span-11-15"><a href="#__codelineno-11-15" id="__codelineno-11-15" name="__codelineno-11-15"></a>
</span><span id="__span-11-16"><a href="#__codelineno-11-16" id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="nv">$hostfile</span> <span class="p">+=</span> <span class="s2">"$gisIP $gisfqdn"</span>
</span><span id="__span-11-17"><a href="#__codelineno-11-17" id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="nv">$hostfile</span> <span class="p">+=</span> <span class="s2">"$hisIP $hisfqdn"</span>
</span><span id="__span-11-18"><a href="#__codelineno-11-18" id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="nv">$hostfile</span> <span class="p">+=</span> <span class="s2">"$agentIP $agentfqdn"</span>
</span><span id="__span-11-19"><a href="#__codelineno-11-19" id="__codelineno-11-19" name="__codelineno-11-19"></a><span class="nv">$hostfile</span> <span class="p">+=</span> <span class="s2">"$gasIP $gasfqdn"</span>
</span><span id="__span-11-20"><a href="#__codelineno-11-20" id="__codelineno-11-20" name="__codelineno-11-20"></a><span class="nv">$hostfile</span> <span class="p">+=</span> <span class="s2">"$dpIP $dpfqdn"</span>
</span></code></pre></div>
<h3 id="storage-account-configuration"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#storage-account-configuration">Storage Account configuration</a></h3>
<h4 id="create-a-storage-account-with-static-website-enabled"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#create-a-storage-account-with-static-website-enabled">Create a Storage Account with static website enabled</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="nv">$resourceGroup</span> <span class="p">=</span> <span class="s2">"myResourceGroup"</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="nv">$location</span> <span class="p">=</span> <span class="s2">"eastus"</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="nv">$storageAccount</span> <span class="p">=</span> <span class="s2">"mystorageaccount"</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="nv">$indexDocument</span> <span class="p">=</span> <span class="s2">"index.html"</span>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="n">az</span> <span class="nb">group </span><span class="n">create</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$resourceGroup</span> <span class="p">-</span><span class="n">-location</span> <span class="nv">$location</span>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="n">az</span> <span class="n">storage</span> <span class="n">account</span> <span class="n">create</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$storageAccount</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$resourceGroup</span> <span class="p">-</span><span class="n">-location</span> <span class="nv">$location</span> <span class="p">-</span><span class="n">-sku</span> <span class="n">Standard_LRS</span>
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="n">az</span> <span class="n">storage</span> <span class="n">blob</span> <span class="n">service-properties</span> <span class="n">update</span> <span class="p">-</span><span class="n">-account-name</span> <span class="nv">$storageAccount</span> <span class="p">-</span><span class="n">-static-website</span> <span class="p">-</span><span class="n">-index-document</span> <span class="nv">$indexDocument</span>
</span></code></pre></div>
<h4 id="add-private-endpoints-to-the-storage-accoun-for-blob-and-static-website"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#add-private-endpoints-to-the-storage-accoun-for-blob-and-static-website">Add private endpoints to the storage accoun for blob and static website</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="nv">$resourceGroup</span> <span class="p">=</span> <span class="s2">"myResourceGroup"</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="nv">$storageAccount</span> <span class="p">=</span> <span class="s2">"mystorageaccount"</span>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="nv">$privateEndpointName</span> <span class="p">=</span> <span class="s2">"myprivatelink"</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="nv">$location</span> <span class="p">=</span> <span class="s2">"eastus"</span>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="nv">$vnetName</span> <span class="p">=</span> <span class="s2">"myVnet"</span>
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="nv">$subnetName</span> <span class="p">=</span> <span class="s2">"mySubnet"</span>
</span><span id="__span-13-7"><a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="nv">$subscriptionId</span> <span class="p">=</span> <span class="s2">"{subscription-id}"</span>
</span><span id="__span-13-8"><a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">create</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$privateEndpointName</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$resourceGroup</span> <span class="p">-</span><span class="n">-vnet-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-subnet</span> <span class="nv">$subnetName</span> <span class="p">-</span><span class="n">-private-connection-resource-id</span> <span class="s2">"/subscriptions/$subscriptionId/resourceGroups/$resourceGroup/providers/Microsoft.Storage/storageAccounts/$storageAccount"</span> <span class="p">-</span><span class="n">-group-id</span> <span class="n">blob</span> <span class="p">-</span><span class="n">-connection-name</span> <span class="nv">$privateEndpointName</span> <span class="p">-</span><span class="n">-location</span> <span class="nv">$location</span>
</span><span id="__span-13-9"><a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">create</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$privateEndpointName</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$resourceGroup</span> <span class="p">-</span><span class="n">-vnet-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-subnet</span> <span class="nv">$subnetName</span> <span class="p">-</span><span class="n">-private-connection-resource-id</span> <span class="s2">"/subscriptions/$subscriptionId/resourceGroups/$resourceGroup/providers/Microsoft.Storage/storageAccounts/$storageAccount"</span> <span class="p">-</span><span class="n">-group-id</span> <span class="n">web</span> <span class="p">-</span><span class="n">-connection-name</span> <span class="nv">$privateEndpointName</span> <span class="p">-</span><span class="n">-location</span> <span class="nv">$location</span>
</span></code></pre></div>
<h4 id="disable-public-access-to-the-storage-account-except-for-your-ip"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#disable-public-access-to-the-storage-account-except-for-your-ip">Disable public access to the storage account except for your ip</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="nv">$resourceGroup</span> <span class="p">=</span> <span class="s2">"myResourceGroup"</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="nv">$storageAccount</span> <span class="p">=</span> <span class="s2">"mystorageaccount"</span>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="nv">$ipAddress</span> <span class="p">=</span> <span class="s2">"myIpAddress"</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="n">az</span> <span class="n">storage</span> <span class="n">account</span> <span class="n">update</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$storageAccount</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$resourceGroup</span> <span class="p">-</span><span class="n">-bypass</span> <span class="s2">"AzureServices,Logging,Metrics"</span> <span class="p">-</span><span class="n">-default-action</span> <span class="n">Deny</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="n">az</span> <span class="n">storage</span> <span class="n">account</span> <span class="n">network-rule</span> <span class="n">add</span> <span class="p">-</span><span class="n">-account-name</span> <span class="nv">$storageAccount</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$resourceGroup</span> <span class="p">-</span><span class="n">-ip-address</span> <span class="nv">$ipAddress</span>
</span></code></pre></div>
<h4 id="assign-the-storage-blob-data-contributor-role-to-the-managed-identity-of-the-azure-arc-enabled-server"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#assign-the-storage-blob-data-contributor-role-to-the-managed-identity-of-the-azure-arc-enabled-server">Assign the Storage Blob Data Contributor role to the managed identity of the Azure ARC-enabled server</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nv">$resourceGroup</span> <span class="p">=</span> <span class="s2">"myResourceGroup"</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="nv">$storageAccount</span> <span class="p">=</span> <span class="s2">"mystorageaccount"</span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="nv">$serverName</span> <span class="p">=</span> <span class="s2">"myserver"</span>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="nv">$managedIdentity</span> <span class="p">=</span> <span class="n">az</span> <span class="n">resource</span> <span class="n">show</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$resourceGroup</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$serverName</span> <span class="p">-</span><span class="n">-resource-type</span> <span class="s2">"Microsoft.HybridCompute/machines"</span> <span class="p">-</span><span class="n">-query</span> <span class="s2">"identity.principalId"</span> <span class="p">-</span><span class="n">-output</span> <span class="n">tsv</span>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="n">az</span> <span class="n">role</span> <span class="n">assignment</span> <span class="n">create</span> <span class="p">-</span><span class="n">-role</span> <span class="s2">"Storage Blob Data Contributor"</span> <span class="p">-</span><span class="n">-assignee-object-id</span> <span class="nv">$managedIdentity</span> <span class="p">-</span><span class="n">-scope</span> <span class="s2">"/subscriptions/{subscription-id}/resourceGroups/$resourceGroup/providers/Microsoft.Storage/storageAccounts/$storageAccount"</span>
</span></code></pre></div>
<h3 id="download-azcopy-install-it-and-copy-something-to-web-in-the-storage-account"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#download-azcopy-install-it-and-copy-something-to-web-in-the-storage-account">Download azcopy,  install it and copy something to $web in the storage account</a></h3>
<h4 id="download-azcopy-in-the-vm"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#download-azcopy-in-the-vm">Download azcopy in the vm</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="s2">"https://aka.ms/downloadazcopy-v10-windows"</span> <span class="n">-OutFile</span> <span class="n">AzCopy</span><span class="p">.</span><span class="n">zip</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="nb">Expand-Archive</span> <span class="n">AzCopy</span><span class="p">.</span><span class="n">zip</span> <span class="n">-DestinationPath</span> <span class="nv">$env:ProgramFiles</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="nv">$env:Path</span> <span class="p">+=</span> <span class="s2">";$env:ProgramFiles\azcopy"</span>
</span></code></pre></div>
<h4 id="copy-something-to-web-in-the-storage-account"><a class="toclink" href="../../07/how-to-use-azue-arc-enabled-servers-with-managed-identity-to-access-to-azure-storage-account/#copy-something-to-web-in-the-storage-account">Copy something to $web in the storage account</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="nv">$storageAccount</span> <span class="p">=</span> <span class="s2">"mystorageaccount"</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="nv">$source</span> <span class="p">=</span> <span class="s2">"C:\Users\Public\Documents\myFile.txt"</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="nv">$destination</span> <span class="p">=</span> <span class="s2">"https://$storageAccount.blob.core.windows.net/\$web/myFile.txt"</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="n">azcopy</span> <span class="n">login</span> <span class="p">-</span><span class="n">-identity</span>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="n">azcopy</span> <span class="nb">copy </span><span class="nv">$source</span> <span class="nv">$destination</span>
</span></code></pre></div>
<p>Now you can check the file in the static website of the storage account.</p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-04-06 00:00:00+00:00">April 6, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../../../category/azure-services/">Azure Services</a></li>
<li class="md-meta__item">
            
              4 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="azure-arc"><a class="toclink" href="../../06/azure-arc/">Azure ARC</a></h2>
<p>Azure ARC is a service that extends Azure management capabilities to any infrastructure. It allows you to manage resources running on-premises, at the edge, or in multi-cloud environments using the same Azure management tools, security, and compliance policies that you use in Azure. Azure ARC enables you to manage and govern your resources consistently across all environments, providing a unified control plane for your hybrid cloud infrastructure. Let's explore how Azure ARC works and how you can leverage it to manage your resources effectively.</p>
<h3 id="azure-arc-overview"><a class="toclink" href="../../06/azure-arc/#azure-arc-overview">Azure ARC Overview</a></h3>
<p><strong>Azure ARC</strong> is a service that extends Azure management capabilities to any infrastructure. It allows you to manage resources running outside of Azure using the same Azure management tools, security, and compliance policies that you use in Azure. Azure ARC provides a unified control plane for managing resources across on-premises, multi-cloud, and edge environments, enabling you to govern your resources consistently.</p>
<p>Azure ARC enables you to:</p>
<ul>
<li><strong>Manage resources</strong>: Azure ARC allows you to manage resources running on-premises, at the edge, or in multi-cloud environments using Azure management tools like Azure Policy, Azure Monitor, and Microsoft Defender for Cloud.</li>
<li><strong>Governance</strong>: Azure ARC provides a unified control plane for managing and governing resources across all environments, enabling you to enforce security and compliance policies consistently.</li>
<li><strong>Security</strong>: Azure ARC extends Azure security capabilities to resources running outside of Azure, enabling you to protect your resources with Azure security features like Azure Security Center and Azure Defender.</li>
<li><strong>Compliance</strong>: Azure ARC enables you to enforce compliance policies across all environments, ensuring that your resources meet regulatory requirements and organizational standards.</li>
</ul>
<h3 id="azure-arc-components"><a class="toclink" href="../../06/azure-arc/#azure-arc-components">Azure ARC Components</a></h3>
<p>Azure ARC consists of the following components:</p>
<ul>
<li><strong>Azure ARC-enabled servers</strong>: Azure ARC-enabled servers allow you to manage and govern servers running on-premises or at the edge using Azure management tools. You can connect your servers to Azure ARC to manage them using Azure Policy, Azure Monitor, and Microsoft Defender for Cloud.</li>
<li><strong>Azure ARC-enabled Kubernetes clusters</strong>: Azure ARC-enabled Kubernetes clusters allow you to manage and govern Kubernetes clusters running on-premises or in other clouds using Azure management tools. You can connect your Kubernetes clusters to Azure ARC to manage them using Azure Policy, Azure Monitor, and Microsoft Defender for Cloud.</li>
<li><strong>Azure ARC-enabled data services</strong>: Azure ARC-enabled data services allow you to manage and govern data services running on-premises or in other clouds using Azure management tools. You can connect your data services to Azure ARC to manage them using Azure Policy, Azure Monitor, and Microsoft Defender for Cloud.</li>
<li><strong>SQL Server enabled by Azure Arc</strong>: SQL Server enabled by Azure Arc allows you to run SQL Server on any infrastructure using Azure management tools. You can connect your SQL Server instances to Azure ARC to manage them using Azure Policy, Azure Monitor, and Microsoft Defender for Cloud.</li>
<li><strong>Azure Arc-enabled private clouds</strong>: Azure Arc resource bridge hosts other components such as custom locations, cluster extensions, and other Azure Arc agents in order to deliver the level of functionality with the private cloud infrastructures it supports.</li>
</ul>
<h3 id="azure-arc-use-cases"><a class="toclink" href="../../06/azure-arc/#azure-arc-use-cases">Azure ARC Use Cases</a></h3>
<p>Azure ARC can be used in a variety of scenarios to manage and govern resources across on-premises, multi-cloud, and edge environments. Some common use cases for Azure ARC include:</p>
<ul>
<li><strong>Hybrid cloud management</strong>: Azure ARC enables you to manage resources consistently across on-premises, multi-cloud, and edge environments using the same Azure management tools and policies.</li>
<li><strong>Security and compliance</strong>: Azure ARC allows you to enforce security and compliance policies consistently across all environments, ensuring that your resources meet regulatory requirements and organizational standards.</li>
<li><strong>Resource governance</strong>: Azure ARC provides a unified control plane for managing and governing resources across all environments, enabling you to enforce policies and monitor resource health and performance.</li>
<li><strong>Application modernization</strong>: Azure ARC enables you to manage and govern Kubernetes clusters and data services running on-premises or in other clouds, allowing you to modernize your applications and infrastructure.</li>
</ul>
<h3 id="getting-started-with-azure-arc"><a class="toclink" href="../../06/azure-arc/#getting-started-with-azure-arc">Getting Started with Azure ARC</a></h3>
<p>To get started with Azure ARC, you need to:</p>
<ol>
<li><strong>Connect your resources</strong>: Connect your servers, Kubernetes clusters, or data services to Azure ARC using the Azure ARC agent.</li>
<li><strong>Manage your resources</strong>: Use Azure management tools like Azure Policy, Azure Monitor, and Microsoft Defender for Cloud to manage and govern your resources consistently across all environments.</li>
<li><strong>Enforce security and compliance</strong>: Use Azure security features like Microsoft Defender for Cloud to protect your resources and enforce security and compliance policies.</li>
</ol>
<p>By leveraging Azure ARC, you can manage and govern your resources consistently across on-premises, multi-cloud, and edge environments, providing a unified control plane for your hybrid cloud infrastructure. Azure ARC enables you to enforce security and compliance policies consistently, ensuring that your resources meet regulatory requirements and organizational standards. </p>
<h3 id="conclusion"><a class="toclink" href="../../06/azure-arc/#conclusion">Conclusion</a></h3>
<p>Azure ARC is a powerful service that extends Azure management capabilities to any infrastructure, enabling you to manage and govern resources consistently across on-premises, multi-cloud, and edge environments. By leveraging Azure ARC, you can enforce security and compliance policies consistently, ensuring that your resources meet regulatory requirements and organizational standards. Azure ARC provides a unified control plane for managing and governing resources, enabling you to manage your hybrid cloud infrastructure effectively.</p>
<p>For more information on Azure ARC, visit the <a href="https://docs.microsoft.com/en-us/azure/azure-arc/">Azure ARC documentation</a>.</p>
</div>
</article>
<article class="md-post md-post--excerpt">
<header class="md-post__header">
<nav class="md-post__authors md-typeset">
<span class="md-author">
<img alt="Rafael FernÃ¡ndez" src="https://avatars.githubusercontent.com/u/39990341">
</span>
</nav>
<div class="md-post__meta md-meta">
<ul class="md-meta__list">
<li class="md-meta__item">
<time datetime="2024-04-05 00:00:00+00:00">April 5, 2024</time></li>
<li class="md-meta__item">
            in
            
              <a class="md-meta__link" href="../../../../category/learning/">Learning</a></li>
<li class="md-meta__item">
            
              6 min read
            
          </li>
</ul>
</div>
</header>
<div class="md-post__content md-typeset">
<h2 id="microsoft-azure-certifications"><a class="toclink" href="../../05/microsoft-azure-certifications/">Microsoft Azure Certifications</a></h2>
<p>Microsoft offers a wide range of certifications for IT professionals who want to demonstrate their expertise in Microsoft technologies. These certifications cover a variety of topics, including Azure, Office 365, Windows Server, and more.</p>
<p>Microsoft divide this certifications into different categories, such as:</p>
<ul>
<li>Infrastructure</li>
<li>Data and AI</li>
<li>Digital app and innovation</li>
<li>Modern work</li>
<li>Business applications</li>
<li>Security</li>
</ul>
<p>Inside of each category, you can find different certification levels:</p>
<ul>
<li>Fundamentals: This level is designed for individuals who are new to the technology and want to demonstrate their knowledge of the basics.</li>
<li>Role-based: This level is designed for individuals who want to demonstrate their expertise in a specific role, such as Azure Administrator or Data Engineer.</li>
<li>Specialty: This level is designed for individuals who want to demonstrate their expertise in a specific skill,  such as Azure Virtual Desktop or Azure SAP.</li>
</ul>
<p>In the case of role-based certifications, Microsoft offers different levels of certification, such as:</p>
<ul>
<li>Associate: This level is designed for individuals who have some experience in the technology and want to demonstrate their expertise in a specific role.</li>
<li>Expert: This level is designed for individuals who have extensive experience in the technology and want to demonstrate their expertise in a specific role.</li>
</ul>
<p>Allways is a good idea to start with the fundamentals certifications, and then move on to the role-based certifications that are relevant to your career goals.</p>
<p>In the majority of cases, you need associate certifications to get expert certifications.</p>
<h3 id="azure-certifications"><a class="toclink" href="../../05/microsoft-azure-certifications/#azure-certifications"><strong>Azure Certifications</strong></a></h3>
<p>Here's a table summarizing the Azure Certifications and their description:</p>
<table>
<thead>
<tr>
<th><strong>Certification</strong></th>
<th><strong>Exam required</strong></th>
<th><strong>Description</strong></th>
<th><strong>url</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Azure Administrator Associate</strong></td>
<td>AZ-104</td>
<td>The Azure Administrator certification is designed for individuals who want to demonstrate their expertise in managing Azure resources. This certification is ideal for IT professionals who are responsible for implementing, monitoring, and maintaining Azure solutions.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-administrator</td>
</tr>
<tr>
<td><strong>Azure Developer Associate</strong></td>
<td>AZ-204</td>
<td>The Azure Developer certification is designed for individuals who want to demonstrate their expertise in developing applications on Azure. This certification is ideal for software developers who want to build and deploy cloud-based applications using Azure services.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-developer</td>
</tr>
<tr>
<td><strong>Azure Data Engineer Associate</strong></td>
<td>DP-203</td>
<td>The Azure Data Engineer certification is designed for individuals who want to demonstrate their expertise in designing and implementing data solutions on Azure. This certification is ideal for data professionals who are responsible for building and maintaining data pipelines and data warehouses on Azure.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-data-engineer</td>
</tr>
<tr>
<td><strong>Azure Database Administrator Associate</strong></td>
<td>DP-300</td>
<td>The Azure Database Administrator certification is designed for individuals who want to demonstrate their expertise in managing Azure databases. This certification is ideal for database administrators who are responsible for designing, implementing, and maintaining databases on Azure.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-database-administrator</td>
</tr>
<tr>
<td><strong>DevOps Engineer Expert</strong></td>
<td>AZ-400</td>
<td>The Azure DevOps Engineer certification is designed for individuals who want to demonstrate their expertise in implementing DevOps practices on Azure. This certification is ideal for IT professionals who are responsible for building, testing, and deploying applications using Azure DevOps.</td>
<td>https://learn.microsoft.com/en-us/certifications/devops-engineer</td>
</tr>
<tr>
<td><strong>Azure Security Engineer Associate</strong></td>
<td>AZ-500</td>
<td>The Azure Security Engineer certification is designed for individuals who want to demonstrate their expertise in securing Azure resources. This certification is ideal for IT professionals who are responsible for implementing security controls and monitoring security events on Azure.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-security-engineer</td>
</tr>
<tr>
<td><strong>Azure Network Engineer Associate</strong></td>
<td>AZ-700</td>
<td>The Azure Network Engineer certification is designed for individuals who want to demonstrate their expertise in designing and implementing network solutions on Azure. This certification is ideal for network engineers who are responsible for building and maintaining network infrastructure on Azure.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-network-engineer</td>
</tr>
<tr>
<td><strong>Windows Server Hybrid Administrator Associate</strong></td>
<td>AZ-800 AZ-801</td>
<td>The Windows Server Hybrid Administrator certification is designed for individuals who want to demonstrate their expertise in managing Windows Server resources on Azure. This certification is ideal for IT professionals who are responsible for implementing, monitoring, and maintaining Windows Server solutions on Azure.</td>
<td>https://learn.microsoft.com/en-us/certifications/windows-server-hybrid-administrator</td>
</tr>
<tr>
<td><strong>Fabric Analytics Engineer Associate</strong></td>
<td>DP-600</td>
<td>The Fabric Analytics Engineer certification is designed for individuals who want to demonstrate their expertise in designing and implementing analytics solutions on Azure. This certification is ideal for data professionals who are responsible for building and maintaining analytics solutions on Azure.</td>
<td>https://learn.microsoft.com/en-us/certifications/fabric-analytics-engineer</td>
</tr>
<tr>
<td><strong>Azure AI Engineer Associate</strong></td>
<td>AI-102</td>
<td>The Azure AI Engineer certification is designed for individuals who want to demonstrate their expertise in designing and implementing AI solutions on Azure. This certification is ideal for data scientists and AI developers who want to build and deploy AI models using Azure services.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-ai-engineer</td>
</tr>
<tr>
<td><strong>Azure Data Scientist Associate</strong></td>
<td>DP-100</td>
<td>The Azure Data Scientist certification is designed for individuals who want to demonstrate their expertise in designing and implementing data science solutions on Azure. This certification is ideal for data scientists who are responsible for building and maintaining data science solutions on Azure.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-data-scientist</td>
</tr>
<tr>
<td><strong>Azure Enterprise Data Analyst Associate</strong></td>
<td>DP-500</td>
<td>The Azure Enterprise Data Analyst certification is designed for individuals who want to demonstrate their expertise in designing and implementing data analysis solutions on Azure. This certification is ideal for data analysts who are responsible for building and maintaining data analysis solutions on Azure.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-enterprise-data-analyst</td>
</tr>
<tr>
<td><strong>Azure Solutions Architect Expert</strong></td>
<td>AZ-305</td>
<td>The Azure Solutions Architect certification is designed for individuals who want to demonstrate their expertise in designing and implementing solutions on Azure. This certification is ideal for IT professionals who are responsible for designing and implementing cloud-based solutions using Azure services.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-solutions-architect</td>
</tr>
<tr>
<td><strong>Azure for SAP Workloads Specialty</strong></td>
<td>AZ-120</td>
<td>The Azure for SAP Workloads certification is designed for individuals who want to demonstrate their expertise in deploying and managing SAP workloads on Azure. This certification is ideal for IT professionals who are responsible for implementing and maintaining SAP solutions on Azure.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-for-sap-workloads</td>
</tr>
<tr>
<td><strong>Azure Virtual Desktop Specialty</strong></td>
<td>AZ-140</td>
<td>The Azure Virtual Desktop certification is designed for individuals who want to demonstrate their expertise in deploying and managing virtual desktop solutions on Azure. This certification is ideal for IT professionals who are responsible for implementing and maintaining virtual desktop solutions on Azure.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-virtual-desktop</td>
</tr>
<tr>
<td><strong>Azure Cosmos DB Developer Specialty</strong></td>
<td>DP-420</td>
<td>The Azure Cosmos DB Developer certification is designed for individuals who want to demonstrate their expertise in developing applications that use Azure Cosmos DB. This certification is ideal for software developers who want to build and deploy applications that use Azure Cosmos DB.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-cosmos-db-developer</td>
</tr>
<tr>
<td><strong>Azure Fundamentals</strong></td>
<td>AZ-900</td>
<td>The Azure Fundamentals certification is designed for individuals who are new to Azure and want to demonstrate their knowledge of the platform. This certification is a great starting point for anyone who wants to learn more about Azure and how it can help them build and deploy applications in the cloud.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-fundamentals</td>
</tr>
<tr>
<td><strong>Azure AI Fundamentals</strong></td>
<td>AI-900</td>
<td>The Azure AI Fundamentals certification is designed for individuals who want to demonstrate their knowledge of AI concepts and how they can be applied to Azure services. This certification is ideal for anyone who wants to learn more about AI and how it can be used to build intelligent applications.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-ai-fundamentals</td>
</tr>
<tr>
<td><strong>Azure Data Fundamentals</strong></td>
<td>DP-900</td>
<td>The Azure Data Fundamentals certification is designed for individuals who want to demonstrate their knowledge of data concepts and how they can be applied to Azure services. This certification is ideal for anyone who wants to learn more about data and how it can be used to build data-driven applications.</td>
<td>https://learn.microsoft.com/en-us/certifications/azure-data-fundamentals</td>
</tr>
</tbody>
</table>
<p>You can find more information about Microsoft certifications on the <a href="https://aka.ms/CertificationsPoster">Microsoft Certification Poster</a> and in the <a href="https://learn.microsoft.com/en-us/certifications/">Microsoft Learning</a> website.</p>
</div>
</article>
<nav class="md-pagination">
<a class="md-pagination__link" href="../../">1</a> <span class="md-pagination__current">2</span> <a class="md-pagination__link" href="../3/">3</a>
</nav>
</div>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright Â© 2023-now Rafael FernÃ¡ndez
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://www.linkedin.com/in/rafaelfernandezd/" rel="noopener" target="_blank" title="LinkedIn">
<svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg>
</a>
<a class="md-social__link" href="https://github.com/rfernandezdo" rel="noopener" target="_blank" title="GitHub">
<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
<a class="md-social__link" href="https://rfernandezdo.github.io/feed_rss_created.xml" rel="noopener" target="_blank" title="RSS feed">
<svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h320c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64zm32 104c0-13.3 10.7-24 24-24 137 0 248 111 248 248 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200-13.3 0-24-10.7-24-24m0 96c0-13.3 10.7-24 24-24 83.9 0 152 68.1 152 152 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104-13.3 0-24-10.7-24-24m0 120a32 32 0 1 1 64 0 32 32 0 1 1-64 0"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-progress" data-md-component="progress" role="progressbar"></div>
<script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.sections", "navigation.top", "navigation.tracking", "toc.integrate", "toc.nested", "toc.smoothscroll", "footer", "content.code.copy", "content.code.select", "content.code.annotate", "content.tooltips"], "search": "../../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
<script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
<script src="../../../../../javascripts/tablesort.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>